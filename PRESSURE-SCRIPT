loadstring(game:HttpGet('https://roblox-obfuscator.vercel.app/api/script?c=aWYgTGlicmFyeSB0aGVuCiAgICBMaWJyYXJ5OlVubG9hZCgpCmVuZAoKbG9jYWwgTG9hZFRpY2sgPSBvcy5jbG9jaygpCgpsb2NhbCBMaWJyYXJ5IGRvCiAgICBsb2NhbCBXb3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpCiAgICBsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKICAgIGxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQogICAgbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikKICAgIGxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQogICAgbG9jYWwgQ29yZUd1aSA9IGNsb25lcmVmIGFuZCBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKSkgb3IgZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikKICAgIGxvY2FsIFR3ZWVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVHdlZW5TZXJ2aWNlIikKCiAgICBnZXRodWkgPSBnZXRodWkgb3IgZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBDb3JlR3VpCiAgICBlbmQKCiAgICBsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIENhbWVyYSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCiAgICBsb2NhbCBNb3VzZSA9IExvY2FsUGxheWVyOkdldE1vdXNlKCkKCiAgICBsb2NhbCBGcm9tUkdCID0gQ29sb3IzLmZyb21SR0IKICAgIGxvY2FsIEZyb21IU1YgPSBDb2xvcjMuZnJvbUhTVgogICAgbG9jYWwgRnJvbUhleCA9IENvbG9yMy5mcm9tSGV4CgogICAgbG9jYWwgUkdCU2VxdWVuY2UgPSBDb2xvclNlcXVlbmNlLm5ldwogICAgbG9jYWwgUkdCU2VxdWVuY2VLZXlwb2ludCA9IENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcKICAgIGxvY2FsIE51bVNlcXVlbmNlID0gTnVtYmVyU2VxdWVuY2UubmV3CiAgICBsb2NhbCBOdW1TZXF1ZW5jZUtleXBvaW50ID0gTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcKCiAgICBsb2NhbCBVRGltMk5ldyA9IFVEaW0yLm5ldwogICAgbG9jYWwgVURpbU5ldyA9IFVEaW0ubmV3CiAgICBsb2NhbCBWZWN0b3IyTmV3ID0gVmVjdG9yMi5uZXcKCiAgICBsb2NhbCBNYXRoQ2xhbXAgPSBtYXRoLmNsYW1wCiAgICBsb2NhbCBNYXRoRmxvb3IgPSBtYXRoLmZsb29yCiAgICBsb2NhbCBNYXRoQWJzID0gbWF0aC5hYnMKICAgIGxvY2FsIE1hdGhTaW4gPSBtYXRoLnNpbgoKICAgIGxvY2FsIFRhYmxlSW5zZXJ0ID0gdGFibGUuaW5zZXJ0CiAgICBsb2NhbCBUYWJsZUZpbmQgPSB0YWJsZS5maW5kCiAgICBsb2NhbCBUYWJsZVJlbW92ZSA9IHRhYmxlLnJlbW92ZQogICAgbG9jYWwgVGFibGVDb25jYXQgPSB0YWJsZS5jb25jYXQKICAgIGxvY2FsIFRhYmxlQ2xvbmUgPSB0YWJsZS5jbG9uZQogICAgbG9jYWwgVGFibGVVbnBhY2sgPSB0YWJsZS51bnBhY2sKCiAgICBsb2NhbCBTdHJpbmdGb3JtYXQgPSBzdHJpbmcuZm9ybWF0CiAgICBsb2NhbCBTdHJpbmdGaW5kID0gc3RyaW5nLmZpbmQKICAgIGxvY2FsIFN0cmluZ0dTdWIgPSBzdHJpbmcuZ3N1YgogICAgbG9jYWwgU3RyaW5nTG93ZXIgPSBzdHJpbmcubG93ZXIKICAgIGxvY2FsIFN0cmluZ0xlbiA9IHN0cmluZy5sZW4KCiAgICBsb2NhbCBJbnN0YW5jZU5ldyA9IEluc3RhbmNlLm5ldwoKICAgIGxvY2FsIFJlY3ROZXcgPSBSZWN0Lm5ldwoKICAgIGxvY2FsIElzTW9iaWxlID0gVXNlcklucHV0U2VydmljZS5Ub3VjaEVuYWJsZWQgb3IgZmFsc2UKCiAgICBMaWJyYXJ5ID0gewogICAgICAgIFRoZW1lID0gIHsgfSwKCiAgICAgICAgTWVudUtleWJpbmQgPSB0b3N0cmluZyhFbnVtLktleUNvZGUuUmlnaHRDb250cm9sKSwgCiAgICAgICAgRmxhZ3MgPSB7IH0sCgogICAgICAgIFR3ZWVuID0gewogICAgICAgICAgICBUaW1lID0gMC4yLAogICAgICAgICAgICBTdHlsZSA9IEVudW0uRWFzaW5nU3R5bGUuUXVhZCwKICAgICAgICAgICAgRGlyZWN0aW9uID0gRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0CiAgICAgICAgfSwKCiAgICAgICAgRmFkZVNwZWVkID0gMC4yLAoKICAgICAgICBGb2xkZXJzID0gewogICAgICAgICAgICBEaXJlY3RvcnkgPSAibWF0Y2hhIiwKICAgICAgICAgICAgQ29uZmlncyA9ICJtYXRjaGEvQ29uZmlncyIsCiAgICAgICAgICAgIEFzc2V0cyA9ICJtYXRjaGEvQXNzZXRzIiwKICAgICAgICB9LAoKICAgICAgICBJbWFnZXMgPSB7CiAgICAgICAgICAgIFsiU2F0dXJhdGlvbiJdID0geyJTYXR1cmF0aW9uLnBuZyIsICJodHRwczovL2dpdGh1Yi5jb20vc2FtZXRleGUwMDEvaW1hZ2VzL2Jsb2IvbWFpbi9zYXR1cmF0aW9uLnBuZz9yYXc9dHJ1ZSIgfSwKICAgICAgICAgICAgWyJWYWx1ZSJdID0geyAiVmFsdWUucG5nIiwgImh0dHBzOi8vZ2l0aHViLmNvbS9zYW1ldGV4ZTAwMS9pbWFnZXMvYmxvYi9tYWluL3ZhbHVlLnBuZz9yYXc9dHJ1ZSIgfSwKICAgICAgICAgICAgWyJIdWUiXSA9IHsgIkh1ZS5wbmciLCAiaHR0cHM6Ly9naXRodWIuY29tL3NhbWV0ZXhlMDAxL2ltYWdlcy9ibG9iL21haW4vaG9yaXpvbnRhbGh1ZS5wbmc/cmF3PXRydWUiIH0sCiAgICAgICAgICAgIFsiQ2hlY2tlcnMiXSA9IHsgIkNoZWNrZXJzLnBuZyIsICJodHRwczovL2dpdGh1Yi5jb20vc2FtZXRleGUwMDEvaW1hZ2VzL2Jsb2IvbWFpbi9jaGVja2Vycy5wbmc/cmF3PXRydWUiIH0sCiAgICAgICAgfSwKCiAgICAgICAgLS0gSWdub3JlIGJlbG93CiAgICAgICAgUGFnZXMgPSB7IH0sCiAgICAgICAgU2VjdGlvbnMgPSB7IH0sCgogICAgICAgIENvbm5lY3Rpb25zID0geyB9LAogICAgICAgIFRocmVhZHMgPSB7IH0sCgogICAgICAgIFRoZW1lTWFwID0geyB9LAogICAgICAgIFRoZW1lSXRlbXMgPSB7IH0sCgogICAgICAgIENvcGllZENvbG9yID0gbmlsLAoKICAgICAgICBPcGVuRnJhbWVzID0geyB9LAoKICAgICAgICBDdXJyZW50UGFnZSA9IG5pbCwKCiAgICAgICAgU2VhcmNoSXRlbXMgPSB7IH0sCgogICAgICAgIFNldEZsYWdzID0geyB9LAoKICAgICAgICBVbm5hbWVkQ29ubmVjdGlvbnMgPSAwLAogICAgICAgIFVubmFtZWRGbGFncyA9IDAsCgogICAgICAgIEhvbGRlciA9IG5pbCwKICAgICAgICBOb3RpZkhvbGRlciA9IG5pbCwKICAgICAgICBVbnVzZWRIb2xkZXIgPSBuaWwsCiAgICAgICAgRm9udCA9IG5pbCwKICAgICAgICBLZXlMaXN0ID0gbmlsLAoKICAgICAgICBDb2xvcnBpY2tlcnMgPSB7IH0sCiAgICB9CgogICAgTGlicmFyeS5fX2luZGV4ID0gTGlicmFyeQogICAgTGlicmFyeS5TZWN0aW9ucy5fX2luZGV4ID0gTGlicmFyeS5TZWN0aW9ucwogICAgTGlicmFyeS5QYWdlcy5fX2luZGV4ID0gTGlicmFyeS5QYWdlcwoKICAgIGxvY2FsIEtleXMgPSB7CiAgICAgICAgWyJVbmtub3duIl0gICAgICAgICAgID0gIlVua25vd24iLAogICAgICAgIFsiQmFja3NwYWNlIl0gICAgICAgICA9ICJCYWNrIiwKICAgICAgICBbIlRhYiJdICAgICAgICAgICAgICAgPSAiVGFiIiwKICAgICAgICBbIkNsZWFyIl0gICAgICAgICAgICAgPSAiQ2xlYXIiLAogICAgICAgIFsiUmV0dXJuIl0gICAgICAgICAgICA9ICJSZXR1cm4iLAogICAgICAgIFsiUGF1c2UiXSAgICAgICAgICAgICA9ICJQYXVzZSIsCiAgICAgICAgWyJFc2NhcGUiXSAgICAgICAgICAgID0gIkVzY2FwZSIsCiAgICAgICAgWyJTcGFjZSJdICAgICAgICAgICAgID0gIlNwYWNlIiwKICAgICAgICBbIlF1b3RlZERvdWJsZSJdICAgICAgPSAnIicsCiAgICAgICAgWyJIYXNoIl0gICAgICAgICAgICAgID0gIiMiLAogICAgICAgIFsiRG9sbGFyIl0gICAgICAgICAgICA9ICIkIiwKICAgICAgICBbIlBlcmNlbnQiXSAgICAgICAgICAgPSAiJSIsCiAgICAgICAgWyJBbXBlcnNhbmQiXSAgICAgICAgID0gIiYiLAogICAgICAgIFsiUXVvdGUiXSAgICAgICAgICAgICA9ICInIiwKICAgICAgICBbIkxlZnRQYXJlbnRoZXNpcyJdICAgPSAiKCIsCiAgICAgICAgWyJSaWdodFBhcmVudGhlc2lzIl0gID0gIiApIiwKICAgICAgICBbIkFzdGVyaXNrIl0gICAgICAgICAgPSAiKiIsCiAgICAgICAgWyJQbHVzIl0gICAgICAgICAgICAgID0gIisiLAogICAgICAgIFsiQ29tbWEiXSAgICAgICAgICAgICA9ICIsIiwKICAgICAgICBbIk1pbnVzIl0gICAgICAgICAgICAgPSAiLSIsCiAgICAgICAgWyJQZXJpb2QiXSAgICAgICAgICAgID0gIi4iLAogICAgICAgIFsiU2xhc2giXSAgICAgICAgICAgICA9ICJgIiwKICAgICAgICBbIlRocmVlIl0gICAgICAgICAgICAgPSAiMyIsCiAgICAgICAgWyJTZXZlbiJdICAgICAgICAgICAgID0gIjciLAogICAgICAgIFsiRWlnaHQiXSAgICAgICAgICAgICA9ICI4IiwKICAgICAgICBbIkNvbG9uIl0gICAgICAgICAgICAgPSAiOiIsCiAgICAgICAgWyJTZW1pY29sb24iXSAgICAgICAgID0gIjsiLAogICAgICAgIFsiTGVzc1RoYW4iXSAgICAgICAgICA9ICI8IiwKICAgICAgICBbIkdyZWF0ZXJUaGFuIl0gICAgICAgPSAiPiIsCiAgICAgICAgWyJRdWVzdGlvbiJdICAgICAgICAgID0gIj8iLAogICAgICAgIFsiRXF1YWxzIl0gICAgICAgICAgICA9ICI9IiwKICAgICAgICBbIkF0Il0gICAgICAgICAgICAgICAgPSAiQCIsCiAgICAgICAgWyJMZWZ0QnJhY2tldCJdICAgICAgID0gIkxlZnRCcmFja2V0IiwKICAgICAgICBbIlJpZ2h0QnJhY2tldCJdICAgICAgPSAiUmlnaHRCcmFja2VkIiwKICAgICAgICBbIkJhY2tTbGFzaCJdICAgICAgICAgPSAiQmFja1NsYXNoIiwKICAgICAgICBbIkNhcmV0Il0gICAgICAgICAgICAgPSAiXiIsCiAgICAgICAgWyJVbmRlcnNjb3JlIl0gICAgICAgID0gIl8iLAogICAgICAgIFsiQmFja3F1b3RlIl0gICAgICAgICA9ICJgIiwKICAgICAgICBbIkxlZnRDdXJseSJdICAgICAgICAgPSAieyIsCiAgICAgICAgWyJQaXBlIl0gICAgICAgICAgICAgID0gInwiLAogICAgICAgIFsiUmlnaHRDdXJseSJdICAgICAgICA9ICJ9IiwKICAgICAgICBbIlRpbGRlIl0gICAgICAgICAgICAgPSAifiIsCiAgICAgICAgWyJEZWxldGUiXSAgICAgICAgICAgID0gIkRlbGV0ZSIsCiAgICAgICAgWyJFbmQiXSAgICAgICAgICAgICAgID0gIkVuZCIsCiAgICAgICAgWyJLZXlwYWRaZXJvIl0gICAgICAgID0gIktleXBhZDAiLAogICAgICAgIFsiS2V5cGFkT25lIl0gICAgICAgICA9ICJLZXlwYWQxIiwKICAgICAgICBbIktleXBhZFR3byJdICAgICAgICAgPSAiS2V5cGFkMiIsCiAgICAgICAgWyJLZXlwYWRUaHJlZSJdICAgICAgID0gIktleXBhZDMiLAogICAgICAgIFsiS2V5cGFkRm91ciJdICAgICAgICA9ICJLZXlwYWQ0IiwKICAgICAgICBbIktleXBhZEZpdmUiXSAgICAgICAgPSAiS2V5cGFkNSIsCiAgICAgICAgWyJLZXlwYWRTaXgiXSAgICAgICAgID0gIktleXBhZDYiLAogICAgICAgIFsiS2V5cGFkU2V2ZW4iXSAgICAgICA9ICJLZXlwYWQ3IiwKICAgICAgICBbIktleXBhZEVpZ2h0Il0gICAgICAgPSAiS2V5cGFkOCIsCiAgICAgICAgWyJLZXlwYWROaW5lIl0gICAgICAgID0gIktleXBhZDkiLAogICAgICAgIFsiS2V5cGFkUGVyaW9kIl0gICAgICA9ICJLZXlwYWRQIiwKICAgICAgICBbIktleXBhZERpdmlkZSJdICAgICAgPSAiS2V5cGFkRCIsCiAgICAgICAgWyJLZXlwYWRNdWx0aXBseSJdICAgID0gIktleXBhZE0iLAogICAgICAgIFsiS2V5cGFkTWludXMiXSAgICAgICA9ICJLZXlwYWRNIiwKICAgICAgICBbIktleXBhZFBsdXMiXSAgICAgICAgPSAiS2V5cGFkUCIsCiAgICAgICAgWyJLZXlwYWRFbnRlciJdICAgICAgID0gIktleXBhZEUiLAogICAgICAgIFsiS2V5cGFkRXF1YWxzIl0gICAgICA9ICJLZXlwYWRFIiwKICAgICAgICBbIkluc2VydCJdICAgICAgICAgICAgPSAiSW5zZXJ0IiwKICAgICAgICBbIkhvbWUiXSAgICAgICAgICAgICAgPSAiSG9tZSIsCiAgICAgICAgWyJQYWdlVXAiXSAgICAgICAgICAgID0gIlBhZ2VVcCIsCiAgICAgICAgWyJQYWdlRG93biJdICAgICAgICAgID0gIlBhZ2VEb3duIiwKICAgICAgICBbIlJpZ2h0U2hpZnQiXSAgICAgICAgPSAiUmlnaHRTaGlmdCIsCiAgICAgICAgWyJMZWZ0U2hpZnQiXSAgICAgICAgID0gIkxlZnRTaGlmdCIsCiAgICAgICAgWyJSaWdodENvbnRyb2wiXSAgICAgID0gIlJpZ2h0Q29udHJvbCIsCiAgICAgICAgWyJMZWZ0Q29udHJvbCJdICAgICAgID0gIkxlZnRDb250cm9sIiwKICAgICAgICBbIkxlZnRBbHQiXSAgICAgICAgICAgPSAiTGVmdEFsdCIsCiAgICAgICAgWyJSaWdodEFsdCJdICAgICAgICAgID0gIlJpZ2h0QWx0IgogICAgfQoKICAgIGxvY2FsIFRoZW1lcyA9IHsKCQlbIlByZXNldCJdID0gewoJCQlbIkJhY2tncm91bmQiXSA9IEZyb21SR0IoMTMsIDEyLCAxNCksICAgICAgICAgICAtLSBO4buBbiBjaMOtbmg6IMSRZW4gcGhhIHhhbmggcsOqdQoJCQlbIkJvcmRlciJdID0gRnJvbVJHQigzMSwgMjgsIDMyKSwgICAgICAgICAgICAgICAtLSBWaeG7gW4KCQkJWyJJbmxpbmUiXSA9IEZyb21SR0IoMzIsIDMwLCAzNCksICAgICAgICAgICAgICAgLS0gR2nhu69hIGPDoWMgcGjhuqduIHThu60KCQkJWyJIb3ZlcmVkIEVsZW1lbnQiXSA9IEZyb21SR0IoNjIsIDUwLCA2MSksICAgICAgLS0gSG92ZXI6IG5o4bqlbiB4YW5oIHTGsMahaQoJCQlbIlBhZ2UgQmFja2dyb3VuZCJdID0gRnJvbVJHQigxOSwgMTgsIDIwKSwgICAgICAtLSBO4buBbiB0cmFuZyBwaOG7pQoJCQlbIk91dGxpbmUiXSA9IEZyb21SR0IoNjksIDYwLCA3NCksICAgICAgICAgICAgICAtLSBPdXRsaW5lCgkJCVsiRWxlbWVudCJdID0gRnJvbVJHQigzNiwgMzUsIDQyKSwgICAgICAgICAgICAgIC0tIEPDoWMga2jhu5FpIGdpYW8gZGnhu4duCgkJCVsiR3JhZGllbnQiXSA9IEZyb21SR0IoMjA3LCAxODAsIDI0MCksICAgICAgICAgIC0tIEdyYWRpZW50IG5o4bq5LCB4YW5oIHTGsMahaQoJCQlbIlRleHQiXSA9IEZyb21SR0IoMjM3LCAyMTAsIDI0NiksICAgICAgICAgICAgICAtLSBDaOG7ryBzw6FuZywgaMahaSBuZ8OgCgkJCVsiVGV4dCBTdHJva2UiXSA9IEZyb21SR0IoMCwgMCwgMCksCgkJCVsiUGxhY2Vob2xkZXIgVGV4dCJdID0gRnJvbVJHQigxNzUsIDE2MCwgMTc0KSwKCQkJWyJBY2NlbnQiXSA9IEZyb21SR0IoMTM0LCAxMTIsIDI0MikgICAgICAgICAgICAgLS0g8J+OryBNYXRjaGEgdMawxqFpCgkJfQogICAgfQoKICAgIExpYnJhcnkuVGhlbWUgPSBUYWJsZUNsb25lKFRoZW1lc1siUHJlc2V0Il0pCgogICAgLS0gRm9sZGVycwogICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMaWJyYXJ5LkZvbGRlcnMgZG8gCiAgICAgICAgaWYgbm90IGlzZm9sZGVyKFZhbHVlKSB0aGVuCiAgICAgICAgICAgIG1ha2Vmb2xkZXIoVmFsdWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBJbWFnZXMKICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTGlicmFyeS5JbWFnZXMgZG8gCiAgICAgICAgbG9jYWwgSW1hZ2VEYXRhID0gVmFsdWUKCiAgICAgICAgbG9jYWwgSW1hZ2VOYW1lID0gSW1hZ2VEYXRhWzFdCiAgICAgICAgbG9jYWwgSW1hZ2VMaW5rID0gSW1hZ2VEYXRhWzJdCiAgICAgICAgCiAgICAgICAgaWYgbm90IGlzZmlsZShMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBJbWFnZU5hbWUpIHRoZW4KICAgICAgICAgICAgd3JpdGVmaWxlKExpYnJhcnkuRm9sZGVycy5Bc3NldHMgLi4gIi8iIC4uIEltYWdlTmFtZSwgZ2FtZTpIdHRwR2V0KEltYWdlTGluaykpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBUd2VlbmluZwogICAgbG9jYWwgVHdlZW4gPSB7IH0gZG8KICAgICAgICBUd2Vlbi5fX2luZGV4ID0gVHdlZW4KCiAgICAgICAgVHdlZW4uQ3JlYXRlID0gZnVuY3Rpb24oc2VsZiwgSXRlbSwgSW5mbywgR29hbCwgSXNSYXdJdGVtKQogICAgICAgICAgICBJdGVtID0gSXNSYXdJdGVtIGFuZCBJdGVtIG9yIEl0ZW0uSW5zdGFuY2UKICAgICAgICAgICAgSW5mbyA9IEluZm8gb3IgVHdlZW5JbmZvLm5ldyhMaWJyYXJ5LlR3ZWVuLlRpbWUsIExpYnJhcnkuVHdlZW4uU3R5bGUsIExpYnJhcnkuVHdlZW4uRGlyZWN0aW9uKQoKICAgICAgICAgICAgbG9jYWwgTmV3VHdlZW4gPSB7CiAgICAgICAgICAgICAgICBUd2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUoSXRlbSwgSW5mbywgR29hbCksCiAgICAgICAgICAgICAgICBJbmZvID0gSW5mbywKICAgICAgICAgICAgICAgIEdvYWwgPSBHb2FsLAogICAgICAgICAgICAgICAgSXRlbSA9IEl0ZW0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgTmV3VHdlZW4uVHdlZW46UGxheSgpCgogICAgICAgICAgICBzZXRtZXRhdGFibGUoTmV3VHdlZW4sIFR3ZWVuKQoKICAgICAgICAgICAgcmV0dXJuIE5ld1R3ZWVuCiAgICAgICAgZW5kCgogICAgICAgIFR3ZWVuLkdldFByb3BlcnR5ID0gZnVuY3Rpb24oc2VsZiwgSXRlbSkKICAgICAgICAgICAgSXRlbSA9IEl0ZW0gb3Igc2VsZi5JdGVtIAoKICAgICAgICAgICAgaWYgSXRlbTpJc0EoIkZyYW1lIikgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHsgIkJhY2tncm91bmRUcmFuc3BhcmVuY3kiIH0KICAgICAgICAgICAgZWxzZWlmIEl0ZW06SXNBKCJUZXh0TGFiZWwiKSBvciBJdGVtOklzQSgiVGV4dEJ1dHRvbiIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB7ICJUZXh0VHJhbnNwYXJlbmN5IiwgIkJhY2tncm91bmRUcmFuc3BhcmVuY3kiIH0KICAgICAgICAgICAgZWxzZWlmIEl0ZW06SXNBKCJJbWFnZUxhYmVsIikgb3IgSXRlbTpJc0EoIkltYWdlQnV0dG9uIikgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIHsgIkJhY2tncm91bmRUcmFuc3BhcmVuY3kiLCAiSW1hZ2VUcmFuc3BhcmVuY3kiIH0KICAgICAgICAgICAgZWxzZWlmIEl0ZW06SXNBKCJTY3JvbGxpbmdGcmFtZSIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB7ICJCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5IiwgIlNjcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5IiB9CiAgICAgICAgICAgIGVsc2VpZiBJdGVtOklzQSgiVGV4dEJveCIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiB7ICJUZXh0VHJhbnNwYXJlbmN5IiwgIkJhY2tncm91bmRUcmFuc3BhcmVuY3kiIH0KICAgICAgICAgICAgZWxzZWlmIEl0ZW06SXNBKCJVSVN0cm9rZSIpIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4geyAiVHJhbnNwYXJlbmN5IiB9CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBUd2Vlbi5GYWRlSXRlbSA9IGZ1bmN0aW9uKHNlbGYsIEl0ZW0sIFByb3BlcnR5LCBWaXNpYmlsaXR5LCBTcGVlZCkKICAgICAgICAgICAgbG9jYWwgSXRlbSA9IEl0ZW0gb3Igc2VsZi5JdGVtIAoKICAgICAgICAgICAgbG9jYWwgT2xkVHJhbnNwYXJlbmN5ID0gSXRlbVtQcm9wZXJ0eV0KICAgICAgICAgICAgSXRlbVtQcm9wZXJ0eV0gPSBWaXNpYmlsaXR5IGFuZCAxIG9yIE9sZFRyYW5zcGFyZW5jeQoKICAgICAgICAgICAgbG9jYWwgTmV3VHdlZW4gPSBUd2VlbjpDcmVhdGUoSXRlbSwgVHdlZW5JbmZvLm5ldyhTcGVlZCBvciBMaWJyYXJ5LlR3ZWVuLlRpbWUsIExpYnJhcnkuVHdlZW4uU3R5bGUsIExpYnJhcnkuVHdlZW4uRGlyZWN0aW9uKSwgewogICAgICAgICAgICAgICAgW1Byb3BlcnR5XSA9IFZpc2liaWxpdHkgYW5kIE9sZFRyYW5zcGFyZW5jeSBvciAxCiAgICAgICAgICAgIH0sIHRydWUpCgogICAgICAgICAgICBMaWJyYXJ5OkNvbm5lY3QoTmV3VHdlZW4uVHdlZW4uQ29tcGxldGVkLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgVmlzaWJpbGl0eSB0aGVuIAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgSXRlbVtQcm9wZXJ0eV0gPSBPbGRUcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICByZXR1cm4gTmV3VHdlZW4KICAgICAgICBlbmQKCiAgICAgICAgVHdlZW4uR2V0ID0gZnVuY3Rpb24oc2VsZikKICAgICAgICAgICAgaWYgbm90IHNlbGYuVHdlZW4gdGhlbiAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBzZWxmLlR3ZWVuLCBzZWxmLkluZm8sIHNlbGYuR29hbAogICAgICAgIGVuZAoKICAgICAgICBUd2Vlbi5QYXVzZSA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLlR3ZWVuIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBzZWxmLlR3ZWVuOlBhdXNlKCkKICAgICAgICBlbmQKCiAgICAgICAgVHdlZW4uUGxheSA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLlR3ZWVuIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBzZWxmLlR3ZWVuOlBsYXkoKQogICAgICAgIGVuZAoKICAgICAgICBUd2Vlbi5DbGVhbiA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLlR3ZWVuIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBUd2VlbjpQYXVzZSgpCiAgICAgICAgICAgIHNlbGYgPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIEluc3RhbmNlcwogICAgbG9jYWwgSW5zdGFuY2VzID0geyB9IGRvCiAgICAgICAgSW5zdGFuY2VzLl9faW5kZXggPSBJbnN0YW5jZXMKCiAgICAgICAgSW5zdGFuY2VzLkNyZWF0ZSA9IGZ1bmN0aW9uKHNlbGYsIENsYXNzLCBQcm9wZXJ0aWVzKQogICAgICAgICAgICBsb2NhbCBOZXdJdGVtID0gewogICAgICAgICAgICAgICAgSW5zdGFuY2UgPSBJbnN0YW5jZU5ldyhDbGFzcyksCiAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzID0gUHJvcGVydGllcywKICAgICAgICAgICAgICAgIENsYXNzID0gQ2xhc3MKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2V0bWV0YXRhYmxlKE5ld0l0ZW0sIEluc3RhbmNlcykKCiAgICAgICAgICAgIGZvciBQcm9wZXJ0eSwgVmFsdWUgaW4gTmV3SXRlbS5Qcm9wZXJ0aWVzIGRvCiAgICAgICAgICAgICAgICBOZXdJdGVtLkluc3RhbmNlW1Byb3BlcnR5XSA9IFZhbHVlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIE5ld0l0ZW0KICAgICAgICBlbmQKCiAgICAgICAgSW5zdGFuY2VzLkZhZGVJdGVtID0gZnVuY3Rpb24oc2VsZiwgVmlzaWJpbGl0eSwgU3BlZWQpCiAgICAgICAgICAgIGxvY2FsIEl0ZW0gPSBzZWxmLkluc3RhbmNlCgogICAgICAgICAgICBpZiBWaXNpYmlsaXR5ID09IHRydWUgdGhlbiAKICAgICAgICAgICAgICAgIEl0ZW0uVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEZXNjZW5kYW50cyA9IEl0ZW06R2V0RGVzY2VuZGFudHMoKQogICAgICAgICAgICBUYWJsZUluc2VydChEZXNjZW5kYW50cywgSXRlbSkKCiAgICAgICAgICAgIGxvY2FsIE5ld1R3ZWVuCgogICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERlc2NlbmRhbnRzIGRvIAogICAgICAgICAgICAgICAgbG9jYWwgVHJhbnNwYXJlbmN5UHJvcGVydHkgPSBUd2VlbjpHZXRQcm9wZXJ0eShWYWx1ZSkKCiAgICAgICAgICAgICAgICBpZiBub3QgVHJhbnNwYXJlbmN5UHJvcGVydHkgdGhlbiAKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgdHlwZShUcmFuc3BhcmVuY3lQcm9wZXJ0eSkgPT0gInRhYmxlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIGZvciBfLCBQcm9wZXJ0eSBpbiBUcmFuc3BhcmVuY3lQcm9wZXJ0eSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgTmV3VHdlZW4gPSBUd2VlbjpGYWRlSXRlbShWYWx1ZSwgUHJvcGVydHksIG5vdCBWaXNpYmlsaXR5LCBTcGVlZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBOZXdUd2VlbiA9IFR3ZWVuOkZhZGVJdGVtKFZhbHVlLCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSwgbm90IFZpc2liaWxpdHksIFNwZWVkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuQWRkVG9UaGVtZSA9IGZ1bmN0aW9uKHNlbGYsIFByb3BlcnRpZXMpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBMaWJyYXJ5OkFkZFRvVGhlbWUoc2VsZiwgUHJvcGVydGllcykKICAgICAgICBlbmQKCiAgICAgICAgSW5zdGFuY2VzLkNoYW5nZUl0ZW1UaGVtZSA9IGZ1bmN0aW9uKHNlbGYsIFByb3BlcnRpZXMpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBMaWJyYXJ5OkNoYW5nZUl0ZW1UaGVtZShzZWxmLCBQcm9wZXJ0aWVzKQogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuQ29ubmVjdCA9IGZ1bmN0aW9uKHNlbGYsIEV2ZW50LCBDYWxsYmFjaywgTmFtZSkKICAgICAgICAgICAgaWYgbm90IHNlbGYuSW5zdGFuY2UgdGhlbiAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlW0V2ZW50XSB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgSXNNb2JpbGUgdGhlbgogICAgICAgICAgICAgICAgaWYgRXZlbnQgPT0gIk1vdXNlQnV0dG9uMURvd24iIG9yIEV2ZW50ID09ICJNb3VzZUJ1dHRvbjFDbGljayIgdGhlbgogICAgICAgICAgICAgICAgICAgIEV2ZW50ID0gIlRvdWNoVGFwIgogICAgICAgICAgICAgICAgZWxzZWlmIEV2ZW50ID09ICJNb3VzZUJ1dHRvbjJEb3duIiBvciBFdmVudCA9PSAiTW91c2VCdXR0b24yQ2xpY2siIHRoZW4KICAgICAgICAgICAgICAgICAgICBFdmVudCA9ICJUb3VjaExvbmdQcmVzcyIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBMaWJyYXJ5OkNvbm5lY3Qoc2VsZi5JbnN0YW5jZVtFdmVudF0sIENhbGxiYWNrLCBOYW1lKQogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuVHdlZW4gPSBmdW5jdGlvbihzZWxmLCBJbmZvLCBHb2FsKQogICAgICAgICAgICBpZiBub3Qgc2VsZi5JbnN0YW5jZSB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIFR3ZWVuOkNyZWF0ZShzZWxmLCBJbmZvLCBHb2FsKQogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuRGlzY29ubmVjdCA9IGZ1bmN0aW9uKHNlbGYsIE5hbWUpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gTGlicmFyeTpEaXNjb25uZWN0KE5hbWUpCiAgICAgICAgZW5kCgogICAgICAgIEluc3RhbmNlcy5DbGVhbiA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBzZWxmLkluc3RhbmNlOkRlc3Ryb3koKQogICAgICAgICAgICBzZWxmID0gbmlsCiAgICAgICAgZW5kCgogICAgICAgIEluc3RhbmNlcy5NYWtlRHJhZ2dhYmxlID0gZnVuY3Rpb24oc2VsZikKICAgICAgICAgICAgaWYgbm90IHNlbGYuSW5zdGFuY2UgdGhlbiAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIEd1aSA9IHNlbGYuSW5zdGFuY2UKCiAgICAgICAgICAgIGxvY2FsIERyYWdnaW5nID0gZmFsc2UgCiAgICAgICAgICAgIGxvY2FsIERyYWdTdGFydAogICAgICAgICAgICBsb2NhbCBTdGFydFBvc2l0aW9uIAoKICAgICAgICAgICAgbG9jYWwgU2V0ID0gZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBsb2NhbCBEcmFnRGVsdGEgPSBJbnB1dC5Qb3NpdGlvbiAtIERyYWdTdGFydAogICAgICAgICAgICAgICAgc2VsZjpUd2VlbihUd2VlbkluZm8ubmV3KDAuMTYsIEVudW0uRWFzaW5nU3R5bGUuUXVhcnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVEaW0yTmV3KFN0YXJ0UG9zaXRpb24uWC5TY2FsZSwgU3RhcnRQb3NpdGlvbi5YLk9mZnNldCArIERyYWdEZWx0YS5YLCBTdGFydFBvc2l0aW9uLlkuU2NhbGUsIFN0YXJ0UG9zaXRpb24uWS5PZmZzZXQgKyBEcmFnRGVsdGEuWSl9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIElucHV0Q2hhbmdlZAoKICAgICAgICAgICAgc2VsZjpDb25uZWN0KCJJbnB1dEJlZ2FuIiwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIERyYWdnaW5nID0gdHJ1ZQoKICAgICAgICAgICAgICAgICAgICBEcmFnU3RhcnQgPSBJbnB1dC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIFN0YXJ0UG9zaXRpb24gPSBHdWkuUG9zaXRpb24KCiAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXRDaGFuZ2VkIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBJbnB1dENoYW5nZWQgPSBJbnB1dC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRTdGF0ZSA9PSBFbnVtLlVzZXJJbnB1dFN0YXRlLkVuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcmFnZ2luZyA9IGZhbHNlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5wdXRDaGFuZ2VkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5wdXRDaGFuZ2VkID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBMaWJyYXJ5OkNvbm5lY3QoVXNlcklucHV0U2VydmljZS5JbnB1dENoYW5nZWQsIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VNb3ZlbWVudCBvciBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgRHJhZ2dpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTZXQoSW5wdXQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgcmV0dXJuIERyYWdnaW5nCiAgICAgICAgZW5kCgogICAgICAgIEluc3RhbmNlcy5NYWtlUmVzaXplYWJsZSA9IGZ1bmN0aW9uKHNlbGYsIE1pbmltdW0sIE1heGltdW0pCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBHdWkgPSBzZWxmLkluc3RhbmNlCgogICAgICAgICAgICBsb2NhbCBSZXNpemluZyA9IGZhbHNlIAogICAgICAgICAgICBsb2NhbCBTdGFydCA9IFVEaW0yTmV3KCkKICAgICAgICAgICAgbG9jYWwgRGVsdGEgPSBVRGltMk5ldygpCiAgICAgICAgICAgIGxvY2FsIFJlc2l6ZU1heCA9IEd1aS5QYXJlbnQuQWJzb2x1dGVTaXplIC0gR3VpLkFic29sdXRlU2l6ZQoKICAgICAgICAgICAgbG9jYWwgUmVzaXplQnV0dG9uID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VCdXR0b24iLCB7CgkJCQlQYXJlbnQgPSBHdWksCiAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vIiwKCQkJCUFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygxLCAxKSwKCQkJCUJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCgkJCQlTaXplID0gVURpbTJOZXcoMCwgNiwgMCwgNiksCgkJCQlQb3NpdGlvbiA9IFVEaW0yTmV3KDEsIC00LCAxLCAtNCksCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKCQkJCUJvcmRlclNpemVQaXhlbCA9IDAsCgkJCQlCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFpJbmRleCA9IDUsCgkJCQlBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgIFZpc2libGUgPSB0cnVlLAoJCQl9KSAgUmVzaXplQnV0dG9uOkFkZFRvVGhlbWUoe0ltYWdlQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgbG9jYWwgSW5wdXRDaGFuZ2VkCgogICAgICAgICAgICBSZXNpemVCdXR0b246Q29ubmVjdCgiSW5wdXRCZWdhbiIsIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KCiAgICAgICAgICAgICAgICAgICAgUmVzaXppbmcgPSB0cnVlCgogICAgICAgICAgICAgICAgICAgIFN0YXJ0ID0gR3VpLlNpemUgLSBVRGltMk5ldygwLCBJbnB1dC5Qb3NpdGlvbi5YLCAwLCBJbnB1dC5Qb3NpdGlvbi5ZKQoKICAgICAgICAgICAgICAgICAgICBpZiBJbnB1dENoYW5nZWQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIElucHV0Q2hhbmdlZCA9IElucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc2l6aW5nID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnB1dENoYW5nZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnB1dENoYW5nZWQgPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIExpYnJhcnk6Q29ubmVjdChVc2VySW5wdXRTZXJ2aWNlLklucHV0Q2hhbmdlZCwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZU1vdmVtZW50IG9yIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBSZXNpemluZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFJlc2l6ZU1heCA9IE1heGltdW0gb3IgR3VpLlBhcmVudC5BYnNvbHV0ZVNpemUgLSBHdWkuQWJzb2x1dGVTaXplCgogICAgICAgICAgICAgICAgICAgICAgICBEZWx0YSA9IFN0YXJ0ICsgVURpbTJOZXcoMCwgSW5wdXQuUG9zaXRpb24uWCwgMCwgSW5wdXQuUG9zaXRpb24uWSkKICAgICAgICAgICAgICAgICAgICAgICAgRGVsdGEgPSBVRGltMk5ldygwLCBtYXRoLmNsYW1wKERlbHRhLlguT2Zmc2V0LCBNaW5pbXVtLlgsIFJlc2l6ZU1heC5YKSwgMCwgbWF0aC5jbGFtcChEZWx0YS5ZLk9mZnNldCwgTWluaW11bS5ZLCBSZXNpemVNYXguWSkpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlbjpDcmVhdGUoR3VpLCBUd2VlbkluZm8ubmV3KDAuMTcsIEVudW0uRWFzaW5nU3R5bGUuUXVhcnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gRGVsdGF9LCB0cnVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIHJldHVybiBSZXNpemluZwogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuT25Ib3ZlciA9IGZ1bmN0aW9uKHNlbGYsIEZ1bmN0aW9uKQogICAgICAgICAgICBpZiBub3Qgc2VsZi5JbnN0YW5jZSB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIExpYnJhcnk6Q29ubmVjdChzZWxmLkluc3RhbmNlLk1vdXNlRW50ZXIsIEZ1bmN0aW9uKQogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuT25Ib3ZlckxlYXZlID0gZnVuY3Rpb24oc2VsZiwgRnVuY3Rpb24pCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gTGlicmFyeTpDb25uZWN0KHNlbGYuSW5zdGFuY2UuTW91c2VMZWF2ZSwgRnVuY3Rpb24pCiAgICAgICAgZW5kCgogICAgICAgIEluc3RhbmNlcy5Cb3JkZXIgPSBmdW5jdGlvbihzZWxmLCBUeXBlKQogICAgICAgICAgICBpZiBub3Qgc2VsZi5JbnN0YW5jZSB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgQ29sb3IgPSBUeXBlID09ICJCb3JkZXIiIGFuZCBMaWJyYXJ5LlRoZW1lLkJvcmRlciBvciBUeXBlID09ICJPdXRsaW5lIiBhbmQgTGlicmFyeS5UaGVtZS5PdXRsaW5lCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFVJU3Ryb2tlID0gSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBzZWxmLkluc3RhbmNlLAogICAgICAgICAgICAgICAgQ29sb3IgPSBDb2xvciwKICAgICAgICAgICAgICAgIFRoaWNrbmVzcyA9IDEsCiAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlcgogICAgICAgICAgICB9KSAgVUlTdHJva2U6QWRkVG9UaGVtZSh7Q29sb3IgPSBUeXBlfSkKCiAgICAgICAgICAgIHJldHVybiBVSVN0cm9rZQogICAgICAgIGVuZAoKICAgICAgICBJbnN0YW5jZXMuVGV4dEJvcmRlciA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLkluc3RhbmNlIHRoZW4gCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBVSVN0cm9rZSA9IEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gc2VsZi5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIENvbG9yID0gTGlicmFyeS5UaGVtZVsiVGV4dCBTdHJva2UiXSwKICAgICAgICAgICAgICAgIFRoaWNrbmVzcyA9IDEsCiAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLjYsCiAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlcgogICAgICAgICAgICB9KSAgVUlTdHJva2U6QWRkVG9UaGVtZSh7Q29sb3IgPSAiVGV4dCBTdHJva2UifSkKCiAgICAgICAgICAgIHJldHVybiBVSVN0cm9rZQogICAgICAgIGVuZCAKICAgIGVuZAoKICAgIC0tIEN1c3RvbSBmb250CiAgICBsb2NhbCBDdXN0b21Gb250ID0geyB9IGRvCiAgICAgICAgZnVuY3Rpb24gQ3VzdG9tRm9udDpOZXcoTmFtZSwgV2VpZ2h0LCBTdHlsZSwgRGF0YSkKICAgICAgICAgICAgaWYgaXNmaWxlKExpYnJhcnkuRm9sZGVycy5Bc3NldHMgLi4gIi8iIC4uIE5hbWUgLi4gIi5qc29uIikgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIEZvbnQubmV3KGdldGN1c3RvbWFzc2V0KExpYnJhcnkuRm9sZGVycy5Bc3NldHMgLi4gIi8iIC4uIE5hbWUgLi4gIi5qc29uIikpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgbm90IGlzZmlsZShMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBOYW1lIC4uICIudHRmIikgdGhlbiAKICAgICAgICAgICAgICAgIHdyaXRlZmlsZShMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBOYW1lIC4uICIudHRmIiwgZ2FtZTpIdHRwR2V0KERhdGEuVXJsKSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBGb250RGF0YSA9IHsKICAgICAgICAgICAgICAgIG5hbWUgPSBOYW1lLAogICAgICAgICAgICAgICAgZmFjZXMgPSB7IHsKICAgICAgICAgICAgICAgICAgICBuYW1lID0gIlJlZ3VsYXIiLAogICAgICAgICAgICAgICAgICAgIHdlaWdodCA9IFdlaWdodCwKICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IFN0eWxlLAogICAgICAgICAgICAgICAgICAgIGFzc2V0SWQgPSBnZXRjdXN0b21hc3NldChMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBOYW1lIC4uICIudHRmIikKICAgICAgICAgICAgICAgIH0gfQogICAgICAgICAgICB9CgogICAgICAgICAgICB3cml0ZWZpbGUoTGlicmFyeS5Gb2xkZXJzLkFzc2V0cyAuLiAiLyIgLi4gTmFtZSAuLiAiLmpzb24iLCBIdHRwU2VydmljZTpKU09ORW5jb2RlKEZvbnREYXRhKSkKICAgICAgICAgICAgcmV0dXJuIEZvbnQubmV3KGdldGN1c3RvbWFzc2V0KExpYnJhcnkuRm9sZGVycy5Bc3NldHMgLi4gIi8iIC4uIE5hbWUgLi4gIi5qc29uIikpCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIEN1c3RvbUZvbnQ6R2V0KE5hbWUpCiAgICAgICAgICAgIGlmIGlzZmlsZShMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBOYW1lIC4uICIuanNvbiIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBGb250Lm5ldyhnZXRjdXN0b21hc3NldChMaWJyYXJ5LkZvbGRlcnMuQXNzZXRzIC4uICIvIiAuLiBOYW1lIC4uICIuanNvbiIpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgQ3VzdG9tRm9udDpOZXcoIk1vbmFjbyIsIDQwMCwgIlJlZ3VsYXIiLCB7CiAgICAgICAgICAgIFVybCA9ICJodHRwczovL2dpdGh1Yi5jb20vc2FtZXRleGUwMDEvbHVhcy9yYXcvcmVmcy9oZWFkcy9tYWluL2ZvbnRzL01vbmFjby50dGYiCiAgICAgICAgfSkKCiAgICAgICAgTGlicmFyeS5Gb250ID0gQ3VzdG9tRm9udDpHZXQoIk1vbmFjbyIpCiAgICBlbmQKCiAgICBMaWJyYXJ5LkhvbGRlciA9IEluc3RhbmNlczpDcmVhdGUoIlNjcmVlbkd1aSIsIHsKICAgICAgICBQYXJlbnQgPSBnZXRodWkoKSwKICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICBaSW5kZXhCZWhhdmlvciA9IEVudW0uWkluZGV4QmVoYXZpb3IuR2xvYmFsLAogICAgICAgIERpc3BsYXlPcmRlciA9IDIsCiAgICAgICAgUmVzZXRPblNwYXduID0gZmFsc2UKICAgIH0pCgogICAgTGlicmFyeS5VbnVzZWRIb2xkZXIgPSBJbnN0YW5jZXM6Q3JlYXRlKCJTY3JlZW5HdWkiLCB7CiAgICAgICAgUGFyZW50ID0gZ2V0aHVpKCksCiAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgWkluZGV4QmVoYXZpb3IgPSBFbnVtLlpJbmRleEJlaGF2aW9yLkdsb2JhbCwKICAgICAgICBFbmFibGVkID0gZmFsc2UsCiAgICAgICAgUmVzZXRPblNwYXduID0gZmFsc2UKICAgIH0pCgogICAgTGlicmFyeS5Ob3RpZkhvbGRlciA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgIFBhcmVudCA9IExpYnJhcnkuSG9sZGVyLkluc3RhbmNlLAogICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAxLCAwKSwKICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YLAogICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICB9KQoKICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5Lk5vdGlmSG9sZGVyLkluc3RhbmNlLAogICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgIFZlcnRpY2FsQWxpZ25tZW50ID0gRW51bS5WZXJ0aWNhbEFsaWdubWVudC5Cb3R0b20sCiAgICAgICAgUGFkZGluZyA9IFVEaW1OZXcoMCwgMTIpLAogICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICB9KQoKICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5Lk5vdGlmSG9sZGVyLkluc3RhbmNlLAogICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgIFBhZGRpbmdUb3AgPSBVRGltTmV3KDAsIDEyKSwKICAgICAgICBQYWRkaW5nQm90dG9tID0gVURpbU5ldygwLCAxMiksCiAgICAgICAgUGFkZGluZ1JpZ2h0ID0gVURpbU5ldygwLCAxMiksCiAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDEyKQogICAgfSkKCiAgICBMaWJyYXJ5LlVubG9hZCA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBzZWxmLkNvbm5lY3Rpb25zIGRvIAogICAgICAgICAgICBWYWx1ZS5Db25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIGVuZAoKICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIHNlbGYuVGhyZWFkcyBkbyAKICAgICAgICAgICAgY29yb3V0aW5lLmNsb3NlKFZhbHVlKQogICAgICAgIGVuZAoKICAgICAgICBpZiBzZWxmLkhvbGRlciB0aGVuIAogICAgICAgICAgICBzZWxmLkhvbGRlcjpDbGVhbigpCiAgICAgICAgZW5kCgogICAgICAgIExpYnJhcnkgPSBuaWwgCiAgICAgICAgZ2V0Z2VudigpLkxpYnJhcnkgPSBuaWwKCiAgICAgICAgVXNlcklucHV0U2VydmljZS5Nb3VzZUljb25FbmFibGVkID0gdHJ1ZQogICAgZW5kCgogICAgTGlicmFyeS5HZXRJbWFnZSA9IGZ1bmN0aW9uKHNlbGYsIEltYWdlKQogICAgICAgIGxvY2FsIEltYWdlRGF0YSA9IHNlbGYuSW1hZ2VzW0ltYWdlXQoKICAgICAgICBpZiBub3QgSW1hZ2VEYXRhIHRoZW4gCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gZ2V0Y3VzdG9tYXNzZXQoc2VsZi5Gb2xkZXJzLkFzc2V0cyAuLiAiLyIgLi4gSW1hZ2VEYXRhWzFdKQogICAgZW5kCgogICAgTGlicmFyeS5Sb3VuZCA9IGZ1bmN0aW9uKHNlbGYsIE51bWJlciwgRmxvYXQpCiAgICAgICAgbG9jYWwgTXVsdGlwbGllciA9IDEgLyAoRmxvYXQgb3IgMSkKICAgICAgICByZXR1cm4gTWF0aEZsb29yKE51bWJlciAqIE11bHRpcGxpZXIpIC8gTXVsdGlwbGllcgogICAgZW5kCgogICAgTGlicmFyeS5UaHJlYWQgPSBmdW5jdGlvbihzZWxmLCBGdW5jdGlvbikKICAgICAgICBsb2NhbCBOZXdUaHJlYWQgPSBjb3JvdXRpbmUuY3JlYXRlKEZ1bmN0aW9uKQogICAgICAgIAogICAgICAgIGNvcm91dGluZS53cmFwKGZ1bmN0aW9uKCkKICAgICAgICAgICAgY29yb3V0aW5lLnJlc3VtZShOZXdUaHJlYWQpCiAgICAgICAgZW5kKSgpCgogICAgICAgIFRhYmxlSW5zZXJ0KHNlbGYuVGhyZWFkcywgTmV3VGhyZWFkKQogICAgICAgIHJldHVybiBOZXdUaHJlYWQKICAgIGVuZAogICAgCiAgICBMaWJyYXJ5LlNhZmVDYWxsID0gZnVuY3Rpb24oc2VsZiwgRnVuY3Rpb24sIC4uLikKICAgICAgICBsb2NhbCBBcmd1ZW1lbnRzID0geyAuLi4gfQogICAgICAgIGxvY2FsIFN1Y2Nlc3MsIFJlc3VsdCA9IHBjYWxsKEZ1bmN0aW9uLCBUYWJsZVVucGFjayhBcmd1ZW1lbnRzKSkKCiAgICAgICAgaWYgbm90IFN1Y2Nlc3MgdGhlbgogICAgICAgICAgICB3YXJuKFJlc3VsdCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBTdWNjZXNzCiAgICBlbmQKCiAgICBMaWJyYXJ5LkNvbm5lY3QgPSBmdW5jdGlvbihzZWxmLCBFdmVudCwgQ2FsbGJhY2ssIE5hbWUpCiAgICAgICAgTmFtZSA9IE5hbWUgb3IgU3RyaW5nRm9ybWF0KCJDb25uZWN0aW9uJXMlcyIsIHNlbGYuVW5uYW1lZENvbm5lY3Rpb25zICsgMSwgSHR0cFNlcnZpY2U6R2VuZXJhdGVHVUlEKGZhbHNlKSkKCiAgICAgICAgbG9jYWwgTmV3Q29ubmVjdGlvbiA9IHsKICAgICAgICAgICAgRXZlbnQgPSBFdmVudCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBDYWxsYmFjaywKICAgICAgICAgICAgTmFtZSA9IE5hbWUsCiAgICAgICAgICAgIENvbm5lY3Rpb24gPSBuaWwKICAgICAgICB9CgogICAgICAgIExpYnJhcnk6VGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgTmV3Q29ubmVjdGlvbi5Db25uZWN0aW9uID0gRXZlbnQ6Q29ubmVjdChDYWxsYmFjaykKICAgICAgICBlbmQpCgogICAgICAgIFRhYmxlSW5zZXJ0KHNlbGYuQ29ubmVjdGlvbnMsIE5ld0Nvbm5lY3Rpb24pCiAgICAgICAgcmV0dXJuIE5ld0Nvbm5lY3Rpb24KICAgIGVuZAoKICAgIExpYnJhcnkuRGlzY29ubmVjdCA9IGZ1bmN0aW9uKHNlbGYsIE5hbWUpCiAgICAgICAgZm9yIF8sIENvbm5lY3Rpb24gaW4gc2VsZi5Db25uZWN0aW9ucyBkbyAKICAgICAgICAgICAgaWYgQ29ubmVjdGlvbi5OYW1lID09IE5hbWUgdGhlbgogICAgICAgICAgICAgICAgQ29ubmVjdGlvbi5Db25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBMaWJyYXJ5Lk5leHRGbGFnID0gZnVuY3Rpb24oc2VsZikKICAgICAgICBsb2NhbCBGbGFnTnVtYmVyID0gc2VsZi5Vbm5hbWVkRmxhZ3MgKyAxCiAgICAgICAgcmV0dXJuIFN0cmluZ0Zvcm1hdCgiZmxhZ19udW1iZXJfJXNfJXMiLCBGbGFnTnVtYmVyLCBIdHRwU2VydmljZTpHZW5lcmF0ZUdVSUQoZmFsc2UpKQogICAgZW5kCgogICAgTGlicmFyeS5BZGRUb1RoZW1lID0gZnVuY3Rpb24oc2VsZiwgSXRlbSwgUHJvcGVydGllcykKICAgICAgICBJdGVtID0gSXRlbS5JbnN0YW5jZSBvciBJdGVtIAoKICAgICAgICBsb2NhbCBUaGVtZURhdGEgPSB7CiAgICAgICAgICAgIEl0ZW0gPSBJdGVtLAogICAgICAgICAgICBQcm9wZXJ0aWVzID0gUHJvcGVydGllcywKICAgICAgICB9CgogICAgICAgIGZvciBQcm9wZXJ0eSwgVmFsdWUgaW4gVGhlbWVEYXRhLlByb3BlcnRpZXMgZG8KICAgICAgICAgICAgaWYgdHlwZShWYWx1ZSkgPT0gInN0cmluZyIgdGhlbgogICAgICAgICAgICAgICAgSXRlbVtQcm9wZXJ0eV0gPSBzZWxmLlRoZW1lW1ZhbHVlXQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBJdGVtW1Byb3BlcnR5XSA9IFZhbHVlKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIFRhYmxlSW5zZXJ0KHNlbGYuVGhlbWVJdGVtcywgVGhlbWVEYXRhKQogICAgICAgIHNlbGYuVGhlbWVNYXBbSXRlbV0gPSBUaGVtZURhdGEKICAgIGVuZAoKCUxpYnJhcnkuVG9SaWNoID0gZnVuY3Rpb24oc2VsZiwgVGV4dCwgQ29sb3IpCiAgICAgICAgaWYgbm90IENvbG9yIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGA8Zm9udCBjb2xvcj0icmdiKDI1NSwgMjU1LCAyNTUpIj57VGV4dH08L2ZvbnQ+YAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgQ29sb3IuUiBvciBub3QgQ29sb3IuRyBvciBub3QgQ29sb3IuQiB0aGVuCiAgICAgICAgICAgIHJldHVybiBgPGZvbnQgY29sb3I9InJnYigyNTUsIDI1NSwgMjU1KSI+e1RleHR9PC9mb250PmAKICAgICAgICBlbmQKCgkJcmV0dXJuIGA8Zm9udCBjb2xvcj0icmdiKHtNYXRoRmxvb3IoQ29sb3IuUiAqIDI1NSl9LCB7TWF0aEZsb29yKENvbG9yLkcgKiAyNTUpfSwge01hdGhGbG9vcihDb2xvci5CICogMjU1KX0pIj57VGV4dH08L2ZvbnQ+YAoJZW5kCgogICAgTGlicmFyeS5HZXRDb25maWcgPSBmdW5jdGlvbihzZWxmKQogICAgICAgIGxvY2FsIENvbmZpZyA9IHsgfSAKCiAgICAgICAgbG9jYWwgU3VjY2VzcywgUmVzdWx0ID0gTGlicmFyeTpTYWZlQ2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTGlicmFyeS5GbGFncyBkbyAKICAgICAgICAgICAgICAgIGlmIHR5cGUoVmFsdWUpID09ICJ0YWJsZSIgYW5kIFZhbHVlLktleSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnW0luZGV4XSA9IHtLZXkgPSB0b3N0cmluZyhWYWx1ZS5LZXkpLCBNb2RlID0gVmFsdWUuTW9kZX0KICAgICAgICAgICAgICAgIGVsc2VpZiB0eXBlKFZhbHVlKSA9PSAidGFibGUiIGFuZCBWYWx1ZS5Db2xvciB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnW0luZGV4XSA9IHtDb2xvciA9ICIjIiAuLiBWYWx1ZS5Db2xvciwgQWxwaGEgPSBWYWx1ZS5BbHBoYX0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBDb25maWdbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCgogICAgICAgIHJldHVybiBIdHRwU2VydmljZTpKU09ORW5jb2RlKENvbmZpZykKICAgIGVuZAoKICAgIExpYnJhcnkuTG9hZENvbmZpZyA9IGZ1bmN0aW9uKHNlbGYsIENvbmZpZykKICAgICAgICBsb2NhbCBEZWNvZGVkID0gSHR0cFNlcnZpY2U6SlNPTkRlY29kZShDb25maWcpCgogICAgICAgIGxvY2FsIFN1Y2Nlc3MsIFJlc3VsdCA9IExpYnJhcnk6U2FmZUNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERlY29kZWQgZG8gCiAgICAgICAgICAgICAgICBsb2NhbCBTZXRGdW5jdGlvbiA9IExpYnJhcnkuU2V0RmxhZ3NbSW5kZXhdCgogICAgICAgICAgICAgICAgaWYgbm90IFNldEZ1bmN0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgdHlwZShWYWx1ZSkgPT0gInRhYmxlIiBhbmQgVmFsdWUuS2V5IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgU2V0RnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBlbHNlaWYgdHlwZShWYWx1ZSkgPT0gInRhYmxlIiBhbmQgVmFsdWUuQ29sb3IgdGhlbgogICAgICAgICAgICAgICAgICAgIFNldEZ1bmN0aW9uKFZhbHVlLkNvbG9yLCBWYWx1ZS5BbHBoYSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBTZXRGdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCgogICAgICAgIHJldHVybiBTdWNjZXNzLCBSZXN1bHQKICAgIGVuZAoKICAgIExpYnJhcnkuRGVsZXRlQ29uZmlnID0gZnVuY3Rpb24oc2VsZiwgQ29uZmlnKQogICAgICAgIGlmIGlzZmlsZShMaWJyYXJ5LkZvbGRlcnMuQ29uZmlncyAuLiAiLyIgLi4gQ29uZmlnKSB0aGVuIAogICAgICAgICAgICBkZWxmaWxlKExpYnJhcnkuRm9sZGVycy5Db25maWdzIC4uICIvIiAuLiBDb25maWcpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBMaWJyYXJ5LlJlZnJlc2hDb25maWdzTGlzdCA9IGZ1bmN0aW9uKHNlbGYsIEVsZW1lbnQpCiAgICAgICAgbG9jYWwgQ3VycmVudExpc3QgPSB7IH0KICAgICAgICBsb2NhbCBMaXN0ID0geyB9CgogICAgICAgIGxvY2FsIENvbmZpZ0ZvbGRlck5hbWUgPSBTdHJpbmdHU3ViKExpYnJhcnkuRm9sZGVycy5Db25maWdzLCBMaWJyYXJ5LkZvbGRlcnMuRGlyZWN0b3J5IC4uICIvIiwgIiIpCgogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbGlzdGZpbGVzKExpYnJhcnkuRm9sZGVycy5Db25maWdzKSBkbwogICAgICAgICAgICBsb2NhbCBGaWxlTmFtZSA9IFN0cmluZ0dTdWIoVmFsdWUsIExpYnJhcnkuRm9sZGVycy5EaXJlY3RvcnkgLi4gIlxcIiAuLiBDb25maWdGb2xkZXJOYW1lIC4uICJcXCIsICIiKQogICAgICAgICAgICBMaXN0W0luZGV4XSA9IEZpbGVOYW1lCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIElzTmV3ID0gI0xpc3Qgfj0gQ3VycmVudExpc3QKCiAgICAgICAgaWYgbm90IElzTmV3IHRoZW4KICAgICAgICAgICAgZm9yIEluZGV4ID0gMSwgI0xpc3QgZG8KICAgICAgICAgICAgICAgIGlmIExpc3RbSW5kZXhdIH49IEN1cnJlbnRMaXN0W0luZGV4XSB0aGVuCiAgICAgICAgICAgICAgICAgICAgSXNOZXcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIEN1cnJlbnRMaXN0ID0gTGlzdAogICAgICAgICAgICBFbGVtZW50OlJlZnJlc2goQ3VycmVudExpc3QpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBMaWJyYXJ5LkNoYW5nZUl0ZW1UaGVtZSA9IGZ1bmN0aW9uKHNlbGYsIEl0ZW0sIFByb3BlcnRpZXMpCiAgICAgICAgSXRlbSA9IEl0ZW0uSW5zdGFuY2Ugb3IgSXRlbQoKICAgICAgICBpZiBub3Qgc2VsZi5UaGVtZU1hcFtJdGVtXSB0aGVuIAogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgc2VsZi5UaGVtZU1hcFtJdGVtXS5Qcm9wZXJ0aWVzID0gUHJvcGVydGllcwogICAgICAgIHNlbGYuVGhlbWVNYXBbSXRlbV0gPSBzZWxmLlRoZW1lTWFwW0l0ZW1dCiAgICBlbmQKCiAgICBMaWJyYXJ5LkNoYW5nZVRoZW1lID0gZnVuY3Rpb24oc2VsZiwgVGhlbWUsIENvbG9yKQogICAgICAgIHNlbGYuVGhlbWVbVGhlbWVdID0gQ29sb3IKCiAgICAgICAgZm9yIF8sIEl0ZW0gaW4gc2VsZi5UaGVtZUl0ZW1zIGRvCiAgICAgICAgICAgIGZvciBQcm9wZXJ0eSwgVmFsdWUgaW4gSXRlbS5Qcm9wZXJ0aWVzIGRvCiAgICAgICAgICAgICAgICBpZiB0eXBlKFZhbHVlKSA9PSAic3RyaW5nIiBhbmQgVmFsdWUgPT0gVGhlbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIEl0ZW0uSXRlbVtQcm9wZXJ0eV0gPSBDb2xvcgogICAgICAgICAgICAgICAgZWxzZWlmIHR5cGUoVmFsdWUpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgIEl0ZW0uSXRlbVtQcm9wZXJ0eV0gPSBWYWx1ZSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBMaWJyYXJ5LklzTW91c2VPdmVyRnJhbWUgPSBmdW5jdGlvbihzZWxmLCBGcmFtZSwgWE9mZnNldCwgWU9mZnNldCkKICAgICAgICBGcmFtZSA9IEZyYW1lLkluc3RhbmNlCiAgICAgICAgWE9mZnNldCA9IFhPZmZzZXQgb3IgMCAKICAgICAgICBZT2Zmc2V0ID0gWU9mZnNldCBvciAwCgogICAgICAgIGxvY2FsIE1vdXNlUG9zaXRpb24gPSBWZWN0b3IyTmV3KE1vdXNlLlggKyBYT2Zmc2V0LCBNb3VzZS5ZICsgWU9mZnNldCkKCiAgICAgICAgcmV0dXJuIE1vdXNlUG9zaXRpb24uWCA+PSBGcmFtZS5BYnNvbHV0ZVBvc2l0aW9uLlggYW5kIE1vdXNlUG9zaXRpb24uWCA8PSBGcmFtZS5BYnNvbHV0ZVBvc2l0aW9uLlggKyBGcmFtZS5BYnNvbHV0ZVNpemUuWCAKICAgICAgICBhbmQgTW91c2VQb3NpdGlvbi5ZID49IEZyYW1lLkFic29sdXRlUG9zaXRpb24uWSBhbmQgTW91c2VQb3NpdGlvbi5ZIDw9IEZyYW1lLkFic29sdXRlUG9zaXRpb24uWSArIEZyYW1lLkFic29sdXRlU2l6ZS5ZCiAgICBlbmQKCiAgICBMaWJyYXJ5LkxlcnAgPSBmdW5jdGlvbihzZWxmLCBTdGFydCwgRmluaXNoLCBUaW1lKQogICAgICAgIHJldHVybiBTdGFydCArIChGaW5pc2ggLSBTdGFydCkgKiBUaW1lCiAgICBlbmQKCiAgICAtLSBDb21wb25lbnRzCiAgICBsb2NhbCBDb21wb25lbnRzID0geyB9IGRvCiAgICAgICAgQ29tcG9uZW50cy5XaW5kb3cgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBsb2NhbCBJdGVtcyA9IHsgfSBkbwogICAgICAgICAgICAgICAgSXRlbXNbIldpbmRvdyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYXJlbnQuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBEYXRhLkFuY2hvclBvaW50LAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gRGF0YS5Qb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBEYXRhLlNpemUsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigxNCwgMTcsIDE1KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJXaW5kb3ciXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgaWYgRGF0YS5EcmFnZ2FibGUgdGhlbiAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siV2luZG93Il06TWFrZURyYWdnYWJsZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBEYXRhLlJlc2l6ZWFibGUgdGhlbiAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siV2luZG93Il06TWFrZVJlc2l6ZWFibGUoVmVjdG9yMk5ldyhEYXRhLlNpemUuWC5PZmZzZXQsIERhdGEuU2l6ZS5ZLk9mZnNldCksIFZlY3RvcjJOZXcoOTk5OSwgOTk5OSkpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBJdGVtc1siVUlTdHJva2UiXSA9IEl0ZW1zWyJXaW5kb3ciXTpCb3JkZXIoIk91dGxpbmUiKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBJdGVtcwogICAgICAgIGVuZAoKICAgICAgICBDb21wb25lbnRzLkF1dG9zaXppbmdMYWJlbCA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgICAgIGxvY2FsIExhYmVsID0geyB9IAoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJMYWJlbCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IERhdGEuUGFyZW50Lkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IERhdGEuVGV4dCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFksCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkxhYmVsIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlVJU3Ryb2tlIl0gPSBJdGVtc1siTGFiZWwiXTpUZXh0Qm9yZGVyKCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBMYWJlbDpTZXRQcm9wZXJ0eShQcm9wZXJ0eSwgVmFsdWUpCiAgICAgICAgICAgICAgICBJdGVtc1siTGFiZWwiXS5JbnN0YW5jZVtQcm9wZXJ0eV0gPSBWYWx1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBMYWJlbCwgSXRlbXMKICAgICAgICBlbmQKCiAgICAgICAgQ29tcG9uZW50cy5XaW5kb3dQYWdlID0gZnVuY3Rpb24oc2VsZiwgRGF0YSkKICAgICAgICAgICAgbG9jYWwgUGFnZSA9IHsKICAgICAgICAgICAgICAgIEFjdGl2ZSA9IGZhbHNlLAogICAgICAgICAgICAgICAgU3ViUGFnZXMgPSB7IH0sCiAgICAgICAgICAgICAgICBJdGVtcyA9IHsgfSwKICAgICAgICAgICAgICAgIFdpbmRvdyA9IERhdGEuV2luZG93LAogICAgICAgICAgICAgICAgQ29sdW1uc0RhdGEgPSB7IH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhcmVudC5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIiwKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC42MDAwMDAwMjM4NDE4NTc5LAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAyNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1LCAzMCwgMjYpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkluYWN0aXZlIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJQYWdlIEJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkJ1dHRvbkJvcmRlciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkluYWN0aXZlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDYxLCA2MCwgNjUpLAogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IDAuNiwKICAgICAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siQnV0dG9uQm9yZGVyIl06QWRkVG9UaGVtZSh7Q29sb3IgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJMaW5lciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkluYWN0aXZlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMSwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNSwgMzAsIDI2KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJMaW5lciJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlRleHQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5hY3RpdmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDAsIDAuNSksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAuNSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIlRleHQiXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dFN0cm9rZSJdID0gSXRlbXNbIlRleHQiXTpUZXh0Qm9yZGVyKCkKCiAgICAgICAgICAgICAgICBJdGVtc1siR2xvdyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkluYWN0aXZlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMjAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjUsIDMwLCAyNikKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siR2xvdyJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkdsb3dHcmFkaWVudCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siR2xvdyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFRyYW5zcGFyZW5jeSA9IE51bVNlcXVlbmNle051bVNlcXVlbmNlS2V5cG9pbnQoMCwgMCksIE51bVNlcXVlbmNlS2V5cG9pbnQoMC4xOTMsIDAuODY4NzQ5OTc2MTU4MTQyMSksIE51bVNlcXVlbmNlS2V5cG9pbnQoMC41MDQsIDAuOTY4NzUpLCBOdW1TZXF1ZW5jZUtleXBvaW50KDEsIDEpfQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siUGFnZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5Db250ZW50SG9sZGVyLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBpZiBEYXRhLlN1YlBhZ2VzIHRoZW4KICAgICAgICAgICAgICAgICAgICBJdGVtc1siU3ViUGFnZXMiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFnZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDM1KSwKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YLAogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMCwgMjQsIDIxKQogICAgICAgICAgICAgICAgICAgIH0pICBJdGVtc1siU3ViUGFnZXMiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIlBhZ2UgQmFja2dyb3VuZCIsIEJvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJTdWJQYWdlcyJdOkJvcmRlcigiQm9yZGVyIikKCiAgICAgICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlQYWRkaW5nIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siU3ViUGFnZXMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IFVEaW1OZXcoMCwgNyksCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCA3KQogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlN1YlBhZ2VzIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbEFsaWdubWVudCA9IEVudW0uVmVydGljYWxBbGlnbm1lbnQuQ2VudGVyLAogICAgICAgICAgICAgICAgICAgICAgICBGaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWwsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDEyKSwKICAgICAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQ29sdW1ucyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJQYWdlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAwLCA1MSksCiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAtNTEpLAogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFnZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsLAogICAgICAgICAgICAgICAgICAgICAgICBIb3Jpem9udGFsRmxleCA9IEVudW0uVUlGbGV4QWxpZ25tZW50LkZpbGwsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDE0KSwKICAgICAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXggPSAxLCBEYXRhLkNvbHVtbnMgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE5ld0NvbHVtbiA9IEluc3RhbmNlczpDcmVhdGUoIlNjcm9sbGluZ0ZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhZ2UiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2Nyb2xsQmFySW1hZ2VDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aXZlID0gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY0NhbnZhc1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhclRoaWNrbmVzcyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW52YXNTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IE5ld0NvbHVtbi5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IFVEaW1OZXcoMCwgMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gVURpbU5ldygwLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IFVEaW1OZXcoMCwgMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IFVEaW1OZXcoMCwgMikKICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IE5ld0NvbHVtbi5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZyA9IFVEaW1OZXcoMCwgMTQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZ2UuQ29sdW1uc0RhdGFbSW5kZXhdID0gTmV3Q29sdW1uCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBQYWdlLkl0ZW1zID0gSXRlbXMKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEZWJvdW5jZSA9IGZhbHNlCgogICAgICAgICAgICBmdW5jdGlvbiBQYWdlOlR1cm4oQm9vbCkKICAgICAgICAgICAgICAgIGlmIERlYm91bmNlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgUGFnZS5BY3RpdmUgPSBCb29sIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IHRydWUKICAgICAgICAgICAgICAgIEl0ZW1zWyJQYWdlIl0uSW5zdGFuY2UuVmlzaWJsZSA9IEJvb2wgCiAgICAgICAgICAgICAgICBJdGVtc1siUGFnZSJdLkluc3RhbmNlLlBhcmVudCA9IEJvb2wgYW5kIERhdGEuQ29udGVudEhvbGRlci5JbnN0YW5jZSBvciBMaWJyYXJ5LlVudXNlZEhvbGRlci5JbnN0YW5jZQoKICAgICAgICAgICAgICAgIGlmIFBhZ2UuQWN0aXZlIHRoZW4KICAgICAgICAgICAgICAgICAgICBJdGVtc1siSW5hY3RpdmUiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkJ1dHRvbkJvcmRlciJdOlR3ZWVuKG5pbCwge1RyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJHbG93Il06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJMaW5lciJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdOlR3ZWVuKG5pbCwge1Bvc2l0aW9uID0gVURpbTJOZXcoMCwgMTMsIDAuNSwgMCl9KQoKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkN1cnJlbnRQYWdlID0gUGFnZQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjZ9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJCdXR0b25Cb3JkZXIiXTpUd2VlbihuaWwsIHtUcmFuc3BhcmVuY3kgPSAwLjZ9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJHbG93Il06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJMaW5lciJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdOlR3ZWVuKG5pbCwge1Bvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMC41LCAwKX0pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBBbGxJbnN0YW5jZXMgPSBJdGVtc1siUGFnZSJdLkluc3RhbmNlOkdldERlc2NlbmRhbnRzKCkKICAgICAgICAgICAgICAgIFRhYmxlSW5zZXJ0KEFsbEluc3RhbmNlcywgSXRlbXNbIlBhZ2UiXS5JbnN0YW5jZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgTmV3VHdlZW4gCgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBBbGxJbnN0YW5jZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVHJhbnNwYXJlbmN5UHJvcGVydHkgPSBUd2VlbjpHZXRQcm9wZXJ0eShWYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFRyYW5zcGFyZW5jeVByb3BlcnR5IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoVHJhbnNwYXJlbmN5UHJvcGVydHkpID09ICJ0YWJsZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIFByb3BlcnR5IGluIFRyYW5zcGFyZW5jeVByb3BlcnR5IGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3VHdlZW4gPSBUd2VlbjpGYWRlSXRlbShWYWx1ZSwgUHJvcGVydHksIEJvb2wsIERhdGEuV2luZG93LkZhZGVUaW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE5ld1R3ZWVuID0gVHdlZW46RmFkZUl0ZW0oVmFsdWUsIFRyYW5zcGFyZW5jeVByb3BlcnR5LCBCb29sLCBEYXRhLldpbmRvdy5GYWRlVGltZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIExpYnJhcnk6Q29ubmVjdChOZXdUd2Vlbi5Ud2Vlbi5Db21wbGV0ZWQsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl06Q29ubmVjdCgiTW91c2VCdXR0b24xRG93biIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGF0YS5XaW5kb3cuUGFnZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgPT0gUGFnZSBhbmQgUGFnZS5BY3RpdmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgVmFsdWU6VHVybihWYWx1ZSA9PSBQYWdlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOk9uSG92ZXIoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkhvdmVyZWQgRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lWyJIb3ZlcmVkIEVsZW1lbnQiXX0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOk9uSG92ZXJMZWF2ZShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBJdGVtc1siSW5hY3RpdmUiXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiUGFnZSBCYWNrZ3JvdW5kIiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQogICAgICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWVbIlBhZ2UgQmFja2dyb3VuZCJdfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgI0RhdGEuV2luZG93LlBhZ2VzID09IDAgdGhlbiAKICAgICAgICAgICAgICAgIFBhZ2U6VHVybih0cnVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KERhdGEuV2luZG93LlBhZ2VzLCBQYWdlKQogICAgICAgICAgICByZXR1cm4gUGFnZSwgSXRlbXMgCiAgICAgICAgZW5kCgogICAgICAgIENvbXBvbmVudHMuV2luZG93U3ViUGFnZSA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgICAgIGxvY2FsIFN1YlBhZ2UgPSB7CiAgICAgICAgICAgICAgICBBY3RpdmUgPSBmYWxzZSwKICAgICAgICAgICAgICAgIENvbHVtbnNEYXRhID0geyB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgICAgICBJdGVtc1siSW5hY3RpdmUiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYWdlLkl0ZW1zWyJTdWJQYWdlcyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNSwgMzAsIDI2KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJJbmFjdGl2ZSJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiUGFnZSBCYWNrZ3JvdW5kIiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJCdXR0b25Cb3JkZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJJbmFjdGl2ZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig2MSwgNjAsIDY1KSwKICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJCdXR0b25Cb3JkZXIiXTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlRleHQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5hY3RpdmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDAuNSwgMC41KSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMC41LCAtNSwgMC41LCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0U3Ryb2tlIl0gPSBJdGVtc1siVGV4dCJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siVGV4dCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IFVEaW1OZXcoMCwgOCksCiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDgpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5hY3RpdmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gVURpbU5ldygwLCAyKSwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IFVEaW1OZXcoMCwgMTgpLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdSaWdodCA9IFVEaW1OZXcoMCwgMTIpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJHbG93Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5hY3RpdmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIC0xOCwgMCwgLTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDIwLCAxLCAyKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkdsb3ciXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkdsb3ciXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBOdW1TZXF1ZW5jZXtOdW1TZXF1ZW5jZUtleXBvaW50KDAsIDApLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuMTkzLCAwLjg2ODc0OTk3NjE1ODE0MjEpLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuNTA0LCAwLjk2ODc1KSwgTnVtU2VxdWVuY2VLZXlwb2ludCgxLCAxKX0KICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5hY3RpdmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIC0xOCwgMCwgLTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDEsIDEsIDIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAyLCAyNDMsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siTGluZXIiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJQYWdlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhZ2UuSXRlbXNbIkNvbHVtbnMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIC0yLCAwLCAtMiksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMiwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBWaXNpYmxlID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJQYWdlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsLAogICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbCwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gVURpbU5ldygwLCAxNCksCiAgICAgICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgZm9yIEluZGV4ID0gMSwgRGF0YS5Db2x1bW5zIGRvIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIE5ld0NvbHVtbiA9IEluc3RhbmNlczpDcmVhdGUoIlNjcm9sbGluZ0ZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFnZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICAgICAgU2Nyb2xsQmFySW1hZ2VDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICBBY3RpdmUgPSB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNDYW52YXNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlksCiAgICAgICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhclRoaWNrbmVzcyA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpLAogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBDYW52YXNTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVBhZGRpbmciLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IE5ld0NvbHVtbi5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhZGRpbmdUb3AgPSBVRGltTmV3KDAsIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gVURpbU5ldygwLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gVURpbU5ldygwLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDIpCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBOZXdDb2x1bW4uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gVURpbU5ldygwLCAxNCksCiAgICAgICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgU3ViUGFnZS5Db2x1bW5zRGF0YVtJbmRleF0gPSBOZXdDb2x1bW4KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIERlYm91bmNlID0gZmFsc2UKCiAgICAgICAgICAgIExpYnJhcnkuU2VhcmNoSXRlbXNbU3ViUGFnZV0gPSB7IH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIFN1YlBhZ2U6VHVybihCb29sKQogICAgICAgICAgICAgICAgaWYgRGVib3VuY2UgdGhlbiAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBTdWJQYWdlLkFjdGl2ZSA9IEJvb2wgCiAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IHRydWUKICAgICAgICAgICAgICAgIEl0ZW1zWyJQYWdlIl0uSW5zdGFuY2UuVmlzaWJsZSA9IEJvb2wgCiAgICAgICAgICAgICAgICBJdGVtc1siUGFnZSJdLkluc3RhbmNlLlBhcmVudCA9IEJvb2wgYW5kIERhdGEuUGFnZS5JdGVtc1siQ29sdW1ucyJdLkluc3RhbmNlIG9yIExpYnJhcnkuVW51c2VkSG9sZGVyLkluc3RhbmNlCgogICAgICAgICAgICAgICAgaWYgU3ViUGFnZS5BY3RpdmUgdGhlbgogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQnV0dG9uQm9yZGVyIl06VHdlZW4obmlsLCB7VHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJHbG93Il06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il06VHdlZW4obmlsLCB7UG9zaXRpb24gPSBVRGltMk5ldygwLjUsIDAsIDAuNSwgMCl9KQoKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkN1cnJlbnRQYWdlID0gU3ViUGFnZQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQnV0dG9uQm9yZGVyIl06VHdlZW4obmlsLCB7VHJhbnNwYXJlbmN5ID0gMX0pCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJHbG93Il06VHdlZW4obmlsLCB7QmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il06VHdlZW4obmlsLCB7UG9zaXRpb24gPSBVRGltMk5ldygwLjUsIC01LCAwLjUsIDApfSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIEFsbEluc3RhbmNlcyA9IEl0ZW1zWyJQYWdlIl0uSW5zdGFuY2U6R2V0RGVzY2VuZGFudHMoKQogICAgICAgICAgICAgICAgVGFibGVJbnNlcnQoQWxsSW5zdGFuY2VzLCBJdGVtc1siUGFnZSJdLkluc3RhbmNlKQoKICAgICAgICAgICAgICAgIGxvY2FsIE5ld1R3ZWVuIAoKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gQWxsSW5zdGFuY2VzIGRvIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRyYW5zcGFyZW5jeVByb3BlcnR5ID0gVHdlZW46R2V0UHJvcGVydHkoVmFsdWUpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKFRyYW5zcGFyZW5jeVByb3BlcnR5KSA9PSAidGFibGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBQcm9wZXJ0eSBpbiBUcmFuc3BhcmVuY3lQcm9wZXJ0eSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld1R3ZWVuID0gVHdlZW46RmFkZUl0ZW0oVmFsdWUsIFByb3BlcnR5LCBCb29sLCBEYXRhLldpbmRvdy5GYWRlVGltZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBOZXdUd2VlbiA9IFR3ZWVuOkZhZGVJdGVtKFZhbHVlLCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSwgQm9vbCwgRGF0YS5XaW5kb3cuRmFkZVRpbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBMaWJyYXJ5OkNvbm5lY3QoTmV3VHdlZW4uVHdlZW4uQ29tcGxldGVkLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgRGVib3VuY2UgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOkNvbm5lY3QoIk1vdXNlQnV0dG9uMURvd24iLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERhdGEuUGFnZS5TdWJQYWdlcyBkbyAKICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSA9PSBTdWJQYWdlIGFuZCBTdWJQYWdlLkFjdGl2ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUdXJuKFZhbHVlID09IFN1YlBhZ2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgI0RhdGEuUGFnZS5TdWJQYWdlcyA9PSAwIHRoZW4gCiAgICAgICAgICAgICAgICBTdWJQYWdlOlR1cm4odHJ1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBUYWJsZUluc2VydChEYXRhLlBhZ2UuU3ViUGFnZXMsIFN1YlBhZ2UpCiAgICAgICAgICAgIHJldHVybiBTdWJQYWdlCiAgICAgICAgZW5kCgogICAgICAgIENvbXBvbmVudHMuVG9nZ2xlID0gZnVuY3Rpb24oc2VsZiwgRGF0YSkKICAgICAgICAgICAgbG9jYWwgVG9nZ2xlID0gewogICAgICAgICAgICAgICAgVmFsdWUgPSBmYWxzZSwKICAgICAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJUb2dnbGUiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYXJlbnQuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDEyKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkluZGljYXRvciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlRvZ2dsZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgMC41LCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAxMiwgMCwgMTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMzAsIDM2LCAzMSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSW5kaWNhdG9yIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJFbGVtZW50IiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJJbmRpY2F0b3IiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5kaWNhdG9yIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAtMTY1LAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBGcm9tUkdCKDIwOCwgMjA4LCAyMDgpKX0KICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JTZXF1ZW5jZXtSR0JTZXF1ZW5jZUtleXBvaW50KDAsIEZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDEsIExpYnJhcnkuVGhlbWUuR3JhZGllbnQpfQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siQ2hlY2siXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkluZGljYXRvciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEltYWdlQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5GaXQsCiAgICAgICAgICAgICAgICAgICAgSW1hZ2VUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDAuNSwgMC41KSwKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTA4MDE2NjcxNDY5NDM5IiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAuNSwgMCwgMC41LCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMiwgMSwgMiksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJUb2dnbGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMC41KSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDIyLCAwLjUsIDApLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJUZXh0Il06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlRleHQiXTpUZXh0Qm9yZGVyKCkKCiAgICAgICAgICAgICAgICBJdGVtc1siU3ViRWxlbWVudHMiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJUb2dnbGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgSXRlbXNbIlRleHQiXS5JbnN0YW5jZS5UZXh0Qm91bmRzLlggKyAzMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siU3ViRWxlbWVudHMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbEFsaWdubWVudCA9IEVudW0uVmVydGljYWxBbGlnbm1lbnQuQ2VudGVyLAogICAgICAgICAgICAgICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbCwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gVURpbU5ldygwLCA2KSwKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBUb2dnbGU6R2V0KCkKICAgICAgICAgICAgICAgIHJldHVybiBUb2dnbGUuVmFsdWUgCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gVG9nZ2xlOlNldFRleHQoVGV4dCkKICAgICAgICAgICAgICAgIFRleHQgPSB0b3N0cmluZyhUZXh0KQogICAgICAgICAgICAgICAgSXRlbXNbIlRleHQiXS5JbnN0YW5jZS5UZXh0ID0gVGV4dAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIFRvZ2dsZTpTZXQoVmFsdWUpCiAgICAgICAgICAgICAgICBUb2dnbGUuVmFsdWUgPSBWYWx1ZSAKICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbVG9nZ2xlLkZsYWddID0gVmFsdWUgCgogICAgICAgICAgICAgICAgaWYgVG9nZ2xlLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBJdGVtc1siSW5kaWNhdG9yIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkFjY2VudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siSW5kaWNhdG9yIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWUuQWNjZW50fSkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQ2hlY2siXTpUd2VlbihUd2VlbkluZm8ubmV3KExpYnJhcnkuVHdlZW4uVGltZSwgRW51bS5FYXNpbmdTdHlsZS5CYWNrLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7SW1hZ2VUcmFuc3BhcmVuY3kgPSAwLCBTaXplID0gVURpbTJOZXcoMSwgMiwgMSwgMil9KQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmRpY2F0b3IiXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siSW5kaWNhdG9yIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWUuRWxlbWVudH0pCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkNoZWNrIl06VHdlZW4oVHdlZW5JbmZvLm5ldyhMaWJyYXJ5LlR3ZWVuLlRpbWUsIEVudW0uRWFzaW5nU3R5bGUuQmFjaywgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge0ltYWdlVHJhbnNwYXJlbmN5ID0gMSwgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDApfSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIERhdGEuQ2FsbGJhY2sgdGhlbiAKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlNhZmVDYWxsKERhdGEuQ2FsbGJhY2ssIFRvZ2dsZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIFRvZ2dsZTpTZXRWaXNpYmlsaXR5KEJvb2wpCiAgICAgICAgICAgICAgICBJdGVtc1siVG9nZ2xlIl0uSW5zdGFuY2UuVmlzaWJsZSA9IEJvb2wgCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgUGFnZVNlYXJjaERhdGEgPSBMaWJyYXJ5LlNlYXJjaEl0ZW1zW0RhdGEuUGFnZV0KCiAgICAgICAgICAgIGlmIFBhZ2VTZWFyY2hEYXRhIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIFNlYXJjaERhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgRWxlbWVudCA9IEl0ZW1zWyJUb2dnbGUiXSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gRGF0YS5OYW1lLAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFRhYmxlSW5zZXJ0KFBhZ2VTZWFyY2hEYXRhLCBTZWFyY2hEYXRhKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIEl0ZW1zWyJUb2dnbGUiXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjFEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgVG9nZ2xlOlNldChub3QgVG9nZ2xlLlZhbHVlKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siVG9nZ2xlIl06T25Ib3ZlcihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBUb2dnbGUuVmFsdWUgdGhlbiAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBJdGVtc1siSW5kaWNhdG9yIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkhvdmVyZWQgRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmRpY2F0b3IiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZVsiSG92ZXJlZCBFbGVtZW50Il19KQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siVG9nZ2xlIl06T25Ib3ZlckxlYXZlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIFRvZ2dsZS5WYWx1ZSB0aGVuIAogICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmRpY2F0b3IiXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmRpY2F0b3IiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZVsiRWxlbWVudCJdfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgVG9nZ2xlOlNldChEYXRhLkRlZmF1bHQpCgogICAgICAgICAgICBMaWJyYXJ5LlNldEZsYWdzW1RvZ2dsZS5GbGFnXSA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgVG9nZ2xlOlNldChWYWx1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gVG9nZ2xlLCBJdGVtcwogICAgICAgIGVuZAoKICAgICAgICBDb21wb25lbnRzLkJ1dHRvbiA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgICAgIGxvY2FsIEJ1dHRvbiA9IHsgfQoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJCdXR0b24iXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IERhdGEuUGFyZW50Lkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQnV0dG9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsLAogICAgICAgICAgICAgICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbCwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nID0gVURpbU5ldygwLCA4KSwKICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBCdXR0b246QWRkKE5hbWUsIENhbGxiYWNrKQogICAgICAgICAgICAgICAgbG9jYWwgTmV3QnV0dG9uID0geyB9CgogICAgICAgICAgICAgICAgbG9jYWwgU3ViSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQnV0dG9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQsCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDMwLCAzNiwgMzEpCiAgICAgICAgICAgICAgICAgICAgfSkgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IFN1Ykl0ZW1zWyJOZXdCdXR0b24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gLTE2NSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBSR0JTZXF1ZW5jZXtSR0JTZXF1ZW5jZUtleXBvaW50KDAsIEZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDEsIEZyb21SR0IoMjA4LCAyMDgsIDIwOCkpfQogICAgICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBMaWJyYXJ5LlRoZW1lLkdyYWRpZW50KX0KICAgICAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gU3ViSXRlbXNbIk5ld0J1dHRvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siVGV4dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBTdWJJdGVtc1siTmV3QnV0dG9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPSBOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSkgIFN1Ykl0ZW1zWyJUZXh0Il06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJUZXh0Il06VGV4dEJvcmRlcigpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBOZXdCdXR0b246UHJlc3MoKQogICAgICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50IiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQogICAgICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZS5BY2NlbnR9KQoKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlNhZmVDYWxsKENhbGxiYWNrKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCgogICAgICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWUuRWxlbWVudH0pCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBOZXdCdXR0b246U2V0VmlzaWJpbGl0eShCb29sKQogICAgICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXS5JbnN0YW5jZS5WaXNpYmxlID0gQm9vbAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgUGFnZVNlYXJjaERhdGEgPSBMaWJyYXJ5LlNlYXJjaEl0ZW1zW0RhdGEuUGFnZV0KCiAgICAgICAgICAgICAgICBpZiBQYWdlU2VhcmNoRGF0YSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgU2VhcmNoRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgRWxlbWVudCA9IFN1Ykl0ZW1zWyJOZXdCdXR0b24iXSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9IE5hbWUsCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBUYWJsZUluc2VydChQYWdlU2VhcmNoRGF0YSwgU2VhcmNoRGF0YSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpPbkhvdmVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkhvdmVyZWQgRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWVbIkhvdmVyZWQgRWxlbWVudCJdfSkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl06T25Ib3ZlckxlYXZlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBTdWJJdGVtc1siTmV3QnV0dG9uIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgICAgICAgICAgU3ViSXRlbXNbIk5ld0J1dHRvbiJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lLkVsZW1lbnR9KQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJOZXdCdXR0b24iXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjFEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIE5ld0J1dHRvbjpQcmVzcygpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgcmV0dXJuIE5ld0J1dHRvbiAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBCdXR0b246U2V0VmlzaWJpbGl0eShCb29sKQogICAgICAgICAgICAgICAgSXRlbXNbIkJ1dHRvbiJdLkluc3RhbmNlLlZpc2libGUgPSBCb29sCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIEJ1dHRvbiwgSXRlbXMKICAgICAgICBlbmQKCiAgICAgICAgQ29tcG9uZW50cy5TbGlkZXIgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBsb2NhbCBTbGlkZXIgPSB7CiAgICAgICAgICAgICAgICBWYWx1ZSA9IDAsCiAgICAgICAgICAgICAgICBGbGFnID0gRGF0YS5GbGFnLAogICAgICAgICAgICAgICAgU2xpZGluZyA9IGZhbHNlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgICAgICBJdGVtc1siU2xpZGVyIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhcmVudC5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAyOCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTbGlkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSXRlbXNbIlJlYWxTbGlkZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNsaWRlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIiwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAxMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigzMCwgMzYsIDMxKQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJSZWFsU2xpZGVyIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJFbGVtZW50IiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlJlYWxTbGlkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBSb3RhdGlvbiA9IC0xNjUsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBSR0JTZXF1ZW5jZXtSR0JTZXF1ZW5jZUtleXBvaW50KDAsIEZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDEsIEZyb21SR0IoMjA4LCAyMDgsIDIwOCkpfQogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgTGlicmFyeS5UaGVtZS5HcmFkaWVudCl9CiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJSZWFsU2xpZGVyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJBY2NlbnQiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJSZWFsU2xpZGVyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMC41LCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkFjY2VudCJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50In0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQWNjZW50Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAtMTY1LAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBGcm9tUkdCKDIwOCwgMjA4LCAyMDgpKX0KICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSR0JTZXF1ZW5jZXtSR0JTZXF1ZW5jZUtleXBvaW50KDAsIEZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDEsIExpYnJhcnkuVGhlbWUuR3JhZGllbnQpfQogICAgICAgICAgICAgICAgZW5kfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siRHJhZ2dlciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkFjY2VudCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygxLCAwLjUpLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMSwgMCwgMC41LCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAzLCAxLCAzKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDE0LCAxNywgMTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkRyYWdnZXIiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJEcmFnZ2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNsaWRlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICI1MCUiLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygxLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMSwgMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIlZhbHVlIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl06VGV4dEJvcmRlcigpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gU2xpZGVyOkdldCgpCiAgICAgICAgICAgICAgICByZXR1cm4gU2xpZGVyLlZhbHVlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gU2xpZGVyOlNldFZpc2liaWxpdHkoQm9vbCkKICAgICAgICAgICAgICAgIEl0ZW1zWyJTbGlkZXIiXS5JbnN0YW5jZS5WaXNpYmxlID0gQm9vbAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIFNsaWRlcjpTZXQoVmFsdWUpCiAgICAgICAgICAgICAgICBTbGlkZXIuVmFsdWUgPSBMaWJyYXJ5OlJvdW5kKE1hdGhDbGFtcChWYWx1ZSwgRGF0YS5NaW4sIERhdGEuTWF4KSwgRGF0YS5EZWNpbWFscykKCiAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW1NsaWRlci5GbGFnXSA9IFNsaWRlci5WYWx1ZQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJBY2NlbnQiXTpUd2VlbihUd2VlbkluZm8ubmV3KExpYnJhcnkuVHdlZW4uVGltZSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMk5ldygoU2xpZGVyLlZhbHVlIC0gRGF0YS5NaW4pIC8gKERhdGEuTWF4IC0gRGF0YS5NaW4pLCAwLCAxLCAwKX0pCiAgICAgICAgICAgICAgICBJdGVtc1siVmFsdWUiXS5JbnN0YW5jZS5UZXh0ID0gU3RyaW5nRm9ybWF0KCIlcyVzIiwgdG9zdHJpbmcoU2xpZGVyLlZhbHVlKSwgRGF0YS5TdWZmaXgpCgogICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuIAogICAgICAgICAgICAgICAgICAgIExpYnJhcnk6U2FmZUNhbGwoRGF0YS5DYWxsYmFjaywgU2xpZGVyLlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS1bWwogICAgICAgICAgICBsb2NhbCBQYWdlU2VhcmNoRGF0YSA9IExpYnJhcnkuU2VhcmNoSXRlbXNbRGF0YS5QYWdlXQoKICAgICAgICAgICAgaWYgUGFnZVNlYXJjaERhdGEgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgU2VhcmNoRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBFbGVtZW50ID0gSXRlbXNbIlNsaWRlciJdLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgVGFibGVJbnNlcnQoUGFnZVNlYXJjaERhdGEsIFNlYXJjaERhdGEpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAtLV1dCgogICAgICAgICAgICBsb2NhbCBJbnB1dENoYW5nZWQKCiAgICAgICAgICAgIEl0ZW1zWyJSZWFsU2xpZGVyIl06Q29ubmVjdCgiSW5wdXRCZWdhbiIsIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBTbGlkZXIuU2xpZGluZyA9IHRydWUgCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFNpemVYID0gKE1vdXNlLlggLSBJdGVtc1siUmVhbFNsaWRlciJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWCkgLyBJdGVtc1siUmVhbFNsaWRlciJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVmFsdWUgPSAoKERhdGEuTWF4IC0gRGF0YS5NaW4pICogU2l6ZVgpICsgRGF0YS5NaW4KCiAgICAgICAgICAgICAgICAgICAgU2xpZGVyOlNldChWYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgSW5wdXRDaGFuZ2VkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIElucHV0Q2hhbmdlZCA9IElucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRlci5TbGlkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5wdXRDaGFuZ2VkOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5wdXRDaGFuZ2VkID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBMaWJyYXJ5OkNvbm5lY3QoVXNlcklucHV0U2VydmljZS5JbnB1dENoYW5nZWQsIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VNb3ZlbWVudCBvciBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgU2xpZGVyLlNsaWRpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTaXplWCA9IChNb3VzZS5YIC0gSXRlbXNbIlJlYWxTbGlkZXIiXS5JbnN0YW5jZS5BYnNvbHV0ZVBvc2l0aW9uLlgpIC8gSXRlbXNbIlJlYWxTbGlkZXIiXS5JbnN0YW5jZS5BYnNvbHV0ZVNpemUuWAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBWYWx1ZSA9ICgoRGF0YS5NYXggLSBEYXRhLk1pbikgKiBTaXplWCkgKyBEYXRhLk1pbgoKICAgICAgICAgICAgICAgICAgICAgICAgU2xpZGVyOlNldChWYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siU2xpZGVyIl06T25Ib3ZlcihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBJdGVtc1siUmVhbFNsaWRlciJdOkNoYW5nZUl0ZW1UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJIb3ZlcmVkIEVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgICAgICBJdGVtc1siUmVhbFNsaWRlciJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lWyJIb3ZlcmVkIEVsZW1lbnQiXX0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJTbGlkZXIiXTpPbkhvdmVyTGVhdmUoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgSXRlbXNbIlJlYWxTbGlkZXIiXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgIEl0ZW1zWyJSZWFsU2xpZGVyIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWVbIkVsZW1lbnQiXX0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGlmIERhdGEuRGVmYXVsdCB0aGVuIAogICAgICAgICAgICAgICAgU2xpZGVyOlNldChEYXRhLkRlZmF1bHQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgTGlicmFyeS5TZXRGbGFnc1tTbGlkZXIuRmxhZ10gPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIFNsaWRlcjpTZXQoVmFsdWUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIFNsaWRlciwgSXRlbXMKICAgICAgICBlbmQKCiAgICAgICAgQ29tcG9uZW50cy5MYWJlbCA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgICAgIGxvY2FsIExhYmVsID0geyB9CgogICAgICAgICAgICBsb2NhbCBJdGVtcyA9IHsgfSBkbwogICAgICAgICAgICAgICAgSXRlbXNbIkxhYmVsIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhcmVudC5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJMYWJlbCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IERhdGEuTmFtZSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgMC41LCAwKSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdCwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSXRlbXNbIlN1YkVsZW1lbnRzIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTGFiZWwiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgSXRlbXNbIlRleHQiXS5JbnN0YW5jZS5UZXh0Qm91bmRzLlggKyA4LCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTdWJFbGVtZW50cyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFZlcnRpY2FsQWxpZ25tZW50ID0gRW51bS5WZXJ0aWNhbEFsaWdubWVudC5DZW50ZXIsCiAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDYpLAogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIExhYmVsOlNldFRleHQoVGV4dCkKICAgICAgICAgICAgICAgIFRleHQgPSB0b3N0cmluZyhUZXh0KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il0uSW5zdGFuY2UuVGV4dCA9IFRleHQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBMYWJlbDpTZXRWaXNpYmlsaXR5KEJvb2wpCiAgICAgICAgICAgICAgICBJdGVtc1siTGFiZWwiXS5JbnN0YW5jZS5WaXNpYmxlID0gQm9vbAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBMYWJlbCwgSXRlbXMgCiAgICAgICAgZW5kCgogICAgICAgIENvbXBvbmVudHMuRHJvcGRvd24gPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBsb2NhbCBEcm9wZG93biA9IHsKICAgICAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcsIAogICAgICAgICAgICAgICAgVmFsdWUgPSB7IH0sCiAgICAgICAgICAgICAgICBPcHRpb25zID0geyB9LAogICAgICAgICAgICAgICAgSXNPcGVuID0gZmFsc2UKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJEcm9wZG93biJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYXJlbnQuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgNDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlRleHQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siRHJvcGRvd24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSXRlbXNbIlJlYWxEcm9wZG93biJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siRHJvcGRvd24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDAsIDEpLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMjApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMzAsIDM2LCAzMSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siUmVhbERyb3Bkb3duIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJFbGVtZW50IiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gLTE2NSwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgRnJvbVJHQigyMDgsIDIwOCwgMjA4KSl9CiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBMaWJyYXJ5LlRoZW1lLkdyYWRpZW50KX0KICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVmFsdWUiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUmVhbERyb3Bkb3duIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIi0tIiwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMC41KSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTI1LCAwLCAxNSksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLjUsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIlZhbHVlIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSXRlbXNbIkljb24iXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEltYWdlQ29sb3IzID0gRnJvbVJHQigyMDIsIDI0MywgMjU1KSwKICAgICAgICAgICAgICAgICAgICBTY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5GaXQsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMSwgMC41KSwKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTEzMjI5MTc2ODg2NDkzIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDEsIC0yLCAwLjUsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAyMCwgMCwgMjApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSWNvbiJdOkFkZFRvVGhlbWUoe0ltYWdlQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJPcHRpb25Ib2xkZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IExpYnJhcnkuVW51c2VkSG9sZGVyLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAxLCA4KSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMjUpLAogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDUsCiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwLCAyNCwgMjEpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIk9wdGlvbkhvbGRlciJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiSW5saW5lIiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJPcHRpb25Ib2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlQYWRkaW5nIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJPcHRpb25Ib2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gVURpbU5ldygwLCA1KSwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gVURpbU5ldygwLCA1KSwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBVRGltTmV3KDAsIDUpLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCA4KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSUxpc3RMYXlvdXQiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIk9wdGlvbkhvbGRlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDMpLAogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duOkdldCgpCiAgICAgICAgICAgICAgICByZXR1cm4gRHJvcGRvd24uVmFsdWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEZWJvdW5jZSA9IGZhbHNlCiAgICAgICAgICAgIGxvY2FsIFJlbmRlclN0ZXBwZWQgIAoKICAgICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd246U2V0T3BlbihCb29sKQogICAgICAgICAgICAgICAgaWYgRGVib3VuY2UgdGhlbiAKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIERyb3Bkb3duLklzT3BlbiA9IEJvb2wKCiAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IHRydWUgCgogICAgICAgICAgICAgICAgaWYgRHJvcGRvd24uSXNPcGVuIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIk9wdGlvbkhvbGRlciJdLkluc3RhbmNlLlZpc2libGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIk9wdGlvbkhvbGRlciJdLkluc3RhbmNlLlBhcmVudCA9IExpYnJhcnkuSG9sZGVyLkluc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkljb24iXTpUd2VlbihuaWwsIHtSb3RhdGlvbiA9IC05MH0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZCA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgSXRlbXNbIk9wdGlvbkhvbGRlciJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWCwgMCwgSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWSArIEl0ZW1zWyJSZWFsRHJvcGRvd24iXS5JbnN0YW5jZS5BYnNvbHV0ZVNpemUuWSArIDUpCiAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJPcHRpb25Ib2xkZXIiXS5JbnN0YW5jZS5TaXplID0gVURpbTJOZXcoMCwgSXRlbXNbIlJlYWxEcm9wZG93biJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IERlYm91bmNlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTGlicmFyeS5PcGVuRnJhbWVzIGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgfj0gRHJvcGRvd24gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpTZXRPcGVuKGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5PcGVuRnJhbWVzW0Ryb3Bkb3duXSA9IERyb3Bkb3duIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEZWJvdW5jZSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5Lk9wZW5GcmFtZXNbRHJvcGRvd25dIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Lk9wZW5GcmFtZXNbRHJvcGRvd25dID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBSZW5kZXJTdGVwcGVkIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIFJlbmRlclN0ZXBwZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIFJlbmRlclN0ZXBwZWQgPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkljb24iXTpUd2VlbihuaWwsIHtSb3RhdGlvbiA9IDB9KQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgRGVzY2VuZGFudHMgPSBJdGVtc1siT3B0aW9uSG9sZGVyIl0uSW5zdGFuY2U6R2V0RGVzY2VuZGFudHMoKQogICAgICAgICAgICAgICAgVGFibGVJbnNlcnQoRGVzY2VuZGFudHMsIEl0ZW1zWyJPcHRpb25Ib2xkZXIiXS5JbnN0YW5jZSkKCiAgICAgICAgICAgICAgICBsb2NhbCBOZXdUd2VlbgoKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGVzY2VuZGFudHMgZG8gCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVHJhbnNwYXJlbmN5UHJvcGVydHkgPSBUd2VlbjpHZXRQcm9wZXJ0eShWYWx1ZSkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFRyYW5zcGFyZW5jeVByb3BlcnR5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoVHJhbnNwYXJlbmN5UHJvcGVydHkpID09ICJ0YWJsZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIFByb3BlcnR5IGluIFRyYW5zcGFyZW5jeVByb3BlcnR5IGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3VHdlZW4gPSBUd2VlbjpGYWRlSXRlbShWYWx1ZSwgUHJvcGVydHksIEJvb2wsIExpYnJhcnkuRmFkZVNwZWVkKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE5ld1R3ZWVuID0gVHdlZW46RmFkZUl0ZW0oVmFsdWUsIFRyYW5zcGFyZW5jeVByb3BlcnR5LCBCb29sLCBMaWJyYXJ5LkZhZGVTcGVlZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBOZXdUd2Vlbi5Ud2Vlbi5Db21wbGV0ZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgRGVib3VuY2UgPSBmYWxzZSAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siT3B0aW9uSG9sZGVyIl0uSW5zdGFuY2UuVmlzaWJsZSA9IERyb3Bkb3duLklzT3BlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIk9wdGlvbkhvbGRlciJdLkluc3RhbmNlLlBhcmVudCA9IG5vdCBEcm9wZG93bi5Jc09wZW4gYW5kIExpYnJhcnkuVW51c2VkSG9sZGVyLkluc3RhbmNlIG9yIExpYnJhcnkuSG9sZGVyLkluc3RhbmNlCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd246U2V0VmlzaWJpbGl0eShCb29sKQogICAgICAgICAgICAgICAgSXRlbXNbIkRyb3Bkb3duIl0uSW5zdGFuY2UuVmlzaWJsZSA9IEJvb2wKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bjpTZXQoT3B0aW9uKQogICAgICAgICAgICAgICAgaWYgRGF0YS5NdWx0aSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoT3B0aW9uKSB+PSAidGFibGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBEcm9wZG93bi5WYWx1ZSA9IE9wdGlvbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbRHJvcGRvd24uRmxhZ10gPSBPcHRpb24KCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBPcHRpb24gZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT3B0aW9uRGF0YSA9IERyb3Bkb3duLk9wdGlvbnNbVmFsdWVdCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgT3B0aW9uRGF0YSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuU2VsZWN0ZWQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhOlRvZ2dsZSgiQWN0aXZlIikKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl0uSW5zdGFuY2UuVGV4dCA9IFRhYmxlQ29uY2F0KE9wdGlvbiwgIiwgIikKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBub3QgRHJvcGRvd24uT3B0aW9uc1tPcHRpb25dIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIE9wdGlvbkRhdGEgPSBEcm9wZG93bi5PcHRpb25zW09wdGlvbl0KCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uVmFsdWUgPSBPcHRpb24KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0Ryb3Bkb3duLkZsYWddID0gT3B0aW9uCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRHJvcGRvd24uT3B0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSB+PSBPcHRpb25EYXRhIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLlNlbGVjdGVkID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUb2dnbGUoIkluYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuU2VsZWN0ZWQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6VG9nZ2xlKCJBY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl0uSW5zdGFuY2UuVGV4dCA9IE9wdGlvbgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuICAgCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBEcm9wZG93bi5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duOkFkZChPcHRpb24pCiAgICAgICAgICAgICAgICBsb2NhbCBPcHRpb25CdXR0b24gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJPcHRpb25Ib2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBPcHRpb24sCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdCwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDUsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgT3B0aW9uQnV0dG9uOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIGxvY2FsIE9wdGlvbkRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgQnV0dG9uID0gT3B0aW9uQnV0dG9uLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSBPcHRpb24sCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIE9wdGlvbkRhdGE6VG9nZ2xlKFN0YXR1cykKICAgICAgICAgICAgICAgICAgICBpZiBTdGF0dXMgPT0gIkFjdGl2ZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5CdXR0b246Q2hhbmdlSXRlbVRoZW1lKHtUZXh0Q29sb3IzID0gIkFjY2VudCJ9KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhLkJ1dHRvbjpUd2VlbihuaWwsIHtUZXh0Q29sb3IzID0gTGlicmFyeS5UaGVtZS5BY2NlbnR9KQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5CdXR0b246Q2hhbmdlSXRlbVRoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkgCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuQnV0dG9uOlR3ZWVuKG5pbCwge1RleHRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lLlRleHR9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gT3B0aW9uRGF0YTpTZXQoKQogICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuU2VsZWN0ZWQgPSBub3QgT3B0aW9uRGF0YS5TZWxlY3RlZAoKICAgICAgICAgICAgICAgICAgICBpZiBEYXRhLk11bHRpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEluZGV4ID0gVGFibGVGaW5kKERyb3Bkb3duLlZhbHVlLCBPcHRpb25EYXRhLk5hbWUpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBJbmRleCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFibGVSZW1vdmUoRHJvcGRvd24uVmFsdWUsIEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWJsZUluc2VydChEcm9wZG93bi5WYWx1ZSwgT3B0aW9uRGF0YS5OYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGE6VG9nZ2xlKEluZGV4IGFuZCAiSW5hY3RpdmUiIG9yICJBY3RpdmUiKQoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5GbGFnc1tEcm9wZG93bi5GbGFnXSA9IERyb3Bkb3duLlZhbHVlCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBUZXh0Rm9ybWF0ID0gI0Ryb3Bkb3duLlZhbHVlID4gMCBhbmQgVGFibGVDb25jYXQoRHJvcGRvd24uVmFsdWUsICIsICIpIG9yICItLSIKICAgICAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl0uSW5zdGFuY2UuVGV4dCA9IFRleHRGb3JtYXQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE9wdGlvbkRhdGEuU2VsZWN0ZWQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLlZhbHVlID0gT3B0aW9uRGF0YS5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0Ryb3Bkb3duLkZsYWddID0gT3B0aW9uRGF0YS5OYW1lCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5TZWxlY3RlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGE6VG9nZ2xlKCJBY3RpdmUiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRHJvcGRvd24uT3B0aW9ucyBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSB+PSBPcHRpb25EYXRhIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuU2VsZWN0ZWQgPSBmYWxzZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6VG9nZ2xlKCJJbmFjdGl2ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJdGVtc1siVmFsdWUiXS5JbnN0YW5jZS5UZXh0ID0gT3B0aW9uRGF0YS5OYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLlZhbHVlID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0Ryb3Bkb3duLkZsYWddID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5TZWxlY3RlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhOlRvZ2dsZSgiSW5hY3RpdmUiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJWYWx1ZSJdLkluc3RhbmNlLlRleHQgPSAiLS0iCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBEYXRhLkNhbGxiYWNrIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBEcm9wZG93bi5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuQnV0dG9uOkNvbm5lY3QoIk1vdXNlQnV0dG9uMURvd24iLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YTpTZXQoKQogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIERyb3Bkb3duLk9wdGlvbnNbT3B0aW9uRGF0YS5OYW1lXSA9IE9wdGlvbkRhdGEKICAgICAgICAgICAgICAgIHJldHVybiBPcHRpb25EYXRhCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd246UmVtb3ZlKE9wdGlvbikKICAgICAgICAgICAgICAgIGlmIG5vdCBEcm9wZG93bi5PcHRpb25zW09wdGlvbl0gdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgRHJvcGRvd24uT3B0aW9uc1tPcHRpb25dLkJ1dHRvbjpDbGVhbigpCiAgICAgICAgICAgICAgICBEcm9wZG93bi5PcHRpb25zW09wdGlvbl0gPSBuaWwKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bjpSZWZyZXNoKExpc3QpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERyb3Bkb3duLk9wdGlvbnMgZG8gCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd246UmVtb3ZlKFZhbHVlLk5hbWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExpc3QgZG8gCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd246QWRkKFZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgSXRlbXNbIlJlYWxEcm9wZG93biJdOkNvbm5lY3QoIk1vdXNlQnV0dG9uMURvd24iLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBEcm9wZG93bjpTZXRPcGVuKG5vdCBEcm9wZG93bi5Jc09wZW4pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJEcm9wZG93biJdOk9uSG92ZXIoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgSXRlbXNbIlJlYWxEcm9wZG93biJdOkNoYW5nZUl0ZW1UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJIb3ZlcmVkIEVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgICAgICBJdGVtc1siUmVhbERyb3Bkb3duIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWVbIkhvdmVyZWQgRWxlbWVudCJdfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgSXRlbXNbIkRyb3Bkb3duIl06T25Ib3ZlckxlYXZlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIEl0ZW1zWyJSZWFsRHJvcGRvd24iXTpDaGFuZ2VJdGVtVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgICAgIEl0ZW1zWyJSZWFsRHJvcGRvd24iXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZVsiRWxlbWVudCJdfSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTGlicmFyeTpDb25uZWN0KFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbiwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEcm9wZG93bi5Jc09wZW4gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6SXNNb3VzZU92ZXJGcmFtZShJdGVtc1siT3B0aW9uSG9sZGVyIl0pIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBEcm9wZG93bjpTZXRPcGVuKGZhbHNlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGF0YS5JdGVtcyBkbyAKICAgICAgICAgICAgICAgIERyb3Bkb3duOkFkZChWYWx1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBEYXRhLkRlZmF1bHQgdGhlbiAKICAgICAgICAgICAgICAgIERyb3Bkb3duOlNldChEYXRhLkRlZmF1bHQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgTGlicmFyeS5TZXRGbGFnc1tEcm9wZG93bi5GbGFnXSA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgRHJvcGRvd246U2V0KFZhbHVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBEcm9wZG93biwgSXRlbXMgCiAgICAgICAgZW5kCgogICAgICAgIENvbXBvbmVudHMuQ29sb3JwaWNrZXJUYWIgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBpZiBub3QgRGF0YS5QYWdlcyB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgTmV3VGFiID0geyAKICAgICAgICAgICAgICAgIE5hbWUgPSBEYXRhLk5hbWUsCiAgICAgICAgICAgICAgICBBY3RpdmUgPSBmYWxzZQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBJdGVtcyA9IHsgfSBkbwogICAgICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IERhdGEuUGFnZUhvbGRlci5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSBOZXdUYWIuTmFtZSwKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAsIDI0LCAyMSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSW5hY3RpdmUiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIklubGluZSJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJQYWdlQ29udGVudCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5Db250ZW50SG9sZGVyLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFZpc2libGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIE5ld1RhYjpUdXJuKEJvb2wpCiAgICAgICAgICAgICAgICBOZXdUYWIuQWN0aXZlID0gQm9vbCAKCiAgICAgICAgICAgICAgICBpZiBOZXdUYWIuQWN0aXZlIHRoZW4KICAgICAgICAgICAgICAgICAgICBJdGVtc1siUGFnZUNvbnRlbnQiXS5JbnN0YW5jZS5WaXNpYmxlID0gdHJ1ZSAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siUGFnZUNvbnRlbnQiXS5JbnN0YW5jZS5QYXJlbnQgPSBEYXRhLkNvbnRlbnRIb2xkZXIuSW5zdGFuY2UgCgogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOkNoYW5nZUl0ZW1UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJCYWNrZ3JvdW5kIn0pCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl06VHdlZW4obmlsLCB7QmFja2dyb3VuZENvbG9yMyA9IExpYnJhcnkuVGhlbWUuQmFja2dyb3VuZH0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlBhZ2VDb250ZW50Il0uSW5zdGFuY2UuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlBhZ2VDb250ZW50Il0uSW5zdGFuY2UuUGFyZW50ID0gTGlicmFyeS5VbnVzZWRIb2xkZXIuSW5zdGFuY2UgCgogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJJbmFjdGl2ZSJdOkNoYW5nZUl0ZW1UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJJbmxpbmUifSkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siSW5hY3RpdmUiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZS5JbmxpbmV9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgSXRlbXNbIkluYWN0aXZlIl06Q29ubmVjdCgiTW91c2VCdXR0b24xRG93biIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGF0YS5TdGFjayBkbyAKICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUdXJuKFZhbHVlID09IE5ld1RhYikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpZiAjRGF0YS5TdGFjayA9PSAwIHRoZW4gCiAgICAgICAgICAgICAgICBOZXdUYWI6VHVybih0cnVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KERhdGEuU3RhY2ssIE5ld1RhYikKICAgICAgICAgICAgcmV0dXJuIE5ld1RhYiwgSXRlbXMgCiAgICAgICAgZW5kCgogICAgICAgIENvbXBvbmVudHMuQ3JlYXRlU3ViUGFsZXR0ZUl0ZW1zID0gZnVuY3Rpb24oc2VsZiwgSXRlbXMpCiAgICAgICAgICAgIEl0ZW1zWyJDb2xvcnBpY2tlcldpbmRvdyJdLkluc3RhbmNlLlNpemUgPSBVRGltMk5ldygwLCAxNzEsIDAsIDE2OCkKCiAgICAgICAgICAgIEl0ZW1zWyJQYWxldHRlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDgpLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC00MSwgMSwgLTQxKSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0LAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJQYWxldHRlIl06QWRkVG9UaGVtZSh7Qm9yZGVyQ29sb3IzID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICBJdGVtc1siU2F0dXJhdGlvbiJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJQYWxldHRlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBJbWFnZSA9IExpYnJhcnk6R2V0SW1hZ2UoIlNhdHVyYXRpb24iKSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgWkluZGV4ID0gMiwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSXRlbXNbIlZhbHVlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJJbWFnZUxhYmVsIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAyLCAxLCAwKSwKICAgICAgICAgICAgICAgIEltYWdlID0gTGlicmFyeTpHZXRJbWFnZSgiVmFsdWUiKSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAtMSwgMCwgMCksCiAgICAgICAgICAgICAgICBaSW5kZXggPSAzLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siUGFsZXR0ZURyYWdnZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA4KSwKICAgICAgICAgICAgICAgIFpJbmRleCA9IDUsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDIsIDAsIDIpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJQYWxldHRlRHJhZ2dlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgIEl0ZW1zWyJIdWUiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEFjdGl2ZSA9IHRydWUsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDEsIDApLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygxLCAtOCwgMCwgOCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMTUsIDEsIC0xNiksCiAgICAgICAgICAgICAgICBTZWxlY3RhYmxlID0gdHJ1ZSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KSAgSXRlbXNbIkh1ZSJdOkFkZFRvVGhlbWUoe0JvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJIdWUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICBJdGVtc1siSHVlSW5saW5lIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkh1ZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JhZGllbnQiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSHVlSW5saW5lIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gOTAsCiAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDAsIDApKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjE3LCBGcm9tUkdCKDI1NSwgMjU1LCAwKSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMC4zMywgRnJvbVJHQigwLCAyNTUsIDApKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjUsIEZyb21SR0IoMCwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjY3LCBGcm9tUkdCKDAsIDAsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDAuODMsIEZyb21SR0IoMjU1LCAwLCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBGcm9tUkdCKDI1NSwgMCwgMCkpfQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSXRlbXNbIkh1ZURyYWdnZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkh1ZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDEpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJIdWVEcmFnZ2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgSXRlbXNbIkFscGhhIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDEsIC04KSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAtNDEsIDAsIDE1KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDE0LAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJBbHBoYSJdOkFkZFRvVGhlbWUoe0JvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgIEl0ZW1zWyJDaGVja2VycyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBTY2FsZVR5cGUgPSBFbnVtLlNjYWxlVHlwZS5UaWxlLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFRpbGVTaXplID0gVURpbTJOZXcoMCwgNiwgMCwgNiksCiAgICAgICAgICAgICAgICBJbWFnZSA9IExpYnJhcnk6R2V0SW1hZ2UoIkNoZWNrZXJzIiksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgIFpJbmRleCA9IDIsCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkgIAoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJDaGVja2VycyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBOdW1TZXF1ZW5jZXtOdW1TZXF1ZW5jZUtleXBvaW50KDAsIDEpLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuMzcsIDAuNSksIE51bVNlcXVlbmNlS2V5cG9pbnQoMSwgMCl9CiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siQWxwaGFEcmFnZ2VyIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBaSW5kZXggPSA1LAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAxLCAxLCAwKSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQWxwaGFEcmFnZ2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIkJvcmRlciJ9KQogICAgICAgIGVuZAoKICAgICAgICBDb21wb25lbnRzLkNvbG9ycGlja2VyID0gZnVuY3Rpb24oc2VsZiwgRGF0YSkgLS0gcG9ldHJ5IHdhcm5pbmcgKOKVr8Kw4pahwrAp4pWvCiAgICAgICAgICAgIGxvY2FsIENvbG9ycGlja2VyID0gewogICAgICAgICAgICAgICAgSXNPcGVuID0gZmFsc2UsCgogICAgICAgICAgICAgICAgSHVlID0gMCwKICAgICAgICAgICAgICAgIFNhdHVyYXRpb24gPSAwLAogICAgICAgICAgICAgICAgVmFsdWUgPSAwLAogICAgICAgICAgICAgICAgQWxwaGEgPSAwLAoKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KSwKICAgICAgICAgICAgICAgIEhleFZhbHVlID0gIiNmZmZmZmYiLAoKICAgICAgICAgICAgICAgIFBhZ2VzID0gRGF0YS5QYWdlcyBhbmQgeyB9IG9yIG5pbCwKICAgICAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIFVwZGF0ZVN5bmMKCiAgICAgICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgICAgICBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b24iXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYXJlbnQuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAtMTIzLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMTUsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b24iXTpBZGRUb1RoZW1lKHtCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyQnV0dG9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJDb2xvcnBpY2tlckJ1dHRvbklubGluZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyQnV0dG9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAxLCAwLCAxKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAtMiwgMSwgLTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b25JbmxpbmUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBSb3RhdGlvbiA9IC0xNjUsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBSR0JTZXF1ZW5jZXtSR0JTZXF1ZW5jZUtleXBvaW50KDAsIEZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDEsIEZyb21SR0IoMjA4LCAyMDgsIDIwOCkpfQogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgTGlicmFyeS5UaGVtZS5HcmFkaWVudCl9CiAgICAgICAgICAgICAgICBlbmR9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJDb2xvcnBpY2tlcldpbmRvdyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5LlVudXNlZEhvbGRlci5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIiIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAxMiwgMCwgMTIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDI2NiwgMCwgMjU4KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDE0LCAxNywgMTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il06QWRkVG9UaGVtZSh7Qm9yZGVyQ29sb3IzID0gIkJvcmRlciIsIEJhY2tncm91bmRDb2xvcjMgPSAiQmFja2dyb3VuZCJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJDb2xvcnBpY2tlcldpbmRvdyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgICAgICBpZiBEYXRhLlBhZ2VzIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlBhZ2VzIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDIwKSwKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSUxpc3RMYXlvdXQiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJQYWdlcyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICAgICAgRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5Ib3Jpem9udGFsLAogICAgICAgICAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgSG9yaXpvbnRhbEZsZXggPSBFbnVtLlVJRmxleEFsaWdubWVudC5GaWxsCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkNvbnRlbnQiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQ29sb3JwaWNrZXJXaW5kb3ciXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDI1KSwKICAgICAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIC0yNSksCiAgICAgICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBDb21wb25lbnRzOkNyZWF0ZVN1YlBhbGV0dGVJdGVtcyhJdGVtcykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIENvbG9yVGFiLCBDb2xvclRhYkl0ZW1zID0gQ29tcG9uZW50czpDb2xvcnBpY2tlclRhYih7CiAgICAgICAgICAgICAgICBDb250ZW50SG9sZGVyID0gSXRlbXNbIkNvbnRlbnQiXSwKICAgICAgICAgICAgICAgIFBhZ2VzID0gQ29sb3JwaWNrZXIuUGFnZXMsCiAgICAgICAgICAgICAgICBQYWdlSG9sZGVyID0gSXRlbXNbIlBhZ2VzIl0sCiAgICAgICAgICAgICAgICBTdGFjayA9IENvbG9ycGlja2VyLlBhZ2VzLAogICAgICAgICAgICAgICAgTmFtZSA9ICJDb2xvciIKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGxvY2FsIEFuaW1hdGlvbnNUYWIsIEFuaW1hdGlvbnNUYWJJdGVtcyA9IENvbXBvbmVudHM6Q29sb3JwaWNrZXJUYWIoewogICAgICAgICAgICAgICAgQ29udGVudEhvbGRlciA9IEl0ZW1zWyJDb250ZW50Il0sCiAgICAgICAgICAgICAgICBQYWdlcyA9IENvbG9ycGlja2VyLlBhZ2VzLAogICAgICAgICAgICAgICAgUGFnZUhvbGRlciA9IEl0ZW1zWyJQYWdlcyJdLAogICAgICAgICAgICAgICAgU3RhY2sgPSBDb2xvcnBpY2tlci5QYWdlcywKICAgICAgICAgICAgICAgIE5hbWUgPSAiQW5pbWF0aW9ucyIKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGxvY2FsIE90aGVyVGFiLCBPdGhlclRhYkl0ZW1zID0gQ29tcG9uZW50czpDb2xvcnBpY2tlclRhYih7CiAgICAgICAgICAgICAgICBDb250ZW50SG9sZGVyID0gSXRlbXNbIkNvbnRlbnQiXSwKICAgICAgICAgICAgICAgIFBhZ2VzID0gQ29sb3JwaWNrZXIuUGFnZXMsCiAgICAgICAgICAgICAgICBQYWdlSG9sZGVyID0gSXRlbXNbIlBhZ2VzIl0sCiAgICAgICAgICAgICAgICBTdGFjayA9IENvbG9ycGlja2VyLlBhZ2VzLAogICAgICAgICAgICAgICAgTmFtZSA9ICJPdGhlciIKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGxvY2FsIE9sZENvbG9yID0gQ29sb3JwaWNrZXIuQ29sb3IKICAgICAgICAgICAgbG9jYWwgT2xkQWxwaGEgPSBDb2xvcnBpY2tlci5BbHBoYQogICAgICAgICAgICBsb2NhbCBDdXJyZW50QW5pbWF0aW9uCgogICAgICAgICAgICBsb2NhbCBBbmltYXRpb25zRHJvcGRvd24sIEFuaW1hdGlvbnNEcm9wZG93bkl0ZW1zCiAgICAgICAgICAgIGxvY2FsIEtleWZyYW1lT25lTGFiZWwsIEtleWZyYW1lT25lTGFiZWxJdGVtcwogICAgICAgICAgICBsb2NhbCBLZXlmcmFtZVR3b0xhYmVsLCBLZXlmcmFtZVR3b0xhYmVsSXRlbXMKCiAgICAgICAgICAgIGxvY2FsIEtleWZyYW1lT25lQ29sb3JwaWNrZXIsIEtleWZyYW1lT25lQ29sb3JwaWNrZXJJdGVtcwogICAgICAgICAgICBsb2NhbCBLZXlmcmFtZVR3b0NvbG9ycGlja2VyLCBLZXlmcmFtZVR3b0NvbG9ycGlja2VySXRlbXMKCiAgICAgICAgICAgIGxvY2FsIEFuaW1hdGlvblNwZWVkU2xpZGVyLCBBbmltYXRpb25TcGVlZFNsaWRlckl0ZW1zCgogICAgICAgICAgICBpZiBDb2xvclRhYiB0aGVuCiAgICAgICAgICAgICAgICBJdGVtc1siUGFsZXR0ZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBDb2xvclRhYkl0ZW1zWyJQYWdlQ29udGVudCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgOCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC00NiwgMSwgLTQ2KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gMTQsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siUGFsZXR0ZSJdOkFkZFRvVGhlbWUoe0JvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siU2F0dXJhdGlvbiJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFsZXR0ZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSBMaWJyYXJ5OkdldEltYWdlKCJTYXR1cmF0aW9uIiksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVmFsdWUiXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAyLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBJbWFnZSA9IExpYnJhcnk6R2V0SW1hZ2UoIlZhbHVlIiksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAtMSwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMywKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJQYWxldHRlRHJhZ2dlciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDgpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDIsIDAsIDIpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gNSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFsZXR0ZURyYWdnZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siSHVlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBDb2xvclRhYkl0ZW1zWyJQYWdlQ29udGVudCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFjdGl2ZSA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMSwgMCksCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygxLCAtOCwgMCwgOCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDIwLCAxLCAtMTYpLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGFibGUgPSB0cnVlLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSHVlIl06QWRkVG9UaGVtZSh7Qm9yZGVyQ29sb3IzID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSHVlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkh1ZUlubGluZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSHVlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSHVlSW5saW5lIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSA5MCwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDAsIDApKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjE3LCBGcm9tUkdCKDI1NSwgMjU1LCAwKSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMC4zMywgRnJvbVJHQigwLCAyNTUsIDApKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjUsIEZyb21SR0IoMCwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgwLjY3LCBGcm9tUkdCKDAsIDAsIDI1NSkpLCBSR0JTZXF1ZW5jZUtleXBvaW50KDAuODMsIEZyb21SR0IoMjU1LCAwLCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBGcm9tUkdCKDI1NSwgMCwgMCkpfQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siSHVlRHJhZ2dlciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkh1ZSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDEpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkh1ZURyYWdnZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siQWxwaGEiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gQ29sb3JUYWJJdGVtc1siUGFnZUNvbnRlbnQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIiwKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAxLCAtOCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC00NiwgMCwgMjApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSAxNCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigxNTcsIDE3NSwgMjU1KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJBbHBoYSJdOkFkZFRvVGhlbWUoe0JvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkFscGhhIl0uSW5zdGFuY2UsICAgCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkNoZWNrZXJzIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJJbWFnZUxhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLlRpbGUsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUaWxlU2l6ZSA9IFVEaW0yTmV3KDAsIDYsIDAsIDYpLAogICAgICAgICAgICAgICAgICAgIEltYWdlID0gTGlicmFyeTpHZXRJbWFnZSgiQ2hlY2tlcnMiKSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQ2hlY2tlcnMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBOdW1TZXF1ZW5jZXtOdW1TZXF1ZW5jZUtleXBvaW50KDAsIDEpLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuMzcsIDAuNSksIE51bVNlcXVlbmNlS2V5cG9pbnQoMSwgMCl9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJBbHBoYURyYWdnZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDEsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIFpJbmRleCA9IDUsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQWxwaGFEcmFnZ2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgQW5pbWF0aW9uc1RhYiB0aGVuCiAgICAgICAgICAgICAgICBBbmltYXRpb25zRHJvcGRvd24sIEFuaW1hdGlvbnNEcm9wZG93bkl0ZW1zID0gQ29tcG9uZW50czpEcm9wZG93bih7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gQW5pbWF0aW9uc1RhYkl0ZW1zWyJQYWdlQ29udGVudCJdLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiQW5pbWF0aW9ucyIsCiAgICAgICAgICAgICAgICAgICAgSXRlbXMgPSB7IlJhaW5ib3ciLCAiRmFkZSIsICJGYWRlIGFscGhhIiwgIkxpbmVhciJ9LAogICAgICAgICAgICAgICAgICAgIERlZmF1bHQgPSBuaWwsCiAgICAgICAgICAgICAgICAgICAgRmxhZyA9IENvbG9ycGlja2VyLkZsYWcuLiJBbmltYXRpb24iLAogICAgICAgICAgICAgICAgICAgIE11bHRpID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgRGVib3VuY2UgPSBDb2xvcnBpY2tlciwKICAgICAgICAgICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50QW5pbWF0aW9uID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgPT0gIlJhaW5ib3ciIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBLZXlmcmFtZU9uZUxhYmVsIGFuZCBLZXlmcmFtZVR3b0xhYmVsIGFuZCBBbmltYXRpb25TcGVlZFNsaWRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ZnJhbWVPbmVMYWJlbDpTZXRWaXNpYmlsaXR5KGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleWZyYW1lVHdvTGFiZWw6U2V0VmlzaWJpbGl0eShmYWxzZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uU3BlZWRTbGlkZXJJdGVtc1siU2xpZGVyIl0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA0NSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZENvbG9yID0gQ29sb3JwaWNrZXIuQ29sb3IKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlRocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFJhaW5ib3dIdWUgPSBNYXRoQWJzKE1hdGhTaW4odGljaygpICogKEFuaW1hdGlvblNwZWVkU2xpZGVyLlZhbHVlIC8gMjUpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ29sb3IgPSBGcm9tSFNWKFJhaW5ib3dIdWUsIDEsIDEpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpTZXQoQ29sb3IsIENvbG9ycGlja2VyLkFscGhhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGVTeW5jKHRydWUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDdXJyZW50QW5pbWF0aW9uIH49ICJSYWluYm93IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpTZXQoT2xkQ29sb3IsIENvbG9ycGlja2VyLkFscGhhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBWYWx1ZSA9PSAiRmFkZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEtleWZyYW1lT25lTGFiZWwgYW5kIEtleWZyYW1lVHdvTGFiZWwgYW5kIEFuaW1hdGlvblNwZWVkU2xpZGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXlmcmFtZU9uZUxhYmVsOlNldFZpc2liaWxpdHkodHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXlmcmFtZVR3b0xhYmVsOlNldFZpc2liaWxpdHkoZmFsc2UpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFuaW1hdGlvblNwZWVkU2xpZGVySXRlbXNbIlNsaWRlciJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgNjUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZENvbG9yID0gQ29sb3JwaWNrZXIuQ29sb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlRocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgU3BlZWQgPSBNYXRoQWJzKE1hdGhTaW4odGljaygpICogKEFuaW1hdGlvblNwZWVkU2xpZGVyLlZhbHVlIC8gMjUpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNldChLZXlmcmFtZU9uZUNvbG9ycGlja2VyLkNvbG9yOkxlcnAoRnJvbVJHQigwLCAwLCAwKSwgU3BlZWQpLCBDb2xvcnBpY2tlci5BbHBoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZVN5bmModHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDdXJyZW50QW5pbWF0aW9uIH49ICJGYWRlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0KE9sZENvbG9yLCBDb2xvcnBpY2tlci5BbHBoYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgVmFsdWUgPT0gIkZhZGUgYWxwaGEiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEtleWZyYW1lT25lTGFiZWwgYW5kIEtleWZyYW1lVHdvTGFiZWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleWZyYW1lT25lTGFiZWw6U2V0VmlzaWJpbGl0eShmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXlmcmFtZVR3b0xhYmVsOlNldFZpc2liaWxpdHkoZmFsc2UpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFuaW1hdGlvblNwZWVkU2xpZGVySXRlbXNbIlNsaWRlciJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgNDUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9sZENvbG9yID0gQ29sb3JwaWNrZXIuQWxwaGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlRocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgpIGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQWxwaGFWYWx1ZSA9IE1hdGhBYnMoTWF0aFNpbih0aWNrKCkgKiAoQW5pbWF0aW9uU3BlZWRTbGlkZXIuVmFsdWUgLyAyNSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0KENvbG9ycGlja2VyLkNvbG9yLCBBbHBoYVZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlU3luYyh0cnVlKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEN1cnJlbnRBbmltYXRpb24gfj0gIkZhZGUgYWxwaGEiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpTZXQoQ29sb3JwaWNrZXIuQ29sb3IsIE9sZEFscGhhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBWYWx1ZSA9PSAiTGluZWFyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBLZXlmcmFtZU9uZUxhYmVsIGFuZCBLZXlmcmFtZVR3b0xhYmVsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXlmcmFtZU9uZUxhYmVsOlNldFZpc2liaWxpdHkodHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXlmcmFtZVR3b0xhYmVsOlNldFZpc2liaWxpdHkodHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uU3BlZWRTbGlkZXJJdGVtc1siU2xpZGVyIl0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA4NSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2xkQ29sb3IgPSBDb2xvcnBpY2tlci5Db2xvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnk6VGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgdGFzay53YWl0KCkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTcGVlZCA9IE1hdGhBYnMoTWF0aFNpbih0aWNrKCkgKiAoQW5pbWF0aW9uU3BlZWRTbGlkZXIuVmFsdWUgLyAyNSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0KEtleWZyYW1lT25lQ29sb3JwaWNrZXIuQ29sb3I6TGVycChLZXlmcmFtZVR3b0NvbG9ycGlja2VyLkNvbG9yLCBTcGVlZCksIENvbG9ycGlja2VyLkFscGhhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlU3luYyh0cnVlKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEN1cnJlbnRBbmltYXRpb24gfj0gIkxpbmVhciIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNldChPbGRDb2xvciwgQ29sb3JwaWNrZXIuQWxwaGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEFuaW1hdGlvbnNEcm9wZG93bkl0ZW1zWyJEcm9wZG93biJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgMCkKICAgICAgICAgICAgICAgIEFuaW1hdGlvbnNEcm9wZG93bkl0ZW1zWyJEcm9wZG93biJdLkluc3RhbmNlLlNpemUgPSBVRGltMk5ldygxLCAtMTYsIDAsIDQwKQoKICAgICAgICAgICAgICAgIEtleWZyYW1lT25lTGFiZWwsIEtleWZyYW1lT25lTGFiZWxJdGVtcyA9IENvbXBvbmVudHM6TGFiZWwoewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEFuaW1hdGlvbnNUYWJJdGVtc1siUGFnZUNvbnRlbnQiXSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIktleWZyYW1lIDEiLAogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBLZXlmcmFtZU9uZUxhYmVsSXRlbXNbIkxhYmVsIl0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA0NSkKICAgICAgICAgICAgICAgIEtleWZyYW1lT25lTGFiZWxJdGVtc1siTGFiZWwiXS5JbnN0YW5jZS5TaXplID0gVURpbTJOZXcoMSwgLTE2LCAwLCAyMCkKCiAgICAgICAgICAgICAgICBLZXlmcmFtZVR3b0xhYmVsLCBLZXlmcmFtZVR3b0xhYmVsSXRlbXMgPSBDb21wb25lbnRzOkxhYmVsKHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBBbmltYXRpb25zVGFiSXRlbXNbIlBhZ2VDb250ZW50Il0sCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJLZXlmcmFtZSAyIiwKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgS2V5ZnJhbWVUd29MYWJlbEl0ZW1zWyJMYWJlbCJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgNjUpCiAgICAgICAgICAgICAgICBLZXlmcmFtZVR3b0xhYmVsSXRlbXNbIkxhYmVsIl0uSW5zdGFuY2UuU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgMjApCgogICAgICAgICAgICAgICAgS2V5ZnJhbWVPbmVDb2xvcnBpY2tlciwgS2V5ZnJhbWVPbmVDb2xvcnBpY2tlckl0ZW1zID0gQ29tcG9uZW50czpDb2xvcnBpY2tlcih7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gS2V5ZnJhbWVPbmVMYWJlbEl0ZW1zWyJTdWJFbGVtZW50cyJdLAogICAgICAgICAgICAgICAgICAgIEFscGhhID0gMCwKICAgICAgICAgICAgICAgICAgICBQYWdlcyA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSwKICAgICAgICAgICAgICAgICAgICBGbGFnID0gQ29sb3JwaWNrZXIuRmxhZy4uIkFuaW1hdGlvbiIuLiJLZXlmcmFtZTEiLAogICAgICAgICAgICAgICAgICAgIERlYm91bmNlID0gQ29sb3JwaWNrZXIsCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEtleWZyYW1lVHdvQ29sb3JwaWNrZXIsIEtleWZyYW1lVHdvQ29sb3JwaWNrZXJJdGVtcyA9IENvbXBvbmVudHM6Q29sb3JwaWNrZXIoewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEtleWZyYW1lVHdvTGFiZWxJdGVtc1siU3ViRWxlbWVudHMiXSwKICAgICAgICAgICAgICAgICAgICBBbHBoYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgUGFnZXMgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgRGVib3VuY2UgPSBDb2xvcnBpY2tlciwKICAgICAgICAgICAgICAgICAgICBGbGFnID0gQ29sb3JwaWNrZXIuRmxhZy4uIkFuaW1hdGlvbiIuLiJLZXlmcmFtZTIiLAogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBBbmltYXRpb25TcGVlZFNsaWRlciwgQW5pbWF0aW9uU3BlZWRTbGlkZXJJdGVtcyA9IENvbXBvbmVudHM6U2xpZGVyKHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBBbmltYXRpb25zVGFiSXRlbXNbIlBhZ2VDb250ZW50Il0sCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJTcGVlZCIsCiAgICAgICAgICAgICAgICAgICAgRmxhZyA9IENvbG9ycGlja2VyLkZsYWcgLi4gIkFuaW1hdGlvblNwZWVkIiwKICAgICAgICAgICAgICAgICAgICBNaW4gPSAwLAogICAgICAgICAgICAgICAgICAgIE1heCA9IDEwMCwKICAgICAgICAgICAgICAgICAgICBEZWNpbWFscyA9IDAuMSwKICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ID0gMjAsCiAgICAgICAgICAgICAgICAgICAgU3VmZml4ID0gIiUiLAogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBBbmltYXRpb25TcGVlZFNsaWRlckl0ZW1zWyJTbGlkZXIiXS5JbnN0YW5jZS5Qb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDg1KQogICAgICAgICAgICAgICAgQW5pbWF0aW9uU3BlZWRTbGlkZXJJdGVtc1siU2xpZGVyIl0uSW5zdGFuY2UuU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgMjgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgSXNTeW5jVG9nZ2xlZAoKICAgICAgICAgICAgaWYgT3RoZXJUYWIgdGhlbgogICAgICAgICAgICAgICAgSXRlbXNbIkN1cnJlbnRDb2xvciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gT3RoZXJUYWJJdGVtc1siUGFnZUNvbnRlbnQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDgpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgNTApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTU3LCAxNzUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siQ3VycmVudENvbG9yIl06QWRkVG9UaGVtZSh7Qm9yZGVyQ29sb3IzID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQ3VycmVudENvbG9yIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQ3VycmVudENvbG9yIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSA4MiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgRnJvbVJHQigxNTQsIDE1NCwgMTU0KSl9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJSR0JDb2xvciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IE90aGVyVGFiSXRlbXNbIlBhZ2VDb250ZW50Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIlJHQjoiLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAtMTYsIDAsIDE1KSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDY1KSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdCwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIFJpY2hUZXh0ID0gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkhFWENvbG9yIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gT3RoZXJUYWJJdGVtc1siUGFnZUNvbnRlbnQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiSEVYOiIsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgMTUpLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgODUpLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPSB0cnVlLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siSFNWQ29sb3IiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBPdGhlclRhYkl0ZW1zWyJQYWdlQ29udGVudCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJIU1Y6IiwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTE2LCAwLCAxNSksCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCAxMDUpLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPSB0cnVlLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBsb2NhbCBDb3B5TlBhc3RlQnV0dG9uLCBDb3B5TlBhc3RlQnV0dG9uSXRlbXMgPSBDb21wb25lbnRzOkJ1dHRvbih7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gT3RoZXJUYWJJdGVtc1siUGFnZUNvbnRlbnQiXSwKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgQ29weU5QYXN0ZUJ1dHRvbkl0ZW1zWyJCdXR0b24iXS5JbnN0YW5jZS5Qb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDE0NSkKICAgICAgICAgICAgICAgIENvcHlOUGFzdGVCdXR0b25JdGVtc1siQnV0dG9uIl0uSW5zdGFuY2UuU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgMjApCgogICAgICAgICAgICAgICAgQ29weU5QYXN0ZUJ1dHRvbjpBZGQoIkNvcHkiLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5Db3BpZWRDb2xvciA9IENvbG9ycGlja2VyLkNvbG9yCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgQ29weU5QYXN0ZUJ1dHRvbjpBZGQoIlBhc3RlIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuQ29waWVkQ29sb3IgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpTZXQoTGlicmFyeS5Db3BpZWRDb2xvcikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBsb2NhbCBTdGFzaCA9IHsgfQoKICAgICAgICAgICAgICAgIElzU3luY1RvZ2dsZWQgPSBmYWxzZQoKICAgICAgICAgICAgICAgIGxvY2FsIFN5bmNDb2xvcnBpY2tlcnNUb2dnbGUsIFN5bmNDb2xvcnBpY2tlclRvZ2dsZUl0ZW1zID0gQ29tcG9uZW50czpUb2dnbGUoewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IE90aGVyVGFiSXRlbXNbIlBhZ2VDb250ZW50Il0sCiAgICAgICAgICAgICAgICAgICAgRmxhZyA9ICJTeW5jQ29sb3JwaWNrZXJzIi4uQ29sb3JwaWNrZXIuRmxhZywKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlN5bmMgY29sb3JwaWNrZXJzIiwKICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgSXNTeW5jVG9nZ2xlZCA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExpYnJhcnkuQ29sb3JwaWNrZXJzIGRvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXNoW1ZhbHVlXSA9IFZhbHVlLkNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6U2V0KENvbG9ycGlja2VyLkNvbG9yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTGlicmFyeS5Db2xvcnBpY2tlcnMgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU3Rhc2hbVmFsdWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6U2V0KFN0YXNoW1ZhbHVlXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgU3luY0NvbG9ycGlja2VyVG9nZ2xlSXRlbXNbIlRvZ2dsZSJdLkluc3RhbmNlLlBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgMTI1KQogICAgICAgICAgICAgICAgU3luY0NvbG9ycGlja2VyVG9nZ2xlSXRlbXNbIlRvZ2dsZSJdLkluc3RhbmNlLlNpemUgPSBVRGltMk5ldygxLCAtMTYsIDAsIDEyKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIERlYm91bmNlID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgUmVuZGVyU3RlcHBlZCAgCgogICAgICAgICAgICBmdW5jdGlvbiBDb2xvcnBpY2tlcjpTZXRPcGVuKEJvb2wpCiAgICAgICAgICAgICAgICBpZiBEZWJvdW5jZSB0aGVuIAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXIuSXNPcGVuID0gQm9vbAoKICAgICAgICAgICAgICAgIERlYm91bmNlID0gdHJ1ZSAKCiAgICAgICAgICAgICAgICBpZiBDb2xvcnBpY2tlci5Jc09wZW4gdGhlbiAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQ29sb3JwaWNrZXJXaW5kb3ciXS5JbnN0YW5jZS5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJDb2xvcnBpY2tlcldpbmRvdyJdLkluc3RhbmNlLlBhcmVudCA9IExpYnJhcnkuSG9sZGVyLkluc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZCA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b24iXS5JbnN0YW5jZS5BYnNvbHV0ZVBvc2l0aW9uLlgsIDAsIEl0ZW1zWyJDb2xvcnBpY2tlckJ1dHRvbiJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWSArIEl0ZW1zWyJDb2xvcnBpY2tlckJ1dHRvbiJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5ZICsgNSkKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEYXRhLkRlYm91bmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMaWJyYXJ5Lk9wZW5GcmFtZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSB+PSBDb2xvcnBpY2tlciBhbmQgVmFsdWUgfj0gQW5pbWF0aW9uc0Ryb3Bkb3duSXRlbXMgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpTZXRPcGVuKGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5PcGVuRnJhbWVzW0NvbG9ycGlja2VyXSA9IENvbG9ycGlja2VyIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEYXRhLkRlYm91bmNlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuT3BlbkZyYW1lc1tDb2xvcnBpY2tlcl0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuT3BlbkZyYW1lc1tDb2xvcnBpY2tlcl0gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIFJlbmRlclN0ZXBwZWQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgRGVzY2VuZGFudHMgPSBJdGVtc1siQ29sb3JwaWNrZXJXaW5kb3ciXS5JbnN0YW5jZTpHZXREZXNjZW5kYW50cygpCiAgICAgICAgICAgICAgICBUYWJsZUluc2VydChEZXNjZW5kYW50cywgSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UpCgogICAgICAgICAgICAgICAgbG9jYWwgTmV3VHdlZW4KCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERlc2NlbmRhbnRzIGRvIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRyYW5zcGFyZW5jeVByb3BlcnR5ID0gVHdlZW46R2V0UHJvcGVydHkoVmFsdWUpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKFRyYW5zcGFyZW5jeVByb3BlcnR5KSA9PSAidGFibGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBQcm9wZXJ0eSBpbiBUcmFuc3BhcmVuY3lQcm9wZXJ0eSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld1R3ZWVuID0gVHdlZW46RmFkZUl0ZW0oVmFsdWUsIFByb3BlcnR5LCBCb29sLCBMaWJyYXJ5LkZhZGVTcGVlZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBOZXdUd2VlbiA9IFR3ZWVuOkZhZGVJdGVtKFZhbHVlLCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSwgQm9vbCwgTGlicmFyeS5GYWRlU3BlZWQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgTmV3VHdlZW4uVHdlZW4uQ29tcGxldGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIERlYm91bmNlID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UuVmlzaWJsZSA9IENvbG9ycGlja2VyLklzT3BlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0uSW5zdGFuY2UuUGFyZW50ID0gbm90IENvbG9ycGlja2VyLklzT3BlbiBhbmQgTGlicmFyeS5VbnVzZWRIb2xkZXIuSW5zdGFuY2Ugb3IgTGlicmFyeS5Ib2xkZXIuSW5zdGFuY2UKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBVcGRhdGVTeW5jID0gZnVuY3Rpb24oQm9vbCkKICAgICAgICAgICAgICAgIGlmIElzU3luY1RvZ2dsZWQgYW5kIEJvb2wgdGhlbiAKICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExpYnJhcnkuQ29sb3JwaWNrZXJzIGRvIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSB+PSBDb2xvcnBpY2tlciBhbmQgbm90IFN0cmluZ0ZpbmQoVmFsdWUuRmxhZywgIlRoZW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6U2V0KENvbG9ycGlja2VyLkNvbG9yKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIENvbG9ycGlja2VyOlVwZGF0ZShJc0Zyb21BbHBoYSwgVXBkYXRlU3luY2MpCiAgICAgICAgICAgICAgICBsb2NhbCBIdWUsIFNhdHVyYXRpb24sIFZhbHVlID0gQ29sb3JwaWNrZXIuSHVlLCBDb2xvcnBpY2tlci5TYXR1cmF0aW9uLCBDb2xvcnBpY2tlci5WYWx1ZQogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXIuQ29sb3IgPSBGcm9tSFNWKEh1ZSwgU2F0dXJhdGlvbiwgVmFsdWUpCiAgICAgICAgICAgICAgICBDb2xvcnBpY2tlci5IZXhWYWx1ZSA9IENvbG9ycGlja2VyLkNvbG9yOlRvSGV4KCkKCiAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0NvbG9ycGlja2VyLkZsYWddID0gewogICAgICAgICAgICAgICAgICAgIEFscGhhID0gQ29sb3JwaWNrZXIuQWxwaGEsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBDb2xvcnBpY2tlci5IZXhWYWx1ZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJDb2xvcnBpY2tlckJ1dHRvbiJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBDb2xvcnBpY2tlci5Db2xvcn0pCiAgICAgICAgICAgICAgICBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b25JbmxpbmUiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3JwaWNrZXIuQ29sb3J9KQoKICAgICAgICAgICAgICAgIFVwZGF0ZVN5bmMoVXBkYXRlU3luY2MpCgogICAgICAgICAgICAgICAgaWYgT3RoZXJUYWIgdGhlbgogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJDdXJyZW50Q29sb3IiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3JwaWNrZXIuQ29sb3J9KQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSZWQgPSBNYXRoRmxvb3IoQ29sb3JwaWNrZXIuQ29sb3IuUiAqIDI1NSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBHcmVlbiA9IE1hdGhGbG9vcihDb2xvcnBpY2tlci5Db2xvci5HICogMjU1KQogICAgICAgICAgICAgICAgICAgIGxvY2FsIEJsdWUgPSBNYXRoRmxvb3IoQ29sb3JwaWNrZXIuQ29sb3IuQiAqIDI1NSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBSZWRHcmVlbkJsdWUgPSB0b3N0cmluZyhSZWQpIC4uICIsICIgLi4gdG9zdHJpbmcoR3JlZW4pIC4uICIsICIgLi4gdG9zdHJpbmcoQmx1ZSkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgRmxvb3JIdWUsIEZsb29yU2F0LCBGbG9vclZhbCA9IG5pbCwgbmlsLCBuaWwKCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIlJHQkNvbG9yIl0uSW5zdGFuY2UuVGV4dCA9ICJSR0I6ICIuLlJlZEdyZWVuQmx1ZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJIU1ZDb2xvciJdLkluc3RhbmNlLlRleHQgPSBgSFNWOiAlMSwgJTEsICUxYAogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJIRVhDb2xvciJdLkluc3RhbmNlLlRleHQgPSAiSEVYOiAiIC4uICIjIiAuLiBDb2xvcnBpY2tlci5IZXhWYWx1ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgSXRlbXNbIlBhbGV0dGUiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbUhTVihIdWUsIDEsIDEpfSkKCiAgICAgICAgICAgICAgICBpZiBub3QgSXNGcm9tQWxwaGEgdGhlbiAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siQWxwaGEiXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3JwaWNrZXIuQ29sb3J9KQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuIAogICAgICAgICAgICAgICAgICAgIExpYnJhcnk6U2FmZUNhbGwoRGF0YS5DYWxsYmFjaywgQ29sb3JwaWNrZXIuQ29sb3IsIENvbG9ycGlja2VyLkFscGhhKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gQ29sb3JwaWNrZXI6U2V0KENvbG9yLCBBbHBoYSkKICAgICAgICAgICAgICAgIGlmIHR5cGUoQ29sb3IpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQihDb2xvclsxXSwgQ29sb3JbMl0sIENvbG9yWzNdKQogICAgICAgICAgICAgICAgICAgIEFscGhhID0gQ29sb3JbNF0KICAgICAgICAgICAgICAgIGVsc2VpZiB0eXBlKENvbG9yKSA9PSAic3RyaW5nIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tSGV4KENvbG9yKQogICAgICAgICAgICAgICAgZW5kIAoKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyLkh1ZSwgQ29sb3JwaWNrZXIuU2F0dXJhdGlvbiwgQ29sb3JwaWNrZXIuVmFsdWUgPSBDb2xvcjpUb0hTVigpCiAgICAgICAgICAgICAgICBDb2xvcnBpY2tlci5BbHBoYSA9IEFscGhhIG9yIDAgIAoKICAgICAgICAgICAgICAgIGxvY2FsIFBhbGV0dGVWYWx1ZVggPSBNYXRoQ2xhbXAoMSAtIENvbG9ycGlja2VyLlNhdHVyYXRpb24sIDAsIDAuOTkpCiAgICAgICAgICAgICAgICBsb2NhbCBQYWxldHRlVmFsdWVZID0gTWF0aENsYW1wKDEgLSBDb2xvcnBpY2tlci5WYWx1ZSwgMCwgMC45OSkKCiAgICAgICAgICAgICAgICBsb2NhbCBBbHBoYVBvc2l0aW9uWCA9IE1hdGhDbGFtcChDb2xvcnBpY2tlci5BbHBoYSwgMCwgMC45OTUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBIdWVQb3NpdGlvblkgPSBNYXRoQ2xhbXAoQ29sb3JwaWNrZXIuSHVlLCAwLCAwLjk5NSkKCiAgICAgICAgICAgICAgICBJdGVtc1siUGFsZXR0ZURyYWdnZXIiXTpUd2VlbihUd2VlbkluZm8ubmV3KExpYnJhcnkuVHdlZW4uVGltZSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTJOZXcoUGFsZXR0ZVZhbHVlWCwgMCwgUGFsZXR0ZVZhbHVlWSwgMCl9KQogICAgICAgICAgICAgICAgSXRlbXNbIkh1ZURyYWdnZXIiXTpUd2VlbihUd2VlbkluZm8ubmV3KExpYnJhcnkuVHdlZW4uVGltZSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgSHVlUG9zaXRpb25ZLCAwKX0pCiAgICAgICAgICAgICAgICBJdGVtc1siQWxwaGFEcmFnZ2VyIl06VHdlZW4oVHdlZW5JbmZvLm5ldyhMaWJyYXJ5LlR3ZWVuLlRpbWUsIEVudW0uRWFzaW5nU3R5bGUuUXVhcnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVEaW0yTmV3KEFscGhhUG9zaXRpb25YLCAwLCAwLCAwKX0pCiAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpVcGRhdGUodHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBJdGVtc1siQ29sb3JwaWNrZXJCdXR0b24iXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjFEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0T3Blbihub3QgQ29sb3JwaWNrZXIuSXNPcGVuKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBTbGlkaW5nUGFsZXR0ZSA9IGZhbHNlCiAgICAgICAgICAgIGxvY2FsIFBhbGV0dGVDaGFuZ2VkCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBDb2xvcnBpY2tlcjpTbGlkZVBhbGV0dGUoSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBub3QgSW5wdXQgb3Igbm90IFNsaWRpbmdQYWxldHRlIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIFZhbHVlWCA9IE1hdGhDbGFtcCgxIC0gKElucHV0LlBvc2l0aW9uLlggLSBJdGVtc1siUGFsZXR0ZSJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWCkgLyBJdGVtc1siUGFsZXR0ZSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YLCAwLCAxKQogICAgICAgICAgICAgICAgbG9jYWwgVmFsdWVZID0gTWF0aENsYW1wKDEgLSAoSW5wdXQuUG9zaXRpb24uWSAtIEl0ZW1zWyJQYWxldHRlIl0uSW5zdGFuY2UuQWJzb2x1dGVQb3NpdGlvbi5ZKSAvIEl0ZW1zWyJQYWxldHRlIl0uSW5zdGFuY2UuQWJzb2x1dGVTaXplLlksIDAsIDEpCgogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXIuU2F0dXJhdGlvbiA9IFZhbHVlWAogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXIuVmFsdWUgPSBWYWx1ZVkKCiAgICAgICAgICAgICAgICBsb2NhbCBTbGlkZVggPSBNYXRoQ2xhbXAoKElucHV0LlBvc2l0aW9uLlggLSBJdGVtc1siUGFsZXR0ZSJdLkluc3RhbmNlLkFic29sdXRlUG9zaXRpb24uWCkgLyBJdGVtc1siUGFsZXR0ZSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YLCAwLCAwLjk5KQogICAgICAgICAgICAgICAgbG9jYWwgU2xpZGVZID0gTWF0aENsYW1wKChJbnB1dC5Qb3NpdGlvbi5ZIC0gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZS5BYnNvbHV0ZVBvc2l0aW9uLlkpIC8gSXRlbXNbIlBhbGV0dGUiXS5JbnN0YW5jZS5BYnNvbHV0ZVNpemUuWSwgMCwgMC45OSkKCiAgICAgICAgICAgICAgICBJdGVtc1siUGFsZXR0ZURyYWdnZXIiXTpUd2VlbihUd2VlbkluZm8ubmV3KExpYnJhcnkuVHdlZW4uVGltZSwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1Bvc2l0aW9uID0gVURpbTJOZXcoU2xpZGVYLCAwLCBTbGlkZVksIDApfSkKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlVwZGF0ZShmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBTbGlkaW5nSHVlID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgSHVlQ2hhbmdlZAoKICAgICAgICAgICAgZnVuY3Rpb24gQ29sb3JwaWNrZXI6U2xpZGVIdWUoSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBub3QgSW5wdXQgb3Igbm90IFNsaWRpbmdIdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFZhbHVlWSA9IE1hdGhDbGFtcCgoSW5wdXQuUG9zaXRpb24uWSAtIEl0ZW1zWyJIdWUiXS5JbnN0YW5jZS5BYnNvbHV0ZVBvc2l0aW9uLlkpIC8gSXRlbXNbIkh1ZSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5ZLCAwLCAxKQoKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyLkh1ZSA9IFZhbHVlWQoKICAgICAgICAgICAgICAgIGxvY2FsIFNsaWRlWSA9IE1hdGhDbGFtcCgoSW5wdXQuUG9zaXRpb24uWSAtIEl0ZW1zWyJIdWUiXS5JbnN0YW5jZS5BYnNvbHV0ZVBvc2l0aW9uLlkpIC8gSXRlbXNbIkh1ZSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5ZLCAwLCAwLjk5NSkKCiAgICAgICAgICAgICAgICBJdGVtc1siSHVlRHJhZ2dlciJdOlR3ZWVuKFR3ZWVuSW5mby5uZXcoTGlicmFyeS5Ud2Vlbi5UaW1lLCBFbnVtLkVhc2luZ1N0eWxlLlF1YXJ0LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7UG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCBTbGlkZVksIDApfSkKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlVwZGF0ZShmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBTbGlkaW5nQWxwaGEgPSBmYWxzZSAKICAgICAgICAgICAgbG9jYWwgQWxwaGFDaGFuZ2VkCgogICAgICAgICAgICBmdW5jdGlvbiBDb2xvcnBpY2tlcjpTbGlkZUFscGhhKElucHV0KQogICAgICAgICAgICAgICAgaWYgbm90IElucHV0IG9yIG5vdCBTbGlkaW5nQWxwaGEgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgVmFsdWVYID0gTWF0aENsYW1wKChJbnB1dC5Qb3NpdGlvbi5YIC0gSXRlbXNbIkFscGhhIl0uSW5zdGFuY2UuQWJzb2x1dGVQb3NpdGlvbi5YKSAvIEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YLCAwLCAxKQoKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyLkFscGhhID0gVmFsdWVYCgogICAgICAgICAgICAgICAgbG9jYWwgU2xpZGVYID0gTWF0aENsYW1wKChJbnB1dC5Qb3NpdGlvbi5YIC0gSXRlbXNbIkFscGhhIl0uSW5zdGFuY2UuQWJzb2x1dGVQb3NpdGlvbi5YKSAvIEl0ZW1zWyJBbHBoYSJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5YLCAwLCAwLjk5NSkKCiAgICAgICAgICAgICAgICBJdGVtc1siQWxwaGFEcmFnZ2VyIl06VHdlZW4oVHdlZW5JbmZvLm5ldyhMaWJyYXJ5LlR3ZWVuLlRpbWUsIEVudW0uRWFzaW5nU3R5bGUuUXVhcnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtQb3NpdGlvbiA9IFVEaW0yTmV3KFNsaWRlWCwgMCwgMCwgMCl9KQogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6VXBkYXRlKHRydWUsIHRydWUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgSXRlbXNbIlBhbGV0dGUiXTpDb25uZWN0KCJJbnB1dEJlZ2FuIiwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIFNsaWRpbmdQYWxldHRlID0gdHJ1ZSAKCiAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2xpZGVQYWxldHRlKElucHV0KQoKICAgICAgICAgICAgICAgICAgICBpZiBQYWxldHRlQ2hhbmdlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBQYWxldHRlQ2hhbmdlZCA9IElucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRpbmdQYWxldHRlID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWxldHRlQ2hhbmdlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhbGV0dGVDaGFuZ2VkID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siSHVlSW5saW5lIl06Q29ubmVjdCgiSW5wdXRCZWdhbiIsIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBTbGlkaW5nSHVlID0gdHJ1ZSAKCiAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2xpZGVIdWUoSW5wdXQpCgogICAgICAgICAgICAgICAgICAgIGlmIEh1ZUNoYW5nZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgSHVlQ2hhbmdlZCA9IElucHV0LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFN0YXRlID09IEVudW0uVXNlcklucHV0U3RhdGUuRW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRpbmdIdWUgPSBmYWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEh1ZUNoYW5nZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIdWVDaGFuZ2VkID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siQWxwaGEiXTpDb25uZWN0KCJJbnB1dEJlZ2FuIiwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIFNsaWRpbmdBbHBoYSA9IHRydWUgCgogICAgICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNsaWRlQWxwaGEoSW5wdXQpCgogICAgICAgICAgICAgICAgICAgIGlmIEFscGhhQ2hhbmdlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBBbHBoYUNoYW5nZWQgPSBJbnB1dC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRTdGF0ZSA9PSBFbnVtLlVzZXJJbnB1dFN0YXRlLkVuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbGlkaW5nQWxwaGEgPSBmYWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFscGhhQ2hhbmdlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFscGhhQ2hhbmdlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTGlicmFyeTpDb25uZWN0KFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRDaGFuZ2VkLCBmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlTW92ZW1lbnQgb3IgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIFNsaWRpbmdQYWxldHRlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNsaWRlUGFsZXR0ZShJbnB1dCkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgU2xpZGluZ0h1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNsaWRlSHVlKElucHV0KQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBTbGlkaW5nQWxwaGEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDb2xvcnBpY2tlcjpTbGlkZUFscGhhKElucHV0KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIExpYnJhcnk6Q29ubmVjdChVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW4sIGZ1bmN0aW9uKElucHV0KQogICAgICAgICAgICAgICAgaWYgSW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ29sb3JwaWNrZXIuSXNPcGVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6SXNNb3VzZU92ZXJGcmFtZShJdGVtc1siQ29sb3JwaWNrZXJXaW5kb3ciXSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgS2V5ZnJhbWVPbmVMYWJlbCBhbmQgS2V5ZnJhbWVUd29MYWJlbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6SXNNb3VzZU92ZXJGcmFtZShLZXlmcmFtZU9uZUNvbG9ycGlja2VySXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6SXNNb3VzZU92ZXJGcmFtZShLZXlmcmFtZVR3b0NvbG9ycGlja2VySXRlbXNbIkNvbG9ycGlja2VyV2luZG93Il0pIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0T3BlbihmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBpZiBEYXRhLkRlZmF1bHQgdGhlbgogICAgICAgICAgICAgICAgQ29sb3JwaWNrZXI6U2V0KERhdGEuRGVmYXVsdCwgRGF0YS5BbHBoYSkKICAgICAgICAgICAgICAgIE9sZENvbG9yID0gQ29sb3JwaWNrZXIuQ29sb3IKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBMaWJyYXJ5LkNvbG9ycGlja2Vyc1tDb2xvcnBpY2tlcl0gPSBDb2xvcnBpY2tlcgoKICAgICAgICAgICAgTGlicmFyeS5TZXRGbGFnc1tDb2xvcnBpY2tlci5GbGFnXSA9IGZ1bmN0aW9uKFZhbHVlLCBBbHBoYSkKICAgICAgICAgICAgICAgIENvbG9ycGlja2VyOlNldChWYWx1ZSwgQWxwaGEpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIENvbG9ycGlja2VyLCBJdGVtcwogICAgICAgIGVuZAoKICAgICAgICBDb21wb25lbnRzLktleWJpbmQgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBsb2NhbCBLZXliaW5kID0geyAKICAgICAgICAgICAgICAgIElzT3BlbiA9IGZhbHNlLAoKICAgICAgICAgICAgICAgIEtleSA9ICIiLAogICAgICAgICAgICAgICAgVmFsdWUgPSAiIiwKCiAgICAgICAgICAgICAgICBGbGFnID0gRGF0YS5GbGFnLAoKICAgICAgICAgICAgICAgIE1vZGUgPSAiIiwKCiAgICAgICAgICAgICAgICBUb2dnbGVkID0gZmFsc2UsCgogICAgICAgICAgICAgICAgUGlja2luZyA9IGZhbHNlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIEtleWxpc3RJdGVtCgogICAgICAgICAgICBpZiBMaWJyYXJ5LktleUxpc3QgdGhlbgogICAgICAgICAgICAgICAgS2V5bGlzdEl0ZW0gPSBMaWJyYXJ5LktleUxpc3Q6QWRkKCIiLCAiIiwgIiIpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJLZXlCdXR0b24iXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gRGF0YS5QYXJlbnQuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgVGV4dFRyYW5zcGFyZW5jeSA9IDAuNDAwMDAwMDA1OTYwNDY0NSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIk1CMiIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIktleUJ1dHRvbiJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBJdGVtc1siS2V5QnV0dG9uIl06VGV4dEJvcmRlcigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEl0ZW1zWyJLZXliaW5kV2luZG93Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5LlVudXNlZEhvbGRlci5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAuMDA3NjkyMzA3Njk5NDcxNzEyLCAwLCAwLjM1MzIzMzg0NDA0MTgyNDM0LCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCA3MCwgMCwgOTApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTQsIDE3LCAxNSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siS2V5YmluZFdpbmRvdyJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQmFja2dyb3VuZCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVG9nZ2xlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0QnV0dG9uIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJLZXliaW5kV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gIlRvZ2dsZSIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA4KSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTE2LCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAyLCAyNDMsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siVG9nZ2xlIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJBY2NlbnQiLCBUZXh0Q29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVG9nZ2xlIl06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIktleWJpbmRXaW5kb3ciXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkhvbGQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCdXR0b24iLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIktleWJpbmRXaW5kb3ciXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiSG9sZCIsCiAgICAgICAgICAgICAgICAgICAgQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCAzOCksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC0xNiwgMCwgMjApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkhvbGQiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkFjY2VudCIsIFRleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJIb2xkIl06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSXRlbXNbIkFsd2F5cyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siS2V5YmluZFdpbmRvdyJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJBbHdheXMiLAogICAgICAgICAgICAgICAgICAgIEF1dG9CdXR0b25Db2xvciA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMCwgNjgpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAtMTYsIDAsIDIwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMDIsIDI0MywgMjU1KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJBbHdheXMiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkFjY2VudCIsIFRleHRDb2xvcjMgPSAiVGV4dCJ9KSAgCgogICAgICAgICAgICAgICAgSXRlbXNbIkFsd2F5cyJdOlRleHRCb3JkZXIoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIE1vZGVzID0gewogICAgICAgICAgICAgICAgWyJUb2dnbGUiXSA9IEl0ZW1zWyJUb2dnbGUiXSwKICAgICAgICAgICAgICAgIFsiSG9sZCJdID0gSXRlbXNbIkhvbGQiXSwKICAgICAgICAgICAgICAgIFsiQWx3YXlzIl0gPSBJdGVtc1siQWx3YXlzIl0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgVXBkYXRlID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgS2V5bGlzdEl0ZW0gdGhlbgogICAgICAgICAgICAgICAgICAgIEtleWxpc3RJdGVtOlNldFRleHQoS2V5YmluZC5WYWx1ZSwgRGF0YS5OYW1lLCBLZXliaW5kLk1vZGUpCiAgICAgICAgICAgICAgICAgICAgS2V5bGlzdEl0ZW06U2V0U3RhdHVzKEtleWJpbmQuVG9nZ2xlZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIEtleWJpbmQ6R2V0KCkKICAgICAgICAgICAgICAgIHJldHVybiBLZXliaW5kLktleSwgS2V5YmluZC5Nb2RlLCBLZXliaW5kLlRvZ2dsZWQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBLZXliaW5kOlNldChLZXkpCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdGaW5kKHRvc3RyaW5nKEtleSksICJFbnVtIikgdGhlbiAKICAgICAgICAgICAgICAgICAgICBLZXliaW5kLktleSA9IHRvc3RyaW5nKEtleSkKCiAgICAgICAgICAgICAgICAgICAgS2V5ID0gS2V5Lk5hbWUgPT0gIkJhY2tzcGFjZSIgYW5kICJOb25lIiBvciBLZXkuTmFtZQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBLZXlTdHJpbmcgPSBLZXlzW0tleWJpbmQuS2V5XSBvciBTdHJpbmdHU3ViKEtleSwgIkVudW0uIiwgIiIpIG9yICJOb25lIgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRleHRUb0Rpc3BsYXkgPSBTdHJpbmdHU3ViKFN0cmluZ0dTdWIoS2V5U3RyaW5nLCAiS2V5Q29kZS4iLCAiIiksICJVc2VySW5wdXRUeXBlLiIsICIiKSBvciAiTm9uZSIKCiAgICAgICAgICAgICAgICAgICAgS2V5YmluZC5WYWx1ZSA9IFRleHRUb0Rpc3BsYXkKICAgICAgICAgICAgICAgICAgICBJdGVtc1siS2V5QnV0dG9uIl0uSW5zdGFuY2UuVGV4dCA9IFRleHRUb0Rpc3BsYXkKCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5GbGFnc1tLZXliaW5kLkZsYWddID0gewogICAgICAgICAgICAgICAgICAgICAgICBNb2RlID0gS2V5YmluZC5Nb2RlLAogICAgICAgICAgICAgICAgICAgICAgICBLZXkgPSBLZXliaW5kLktleSwKICAgICAgICAgICAgICAgICAgICAgICAgVG9nZ2xlZCA9IEtleWJpbmQuVG9nZ2xlZAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OlNhZmVDYWxsKERhdGEuQ2FsbGJhY2ssIEtleWJpbmQuVG9nZ2xlZCkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlKCkKICAgICAgICAgICAgICAgIGVsc2VpZiB0eXBlKEtleSkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUmVhbEtleSA9IEtleS5LZXkgPT0gIkJhY2tzcGFjZSIgYW5kICJOb25lIiBvciBLZXkuS2V5CiAgICAgICAgICAgICAgICAgICAgS2V5YmluZC5LZXkgPSB0b3N0cmluZyhLZXkuS2V5KQoKICAgICAgICAgICAgICAgICAgICBpZiBLZXkuTW9kZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQuTW9kZSA9IEtleS5Nb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0TW9kZShLZXkuTW9kZSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQuTW9kZSA9ICJUb2dnbGUiCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0TW9kZSgiVG9nZ2xlIikKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgS2V5U3RyaW5nID0gS2V5c1tLZXliaW5kLktleV0gb3IgU3RyaW5nR1N1Yih0b3N0cmluZyhSZWFsS2V5KSwgIkVudW0uIiwgIiIpIG9yIFJlYWxLZXkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUZXh0VG9EaXNwbGF5ID0gS2V5U3RyaW5nIGFuZCBTdHJpbmdHU3ViKFN0cmluZ0dTdWIoS2V5U3RyaW5nLCAiS2V5Q29kZS4iLCAiIiksICJVc2VySW5wdXRUeXBlLiIsICIiKSBvciAiTm9uZSIKCiAgICAgICAgICAgICAgICAgICAgVGV4dFRvRGlzcGxheSA9IFN0cmluZ0dTdWIoU3RyaW5nR1N1YihLZXlTdHJpbmcsICJLZXlDb2RlLiIsICIiKSwgIlVzZXJJbnB1dFR5cGUuIiwgIiIpCgogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuVmFsdWUgPSBUZXh0VG9EaXNwbGF5CiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIktleUJ1dHRvbiJdLkluc3RhbmNlLlRleHQgPSBUZXh0VG9EaXNwbGF5CgogICAgICAgICAgICAgICAgICAgIGlmIERhdGEuQ2FsbGJhY2sgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBLZXliaW5kLlRvZ2dsZWQpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZSgpCiAgICAgICAgICAgICAgICBlbHNlaWYgVGFibGVGaW5kKHsiVG9nZ2xlIiwgIkhvbGQiLCAiQWx3YXlzIn0sIEtleSkgdGhlbgogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuTW9kZSA9IEtleQogICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0TW9kZShLZXliaW5kLk1vZGUpCgogICAgICAgICAgICAgICAgICAgIGlmIERhdGEuQ2FsbGJhY2sgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBLZXliaW5kLlRvZ2dsZWQpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBLZXliaW5kLlBpY2tpbmcgPSBmYWxzZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIERlYm91bmNlID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgUmVuZGVyU3RlcHBlZCAgCgogICAgICAgICAgICBmdW5jdGlvbiBLZXliaW5kOlNldE9wZW4oQm9vbCkKICAgICAgICAgICAgICAgIGlmIERlYm91bmNlIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBLZXliaW5kLklzT3BlbiA9IEJvb2wKCiAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IHRydWUgCgogICAgICAgICAgICAgICAgaWYgS2V5YmluZC5Jc09wZW4gdGhlbiAKICAgICAgICAgICAgICAgICAgICBJdGVtc1siS2V5YmluZFdpbmRvdyJdLkluc3RhbmNlLlZpc2libGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgSXRlbXNbIktleWJpbmRXaW5kb3ciXS5JbnN0YW5jZS5QYXJlbnQgPSBMaWJyYXJ5LkhvbGRlci5JbnN0YW5jZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFJlbmRlclN0ZXBwZWQgPSBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJLZXliaW5kV2luZG93Il0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCBJdGVtc1siS2V5QnV0dG9uIl0uSW5zdGFuY2UuQWJzb2x1dGVQb3NpdGlvbi5YLCAwLCBJdGVtc1siS2V5QnV0dG9uIl0uSW5zdGFuY2UuQWJzb2x1dGVQb3NpdGlvbi5ZICsgSXRlbXNbIktleUJ1dHRvbiJdLkluc3RhbmNlLkFic29sdXRlU2l6ZS5ZICsgNSkKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBEZWJvdW5jZSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIExpYnJhcnkuT3BlbkZyYW1lcyBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlIH49IEtleWJpbmQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpTZXRPcGVuKGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5PcGVuRnJhbWVzW0tleWJpbmRdID0gS2V5YmluZCAKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBub3QgRGVib3VuY2UgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgTGlicmFyeS5PcGVuRnJhbWVzW0tleWJpbmRdIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Lk9wZW5GcmFtZXNbS2V5YmluZF0gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIFJlbmRlclN0ZXBwZWQgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZCA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgRGVzY2VuZGFudHMgPSBJdGVtc1siS2V5YmluZFdpbmRvdyJdLkluc3RhbmNlOkdldERlc2NlbmRhbnRzKCkKICAgICAgICAgICAgICAgIFRhYmxlSW5zZXJ0KERlc2NlbmRhbnRzLCBJdGVtc1siS2V5YmluZFdpbmRvdyJdLkluc3RhbmNlKQoKICAgICAgICAgICAgICAgIGxvY2FsIE5ld1R3ZWVuCgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBEZXNjZW5kYW50cyBkbyAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSA9IFR3ZWVuOkdldFByb3BlcnR5KFZhbHVlKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgVHJhbnNwYXJlbmN5UHJvcGVydHkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSAKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgdHlwZShUcmFuc3BhcmVuY3lQcm9wZXJ0eSkgPT0gInRhYmxlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgUHJvcGVydHkgaW4gVHJhbnNwYXJlbmN5UHJvcGVydHkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXdUd2VlbiA9IFR3ZWVuOkZhZGVJdGVtKFZhbHVlLCBQcm9wZXJ0eSwgQm9vbCwgTGlicmFyeS5GYWRlU3BlZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgTmV3VHdlZW4gPSBUd2VlbjpGYWRlSXRlbShWYWx1ZSwgVHJhbnNwYXJlbmN5UHJvcGVydHksIEJvb2wsIExpYnJhcnkuRmFkZVNwZWVkKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIE5ld1R3ZWVuLlR3ZWVuLkNvbXBsZXRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IGZhbHNlIAogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJLZXliaW5kV2luZG93Il0uSW5zdGFuY2UuVmlzaWJsZSA9IEtleWJpbmQuSXNPcGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMikKICAgICAgICAgICAgICAgICAgICBJdGVtc1siS2V5YmluZFdpbmRvdyJdLkluc3RhbmNlLlBhcmVudCA9IG5vdCBLZXliaW5kLklzT3BlbiBhbmQgTGlicmFyeS5VbnVzZWRIb2xkZXIuSW5zdGFuY2Ugb3IgTGlicmFyeS5Ib2xkZXIuSW5zdGFuY2UKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBLZXliaW5kOlNldE1vZGUoTW9kZSkKICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gTW9kZXMgZG8gCiAgICAgICAgICAgICAgICAgICAgaWYgSW5kZXggPT0gTW9kZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbS2V5YmluZC5GbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICBNb2RlID0gS2V5YmluZC5Nb2RlLAogICAgICAgICAgICAgICAgICAgIEtleSA9IEtleWJpbmQuS2V5LAogICAgICAgICAgICAgICAgICAgIFRvZ2dsZWQgPSBLZXliaW5kLlRvZ2dsZWQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiBEYXRhLkNhbGxiYWNrIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBLZXliaW5kLlRvZ2dsZWQpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBVcGRhdGUoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIEtleWJpbmQ6UHJlc3MoQm9vbCkKICAgICAgICAgICAgICAgIGlmIEtleWJpbmQuTW9kZSA9PSAiVG9nZ2xlIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuVG9nZ2xlZCA9IG5vdCBLZXliaW5kLlRvZ2dsZWQKICAgICAgICAgICAgICAgIGVsc2VpZiBLZXliaW5kLk1vZGUgPT0gIkhvbGQiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgS2V5YmluZC5Ub2dnbGVkID0gQm9vbAogICAgICAgICAgICAgICAgZWxzZWlmIEtleWJpbmQuTW9kZSA9PSAiQWx3YXlzIiB0aGVuIAogICAgICAgICAgICAgICAgICAgIEtleWJpbmQuVG9nZ2xlZCA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbS2V5YmluZC5GbGFnXSA9IHsKICAgICAgICAgICAgICAgICAgICBNb2RlID0gS2V5YmluZC5Nb2RlLAogICAgICAgICAgICAgICAgICAgIEtleSA9IEtleWJpbmQuS2V5LAogICAgICAgICAgICAgICAgICAgIFRvZ2dsZWQgPSBLZXliaW5kLlRvZ2dsZWQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiBEYXRhLkNhbGxiYWNrIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBLZXliaW5kLlRvZ2dsZWQpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBVcGRhdGUoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIEl0ZW1zWyJLZXlCdXR0b24iXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjFDbGljayIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIEtleWJpbmQuUGlja2luZyA9IHRydWUgCgogICAgICAgICAgICAgICAgSXRlbXNbIktleUJ1dHRvbiJdLkluc3RhbmNlLlRleHQgPSAiLiIKICAgICAgICAgICAgICAgIExpYnJhcnk6VGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBDb3VudCA9IDEKCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEtleWJpbmQuUGlja2luZyB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb3VudCA9PSA0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvdW50ID0gMQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJLZXlCdXR0b24iXS5JbnN0YW5jZS5UZXh0ID0gQ291bnQgPT0gMSBhbmQgIi4iIG9yIENvdW50ID09IDIgYW5kICIuLiIgb3IgQ291bnQgPT0gMyBhbmQgIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgQ291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgIGxvY2FsIElucHV0QmVnYW4KICAgICAgICAgICAgICAgIElucHV0QmVnYW4gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgICAgICAgICBpZiBJbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBLZXliaW5kOlNldChJbnB1dC5LZXlDb2RlKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgS2V5YmluZDpTZXQoSW5wdXQuVXNlcklucHV0VHlwZSkKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgSW5wdXRCZWdhbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBJbnB1dEJlZ2FuID0gbmlsCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJLZXlCdXR0b24iXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjJEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgS2V5YmluZDpTZXRPcGVuKG5vdCBLZXliaW5kLklzT3BlbikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTGlicmFyeTpDb25uZWN0KFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbiwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBLZXliaW5kLlZhbHVlID09ICJOb25lIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhJbnB1dC5LZXlDb2RlKSA9PSBLZXliaW5kLktleSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgS2V5YmluZC5Nb2RlID09ICJUb2dnbGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3MoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBLZXliaW5kLk1vZGUgPT0gIkhvbGQiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3ModHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgS2V5YmluZC5Nb2RlID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3ModHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiB0b3N0cmluZyhJbnB1dC5Vc2VySW5wdXRUeXBlKSA9PSBLZXliaW5kLktleSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgS2V5YmluZC5Nb2RlID09ICJUb2dnbGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3MoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBLZXliaW5kLk1vZGUgPT0gIkhvbGQiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3ModHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgS2V5YmluZC5Nb2RlID09ICJBbHdheXMiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3ModHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIElucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEtleWJpbmQuSXNPcGVuIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6SXNNb3VzZU92ZXJGcmFtZShJdGVtc1siS2V5YmluZFdpbmRvdyJdKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBLZXliaW5kOlNldE9wZW4oZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgTGlicmFyeTpDb25uZWN0KFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRFbmRlZCwgZnVuY3Rpb24oSW5wdXQpCiAgICAgICAgICAgICAgICBpZiBLZXliaW5kLlZhbHVlID09ICJOb25lIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiB0b3N0cmluZyhJbnB1dC5LZXlDb2RlKSA9PSBLZXliaW5kLktleSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgS2V5YmluZC5Nb2RlID09ICJIb2xkIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBLZXliaW5kOlByZXNzKGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBLZXliaW5kLk1vZGUgPT0gIkFsd2F5cyIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgS2V5YmluZDpQcmVzcyh0cnVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIHRvc3RyaW5nKElucHV0LlVzZXJJbnB1dFR5cGUpID09IEtleWJpbmQuS2V5IHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBLZXliaW5kLk1vZGUgPT0gIkhvbGQiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmQ6UHJlc3MoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIEtleWJpbmQuTW9kZSA9PSAiQWx3YXlzIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBLZXliaW5kOlByZXNzKHRydWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgSXRlbXNbIlRvZ2dsZSJdOkNvbm5lY3QoIk1vdXNlQnV0dG9uMURvd24iLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBLZXliaW5kLk1vZGUgPSAiVG9nZ2xlIgogICAgICAgICAgICAgICAgS2V5YmluZDpTZXRNb2RlKCJUb2dnbGUiKQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBJdGVtc1siSG9sZCJdOkNvbm5lY3QoIk1vdXNlQnV0dG9uMURvd24iLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBLZXliaW5kLk1vZGUgPSAiSG9sZCIKICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0TW9kZSgiSG9sZCIpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJBbHdheXMiXTpDb25uZWN0KCJNb3VzZUJ1dHRvbjFEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgS2V5YmluZC5Nb2RlID0gIkFsd2F5cyIKICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0TW9kZSgiQWx3YXlzIikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgaWYgRGF0YS5EZWZhdWx0IHRoZW4KICAgICAgICAgICAgICAgIEtleWJpbmQ6U2V0KHtLZXkgPSBEYXRhLkRlZmF1bHQsIE1vZGUgPSBEYXRhLk1vZGUgb3IgIlRvZ2dsZSJ9KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIExpYnJhcnkuU2V0RmxhZ3NbS2V5YmluZC5GbGFnXSA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgS2V5YmluZDpTZXQoVmFsdWUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIEtleWJpbmQsIEl0ZW1zIAogICAgICAgIGVuZAoKICAgICAgICBDb21wb25lbnRzLlRleHRib3ggPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgICAgICBsb2NhbCBUZXh0Ym94ID0gewogICAgICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZywKICAgICAgICAgICAgICAgIFZhbHVlID0gIiIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJUZXh0Ym94Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhcmVudC5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCA0MCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJUZXh0Ym94Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBUZXh0ID0gRGF0YS5OYW1lLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAwLCAxNSksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIlRleHQiXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siVGV4dCJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJCYWNrZ3JvdW5kIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siVGV4dGJveCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAxKSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDIwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDMwLCAzNiwgMzEpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIkJhY2tncm91bmQiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siQmFja2dyb3VuZCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gLTE2NSwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgRnJvbVJHQigyMDgsIDIwOCwgMjA4KSl9CiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBMaWJyYXJ5LlRoZW1lLkdyYWRpZW50KX0KICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkJhY2tncm91bmQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIklucHV0Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0Qm94IiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJCYWNrZ3JvdW5kIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICAgICAgUGxhY2Vob2xkZXJDb2xvcjMgPSBGcm9tUkdCKDE4NSwgMTg1LCAxODUpLAogICAgICAgICAgICAgICAgICAgIFBsYWNlaG9sZGVyVGV4dCA9IERhdGEuUGxhY2Vob2xkZXIsCiAgICAgICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBDbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFRleHQgPSAiIiwKICAgICAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdCwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIENsZWFyVGV4dE9uRm9jdXMgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIklucHV0Il06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0IiwgUGxhY2Vob2xkZXJDb2xvcjMgPSAiUGxhY2Vob2xkZXIgVGV4dCJ9KQoKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbnB1dCJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW5wdXQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IFVEaW1OZXcoMCwgOCksCiAgICAgICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gVURpbU5ldygwLCA4KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBUZXh0Ym94OkdldCgpCiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dGJveC5WYWx1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIFRleHRib3g6U2V0VmlzaWJpbGl0eShCb29sKQogICAgICAgICAgICAgICAgSXRlbXNbIlRleHRib3giXS5JbnN0YW5jZS5WaXNpYmxlID0gQm9vbAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIFRleHRib3g6U2V0KFZhbHVlKQogICAgICAgICAgICAgICAgaWYgRGF0YS5OdW1lcmljIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiAobm90IHRvbnVtYmVyKFZhbHVlKSkgYW5kIFN0cmluZ0xlbih0b3N0cmluZyhWYWx1ZSkpID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlID0gVGV4dGJveC5WYWx1ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgVGV4dGJveC5WYWx1ZSA9IFZhbHVlCiAgICAgICAgICAgICAgICBJdGVtc1siSW5wdXQiXS5JbnN0YW5jZS5UZXh0ID0gVmFsdWUKICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbVGV4dGJveC5GbGFnXSA9IFZhbHVlCgogICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpTYWZlQ2FsbChEYXRhLkNhbGxiYWNrLCBWYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIERhdGEuRmluaXNoZWQgdGhlbiAKICAgICAgICAgICAgICAgIEl0ZW1zWyJJbnB1dCJdOkNvbm5lY3QoIkZvY3VzTG9zdCIsIGZ1bmN0aW9uKFByZXNzZWRFbnRlclF1ZXN0aW9uTWFyaykKICAgICAgICAgICAgICAgICAgICBpZiBQcmVzc2VkRW50ZXJRdWVzdGlvbk1hcmsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Ym94OlNldChJdGVtc1siSW5wdXQiXS5JbnN0YW5jZS5UZXh0KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBJdGVtc1siSW5wdXQiXS5JbnN0YW5jZTpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoIlRleHQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBUZXh0Ym94OlNldChJdGVtc1siSW5wdXQiXS5JbnN0YW5jZS5UZXh0KQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIERhdGEuRGVmYXVsdCB0aGVuCiAgICAgICAgICAgICAgICBUZXh0Ym94OlNldChEYXRhLkRlZmF1bHQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgTGlicmFyeS5TZXRGbGFnc1tUZXh0Ym94LkZsYWddID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBUZXh0Ym94OlNldChWYWx1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gVGV4dGJveCwgSXRlbXMKICAgICAgICBlbmQKCiAgICAgICAgQ29tcG9uZW50cy5TZWFyY2hib3ggPSBmdW5jdGlvbihzZWxmLCBEYXRhKSAtLSBqdXN0IHBhc3RlZCB0aGUgZW50aXJlIGRyb3Bkb3duIGZ1Y250aW9uIHdpdGggZGlmZmVyZW50IGluc3RhbmNlcywgaSBjYW50IGJlIGFza2VkIHRvIG1ha2UgYSB3aG9sZSBuZXcgZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBsb2NhbCBEcm9wZG93biA9IHsKICAgICAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcsIAogICAgICAgICAgICAgICAgVmFsdWUgPSB7IH0sCiAgICAgICAgICAgICAgICBPcHRpb25zID0geyB9LAogICAgICAgICAgICAgICAgSXNPcGVuID0gZmFsc2UKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IH0gZG8KICAgICAgICAgICAgICAgIEl0ZW1zWyJMaXN0Ym94Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBEYXRhLlBhcmVudC5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAxODUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIlNlYXJjaCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkxpc3Rib3giXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC40MDAwMDAwMDU5NjA0NjQ1LAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigxNCwgMTcsIDE1KQogICAgICAgICAgICAgICAgfSkgIEl0ZW1zWyJTZWFyY2giXTpBZGRUb1RoZW1lKHtCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIiwgQmFja2dyb3VuZENvbG9yMyA9ICJCYWNrZ3JvdW5kIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNlYXJjaCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlciwKICAgICAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSAwLjQwMDAwMDAwNTk2MDQ2NDUsCiAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkljb24iXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNlYXJjaCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdCwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgICAgIEltYWdlID0gInJieGFzc2V0aWQ6Ly83MTE5Nzk0NjEzNTE1MCIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAwLjUsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAxNiwgMCwgMTYpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSWNvbiJdOkFkZFRvVGhlbWUoe0ltYWdlQ29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgICAgICBJdGVtc1siSW5wdXQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRCb3giLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNlYXJjaCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAxLCAwKSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDIyLCAwLCAwKSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBsYWNlaG9sZGVyQ29sb3IzID0gRnJvbVJHQigxODUsIDE4NSwgMTg1KSwKICAgICAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICAgICAgUGxhY2Vob2xkZXJUZXh0ID0gInNlYXJjaC4uIiwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siSW5wdXQiXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQiLCBQbGFjZWhvbGRlckNvbG9yMyA9ICJQbGFjZWhvbGRlciBUZXh0In0pCgogICAgICAgICAgICAgICAgSXRlbXNbIklucHV0Il06VGV4dEJvcmRlcigpCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlQYWRkaW5nIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTZWFyY2giXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBVRGltTmV3KDAsIDUpLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCAzKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBJdGVtc1siUmVhbExpc3Rib3giXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJMaXN0Ym94Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgQ2xpcHNEZXNjZW5kYW50cyA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgLTI4KSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3Rpb25Hcm91cCA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAwLCAyOCksCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0YWJsZSA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlID0gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDMwLCAzNiwgMzEpCiAgICAgICAgICAgICAgICB9KSAgSXRlbXNbIlJlYWxMaXN0Ym94Il06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJFbGVtZW50IiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJSZWFsTGlzdGJveCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSUdyYWRpZW50IiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJSZWFsTGlzdGJveCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gLTE2NSwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgRnJvbVJHQigyMDgsIDIwOCwgMjA4KSl9CiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUkdCU2VxdWVuY2V7UkdCU2VxdWVuY2VLZXlwb2ludCgwLCBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpKSwgUkdCU2VxdWVuY2VLZXlwb2ludCgxLCBMaWJyYXJ5LlRoZW1lLkdyYWRpZW50KX0KICAgICAgICAgICAgICAgIGVuZH0pCgogICAgICAgICAgICAgICAgSXRlbXNbIkxpc3QiXSA9IEluc3RhbmNlczpDcmVhdGUoIlNjcm9sbGluZ0ZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJSZWFsTGlzdGJveCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEFjdGl2ZSA9IHRydWUsCiAgICAgICAgICAgICAgICAgICAgQXV0b21hdGljQ2FudmFzU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQ2FudmFzU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhckltYWdlQ29sb3IzID0gRnJvbVJHQigyMDIsIDI0MywgMjU1KSwKICAgICAgICAgICAgICAgICAgICBNaWRJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTM2NDE5NDc0MzgxOTY1IiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIFNjcm9sbEJhclRoaWNrbmVzcyA9IDIsCiAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC0xMiwgMSwgLTEwKSwKICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDMsIDAsIDUpLAogICAgICAgICAgICAgICAgICAgIFRvcEltYWdlID0gInJieGFzc2V0aWQ6Ly8xMzY0MTk0NzQzODE5NjUiLAogICAgICAgICAgICAgICAgICAgIENhbnZhc1Bvc2l0aW9uID0gVmVjdG9yMk5ldygwLCA1NyksCiAgICAgICAgICAgICAgICAgICAgQm90dG9tSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzEzNjQxOTQ3NDM4MTk2NSIsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBJdGVtc1siTGlzdCJdOkFkZFRvVGhlbWUoe1Njcm9sbEJhckltYWdlQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTGlzdCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDIpLAogICAgICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTGlzdCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBVRGltTmV3KDAsIDgpLAogICAgICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCA1KSwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd246R2V0KCkKICAgICAgICAgICAgICAgIHJldHVybiBEcm9wZG93bi5WYWx1ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duOlNldFZpc2liaWxpdHkoQm9vbCkKICAgICAgICAgICAgICAgIEl0ZW1zWyJMaXN0Ym94Il0uSW5zdGFuY2UuVmlzaWJsZSA9IEJvb2wKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bjpTZXQoT3B0aW9uKQogICAgICAgICAgICAgICAgaWYgRGF0YS5NdWx0aSB0aGVuIAogICAgICAgICAgICAgICAgICAgIGlmIHR5cGUoT3B0aW9uKSB+PSAidGFibGUiIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBEcm9wZG93bi5WYWx1ZSA9IE9wdGlvbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuRmxhZ3NbRHJvcGRvd24uRmxhZ10gPSBPcHRpb24KCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBPcHRpb24gZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgT3B0aW9uRGF0YSA9IERyb3Bkb3duLk9wdGlvbnNbVmFsdWVdCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgT3B0aW9uRGF0YSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuU2VsZWN0ZWQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhOlRvZ2dsZSgiQWN0aXZlIikKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBpZiBub3QgRHJvcGRvd24uT3B0aW9uc1tPcHRpb25dIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIE9wdGlvbkRhdGEgPSBEcm9wZG93bi5PcHRpb25zW09wdGlvbl0KCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uVmFsdWUgPSBPcHRpb24KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0Ryb3Bkb3duLkZsYWddID0gT3B0aW9uCgogICAgICAgICAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRHJvcGRvd24uT3B0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBWYWx1ZSB+PSBPcHRpb25EYXRhIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLlNlbGVjdGVkID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUb2dnbGUoIkluYWN0aXZlIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuU2VsZWN0ZWQgPSB0cnVlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6VG9nZ2xlKCJBY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIERhdGEuQ2FsbGJhY2sgdGhlbiAgIAogICAgICAgICAgICAgICAgICAgIExpYnJhcnk6U2FmZUNhbGwoRGF0YS5DYWxsYmFjaywgRHJvcGRvd24uVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bjpBZGQoT3B0aW9uKQogICAgICAgICAgICAgICAgbG9jYWwgT3B0aW9uQnV0dG9uID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJ1dHRvbiIsIHsKICAgICAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTGlzdCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9IE9wdGlvbiwKICAgICAgICAgICAgICAgICAgICBBdXRvQnV0dG9uQ29sb3IgPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCAyMCksCiAgICAgICAgICAgICAgICAgICAgWkluZGV4ID0gMSwKICAgICAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBPcHRpb25CdXR0b246QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICAgICAgT3B0aW9uQnV0dG9uOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgICAgIGxvY2FsIE9wdGlvbkRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgQnV0dG9uID0gT3B0aW9uQnV0dG9uLAogICAgICAgICAgICAgICAgICAgIE5hbWUgPSBPcHRpb24sCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIE9wdGlvbkRhdGE6VG9nZ2xlKFN0YXR1cykKICAgICAgICAgICAgICAgICAgICBpZiBTdGF0dXMgPT0gIkFjdGl2ZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5CdXR0b246Q2hhbmdlSXRlbVRoZW1lKHtUZXh0Q29sb3IzID0gIkFjY2VudCJ9KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhLkJ1dHRvbjpUd2VlbihuaWwsIHtUZXh0Q29sb3IzID0gTGlicmFyeS5UaGVtZS5BY2NlbnR9KQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5CdXR0b246Q2hhbmdlSXRlbVRoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkgCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuQnV0dG9uOlR3ZWVuKG5pbCwge1RleHRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lLlRleHR9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gT3B0aW9uRGF0YTpTZXQoKQogICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuU2VsZWN0ZWQgPSBub3QgT3B0aW9uRGF0YS5TZWxlY3RlZAoKICAgICAgICAgICAgICAgICAgICBpZiBEYXRhLk11bHRpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEluZGV4ID0gVGFibGVGaW5kKERyb3Bkb3duLlZhbHVlLCBPcHRpb25EYXRhLk5hbWUpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBJbmRleCB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFibGVSZW1vdmUoRHJvcGRvd24uVmFsdWUsIEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWJsZUluc2VydChEcm9wZG93bi5WYWx1ZSwgT3B0aW9uRGF0YS5OYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGE6VG9nZ2xlKEluZGV4IGFuZCAiSW5hY3RpdmUiIG9yICJBY3RpdmUiKQoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5GbGFnc1tEcm9wZG93bi5GbGFnXSA9IERyb3Bkb3duLlZhbHVlCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBPcHRpb25EYXRhLlNlbGVjdGVkIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcm9wZG93bi5WYWx1ZSA9IE9wdGlvbkRhdGEuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5GbGFnc1tEcm9wZG93bi5GbGFnXSA9IE9wdGlvbkRhdGEuTmFtZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGEuU2VsZWN0ZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhOlRvZ2dsZSgiQWN0aXZlIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERyb3Bkb3duLk9wdGlvbnMgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgVmFsdWUgfj0gT3B0aW9uRGF0YSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLlNlbGVjdGVkID0gZmFsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlOlRvZ2dsZSgiSW5hY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLlZhbHVlID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LkZsYWdzW0Ryb3Bkb3duLkZsYWddID0gbmlsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uRGF0YS5TZWxlY3RlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcHRpb25EYXRhOlRvZ2dsZSgiSW5hY3RpdmUiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgRGF0YS5DYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnk6U2FmZUNhbGwoRGF0YS5DYWxsYmFjaywgRHJvcGRvd24uVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBPcHRpb25EYXRhLkJ1dHRvbjpDb25uZWN0KCJNb3VzZUJ1dHRvbjFEb3duIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIE9wdGlvbkRhdGE6U2V0KCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBEcm9wZG93bi5PcHRpb25zW09wdGlvbkRhdGEuTmFtZV0gPSBPcHRpb25EYXRhCiAgICAgICAgICAgICAgICByZXR1cm4gT3B0aW9uRGF0YQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duOlJlbW92ZShPcHRpb24pCiAgICAgICAgICAgICAgICBpZiBub3QgRHJvcGRvd24uT3B0aW9uc1tPcHRpb25dIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIERyb3Bkb3duLk9wdGlvbnNbT3B0aW9uXS5CdXR0b246Q2xlYW4oKQogICAgICAgICAgICAgICAgRHJvcGRvd24uT3B0aW9uc1tPcHRpb25dID0gbmlsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd246UmVmcmVzaChMaXN0KQogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBEcm9wZG93bi5PcHRpb25zIGRvIAogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duOlJlbW92ZShWYWx1ZS5OYW1lKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMaXN0IGRvIAogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duOkFkZChWYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIEl0ZW1zWyJMaXN0Ym94Il06T25Ib3ZlcihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBJdGVtc1siTGlzdGJveCJdOkNoYW5nZUl0ZW1UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJIb3ZlcmVkIEVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgICAgICBJdGVtc1siTGlzdGJveCJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lWyJIb3ZlcmVkIEVsZW1lbnQiXX0pCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJMaXN0Ym94Il06T25Ib3ZlckxlYXZlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIEl0ZW1zWyJMaXN0Ym94Il06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkVsZW1lbnQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgICAgICBJdGVtc1siTGlzdGJveCJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lWyJFbGVtZW50Il19KQogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBsb2NhbCBTZWFyY2hTdGVwcGVkCgogICAgICAgICAgICBJdGVtc1siSW5wdXQiXTpDb25uZWN0KCJGb2N1c2VkIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgU2VhcmNoU3RlcHBlZCA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIERyb3Bkb3duLk9wdGlvbnMgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgSXRlbXNbIklucHV0Il0uSW5zdGFuY2UuVGV4dCB+PSAiIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTdHJpbmdGaW5kKFN0cmluZ0xvd2VyKFZhbHVlLk5hbWUpLCBTdHJpbmdMb3dlcihJdGVtc1siSW5wdXQiXS5JbnN0YW5jZS5UZXh0KSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLkJ1dHRvbi5JbnN0YW5jZS5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlLkJ1dHRvbi5JbnN0YW5jZS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5CdXR0b24uSW5zdGFuY2UuVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEl0ZW1zWyJJbnB1dCJdOkNvbm5lY3QoIkZvY3VzTG9zdCIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIFNlYXJjaFN0ZXBwZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIFNlYXJjaFN0ZXBwZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoU3RlcHBlZCA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gRGF0YS5JdGVtcyBkbyAKICAgICAgICAgICAgICAgIERyb3Bkb3duOkFkZChWYWx1ZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBEYXRhLkRlZmF1bHQgdGhlbiAKICAgICAgICAgICAgICAgIERyb3Bkb3duOlNldChEYXRhLkRlZmF1bHQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgTGlicmFyeS5TZXRGbGFnc1tEcm9wZG93bi5GbGFnXSA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgRHJvcGRvd246U2V0KFZhbHVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBEcm9wZG93biwgSXRlbXMgCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBMaWJyYXJ5IGNvbXBvbmVudHMKCUxpYnJhcnkuV2F0ZXJtYXJrID0gZnVuY3Rpb24oc2VsZiwgTmFtZSkKCSAgICBsb2NhbCBXYXRlcm1hcmsgPSB7IH0KCQoJICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvIAoJICAgICAgICBJdGVtc1siV2F0ZXJtYXJrIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKCSAgICAgICAgICAgIFBhcmVudCA9IExpYnJhcnkuSG9sZGVyLkluc3RhbmNlLAoJICAgICAgICAgICAgTmFtZSA9ICJcMCIsCgkgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMC41LCAxKSwKCSAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMC41LCAwLCAxLCAtMSksCgkgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAoJICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKCSAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFksCgkgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigxNCwgMTcsIDE1KQoJICAgICAgICB9KSAgSXRlbXNbIldhdGVybWFyayJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQmFja2dyb3VuZCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKCQoJICAgICAgICBJdGVtc1siV2F0ZXJtYXJrIl06TWFrZURyYWdnYWJsZSgpCgkKCSAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CgkgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siV2F0ZXJtYXJrIl0uSW5zdGFuY2UsCgkgICAgICAgICAgICBOYW1lID0gIlwwIiwKCSAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKCSAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAoJICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCgkgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCQoJICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVBhZGRpbmciLCB7CgkgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siV2F0ZXJtYXJrIl0uSW5zdGFuY2UsCgkgICAgICAgICAgICBOYW1lID0gIlwwIiwKCSAgICAgICAgICAgIFBhZGRpbmdUb3AgPSBVRGltTmV3KDAsIDUpLAoJICAgICAgICAgICAgUGFkZGluZ0JvdHRvbSA9IFVEaW1OZXcoMCwgNyksCgkgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBVRGltTmV3KDAsIDUpLAoJICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDUpCgkgICAgICAgIH0pCgkKCSAgICAgICAgSXRlbXNbIlRleHQiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKCSAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJXYXRlcm1hcmsiXS5JbnN0YW5jZSwKCSAgICAgICAgICAgIE5hbWUgPSAiXDAiLAoJICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCgkgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKCSAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCgkgICAgICAgICAgICBUZXh0ID0gTmFtZSAuLiAiIHwgMCBmcHMgfCAwIG1zIiwgLS0gSW5pdGlhbCB0ZXh0IHdpdGggcGxhY2Vob2xkZXIgdmFsdWVzCgkgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDIpLAoJICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCgkgICAgICAgICAgICBUZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdCwKCSAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCgkgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZLAoJICAgICAgICAgICAgVGV4dFNpemUgPSA5LAoJICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKCSAgICAgICAgfSkgIEl0ZW1zWyJUZXh0Il06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgkKCSAgICAgICAgSXRlbXNbIlRleHQiXTpUZXh0Qm9yZGVyKCkKCQoJICAgICAgICBJdGVtc1siTGluZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewoJICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIldhdGVybWFyayJdLkluc3RhbmNlLAoJICAgICAgICAgICAgTmFtZSA9ICJcMCIsCgkgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIC01LCAwLCAtNSksCgkgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAoJICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDEwLCAwLCAxKSwKCSAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCgkgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMDIsIDI0MywgMjU1KQoJICAgICAgICB9KSAgSXRlbXNbIkxpbmVyIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJBY2NlbnQifSkKCSAgICBlbmQKCQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikKbG9jYWwgU3RhdHMgPSBnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikKbG9jYWwgdXBkYXRlRGVsYXkgPSAuMSAgLS0gRGVmYXVsdCB1cGRhdGUgZGVsYXkgKHNlY29uZHMpCmxvY2FsIGxhc3RVcGRhdGVUaW1lID0gMApsb2NhbCBsYXN0RnJhbWVUaW1lID0gdGljaygpCmxvY2FsIGZyYW1lVGltZXMgPSB7fQpsb2NhbCBmcHMgPSAwCgotLSBGdW5jdGlvbiB0byBnZXQgcGluZyAoaW4gbWlsbGlzZWNvbmRzKQpsb2NhbCBmdW5jdGlvbiBnZXRQaW5nKCkKICAgIGxvY2FsIHBpbmdTdGF0ID0gU3RhdHM6RmluZEZpcnN0Q2hpbGQoIlBlcmZvcm1hbmNlU3RhdHMiKSBhbmQgU3RhdHMuUGVyZm9ybWFuY2VTdGF0czpGaW5kRmlyc3RDaGlsZCgiUGluZyIpCiAgICBpZiBwaW5nU3RhdCB0aGVuCiAgICAgICAgcmV0dXJuIG1hdGguZmxvb3IocGluZ1N0YXQ6R2V0VmFsdWUoKSkKICAgIGVsc2UKICAgICAgICByZXR1cm4gMCAgLS0gRmFsbGJhY2sgaWYgcGluZyBzdGF0IGlzIHVuYXZhaWxhYmxlCiAgICBlbmQKZW5kCgotLSBGdW5jdGlvbiB0byBjYWxjdWxhdGUgRlBTCmxvY2FsIGZ1bmN0aW9uIGNhbGN1bGF0ZUZQUygpCiAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgdGFibGUuaW5zZXJ0KGZyYW1lVGltZXMsIGN1cnJlbnRUaW1lKQogICAgLS0gS2VlcCBmcmFtZSB0aW1lcyBmb3IgdGhlIGxhc3QgMSBzZWNvbmQKICAgIHdoaWxlIGZyYW1lVGltZXNbMV0gYW5kIGN1cnJlbnRUaW1lIC0gZnJhbWVUaW1lc1sxXSA+IDEgZG8KICAgICAgICB0YWJsZS5yZW1vdmUoZnJhbWVUaW1lcywgMSkKICAgIGVuZAogICAgLS0gRlBTIGlzIHRoZSBudW1iZXIgb2YgZnJhbWVzIGluIHRoZSBsYXN0IHNlY29uZAogICAgZnBzID0gI2ZyYW1lVGltZXMKICAgIHJldHVybiBmcHMKZW5kCgotLSBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHdhdGVybWFyawpsb2NhbCBmdW5jdGlvbiB1cGRhdGVXYXRlcm1hcmsoKQogICAgbG9jYWwgY3VycmVudEZQUyA9IGNhbGN1bGF0ZUZQUygpCiAgICBsb2NhbCBwaW5nID0gZ2V0UGluZygpCiAgICBJdGVtc1siVGV4dCJdLkluc3RhbmNlLlRleHQgPSBzdHJpbmcuZm9ybWF0KCIlcyB8ICVkIGZwcyB8ICVkIG1zIiwgTmFtZSwgY3VycmVudEZQUywgcGluZykKZW5kCgotLSBTdGFydCB0aGUgdXBkYXRlIGxvb3AKbG9jYWwgdXBkYXRlQ29ubmVjdGlvbiA9IG5pbApsb2NhbCBmdW5jdGlvbiBzdGFydFdhdGVybWFya1VwZGF0ZXMoZGVsYXkpCiAgICBpZiB1cGRhdGVDb25uZWN0aW9uIHRoZW4KICAgICAgICB1cGRhdGVDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgZW5kCiAgICB1cGRhdGVEZWxheSA9IGRlbGF5CiAgICBsYXN0VXBkYXRlVGltZSA9IHRpY2soKQogICAgZnJhbWVUaW1lcyA9IHt0aWNrKCl9ICAtLSBSZXNldCBmcmFtZSB0aW1lcwoKICAgIHVwZGF0ZUNvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICB0YWJsZS5pbnNlcnQoZnJhbWVUaW1lcywgdGljaygpKQogICAgICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpCiAgICAgICAgaWYgY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlVGltZSA+PSB1cGRhdGVEZWxheSB0aGVuCiAgICAgICAgICAgIHVwZGF0ZVdhdGVybWFyaygpCiAgICAgICAgICAgIGxhc3RVcGRhdGVUaW1lID0gY3VycmVudFRpbWUKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBTdGFydCB3aXRoIGEgMC41LXNlY29uZCBkZWxheQpzdGFydFdhdGVybWFya1VwZGF0ZXMoMC4wNSkKCgoKCQoJICAgIGZ1bmN0aW9uIFdhdGVybWFyazpTZXRWaXNpYmlsaXR5KEJvb2wpCgkgICAgICAgIEl0ZW1zWyJXYXRlcm1hcmsiXS5JbnN0YW5jZS5WaXNpYmxlID0gQm9vbAoJICAgIGVuZAoJCgkgICAgcmV0dXJuIFdhdGVybWFyawoJZW5kCgogICAgTGlicmFyeS5LZXliaW5kTGlzdCA9IGZ1bmN0aW9uKHNlbGYpCiAgICAgICAgbG9jYWwgS2V5YmluZExpc3QgPSB7IH0KICAgICAgICBMaWJyYXJ5LktleUxpc3QgPSBLZXliaW5kTGlzdAoKICAgICAgICBsb2NhbCBJdGVtcyA9IHsgfSBkbwogICAgICAgICAgICBJdGVtc1siS2V5YmluZExpc3QiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gTGlicmFyeS5Ib2xkZXIuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAxMiwgMC41LCA1NSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDExNiwgMCwgMzIpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDE0LCAxNywgMTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siS2V5YmluZExpc3QiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICBJdGVtc1siS2V5YmluZExpc3QiXTpNYWtlRHJhZ2dhYmxlKCkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIktleWJpbmRMaXN0Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgIEl0ZW1zWyJUaXRsZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIktleWJpbmRMaXN0Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgVGV4dCA9ICJLZXliaW5kcyIsCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMjApLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIC00KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KSAgSXRlbXNbIlRpdGxlIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICBJdGVtc1siVGl0bGUiXTpUZXh0Qm9yZGVyKCkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJLZXliaW5kTGlzdCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBQYWRkaW5nVG9wID0gVURpbU5ldygwLCA4KSwKICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBVRGltTmV3KDAsIDgpLAogICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gVURpbU5ldygwLCA4KSwKICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCA4KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJLZXliaW5kTGlzdCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMSksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAyLCAyNDMsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJMaW5lciJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50In0pCgogICAgICAgICAgICBJdGVtc1siQ29udGVudCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siS2V5YmluZExpc3QiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAwLCAzMiksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJTGlzdExheW91dCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJDb250ZW50Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIEtleWJpbmRMaXN0OkFkZChLZXksIE5hbWUsIE1vZGUpCiAgICAgICAgICAgIGxvY2FsIE5ld0tleSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJDb250ZW50Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgVGV4dCA9ICIiIC4uS2V5IC4uIiAtICIgLi5OYW1lIC4uICIgKCIuLk1vZGUuLiIpIiwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICBUZXh0VHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFZpc2libGUgPSBmYWxzZSwKICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBOZXdLZXk6QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICBOZXdLZXk6VGV4dEJvcmRlcigpCgogICAgICAgICAgICBmdW5jdGlvbiBOZXdLZXk6U2V0VGV4dChLZXksIE5hbWUsIE1vZGUpCiAgICAgICAgICAgICAgICBOZXdLZXkuSW5zdGFuY2UuVGV4dCA9ICIiIC4uS2V5IC4uIiAtICIgLi5OYW1lIC4uICIgKCIuLk1vZGUuLiIpIgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIE5ld0tleTpTZXRTdGF0dXMoQm9vbCkKICAgICAgICAgICAgICAgIGlmIEJvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgIE5ld0tleS5JbnN0YW5jZS5WaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIE5ld0tleTpUd2VlbihuaWwsIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgTmV3S2V5OlR3ZWVuKG5pbCwge1RleHRUcmFuc3BhcmVuY3kgPSAxfSkuVHdlZW4uQ29tcGxldGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBOZXdLZXkuSW5zdGFuY2UuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIE5ld0tleQogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBLZXliaW5kTGlzdDpTZXRWaXNpYmlsaXR5KEJvb2wpCiAgICAgICAgICAgIEl0ZW1zWyJLZXliaW5kTGlzdCJdLkluc3RhbmNlLlZpc2libGUgPSBCb29sCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBLZXliaW5kTGlzdAogICAgZW5kCgogICAgTGlicmFyeS5Ob3RpZmljYXRpb24gPSBmdW5jdGlvbihzZWxmLCBUaXRsZSwgRGVzY3JpcHRpb24sIER1cmF0aW9uKQogICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvIAogICAgICAgICAgICBJdGVtc1siTm90aWZpY2F0aW9uIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IExpYnJhcnkuTm90aWZIb2xkZXIuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAwLCAyNSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigxNCwgMTcsIDE1KQogICAgICAgICAgICB9KSAgSXRlbXNbIk5vdGlmaWNhdGlvbiJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQmFja2dyb3VuZCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKCiAgICAgICAgICAgIEl0ZW1zWyJVSVN0cm9rZTEiXSA9IEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIk5vdGlmaWNhdGlvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICBMaW5lSm9pbk1vZGUgPSBFbnVtLkxpbmVKb2luTW9kZS5NaXRlciwKICAgICAgICAgICAgICAgIEFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICB9KSAgSXRlbXNbIlVJU3Ryb2tlMSJdOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJOb3RpZmljYXRpb24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IFVEaW1OZXcoMCwgNSksCiAgICAgICAgICAgICAgICBQYWRkaW5nQm90dG9tID0gVURpbU5ldygwLCAxMiksCiAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBVRGltTmV3KDAsIDUpLAogICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siVGl0bGUiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJOb3RpZmljYXRpb24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBUZXh0ID0gVGl0bGUsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFksCiAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KSAgSXRlbXNbIlRpdGxlIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgIEl0ZW1zWyJVSVN0cm9rZTIiXSA9ICBJdGVtc1siVGl0bGUiXTpUZXh0Qm9yZGVyKCkKCiAgICAgICAgICAgIEl0ZW1zWyJEZXNjcmlwdGlvbiJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIk5vdGlmaWNhdGlvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgVGV4dFRyYW5zcGFyZW5jeSA9IDAuNDAwMDAwMDA1OTYwNDY0NSwKICAgICAgICAgICAgICAgIFRleHQgPSBEZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWSwKICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siRGVzY3JpcHRpb24iXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgIEl0ZW1zWyJVSVN0cm9rZTMiXSA9IEl0ZW1zWyJEZXNjcmlwdGlvbiJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJOb3RpZmljYXRpb24iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAxLCA4KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMSksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAyLCAyNDMsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJMaW5lciJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgPSAiQWNjZW50In0pCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIFNpemUgPSBJdGVtc1siTm90aWZpY2F0aW9uIl0uSW5zdGFuY2UuQWJzb2x1dGVTaXplCgogICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gSXRlbXMgZG8gCiAgICAgICAgICAgIGlmIFZhbHVlLkluc3RhbmNlOklzQSgiRnJhbWUiKSB0aGVuCiAgICAgICAgICAgICAgICBWYWx1ZS5JbnN0YW5jZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBlbHNlaWYgVmFsdWUuSW5zdGFuY2U6SXNBKCJUZXh0TGFiZWwiKSB0aGVuIAogICAgICAgICAgICAgICAgVmFsdWUuSW5zdGFuY2UuVGV4dFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgZWxzZWlmIFZhbHVlLkluc3RhbmNlOklzQSgiVUlTdHJva2UiKSB0aGVuCiAgICAgICAgICAgICAgICBWYWx1ZS5JbnN0YW5jZS5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKCiAgICAgICAgSXRlbXNbIk5vdGlmaWNhdGlvbiJdLkluc3RhbmNlLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWQoKICAgICAgICBMaWJyYXJ5OlRocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBJbmRleCwgVmFsdWUgaW4gSXRlbXMgZG8gCiAgICAgICAgICAgICAgICBpZiBWYWx1ZS5JbnN0YW5jZTpJc0EoIkZyYW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICAgICAgICAgIGVsc2VpZiBWYWx1ZS5JbnN0YW5jZTpJc0EoIlRleHRMYWJlbCIpIGFuZCBJbmRleCB+PSAiRGVzY3JpcHRpb24iIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgVmFsdWU6VHdlZW4obmlsLCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgZWxzZWlmIFZhbHVlLkluc3RhbmNlOklzQSgiVGV4dExhYmVsIikgYW5kIEluZGV4ID09ICJEZXNjcmlwdGlvbiIgdGhlbiAKICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUd2VlbihuaWwsIHtUZXh0VHJhbnNwYXJlbmN5ID0gMC40fSkKICAgICAgICAgICAgICAgIGVsc2VpZiBWYWx1ZS5JbnN0YW5jZTpJc0EoIlVJU3Ryb2tlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge1RyYW5zcGFyZW5jeSA9IDB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgSXRlbXNbIk5vdGlmaWNhdGlvbiJdOlR3ZWVuKG5pbCwge1NpemUgPSBVRGltMk5ldygwLCBTaXplLlgsIDAsIDApfSkKICAgICAgICAgICAgSXRlbXNbIkxpbmVyIl06VHdlZW4oVHdlZW5JbmZvLm5ldyhEdXJhdGlvbiwgRW51bS5FYXNpbmdTdHlsZS5RdWFydCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwge1NpemUgPSBVRGltMk5ldygwLCAwLCAwLCAxKX0pCiAgICAgICAgICAgIAogICAgICAgICAgICB0YXNrLmRlbGF5KER1cmF0aW9uICsgMC4xLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIEl0ZW1zIGRvIAogICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlLkluc3RhbmNlOklzQSgiRnJhbWUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxfSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgVmFsdWUuSW5zdGFuY2U6SXNBKCJUZXh0TGFiZWwiKSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTpUd2VlbihuaWwsIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0pCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIFZhbHVlLkluc3RhbmNlOklzQSgiVUlTdHJva2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlOlR3ZWVuKG5pbCwge1RyYW5zcGFyZW5jeSA9IDF9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgSXRlbXNbIk5vdGlmaWNhdGlvbiJdOlR3ZWVuKG5pbCwge1NpemUgPSBVRGltMk5ldygwLCAwLCAwLCAwKX0pCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KQogICAgICAgICAgICAgICAgSXRlbXNbIk5vdGlmaWNhdGlvbiJdOkNsZWFuKCkKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZCkKICAgIGVuZAoKICAgIExpYnJhcnkuSW52ZW50b3J5Vmlld2VyID0gZnVuY3Rpb24oc2VsZikKICAgICAgICBsb2NhbCBWaWV3ZXIgPSB7IH0KICAgICAgICBWaWV3ZXIuSXRlbXMgPSB7IH0gCgogICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgIEl0ZW1zWyJJbnZlbnRvcnlWaWV3ZXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gTGlicmFyeS5Ib2xkZXIuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMC4wMDc3NjY5OTA0NTY3MzAxMjcsIDAsIDAuMTE0NDI3ODU3MTAwOTYzNTksIDApLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAzMjUsIDAsIDI3NyksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTQsIDE3LCAxNSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJJbnZlbnRvcnlWaWV3ZXIiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVN0cm9rZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJJbnZlbnRvcnlWaWV3ZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQ29sb3IgPSBGcm9tUkdCKDQyLCA0OSwgNDUpLAogICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICBBcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgfSk6QWRkVG9UaGVtZSh7Q29sb3IgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgSXRlbXNbIlRpdGxlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW52ZW50b3J5Vmlld2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEZvbnRGYWNlID0gTGlicmFyeS5Gb250LAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgVGV4dCA9ICJJbnZlbnRvcnkiLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDAsIDE1KSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA4LCAwLCA0KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICBUZXh0U2l6ZSA9IDksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KSAgSXRlbXNbIlRpdGxlIl06QWRkVG9UaGVtZSh7VGV4dENvbG9yMyA9ICJUZXh0In0pCgogICAgICAgICAgICBJdGVtc1siVG9vbHMiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkludmVudG9yeVZpZXdlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDgsIDAsIDI3KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTE2LCAxLCAtMTA4KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMCwgMjQsIDIxKQogICAgICAgICAgICB9KSAgSXRlbXNbIlRvb2xzIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJCYWNrZ3JvdW5kIiwgQm9yZGVyQ29sb3IzID0gIk91dGxpbmUifSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJU3Ryb2tlIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlRvb2xzIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgSXRlbXNbIkhvbGRlciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiU2Nyb2xsaW5nRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siVG9vbHMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQWN0aXZlID0gdHJ1ZSwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY0NhbnZhc1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBDYW52YXNTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTY3JvbGxCYXJJbWFnZUNvbG9yMyA9IEZyb21SR0IoMjAyLCAyNDMsIDI1NSksCiAgICAgICAgICAgICAgICBNaWRJbWFnZSA9ICJyYnhhc3NldGlkOi8vMTIzNzA4MjI4MzY4MDk4IiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTY3JvbGxCYXJUaGlja25lc3MgPSAyLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIC00LCAxLCAtOCksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgMCwgMCwgNCksCiAgICAgICAgICAgICAgICBCb3R0b21JbWFnZSA9ICJyYnhhc3NldGlkOi8vMTIzNzA4MjI4MzY4MDk4IiwKICAgICAgICAgICAgICAgIFRvcEltYWdlID0gInJieGFzc2V0aWQ6Ly8xMjM3MDgyMjgzNjgwOTgiLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJIb2xkZXIiXTpBZGRUb1RoZW1lKHtTY3JvbGxCYXJJbWFnZUNvbG9yMyA9ICJBY2NlbnQifSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJR3JpZExheW91dCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJIb2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIsCiAgICAgICAgICAgICAgICBDZWxsU2l6ZSA9IFVEaW0yTmV3KDAsIDY1LCAwLCA2NSkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJIb2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUGFkZGluZ1RvcCA9IFVEaW1OZXcoMCwgNCksCiAgICAgICAgICAgICAgICBQYWRkaW5nTGVmdCA9IFVEaW1OZXcoMCwgOCkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEl0ZW1zWyJQbGF5ZXJBdmF0YXIiXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siSW52ZW50b3J5Vmlld2VyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldDovL3RleHR1cmVzL3VpL0d1aUltYWdlUGxhY2Vob2xkZXIucG5nIiwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgOCwgMSwgLTgpLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDYwLCAwLCA2MCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMTQsIDE3LCAxNSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJQbGF5ZXJBdmF0YXIiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiT3V0bGluZSJ9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGxheWVyQXZhdGFyIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIENvbG9yID0gRnJvbVJHQigxMiwgMTIsIDEyKSwKICAgICAgICAgICAgICAgIExpbmVKb2luTW9kZSA9IEVudW0uTGluZUpvaW5Nb2RlLk1pdGVyLAogICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgIH0pOkFkZFRvVGhlbWUoe0NvbG9yID0gIk91dGxpbmUifSkKICAgICAgICAgICAgCiAgICAgICAgICAgIEl0ZW1zWyJQbGF5ZXJIZWFsdGgiXSA9IEluc3RhbmNlczpDcmVhdGUoIlRleHRMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJJbnZlbnRvcnlWaWV3ZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBUZXh0ID0gIkhlYWx0aDogIiwKICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAxKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAwLCAwLCAxNSksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMCwgNzUsIDEsIC01NSksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YLAogICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJQbGF5ZXJIZWFsdGgiXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkKCiAgICAgICAgICAgIEl0ZW1zWyJQbGF5ZXJEaXN0YW5jZSJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dExhYmVsIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkludmVudG9yeVZpZXdlciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFRleHQgPSAiRGlzdGFuY2U6ICBzdHVkcyIsCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDc1LCAxLCAtMzUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siUGxheWVyRGlzdGFuY2UiXTpBZGRUb1RoZW1lKHtUZXh0Q29sb3IzID0gIlRleHQifSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gVmlld2VyOlNldFBsYXllckhlYWx0aChWYWx1ZSkKICAgICAgICAgICAgSXRlbXNbIlBsYXllckhlYWx0aCJdLkluc3RhbmNlLlRleHQgPSB0b3N0cmluZyhWYWx1ZSkKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gVmlld2VyOlNldFBsYXllckRpc3RhbmNlKFZhbHVlKQogICAgICAgICAgICBJdGVtc1siUGxheWVyRGlzdGFuY2UiXS5JbnN0YW5jZS5UZXh0ID0gIkRpc3RhbmNlOiAiLi50b3N0cmluZyhWYWx1ZSkuLiIgc3R1ZHMiCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIFZpZXdlcjpTZXRQbGF5ZXIoVmFsdWUpCiAgICAgICAgICAgIGxvY2FsIFBsYXllckF2YXRhciwgXyA9IFBsYXllcnM6R2V0VXNlclRodW1ibmFpbEFzeW5jKFZhbHVlLlVzZXJJZCkKICAgICAgICAgICAgSXRlbXNbIlBsYXllckF2YXRhciJdLkluc3RhbmNlLkltYWdlID0gUGxheWVyQXZhdGFyCiAgICAgICAgICAgIEl0ZW1zWyJUaXRsZSJdLkluc3RhbmNlLlRleHQgPSBWYWx1ZS5OYW1lIC4uICIncyBJbnZlbnRvcnkiCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIFZpZXdlcjpBZGRUb29sKE5hbWUsIEltYWdlKQogICAgICAgICAgICBsb2NhbCBOZXdJdGVtID0geyB9CgogICAgICAgICAgICBsb2NhbCBTdWJJdGVtcyA9IHsgfSBkbwogICAgICAgICAgICAgICAgU3ViSXRlbXNbIkl0ZW0iXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJIb2xkZXIiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDEyLCAxMiwgMTIpLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAxMDAsIDAsIDEwMCksCiAgICAgICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMCwgMjQsIDIxKQogICAgICAgICAgICAgICAgfSkgIFN1Ykl0ZW1zWyJJdGVtIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJJbmxpbmUiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCgogICAgICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlTdHJva2UiLCB7CiAgICAgICAgICAgICAgICAgICAgUGFyZW50ID0gU3ViSXRlbXNbIkl0ZW0iXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgICAgICBDb2xvciA9IEZyb21SR0IoNDIsIDQ5LCA0NSksCiAgICAgICAgICAgICAgICAgICAgTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuTWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgQXBwbHlTdHJva2VNb2RlID0gRW51bS5BcHBseVN0cm9rZU1vZGUuQm9yZGVyCiAgICAgICAgICAgICAgICB9KTpBZGRUb1RoZW1lKHtDb2xvciA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICAgICAgU3ViSXRlbXNbIkltYWdlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJJbWFnZUxhYmVsIiwgewogICAgICAgICAgICAgICAgICAgIFBhcmVudCA9IFN1Ykl0ZW1zWyJJdGVtIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpLAogICAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdCwKICAgICAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLjUsIDAuNSksCiAgICAgICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIuLkltYWdlLAogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMC41LCAwLCAwLjUsIDApLAogICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCA0NSwgMCwgNDUpLAogICAgICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIH0pICBTdWJJdGVtc1siSW1hZ2UiXTpBZGRUb1RoZW1lKHtJbWFnZUNvbG9yMyA9ICJBY2NlbnQifSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBOZXdJdGVtOlJlbW92ZSgpCiAgICAgICAgICAgICAgICBWaWV3ZXIuSXRlbXNbTmFtZV0gPSBuaWwKICAgICAgICAgICAgICAgIFN1Ykl0ZW1zWyJJdGVtIl06Q2xlYW4oKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIFZpZXdlci5JdGVtc1tOYW1lXSA9IE5ld0l0ZW0KICAgICAgICAgICAgcmV0dXJuIE5ld0l0ZW0KICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gVmlld2VyOlJlbW92ZUFsbFRvb2xzKCkKICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBWaWV3ZXIuSXRlbXMgZG8gCiAgICAgICAgICAgICAgICBWYWx1ZTpSZW1vdmUoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIFZpZXdlcgogICAgZW5kCgogICAgTGlicmFyeS5XaW5kb3cgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgIERhdGEgPSBEYXRhIG9yIHsgfQoKICAgICAgICBsb2NhbCBXaW5kb3cgPSB7IAogICAgICAgICAgICBMb2dvID0gRGF0YS5Mb2dvIG9yIERhdGEubG9nbyBvciAiIiwKICAgICAgICAgICAgRmFkZVRpbWUgPSBEYXRhLkZhZGVUaW1lIG9yIERhdGEuZmFkZXRpbWUgb3IgMC40LAogICAgICAgICAgICBTaXplID0gRGF0YS5TaXplIG9yIERhdGEuc2l6ZSBvciBVRGltMk5ldygwLCA3NTEsIDAsIDUzOSksCgogICAgICAgICAgICBQYWdlcyA9IHsgfSwKICAgICAgICAgICAgSXRlbXMgPSB7IH0sCgogICAgICAgICAgICBJc09wZW4gPSBmYWxzZSwKICAgICAgICB9CgogICAgICAgIGxvY2FsIEl0ZW1zID0gQ29tcG9uZW50czpXaW5kb3coewogICAgICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5LkhvbGRlciwKICAgICAgICAgICAgRHJhZ2dhYmxlID0gdHJ1ZSwKICAgICAgICAgICAgUmVzaXplYWJsZSA9IHRydWUsCiAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwKSwKICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCBDYW1lcmEuVmlld3BvcnRTaXplLlggLyAzLjMsIDAsIENhbWVyYS5WaWV3cG9ydFNpemUuWSAvIDMuMyksCiAgICAgICAgICAgIFNpemUgPSBXaW5kb3cuU2l6ZQogICAgICAgIH0pIGRvCiAgICAgICAgICAgIEl0ZW1zWyJTaWRlIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJXaW5kb3ciXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAxMiwgMCwgMTIpLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAyMDAsIDEsIC0yNCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAyLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjAsIDI0LCAyMSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJTaWRlIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJJbmxpbmUiLCBCb3JkZXJDb2xvcjMgPSAiT3V0bGluZSJ9KQogICAgICAgICAgICAKICAgICAgICAgICAgSXRlbXNbIlNpZGUiXTpCb3JkZXIoIkJvcmRlciIpCgogICAgICAgICAgICBJdGVtc1siV2luZG93Il0uSW5zdGFuY2UuVmlzaWJsZSA9IGZhbHNlCgogICAgICAgICAgICBJdGVtc1siTG9nbyJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTaWRlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEltYWdlQ29sb3IzID0gRnJvbVJHQigyMDIsIDI0MywgMjU1KSwKICAgICAgICAgICAgICAgIFNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdCwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMC41LCAwKSwKICAgICAgICAgICAgICAgIEltYWdlID0gInJieGFzc2V0aWQ6Ly8iIC4uIFdpbmRvdy5Mb2dvLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAuNSwgMCwgMCwgMTIpLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDc1LCAwLCA3NSksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJMb2dvIl06QWRkVG9UaGVtZSh7SW1hZ2VDb2xvcjMgPSAiQWNjZW50In0pCgogICAgICAgICAgICBJdGVtc1siU2VhcmNoIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTaWRlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMTIsIDEyLCAxMiksCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMCwgMSksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC40MDAwMDAwMDU5NjA0NjQ1LAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCA2LCAxLCAtNiksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMjApLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMiwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDE0LCAxNywgMTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siU2VhcmNoIl06QWRkVG9UaGVtZSh7QmFja2dyb3VuZENvbG9yMyA9ICJCYWNrZ3JvdW5kIiwgQm9yZGVyQ29sb3IzID0gIkJvcmRlciJ9KQoKICAgICAgICAgICAgSXRlbXNbIlNlYXJjaFN0cm9rZSJdID0gSXRlbXNbIlNlYXJjaCJdOkJvcmRlcigiT3V0bGluZSIpCgogICAgICAgICAgICBJdGVtc1siSWNvbiJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTZWFyY2giXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgU2NhbGVUeXBlID0gRW51bS5TY2FsZVR5cGUuRml0LAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIEFuY2hvclBvaW50ID0gVmVjdG9yMk5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgSW1hZ2UgPSAicmJ4YXNzZXRpZDovLzcxMTk3OTQ2MTM1MTUwIiwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAwLCAwLjUsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDE2LCAwLCAxNiksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEl0ZW1zWyJJbnB1dCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiVGV4dEJveCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTZWFyY2giXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICBDdXJzb3JQb3NpdGlvbiA9IC0xLAogICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IEZyb21SR0IoMjM1LCAyMzUsIDIzNSksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgVGV4dCA9ICIiLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDAsIDAsIDEsIDApLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAyMiwgMCwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQbGFjZWhvbGRlckNvbG9yMyA9IEZyb21SR0IoMTg1LCAxODUsIDE4NSksCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlgsCiAgICAgICAgICAgICAgICBQbGFjZWhvbGRlclRleHQgPSAiLi4iLAogICAgICAgICAgICAgICAgVGV4dFNpemUgPSA5LAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkgIEl0ZW1zWyJJbnB1dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCIsIFBsYWNlaG9sZGVyQ29sb3IzID0gIlBsYWNlaG9sZGVyIFRleHQifSkKCiAgICAgICAgICAgIEl0ZW1zWyJJbnB1dCJdOlRleHRCb3JkZXIoKQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlQYWRkaW5nIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNlYXJjaCJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBQYWRkaW5nUmlnaHQgPSBVRGltTmV3KDAsIDUpLAogICAgICAgICAgICAgICAgUGFkZGluZ0xlZnQgPSBVRGltTmV3KDAsIDMpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siUGFnZXMiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlNpZGUiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDEwMCksCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDEsIC0xMzUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJbnN0YW5jZXM6Q3JlYXRlKCJVSVBhZGRpbmciLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siUGFnZXMiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUGFkZGluZ1JpZ2h0ID0gVURpbU5ldygwLCA4KSwKICAgICAgICAgICAgICAgIFBhZGRpbmdMZWZ0ID0gVURpbU5ldygwLCA4KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIlBhZ2VzIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFBhZGRpbmcgPSBVRGltTmV3KDAsIDgpLAogICAgICAgICAgICAgICAgU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIGxvY2FsIENvbnRlbnQsIF8gPSBQbGF5ZXJzOkdldFVzZXJUaHVtYm5haWxBc3luYyhMb2NhbFBsYXllci5Vc2VySWQsIEVudW0uVGh1bWJuYWlsVHlwZS5IZWFkU2hvdCwgRW51bS5UaHVtYm5haWxTaXplLlNpemU0MjB4NDIwKQoKICAgICAgICAgICAgSXRlbXNbIkF2YXRhciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiSW1hZ2VMYWJlbCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTaWRlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBBbmNob3JQb2ludCA9IFZlY3RvcjJOZXcoMSwgMSksCiAgICAgICAgICAgICAgICBJbWFnZSA9IENvbnRlbnQsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTJOZXcoMSwgLTYsIDEsIC02KSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAyNSwgMCwgMjUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siQXZhdGFyIl06Qm9yZGVyKCJPdXRsaW5lIikuSW5zdGFuY2UuTGluZUpvaW5Nb2RlID0gRW51bS5MaW5lSm9pbk1vZGUuUm91bmQKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJQ29ybmVyIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkF2YXRhciJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBDb3JuZXJSYWRpdXMgPSBVRGltTmV3KDEsIDApCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siQ29udGVudCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siV2luZG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMk5ldygwLCAyMjYsIDAsIDEyKSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTIzOCwgMSwgLTI0KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSXRlbXNbIk1vdXNlQmFja2dyb3VuZCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBMaWJyYXJ5LkhvbGRlci5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAsIDApLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygwLCAxNiwgMCwgMTYpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIFpJbmRleCA9IDk5OTksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSXRlbXNbIk1vdXNlSW1hZ2UiXSA9IEluc3RhbmNlczpDcmVhdGUoIkltYWdlTGFiZWwiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTW91c2VCYWNrZ3JvdW5kIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBJbWFnZSA9ICJyYnhhc3NldGlkOi8vNzY2MzE2NjAxMTQxOTYiLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMSwgMCksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgWkluZGV4ID0gOTk5OSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siTW91c2VJbWFnZSJdOkFkZFRvVGhlbWUoe0ltYWdlQ29sb3IzID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJNb3VzZUltYWdlIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gOTAsCiAgICAgICAgICAgICAgICBDb2xvciA9IFJHQlNlcXVlbmNle1JHQlNlcXVlbmNlS2V5cG9pbnQoMCwgRnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIFJHQlNlcXVlbmNlS2V5cG9pbnQoMSwgRnJvbVJHQig5OSwgMTA4LCAxMTcpKX0KICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIFVzZXJJbnB1dFNlcnZpY2UuTW91c2VJY29uRW5hYmxlZCA9IGZhbHNlCgogICAgICAgICAgICBXaW5kb3cuSXRlbXMgPSBJdGVtcwogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBEZWJvdW5jZSA9IGZhbHNlCgogICAgICAgIEl0ZW1zWyJJbnB1dCJdOkNvbm5lY3QoIkZvY3VzZWQiLCBmdW5jdGlvbigpCiAgICAgICAgICAgIEl0ZW1zWyJTZWFyY2giXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMH0pCiAgICAgICAgICAgIEl0ZW1zWyJTZWFyY2hTdHJva2UiXTpUd2VlbihuaWwsIHtUcmFuc3BhcmVuY3kgPSAwfSkKICAgICAgICBlbmQpCgogICAgICAgIEl0ZW1zWyJJbnB1dCJdOkNvbm5lY3QoIkZvY3VzTG9zdCIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgSXRlbXNbIlNlYXJjaCJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjR9KQogICAgICAgICAgICBJdGVtc1siU2VhcmNoU3Ryb2tlIl06VHdlZW4obmlsLCB7VHJhbnNwYXJlbmN5ID0gMC40fSkKICAgICAgICBlbmQpCgogICAgICAgIEl0ZW1zWyJJbnB1dCJdOk9uSG92ZXIoZnVuY3Rpb24oKQogICAgICAgICAgICBJdGVtc1siU2VhcmNoIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkhvdmVyZWQgRWxlbWVudCIsIEJvcmRlckNvbG9yMyA9ICJCb3JkZXIifSkKICAgICAgICAgICAgSXRlbXNbIlNlYXJjaCJdOlR3ZWVuKG5pbCwge0JhY2tncm91bmRDb2xvcjMgPSBMaWJyYXJ5LlRoZW1lWyJIb3ZlcmVkIEVsZW1lbnQiXX0pCiAgICAgICAgZW5kKQoKICAgICAgICBJdGVtc1siSW5wdXQiXTpPbkhvdmVyTGVhdmUoZnVuY3Rpb24oKQogICAgICAgICAgICBJdGVtc1siU2VhcmNoIl06Q2hhbmdlSXRlbVRoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIkJhY2tncm91bmQiLCBCb3JkZXJDb2xvcjMgPSAiQm9yZGVyIn0pCiAgICAgICAgICAgIEl0ZW1zWyJTZWFyY2giXTpUd2VlbihuaWwsIHtCYWNrZ3JvdW5kQ29sb3IzID0gTGlicmFyeS5UaGVtZS5CYWNrZ3JvdW5kfSkKICAgICAgICBlbmQpCgogICAgICAgIExpYnJhcnk6Q29ubmVjdChSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgTW91c2VMb2NhdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2U6R2V0TW91c2VMb2NhdGlvbigpIAogICAgICAgICAgICBJdGVtc1siTW91c2VCYWNrZ3JvdW5kIl0uSW5zdGFuY2UuUG9zaXRpb24gPSBVRGltMk5ldygwLCBNb3VzZUxvY2F0aW9uLlggLSAxLCAwLCBNb3VzZUxvY2F0aW9uLlkgLSA1NikgICAgICAgICAgIAogICAgICAgIGVuZCkKCiAgICAgICAgbG9jYWwgT2xkU2l6ZXMgPSB7IH0KCiAgICAgICAgZnVuY3Rpb24gV2luZG93OkFkZFRvT2xkU2l6ZXMoSXRlbSwgU2l6ZSkKICAgICAgICAgICAgaWYgbm90IE9sZFNpemVzW0l0ZW1dIHRoZW4KICAgICAgICAgICAgICAgIE9sZFNpemVzW0l0ZW1dID0gU2l6ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gV2luZG93OkdldE9sZFNpemUoSXRlbSkKICAgICAgICAgICAgaWYgT2xkU2l6ZXNbSXRlbV0gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIE9sZFNpemVzW0l0ZW1dCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBXaW5kb3c6U2V0T3BlbihCb29sKQogICAgICAgICAgICBpZiBEZWJvdW5jZSB0aGVuIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgV2luZG93LklzT3BlbiA9IEJvb2wKCiAgICAgICAgICAgIERlYm91bmNlID0gdHJ1ZSAKCiAgICAgICAgICAgIGlmIFdpbmRvdy5Jc09wZW4gdGhlbiAKICAgICAgICAgICAgICAgIEl0ZW1zWyJXaW5kb3ciXS5JbnN0YW5jZS5WaXNpYmxlID0gdHJ1ZSAKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBEZXNjZW5kYW50cyA9IEl0ZW1zWyJXaW5kb3ciXS5JbnN0YW5jZTpHZXREZXNjZW5kYW50cygpCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KERlc2NlbmRhbnRzLCBJdGVtc1siV2luZG93Il0uSW5zdGFuY2UpCgogICAgICAgICAgICBsb2NhbCBOZXdUd2VlbgoKICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBEZXNjZW5kYW50cyBkbyAKICAgICAgICAgICAgICAgIGxvY2FsIFRyYW5zcGFyZW5jeVByb3BlcnR5ID0gVHdlZW46R2V0UHJvcGVydHkoVmFsdWUpCgogICAgICAgICAgICAgICAgaWYgbm90IFRyYW5zcGFyZW5jeVByb3BlcnR5IHRoZW4KICAgICAgICAgICAgICAgICAgICBjb250aW51ZSAKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIHR5cGUoVHJhbnNwYXJlbmN5UHJvcGVydHkpID09ICJ0YWJsZSIgdGhlbiAKICAgICAgICAgICAgICAgICAgICBmb3IgXywgUHJvcGVydHkgaW4gVHJhbnNwYXJlbmN5UHJvcGVydHkgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgIE5ld1R3ZWVuID0gVHdlZW46RmFkZUl0ZW0oVmFsdWUsIFByb3BlcnR5LCBCb29sLCBMaWJyYXJ5LkZhZGVTcGVlZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBOZXdUd2VlbiA9IFR3ZWVuOkZhZGVJdGVtKFZhbHVlLCBUcmFuc3BhcmVuY3lQcm9wZXJ0eSwgQm9vbCwgTGlicmFyeS5GYWRlU3BlZWQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBOZXdUd2Vlbi5Ud2Vlbi5Db21wbGV0ZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBEZWJvdW5jZSA9IGZhbHNlIAogICAgICAgICAgICAgICAgSXRlbXNbIldpbmRvdyJdLkluc3RhbmNlLlZpc2libGUgPSBXaW5kb3cuSXNPcGVuCiAgICAgICAgICAgICAgICBpZiBXaW5kb3cuSXNPcGVuIHRoZW4KICAgICAgICAgICAgICAgICAgICBJdGVtc1siTW91c2VCYWNrZ3JvdW5kIl0uSW5zdGFuY2UuVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlSWNvbkVuYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEl0ZW1zWyJNb3VzZUJhY2tncm91bmQiXS5JbnN0YW5jZS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlSWNvbkVuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAoKICAgICAgICBMaWJyYXJ5OkNvbm5lY3QoVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuLCBmdW5jdGlvbihJbnB1dCkKICAgICAgICAgICAgaWYgdG9zdHJpbmcoSW5wdXQuS2V5Q29kZSkgPT0gTGlicmFyeS5NZW51S2V5YmluZCBvciB0b3N0cmluZyhJbnB1dC5Vc2VySW5wdXRUeXBlKSA9PSBMaWJyYXJ5Lk1lbnVLZXliaW5kIHRoZW4KICAgICAgICAgICAgICAgIFdpbmRvdzpTZXRPcGVuKG5vdCBXaW5kb3cuSXNPcGVuKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCgogICAgICAgIGxvY2FsIFNlYXJjaFN0ZXBwZWQKCiAgICAgICAgSXRlbXNbIklucHV0Il06Q29ubmVjdCgiRm9jdXNlZCIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgUGFnZVNlYXJjaERhdGEgPSBMaWJyYXJ5LlNlYXJjaEl0ZW1zW0xpYnJhcnkuQ3VycmVudFBhZ2VdCgogICAgICAgICAgICBpZiBub3QgUGFnZVNlYXJjaERhdGEgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIFNlYXJjaFN0ZXBwZWQgPSBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBmb3IgSW5kZXgsIFZhbHVlIGluIFBhZ2VTZWFyY2hEYXRhIGRvIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIE5hbWUgPSBWYWx1ZS5OYW1lCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgRWxlbWVudCA9IFZhbHVlLkVsZW1lbnQKCiAgICAgICAgICAgICAgICAgICAgaWYgU3RyaW5nRmluZChTdHJpbmdMb3dlcihOYW1lKSwgU3RyaW5nTG93ZXIoSXRlbXNbIklucHV0Il0uSW5zdGFuY2UuVGV4dCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgSXRlbXNbIklucHV0Il0uSW5zdGFuY2UuVGV4dCB+PSAiIiB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxlbWVudC5JbnN0YW5jZS5WaXNpYmxlICA9IHRydWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGVtZW50OlR3ZWVuKFR3ZWVuSW5mby5uZXcoMC4wOCwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFdpbmRvdzpHZXRPbGRTaXplKEVsZW1lbnQpfSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxlbWVudC5JbnN0YW5jZS5WaXNpYmxlICA9IHRydWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbGVtZW50OlR3ZWVuKFR3ZWVuSW5mby5uZXcoMC4wOCwgRW51bS5FYXNpbmdTdHlsZS5RdWFkLCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7U2l6ZSA9IFdpbmRvdzpHZXRPbGRTaXplKEVsZW1lbnQpfSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBXaW5kb3c6QWRkVG9PbGRTaXplcyhFbGVtZW50LCBFbGVtZW50Lkluc3RhbmNlLlNpemUpCiAgICAgICAgICAgICAgICAgICAgICAgIEVsZW1lbnQ6VHdlZW4oVHdlZW5JbmZvLm5ldygwLjA4LCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHtTaXplID0gVURpbTJOZXcoV2luZG93OkdldE9sZFNpemUoRWxlbWVudCkuWC5TY2FsZSwgV2luZG93OkdldE9sZFNpemUoRWxlbWVudCkuWC5PZmZzZXQsIDAsIDApfSkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgRWxlbWVudC5JbnN0YW5jZS5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQoKICAgICAgICBJdGVtc1siSW5wdXQiXTpDb25uZWN0KCJGb2N1c0xvc3QiLCBmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIFNlYXJjaFN0ZXBwZWQgdGhlbiAKICAgICAgICAgICAgICAgIFNlYXJjaFN0ZXBwZWQ6RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBTZWFyY2hTdGVwcGVkID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKCiAgICAgICAgV2luZG93OlNldE9wZW4odHJ1ZSkKICAgICAgICByZXR1cm4gc2V0bWV0YXRhYmxlKFdpbmRvdywgc2VsZikKICAgIGVuZAoKICAgIExpYnJhcnkuUGFnZSA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgIGxvY2FsIFBhZ2UgPSB7CiAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYsCgogICAgICAgICAgICBOYW1lID0gRGF0YS5OYW1lIG9yIERhdGEubmFtZSBvciAiUGFnZSIsCiAgICAgICAgICAgIENvbHVtbnMgPSBEYXRhLkNvbHVtbnMgb3IgRGF0YS5jb2x1bW5zIG9yIDIsCiAgICAgICAgICAgIFN1YlBhZ2VzID0gRGF0YS5TdWJQYWdlcyBvciBEYXRhLnN1YnBhZ2VzIG9yIGZhbHNlLAogICAgICAgIH0KCiAgICAgICAgTGlicmFyeS5TZWFyY2hJdGVtc1tQYWdlXSA9IHsgfQoKICAgICAgICBsb2NhbCBOZXdQYWdlLCBJdGVtcyA9IENvbXBvbmVudHM6V2luZG93UGFnZSh7CiAgICAgICAgICAgIE5hbWUgPSBQYWdlLk5hbWUsCiAgICAgICAgICAgIENvbnRlbnRIb2xkZXIgPSBQYWdlLldpbmRvdy5JdGVtc1siQ29udGVudCJdLAogICAgICAgICAgICBTdGFjayA9IFBhZ2UuV2luZG93LlBhZ2VzLAogICAgICAgICAgICBQYXJlbnQgPSBQYWdlLldpbmRvdy5JdGVtc1siUGFnZXMiXSwKICAgICAgICAgICAgQ29sdW1ucyA9IFBhZ2UuQ29sdW1ucywKICAgICAgICAgICAgU3ViUGFnZXMgPSBQYWdlLlN1YlBhZ2VzLAogICAgICAgICAgICBGYWRlVGltZSA9IFBhZ2UuV2luZG93LkZhZGVUaW1lLAogICAgICAgICAgICBXaW5kb3cgPSBQYWdlLldpbmRvdwogICAgICAgIH0pCgogICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoTmV3UGFnZSwgTGlicmFyeS5QYWdlcykKICAgIGVuZAoKICAgIExpYnJhcnkuUGFnZXMuU3ViUGFnZSA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgIGxvY2FsIFN1YlBhZ2UgPSB7CiAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYuV2luZG93LAogICAgICAgICAgICBQYWdlID0gc2VsZiwKCiAgICAgICAgICAgIE5hbWUgPSBEYXRhLk5hbWUgb3IgRGF0YS5uYW1lIG9yICJTdWJQYWdlIiwKICAgICAgICAgICAgQ29sdW1ucyA9IERhdGEuQ29sdW1ucyBvciBEYXRhLmNvbHVtbnMgb3IgMiwKICAgICAgICB9CgogICAgICAgIExpYnJhcnkuU2VhcmNoSXRlbXNbU3ViUGFnZV0gPSB7IH0KCiAgICAgICAgbG9jYWwgTmV3U3ViUGFnZSwgSXRlbXMgPSBDb21wb25lbnRzOldpbmRvd1N1YlBhZ2UoewogICAgICAgICAgICBQYWdlID0gU3ViUGFnZS5QYWdlLAogICAgICAgICAgICBOYW1lID0gU3ViUGFnZS5OYW1lLAogICAgICAgICAgICBDb2x1bW5zID0gU3ViUGFnZS5Db2x1bW5zLAogICAgICAgICAgICBXaW5kb3cgPSBTdWJQYWdlLlBhZ2UuV2luZG93CiAgICAgICAgfSkKCiAgICAgICAgcmV0dXJuIHNldG1ldGF0YWJsZShOZXdTdWJQYWdlLCBMaWJyYXJ5LlBhZ2VzKQogICAgZW5kCgogICAgTGlicmFyeS5QYWdlcy5TZWN0aW9uID0gZnVuY3Rpb24oc2VsZiwgRGF0YSkKICAgICAgICBEYXRhID0gRGF0YSBvciB7IH0KCiAgICAgICAgbG9jYWwgU2VjdGlvbiA9IHsKICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgIFBhZ2UgPSBzZWxmLAoKICAgICAgICAgICAgTmFtZSA9IERhdGEuTmFtZSBvciBEYXRhLm5hbWUgb3IgIlNlY3Rpb24iLAogICAgICAgICAgICBTaWRlID0gRGF0YS5TaWRlIG9yIERhdGEuc2lkZSBvciAxLAoKICAgICAgICAgICAgSXRlbXMgPSB7IH0KICAgICAgICB9CgogICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgIEl0ZW1zWyJTZWN0aW9uIl0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IFNlY3Rpb24uUGFnZS5Db2x1bW5zRGF0YVtTZWN0aW9uLlNpZGVdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMjUpLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQig0MiwgNDksIDQ1KSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDIsCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyMCwgMjQsIDIxKQogICAgICAgICAgICB9KSAgSXRlbXNbIlNlY3Rpb24iXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzID0gIklubGluZSIsIEJvcmRlckNvbG9yMyA9ICJPdXRsaW5lIn0pCgogICAgICAgICAgICBJdGVtc1siU2VjdGlvbiJdOkJvcmRlcigiQm9yZGVyIikKCiAgICAgICAgICAgIEl0ZW1zWyJMaW5lciJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siU2VjdGlvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yTmV3KDEsIDAsIDAsIDEpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siTGluZXIiXTpBZGRUb1RoZW1lKHtCYWNrZ3JvdW5kQ29sb3IzICA9ICJBY2NlbnQifSkKCiAgICAgICAgICAgIEl0ZW1zWyJHbG93Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJGcmFtZSIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTZWN0aW9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDIwMiwgMjQzLCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siR2xvdyJdOkFkZFRvVGhlbWUoe0JhY2tncm91bmRDb2xvcjMgID0gIkFjY2VudCJ9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlHcmFkaWVudCIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJHbG93Il0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFJvdGF0aW9uID0gOTAsCiAgICAgICAgICAgICAgICBUcmFuc3BhcmVuY3kgPSBOdW1TZXF1ZW5jZXtOdW1TZXF1ZW5jZUtleXBvaW50KDAsIDApLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuMTkzLCAwLjg2ODc0OTk3NjE1ODE0MjEpLCBOdW1TZXF1ZW5jZUtleXBvaW50KDAuNTA0LCAwLjk2ODc1KSwgTnVtU2VxdWVuY2VLZXlwb2ludCgxLCAxKX0KICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siU2VjdGlvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBGb250RmFjZSA9IExpYnJhcnkuRm9udCwKICAgICAgICAgICAgICAgIFRleHRDb2xvcjMgPSBGcm9tUkdCKDIzNSwgMjM1LCAyMzUpLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFRleHQgPSBTZWN0aW9uLk5hbWUsCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDYsIDAsIDUpLAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgSXRlbXNbIlRleHQiXTpUZXh0Qm9yZGVyKCkKCiAgICAgICAgICAgIEluc3RhbmNlczpDcmVhdGUoIlVJUGFkZGluZyIsIHsKICAgICAgICAgICAgICAgIFBhcmVudCA9IEl0ZW1zWyJTZWN0aW9uIl0uSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIFBhZGRpbmdCb3R0b20gPSBVRGltTmV3KDAsIDgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICBJdGVtc1siQ29udGVudCJdID0gSW5zdGFuY2VzOkNyZWF0ZSgiRnJhbWUiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siU2VjdGlvbiJdLkluc3RhbmNlLAogICAgICAgICAgICAgICAgTmFtZSA9ICJcMCIsCiAgICAgICAgICAgICAgICBCb3JkZXJDb2xvcjMgPSBGcm9tUkdCKDAsIDAsIDApLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEsCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDEwLCAwLCAyNiksCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMSwgLTIwLCAwLCAwKSwKICAgICAgICAgICAgICAgIEJvcmRlclNpemVQaXhlbCA9IDAsCiAgICAgICAgICAgICAgICBBdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gRnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgSW5zdGFuY2VzOkNyZWF0ZSgiVUlMaXN0TGF5b3V0IiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gSXRlbXNbIkNvbnRlbnQiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgUGFkZGluZyA9IFVEaW1OZXcoMCwgOCksCiAgICAgICAgICAgICAgICBTb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICB9KQoKICAgICAgICAgICAgU2VjdGlvbi5JdGVtcyA9IEl0ZW1zCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBzZXRtZXRhdGFibGUoU2VjdGlvbiwgTGlicmFyeS5TZWN0aW9ucykKICAgIGVuZAogICAgCiAgICBMaWJyYXJ5LlNlY3Rpb25zLlRvZ2dsZSA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgIGxvY2FsIFRvZ2dsZSA9IHsKICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgIFBhZ2UgPSBzZWxmLlBhZ2UsCiAgICAgICAgICAgIFNlY3Rpb24gPSBzZWxmLAoKICAgICAgICAgICAgTmFtZSA9IERhdGEuTmFtZSBvciBEYXRhLm5hbWUgb3IgIlRvZ2dsZSIsCiAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcgb3IgRGF0YS5mbGFnIG9yIExpYnJhcnk6TmV4dEZsYWcoKSwKICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLmRlZmF1bHQgb3IgZmFsc2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gRGF0YS5DYWxsYmFjayBvciBEYXRhLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBOZXdUb2dnbGUsIFRvZ2dsZUl0ZW1zID0gQ29tcG9uZW50czpUb2dnbGUoewogICAgICAgICAgICBOYW1lID0gVG9nZ2xlLk5hbWUsCiAgICAgICAgICAgIFBhcmVudCA9IFRvZ2dsZS5TZWN0aW9uLkl0ZW1zWyJDb250ZW50Il0sCiAgICAgICAgICAgIEZsYWcgPSBUb2dnbGUuRmxhZywKICAgICAgICAgICAgRGVmYXVsdCA9IFRvZ2dsZS5EZWZhdWx0LAogICAgICAgICAgICBQYWdlID0gVG9nZ2xlLlBhZ2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gVG9nZ2xlLkNhbGxiYWNrCiAgICAgICAgfSkKCiAgICAgICAgZnVuY3Rpb24gTmV3VG9nZ2xlOkNvbG9ycGlja2VyKERhdGEpCiAgICAgICAgICAgIGxvY2FsIENvbG9ycGlja2VyID0gewogICAgICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgICAgICBQYWdlID0gc2VsZi5QYWdlLAogICAgICAgICAgICAgICAgU2VjdGlvbiA9IHNlbGYsCgogICAgICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZyBvciBEYXRhLmZsYWcgb3IgTGlicmFyeTpOZXh0RmxhZygpLAogICAgICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLmRlZmF1bHQgb3IgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksCiAgICAgICAgICAgICAgICBDYWxsYmFjayA9IERhdGEuQ2FsbGJhY2sgb3IgRGF0YS5jYWxsYmFjayBvciBmdW5jdGlvbigpIGVuZCwKICAgICAgICAgICAgICAgIEFscGhhID0gRGF0YS5BbHBoYSBvciBEYXRhLmFscGhhIG9yIDAsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIE5ld0NvbG9ycGlja2VyLCBDb2xvcnBpY2tlckl0ZW1zID0gQ29tcG9uZW50czpDb2xvcnBpY2tlcih7CiAgICAgICAgICAgICAgICBOYW1lID0gQ29sb3JwaWNrZXIuTmFtZSwKICAgICAgICAgICAgICAgIFBhcmVudCA9IFRvZ2dsZUl0ZW1zWyJTdWJFbGVtZW50cyJdLAogICAgICAgICAgICAgICAgUGFnZXMgPSB0cnVlLAogICAgICAgICAgICAgICAgUGFnZSA9IENvbG9ycGlja2VyLlBhZ2UsCiAgICAgICAgICAgICAgICBGbGFnID0gQ29sb3JwaWNrZXIuRmxhZywKICAgICAgICAgICAgICAgIERlZmF1bHQgPSBDb2xvcnBpY2tlci5EZWZhdWx0LAogICAgICAgICAgICAgICAgQWxwaGEgPSBDb2xvcnBpY2tlci5BbHBoYSwKICAgICAgICAgICAgICAgIENhbGxiYWNrID0gQ29sb3JwaWNrZXIuQ2FsbGJhY2ssCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gTmV3Q29sb3JwaWNrZXIKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gTmV3VG9nZ2xlOktleWJpbmQoRGF0YSkKICAgICAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgICAgICBsb2NhbCBLZXliaW5kID0gewogICAgICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgICAgICBQYWdlID0gc2VsZi5QYWdlLAogICAgICAgICAgICAgICAgU2VjdGlvbiA9IHNlbGYuU2VjdGlvbiwKCiAgICAgICAgICAgICAgICBGbGFnID0gRGF0YS5GbGFnIG9yIERhdGEuZmxhZyBvciBMaWJyYXJ5Ok5leHRGbGFnKCksCiAgICAgICAgICAgICAgICBEZWZhdWx0ID0gRGF0YS5EZWZhdWx0IG9yIERhdGEuZGVmYXVsdCBvciBFbnVtLktleUNvZGUuUmlnaHRTaGlmdCwKICAgICAgICAgICAgICAgIENhbGxiYWNrID0gRGF0YS5DYWxsYmFjayBvciBEYXRhLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kLAogICAgICAgICAgICAgICAgTW9kZSA9IERhdGEuTW9kZSBvciBEYXRhLm1vZGUgb3IgIlRvZ2dsZSIsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIE5ld0tleWJpbmQsIEtleWJpbmRJdGVtcyA9IENvbXBvbmVudHM6S2V5YmluZCh7CiAgICAgICAgICAgICAgICBOYW1lID0gVG9nZ2xlLk5hbWUsCiAgICAgICAgICAgICAgICBQYXJlbnQgPSBUb2dnbGVJdGVtc1siU3ViRWxlbWVudHMiXSwKICAgICAgICAgICAgICAgIFBhZ2UgPSBLZXliaW5kLlBhZ2UsCiAgICAgICAgICAgICAgICBGbGFnID0gS2V5YmluZC5GbGFnLAogICAgICAgICAgICAgICAgRGVmYXVsdCA9IEtleWJpbmQuRGVmYXVsdCwKICAgICAgICAgICAgICAgIE1vZGUgPSBLZXliaW5kLk1vZGUsCiAgICAgICAgICAgICAgICBDYWxsYmFjayA9IEtleWJpbmQuQ2FsbGJhY2sKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHJldHVybiBOZXdLZXliaW5kCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBOZXdUb2dnbGUKICAgIGVuZAoKICAgIExpYnJhcnkuU2VjdGlvbnMuQnV0dG9uID0gZnVuY3Rpb24oc2VsZikKICAgICAgICBsb2NhbCBCdXR0b24gPSB7CiAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYuV2luZG93LAogICAgICAgICAgICBQYWdlID0gc2VsZi5QYWdlLAogICAgICAgICAgICBTZWN0aW9uID0gc2VsZgogICAgICAgIH0KCiAgICAgICAgbG9jYWwgTmV3QnV0dG9uLCBCdXR0b25JdGVtcyA9IENvbXBvbmVudHM6QnV0dG9uKHsKICAgICAgICAgICAgUGFyZW50ID0gQnV0dG9uLlNlY3Rpb24uSXRlbXNbIkNvbnRlbnQiXSwKICAgICAgICAgICAgUGFnZSA9IEJ1dHRvbi5QYWdlCiAgICAgICAgfSkKCiAgICAgICAgcmV0dXJuIE5ld0J1dHRvbgogICAgZW5kCgogICAgTGlicmFyeS5TZWN0aW9ucy5TbGlkZXIgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgIERhdGEgPSBEYXRhIG9yIHsgfQogICAgICAgIAogICAgICAgIGxvY2FsIFNsaWRlciA9IHsKICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgIFBhZ2UgPSBzZWxmLlBhZ2UsCiAgICAgICAgICAgIFNlY3Rpb24gPSBzZWxmLAoKICAgICAgICAgICAgTmFtZSA9IERhdGEuTmFtZSBvciBEYXRhLm5hbWUgb3IgIlNsaWRlciIsCiAgICAgICAgICAgIEZsYWcgPSBEYXRhLkZsYWcgb3IgRGF0YS5mbGFnIG9yIExpYnJhcnk6TmV4dEZsYWcoKSwKICAgICAgICAgICAgTWluID0gRGF0YS5NaW4gb3IgRGF0YS5taW4gb3IgMCwKICAgICAgICAgICAgRGVjaW1hbHMgPSBEYXRhLkRlY2ltYWxzIG9yIERhdGEuZGVjaW1hbHMgb3IgMSwKICAgICAgICAgICAgU3VmZml4ID0gRGF0YS5TdWZmaXggb3IgRGF0YS5zdWZmaXggb3IgIiIsCiAgICAgICAgICAgIE1heCA9IERhdGEuTWF4IG9yIERhdGEubWF4IG9yIDEwMCwKICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLkRlZmF1bHQgb3IgMCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBEYXRhLkNhbGxiYWNrIG9yIERhdGEuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBOZXdTbGlkZXIsIFNsaWRlckl0ZW1zID0gQ29tcG9uZW50czpTbGlkZXIoewogICAgICAgICAgICBOYW1lID0gU2xpZGVyLk5hbWUsCiAgICAgICAgICAgIFBhcmVudCA9IFNsaWRlci5TZWN0aW9uLkl0ZW1zWyJDb250ZW50Il0sCiAgICAgICAgICAgIEZsYWcgPSBTbGlkZXIuRmxhZywKICAgICAgICAgICAgTWluID0gU2xpZGVyLk1pbiwKICAgICAgICAgICAgUGFnZSA9IFNsaWRlci5QYWdlLAogICAgICAgICAgICBEZWNpbWFscyA9IFNsaWRlci5EZWNpbWFscywKICAgICAgICAgICAgU3VmZml4ID0gU2xpZGVyLlN1ZmZpeCwKICAgICAgICAgICAgTWF4ID0gU2xpZGVyLk1heCwKICAgICAgICAgICAgRGVmYXVsdCA9IFNsaWRlci5EZWZhdWx0LAogICAgICAgICAgICBDYWxsYmFjayA9IFNsaWRlci5DYWxsYmFjaywKICAgICAgICB9KQoKICAgICAgICBsb2NhbCBQYWdlU2VhcmNoRGF0YSA9IExpYnJhcnkuU2VhcmNoSXRlbXNbU2xpZGVyLlBhZ2VdCgogICAgICAgIGlmIFBhZ2VTZWFyY2hEYXRhIHRoZW4KICAgICAgICAgICAgbG9jYWwgU2VhcmNoRGF0YSA9IHsKICAgICAgICAgICAgICAgIEVsZW1lbnQgPSBTbGlkZXJJdGVtc1siU2xpZGVyIl0sCiAgICAgICAgICAgICAgICBOYW1lID0gU2xpZGVyLk5hbWUsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KFBhZ2VTZWFyY2hEYXRhLCBTZWFyY2hEYXRhKQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gTmV3U2xpZGVyIAogICAgZW5kCgogICAgTGlicmFyeS5TZWN0aW9ucy5Ecm9wZG93biA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgIGxvY2FsIERyb3Bkb3duID0gewogICAgICAgICAgICBXaW5kb3cgPSBzZWxmLldpbmRvdywKICAgICAgICAgICAgUGFnZSA9IHNlbGYuUGFnZSwKICAgICAgICAgICAgU2VjdGlvbiA9IHNlbGYsCgogICAgICAgICAgICBOYW1lID0gRGF0YS5OYW1lIG9yIERhdGEubmFtZSBvciAiRHJvcGRvd24iLAogICAgICAgICAgICBGbGFnID0gRGF0YS5GbGFnIG9yIERhdGEuZmxhZyBvciBMaWJyYXJ5Ok5leHRGbGFnKCksCiAgICAgICAgICAgIEl0ZW1zID0gRGF0YS5JdGVtcyBvciBEYXRhLml0ZW1zIG9yIHsgfSwKICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLmRlZmF1bHQgb3IgbmlsLAogICAgICAgICAgICBNdWx0aSA9IERhdGEuTXVsdGkgb3IgRGF0YS5tdWx0aSBvciBmYWxzZSwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBEYXRhLkNhbGxiYWNrIG9yIERhdGEuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQgICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIGxvY2FsIE5ld0Ryb3Bkb3duLCBEcm9wZG93bkl0ZW1zID0gQ29tcG9uZW50czpEcm9wZG93bih7CiAgICAgICAgICAgIE5hbWUgPSBEcm9wZG93bi5OYW1lLAogICAgICAgICAgICBQYXJlbnQgPSBEcm9wZG93bi5TZWN0aW9uLkl0ZW1zWyJDb250ZW50Il0sCiAgICAgICAgICAgIEZsYWcgPSBEcm9wZG93bi5GbGFnLAogICAgICAgICAgICBJdGVtcyA9IERyb3Bkb3duLkl0ZW1zLAogICAgICAgICAgICBQYWdlID0gRHJvcGRvd24uUGFnZSwKICAgICAgICAgICAgRGVmYXVsdCA9IERyb3Bkb3duLkRlZmF1bHQsCiAgICAgICAgICAgIE11bHRpID0gRHJvcGRvd24uTXVsdGksCiAgICAgICAgICAgIENhbGxiYWNrID0gRHJvcGRvd24uQ2FsbGJhY2ssCiAgICAgICAgfSkKCiAgICAgICAgbG9jYWwgUGFnZVNlYXJjaERhdGEgPSBMaWJyYXJ5LlNlYXJjaEl0ZW1zW0Ryb3Bkb3duLlBhZ2VdCgogICAgICAgIGlmIFBhZ2VTZWFyY2hEYXRhIHRoZW4KICAgICAgICAgICAgbG9jYWwgU2VhcmNoRGF0YSA9IHsKICAgICAgICAgICAgICAgIEVsZW1lbnQgPSBEcm9wZG93bkl0ZW1zWyJEcm9wZG93biJdLAogICAgICAgICAgICAgICAgTmFtZSA9IERyb3Bkb3duLk5hbWUsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KFBhZ2VTZWFyY2hEYXRhLCBTZWFyY2hEYXRhKQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gTmV3RHJvcGRvd24gCiAgICBlbmQKCiAgICBMaWJyYXJ5LlNlY3Rpb25zLkxhYmVsID0gZnVuY3Rpb24oc2VsZiwgTmFtZSkKICAgICAgICBsb2NhbCBMYWJlbCA9IHsKICAgICAgICAgICAgV2luZG93ID0gc2VsZi5XaW5kb3csCiAgICAgICAgICAgIFBhZ2UgPSBzZWxmLlBhZ2UsCiAgICAgICAgICAgIFNlY3Rpb24gPSBzZWxmLAoKICAgICAgICAgICAgTmFtZSA9IE5hbWUgb3IgIkxhYmVsIgogICAgICAgIH0KCiAgICAgICAgbG9jYWwgTmV3TGFiZWwsIExhYmVsSXRlbXMgPSBDb21wb25lbnRzOkxhYmVsKHsKICAgICAgICAgICAgTmFtZSA9IExhYmVsLk5hbWUsCiAgICAgICAgICAgIFBhcmVudCA9IExhYmVsLlNlY3Rpb24uSXRlbXNbIkNvbnRlbnQiXSwKICAgICAgICAgICAgUGFnZSA9IExhYmVsLlBhZ2UsCiAgICAgICAgfSkKCiAgICAgICAgZnVuY3Rpb24gTmV3TGFiZWw6Q29sb3JwaWNrZXIoRGF0YSkKICAgICAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgICAgICBsb2NhbCBDb2xvcnBpY2tlciA9IHsKICAgICAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYuV2luZG93LAogICAgICAgICAgICAgICAgUGFnZSA9IHNlbGYuUGFnZSwKICAgICAgICAgICAgICAgIFNlY3Rpb24gPSBzZWxmLlNlY3Rpb24sCgogICAgICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZyBvciBEYXRhLmZsYWcgb3IgTGlicmFyeTpOZXh0RmxhZygpLAogICAgICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLmRlZmF1bHQgb3IgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSksCiAgICAgICAgICAgICAgICBDYWxsYmFjayA9IERhdGEuQ2FsbGJhY2sgb3IgRGF0YS5jYWxsYmFjayBvciBmdW5jdGlvbigpIGVuZCwKICAgICAgICAgICAgICAgIEFscGhhID0gRGF0YS5BbHBoYSBvciBEYXRhLmFscGhhIG9yIDAsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIE5ld0NvbG9ycGlja2VyLCBDb2xvcnBpY2tlckl0ZW1zID0gQ29tcG9uZW50czpDb2xvcnBpY2tlcih7CiAgICAgICAgICAgICAgICBOYW1lID0gQ29sb3JwaWNrZXIuTmFtZSwKICAgICAgICAgICAgICAgIFBhcmVudCA9IExhYmVsSXRlbXNbIlN1YkVsZW1lbnRzIl0sCiAgICAgICAgICAgICAgICBQYWdlcyA9IHRydWUsCiAgICAgICAgICAgICAgICBQYWdlID0gQ29sb3JwaWNrZXIuUGFnZSwKICAgICAgICAgICAgICAgIEZsYWcgPSBDb2xvcnBpY2tlci5GbGFnLAogICAgICAgICAgICAgICAgRGVmYXVsdCA9IENvbG9ycGlja2VyLkRlZmF1bHQsCiAgICAgICAgICAgICAgICBBbHBoYSA9IENvbG9ycGlja2VyLkFscGhhLAogICAgICAgICAgICAgICAgQ2FsbGJhY2sgPSBDb2xvcnBpY2tlci5DYWxsYmFjaywKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIHJldHVybiBOZXdDb2xvcnBpY2tlcgogICAgICAgIGVuZAoKICAgICAgICBmdW5jdGlvbiBOZXdMYWJlbDpLZXliaW5kKERhdGEpCiAgICAgICAgICAgIERhdGEgPSBEYXRhIG9yIHsgfQoKICAgICAgICAgICAgbG9jYWwgS2V5YmluZCA9IHsKICAgICAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYuV2luZG93LAogICAgICAgICAgICAgICAgUGFnZSA9IHNlbGYuUGFnZSwKICAgICAgICAgICAgICAgIFNlY3Rpb24gPSBzZWxmLlNlY3Rpb24sCgogICAgICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZyBvciBEYXRhLmZsYWcgb3IgTGlicmFyeTpOZXh0RmxhZygpLAogICAgICAgICAgICAgICAgRGVmYXVsdCA9IERhdGEuRGVmYXVsdCBvciBEYXRhLmRlZmF1bHQgb3IgRW51bS5LZXlDb2RlLlJpZ2h0U2hpZnQsCiAgICAgICAgICAgICAgICBDYWxsYmFjayA9IERhdGEuQ2FsbGJhY2sgb3IgRGF0YS5jYWxsYmFjayBvciBmdW5jdGlvbigpIGVuZCwKICAgICAgICAgICAgICAgIE1vZGUgPSBEYXRhLk1vZGUgb3IgRGF0YS5tb2RlIG9yICJUb2dnbGUiLAogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2NhbCBOZXdLZXliaW5kLCBLZXliaW5kSXRlbXMgPSBDb21wb25lbnRzOktleWJpbmQoewogICAgICAgICAgICAgICAgTmFtZSA9IExhYmVsLk5hbWUsCiAgICAgICAgICAgICAgICBQYXJlbnQgPSBMYWJlbEl0ZW1zWyJTdWJFbGVtZW50cyJdLAogICAgICAgICAgICAgICAgUGFnZSA9IEtleWJpbmQuUGFnZSwKICAgICAgICAgICAgICAgIEZsYWcgPSBLZXliaW5kLkZsYWcsCiAgICAgICAgICAgICAgICBEZWZhdWx0ID0gS2V5YmluZC5EZWZhdWx0LAogICAgICAgICAgICAgICAgTW9kZSA9IEtleWJpbmQuTW9kZSwKICAgICAgICAgICAgICAgIENhbGxiYWNrID0gS2V5YmluZC5DYWxsYmFjawogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIE5ld0tleWJpbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgUGFnZVNlYXJjaERhdGEgPSBMaWJyYXJ5LlNlYXJjaEl0ZW1zW0xhYmVsLlBhZ2VdCgogICAgICAgIGlmIFBhZ2VTZWFyY2hEYXRhIHRoZW4KICAgICAgICAgICAgbG9jYWwgU2VhcmNoRGF0YSA9IHsKICAgICAgICAgICAgICAgIEVsZW1lbnQgPSBMYWJlbEl0ZW1zWyJMYWJlbCJdLAogICAgICAgICAgICAgICAgTmFtZSA9IExhYmVsLk5hbWUsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KFBhZ2VTZWFyY2hEYXRhLCBTZWFyY2hEYXRhKQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gTmV3TGFiZWwKICAgIGVuZAoKICAgIExpYnJhcnkuU2VjdGlvbnMuVGV4dGJveCA9IGZ1bmN0aW9uKHNlbGYsIERhdGEpCiAgICAgICAgRGF0YSA9IERhdGEgb3IgeyB9CgogICAgICAgIGxvY2FsIFRleHRib3ggPSB7CiAgICAgICAgICAgIFdpbmRvdyA9IHNlbGYuV2luZG93LAogICAgICAgICAgICBQYWdlID0gc2VsZi5QYWdlLAogICAgICAgICAgICBTZWN0aW9uID0gc2VsZiwKCiAgICAgICAgICAgIE5hbWUgPSBEYXRhLk5hbWUgb3IgRGF0YS5uYW1lIG9yICJUZXh0Ym94IiwKICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZyBvciBEYXRhLmZsYWcgb3IgTGlicmFyeTpOZXh0RmxhZygpLAogICAgICAgICAgICBEZWZhdWx0ID0gRGF0YS5EZWZhdWx0IG9yIERhdGEuZGVmYXVsdCBvciAiIiwKICAgICAgICAgICAgTnVtZXJpYyA9IERhdGEuTnVtZXJpYyBvciBEYXRhLm51bWVyaWMgb3IgZmFsc2UsCiAgICAgICAgICAgIEZpbmlzaGVkID0gRGF0YS5GaW5pc2hlZCBvciBEYXRhLmZpbmlzaGVkIG9yIGZhbHNlLAogICAgICAgICAgICBQbGFjZWhvbGRlciA9IERhdGEuUGxhY2Vob2xkZXIgb3IgRGF0YS5wbGFjZWhvbGRlciBvciAiLi4uIiwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBEYXRhLkNhbGxiYWNrIG9yIERhdGEuY2FsbGJhY2sgb3IgZnVuY3Rpb24oKSBlbmQsCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBOZXdUZXh0Ym94LCBUZXh0Ym94SXRlbXMgPSBDb21wb25lbnRzOlRleHRib3goewogICAgICAgICAgICBOYW1lID0gVGV4dGJveC5OYW1lLAogICAgICAgICAgICBQbGFjZWhvbGRlciA9IFRleHRib3guUGxhY2Vob2xkZXIsCiAgICAgICAgICAgIFBhcmVudCA9IFRleHRib3guU2VjdGlvbi5JdGVtc1siQ29udGVudCJdLAogICAgICAgICAgICBGbGFnID0gVGV4dGJveC5GbGFnLAogICAgICAgICAgICBQYWdlID0gVGV4dGJveC5QYWdlLAogICAgICAgICAgICBEZWZhdWx0ID0gVGV4dGJveC5EZWZhdWx0LAogICAgICAgICAgICBOdW1lcmljID0gVGV4dGJveC5OdW1lcmljLAogICAgICAgICAgICBGaW5pc2hlZCA9IFRleHRib3guRmluaXNoZWQsCiAgICAgICAgICAgIENhbGxiYWNrID0gVGV4dGJveC5DYWxsYmFjaywKICAgICAgICB9KQoKICAgICAgICBsb2NhbCBQYWdlU2VhcmNoRGF0YSA9IExpYnJhcnkuU2VhcmNoSXRlbXNbVGV4dGJveC5QYWdlXQoKICAgICAgICBpZiBQYWdlU2VhcmNoRGF0YSB0aGVuCiAgICAgICAgICAgIGxvY2FsIFNlYXJjaERhdGEgPSB7CiAgICAgICAgICAgICAgICBFbGVtZW50ID0gVGV4dGJveEl0ZW1zWyJUZXh0Ym94Il0sCiAgICAgICAgICAgICAgICBOYW1lID0gVGV4dGJveC5OYW1lLAogICAgICAgICAgICB9CgogICAgICAgICAgICBUYWJsZUluc2VydChQYWdlU2VhcmNoRGF0YSwgU2VhcmNoRGF0YSkKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIE5ld1RleHRib3gKICAgIGVuZAoKICAgIExpYnJhcnkuU2VjdGlvbnMuU2VhcmNoYm94ID0gZnVuY3Rpb24oc2VsZiwgRGF0YSkKICAgICAgICBEYXRhID0gRGF0YSBvciB7IH0KCiAgICAgICAgbG9jYWwgU2VhcmNoYm94ID0gewogICAgICAgICAgICBXaW5kb3cgPSBzZWxmLldpbmRvdywKICAgICAgICAgICAgUGFnZSA9IHNlbGYuUGFnZSwKICAgICAgICAgICAgU2VjdGlvbiA9IHNlbGYsCgogICAgICAgICAgICBOYW1lID0gRGF0YS5OYW1lIG9yIERhdGEubmFtZSBvciAiU2VhcmNoYm94IiwKICAgICAgICAgICAgRmxhZyA9IERhdGEuRmxhZyBvciBEYXRhLmZsYWcgb3IgTGlicmFyeTpOZXh0RmxhZygpLAogICAgICAgICAgICBJdGVtcyA9IERhdGEuSXRlbXMgb3IgRGF0YS5pdGVtcyBvciB7IH0sCiAgICAgICAgICAgIERlZmF1bHQgPSBEYXRhLkRlZmF1bHQgb3IgRGF0YS5kZWZhdWx0IG9yIG5pbCwKICAgICAgICAgICAgTXVsdGkgPSBEYXRhLk11bHRpIG9yIERhdGEubXVsdGkgb3IgZmFsc2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gRGF0YS5DYWxsYmFjayBvciBEYXRhLmNhbGxiYWNrIG9yIGZ1bmN0aW9uKCkgZW5kICAgICAgICAgICAgCiAgICAgICAgfQoKICAgICAgICBsb2NhbCBOZXdTZWFyY2hib3gsIFNlYXJjaGJveEl0ZW1zID0gQ29tcG9uZW50czpTZWFyY2hib3goewogICAgICAgICAgICBQYXJlbnQgPSBTZWFyY2hib3guU2VjdGlvbi5JdGVtc1siQ29udGVudCJdLAogICAgICAgICAgICBGbGFnID0gU2VhcmNoYm94LkZsYWcsCiAgICAgICAgICAgIEl0ZW1zID0gU2VhcmNoYm94Lkl0ZW1zLAogICAgICAgICAgICBQYWdlID0gU2VhcmNoYm94LlBhZ2UsCiAgICAgICAgICAgIERlZmF1bHQgPSBTZWFyY2hib3guRGVmYXVsdCwKICAgICAgICAgICAgTXVsdGkgPSBTZWFyY2hib3guTXVsdGksCiAgICAgICAgICAgIENhbGxiYWNrID0gU2VhcmNoYm94LkNhbGxiYWNrLAogICAgICAgIH0pCgogICAgICAgIGxvY2FsIFBhZ2VTZWFyY2hEYXRhID0gTGlicmFyeS5TZWFyY2hJdGVtc1tTZWFyY2hib3guUGFnZV0KCiAgICAgICAgaWYgUGFnZVNlYXJjaERhdGEgdGhlbgogICAgICAgICAgICBsb2NhbCBTZWFyY2hEYXRhID0gewogICAgICAgICAgICAgICAgRWxlbWVudCA9IFNlYXJjaGJveEl0ZW1zWyJMaXN0Ym94Il0sCiAgICAgICAgICAgICAgICBOYW1lID0gU2VhcmNoYm94Lk5hbWUsCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFRhYmxlSW5zZXJ0KFBhZ2VTZWFyY2hEYXRhLCBTZWFyY2hEYXRhKQogICAgICAgIGVuZAoKICAgICAgICByZXR1cm4gTmV3U2VhcmNoYm94IAogICAgZW5kCgogICAgTGlicmFyeS5CbGFua0VsZW1lbnQgPSBmdW5jdGlvbihzZWxmLCBEYXRhKQogICAgICAgIGxvY2FsIEJsYW5rRWxlbWVudCA9IHsKICAgICAgICAgICAgTmFtZSA9IERhdGEuTmFtZSBvciBEYXRhLm5hbWUgb3IgIkJsYW5rIiwKICAgICAgICAgICAgU2l6ZSA9IERhdGEuU2l6ZSBvciBEYXRhLnNpemUgb3IgMTgKICAgICAgICB9CgogICAgICAgIGxvY2FsIEl0ZW1zID0geyB9IGRvCiAgICAgICAgICAgIEl0ZW1zWyJCbGFua0VsZW1lbnQiXSA9IEluc3RhbmNlczpDcmVhdGUoIkZyYW1lIiwgewogICAgICAgICAgICAgICAgUGFyZW50ID0gTGlicmFyeS5Ib2xkZXIuSW5zdGFuY2UsCiAgICAgICAgICAgICAgICBOYW1lID0gIlwwIiwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxLAogICAgICAgICAgICAgICAgQm9yZGVyQ29sb3IzID0gRnJvbVJHQigwLCAwLCAwKSwKICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMk5ldygxLCAwLCAwLCBCbGFua0VsZW1lbnQuU2l6ZSksCiAgICAgICAgICAgICAgICBCb3JkZXJTaXplUGl4ZWwgPSAwLAogICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IEZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIEl0ZW1zWyJUZXh0Il0gPSBJbnN0YW5jZXM6Q3JlYXRlKCJUZXh0TGFiZWwiLCB7CiAgICAgICAgICAgICAgICBQYXJlbnQgPSBJdGVtc1siTGFiZWwiXS5JbnN0YW5jZSwKICAgICAgICAgICAgICAgIE5hbWUgPSAiXDAiLAogICAgICAgICAgICAgICAgRm9udEZhY2UgPSBMaWJyYXJ5LkZvbnQsCiAgICAgICAgICAgICAgICBUZXh0Q29sb3IzID0gRnJvbVJHQigyMzUsIDIzNSwgMjM1KSwKICAgICAgICAgICAgICAgIEJvcmRlckNvbG9yMyA9IEZyb21SR0IoMCwgMCwgMCksCiAgICAgICAgICAgICAgICBUZXh0ID0gQmxhbmtFbGVtZW50Lk5hbWUsCiAgICAgICAgICAgICAgICBTaXplID0gVURpbTJOZXcoMCwgMCwgMCwgMTUpLAogICAgICAgICAgICAgICAgQW5jaG9yUG9pbnQgPSBWZWN0b3IyTmV3KDAsIDAuNSksCiAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yTmV3KDAsIDAsIDAuNSwgMCksCiAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSwKICAgICAgICAgICAgICAgIFRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAogICAgICAgICAgICAgICAgQm9yZGVyU2l6ZVBpeGVsID0gMCwKICAgICAgICAgICAgICAgIEF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWCwKICAgICAgICAgICAgICAgIFRleHRTaXplID0gOSwKICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBGcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIH0pICBJdGVtc1siVGV4dCJdOkFkZFRvVGhlbWUoe1RleHRDb2xvcjMgPSAiVGV4dCJ9KQoKICAgICAgICAgICAgSXRlbXNbIlRleHQiXTpUZXh0Qm9yZGVyKCkKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIEJsYW5rRWxlbWVudCwgSXRlbXMKICAgIGVuZAoKICAgIExpYnJhcnkuQ3JlYXRlU2V0dGluZ3NQYWdlID0gZnVuY3Rpb24oc2VsZiwgV2luZG93LCBXYXRlcm1hcmssIEtleWJpbmRMaXN0KQogICAgICAgIGxvY2FsIFNldHRpbmdzUGFnZSA9IFdpbmRvdzpQYWdlKHtOYW1lID0gIlNldHRpbmdzIiwgU3ViUGFnZXMgPSB0cnVlfSkgZG8gCiAgICAgICAgICAgIGxvY2FsIFRoZW1pbmdTdWJQYWdlID0gU2V0dGluZ3NQYWdlOlN1YlBhZ2Uoe05hbWUgPSAiVGhlbWluZyIsIENvbHVtbnMgPSAyfSkgZG8gCiAgICAgICAgICAgICAgICBsb2NhbCBUaGVtZXNTZWN0aW9uID0gVGhlbWluZ1N1YlBhZ2U6U2VjdGlvbih7TmFtZSA9ICJUaGVtZXMiLCBTaWRlID0gMX0pIGRvCiAgICAgICAgICAgICAgICAgICAgZm9yIEluZGV4LCBWYWx1ZSBpbiBMaWJyYXJ5LlRoZW1lIGRvIAogICAgICAgICAgICAgICAgICAgICAgICBUaGVtZXNTZWN0aW9uOkxhYmVsKEluZGV4KTpDb2xvcnBpY2tlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGbGFnID0gSW5kZXguLiJUaGVtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0ID0gVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuVGhlbWVbSW5kZXhdID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5OkNoYW5nZVRoZW1lKEluZGV4LCBWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgQ29uZmlnc1N1YlBhZ2UgPSBTZXR0aW5nc1BhZ2U6U3ViUGFnZSh7TmFtZSA9ICJDb25maWdzIiwgQ29sdW1ucyA9IDJ9KSBkbyAKICAgICAgICAgICAgICAgIGxvY2FsIENvbmZpZ3NTZWN0aW9uID0gQ29uZmlnc1N1YlBhZ2U6U2VjdGlvbih7TmFtZSA9ICJDb25maWdzIiwgU2lkZSA9IDF9KSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIENvbmZpZ05hbWUKICAgICAgICAgICAgICAgICAgICBsb2NhbCBDb25maWdTZWxlY3RlZAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBDb25maWdzU2VhcmNoYm94ID0gQ29uZmlnc1NlY3Rpb246U2VhcmNoYm94KHsKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9ICJTZWFyY2hib3hDb25maWdzIiwKICAgICAgICAgICAgICAgICAgICAgICAgRmxhZyA9ICJDb25maWdzU2VhcmNob2J4IiwKICAgICAgICAgICAgICAgICAgICAgICAgSXRlbXMgPSB7IH0sCiAgICAgICAgICAgICAgICAgICAgICAgIE11bHRpID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWdTZWxlY3RlZCA9IFZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIENvbmZpZ3NTZWN0aW9uOlRleHRib3goewogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0gIkNvbmZpZyBuYW1lIiwgCiAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgPSAiIiwgCiAgICAgICAgICAgICAgICAgICAgICAgIEZsYWcgPSAiQ29uZmlnTmFtZSIsIAogICAgICAgICAgICAgICAgICAgICAgICBQbGFjZWhvbGRlciA9ICJFbnRlciB0ZXh0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWdOYW1lID0gVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ3JlYXRlQW5kRGVsZXRlQnV0dG9uID0gQ29uZmlnc1NlY3Rpb246QnV0dG9uKCkKCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlQW5kRGVsZXRlQnV0dG9uOkFkZCgiQ3JlYXRlIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWdOYW1lIGFuZCBDb25maWdOYW1lIH49ICIiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUoTGlicmFyeS5Gb2xkZXJzLkNvbmZpZ3MgLi4gIi8iIC4uIENvbmZpZ05hbWUgLi4gIi5qc29uIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlZmlsZShMaWJyYXJ5LkZvbGRlcnMuQ29uZmlncyAuLiAiLyIgLi4gQ29uZmlnTmFtZSAuLiAiLmpzb24iLCBMaWJyYXJ5OkdldENvbmZpZygpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnk6Tm90aWZpY2F0aW9uKCJTdWNjZXNzIiwgIkNyZWF0ZWQgY29uZmlnICIuLkNvbmZpZ05hbWUgLi4gIiBzdWNjZXNmdWxseSIsIDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpSZWZyZXNoQ29uZmlnc0xpc3QoQ29uZmlnc1NlYXJjaGJveCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmaWNhdGlvbigiRXJyb3IiLCAiQ29uZmlnIHdpdGggdGhlIG5hbWUgIi4uQ29uZmlnTmFtZSAuLiAiIGFscmVhZHkgZXhpc3RzIiwgNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIENyZWF0ZUFuZERlbGV0ZUJ1dHRvbjpBZGQoIkRlbGV0ZSIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29uZmlnU2VsZWN0ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpEZWxldGVDb25maWcoQ29uZmlnU2VsZWN0ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmaWNhdGlvbigiU3VjY2VzcyIsICJEZWxldGVkIGNvbmZpZyAiLi5Db25maWdTZWxlY3RlZCAuLiAiIHN1Y2Nlc2Z1bGx5IiwgNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnk6UmVmcmVzaENvbmZpZ3NMaXN0KENvbmZpZ3NTZWFyY2hib3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTG9hZEFuZFNhdmVCdXR0b24gPSBDb25maWdzU2VjdGlvbjpCdXR0b24oKSAgICAKCiAgICAgICAgICAgICAgICAgICAgTG9hZEFuZFNhdmVCdXR0b246QWRkKCJMb2FkIiwgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25maWdTZWxlY3RlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTdWNjZXNzLCBSZXN1bHQgPSBMaWJyYXJ5OkxvYWRDb25maWcocmVhZGZpbGUoTGlicmFyeS5Gb2xkZXJzLkNvbmZpZ3MgLi4gIi8iIC4uIENvbmZpZ1NlbGVjdGVkKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTdWNjZXNzIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpOb3RpZmljYXRpb24oIlN1Y2Nlc3MiLCAiTG9hZGVkIGNvbmZpZyAiLi5Db25maWdTZWxlY3RlZCAuLiAiIHN1Y2Nlc2Z1bGx5IiwgNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmaWNhdGlvbigiRXJyb3IiLCAiRmFpbGVkIHRvIGxvYWQgY29uZmlnICIuLkNvbmZpZ1NlbGVjdGVkIC4uICIgcmVwb3J0IHRoaXMgdG8gdGhlIGRldnM6XG4iLi5SZXN1bHQsIDUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgICAgICAgICBMb2FkQW5kU2F2ZUJ1dHRvbjpBZGQoIlNhdmUiLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbmZpZ05hbWUgYW5kIENvbmZpZ05hbWUgfj0gIiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVmaWxlKExpYnJhcnkuRm9sZGVycy5Db25maWdzIC4uICIvIiAuLiBDb25maWdOYW1lIC4uICIuanNvbiIsIExpYnJhcnk6R2V0Q29uZmlnKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmaWNhdGlvbigiU3VjY2VzcyIsICJTYXZlZCBjb25maWcgIi4uQ29uZmlnTmFtZSAuLiAiIHN1Y2Nlc2Z1bGx5IiwgNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnk6UmVmcmVzaENvbmZpZ3NMaXN0KENvbmZpZ3NTZWFyY2hib3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpSZWZyZXNoQ29uZmlnc0xpc3QoQ29uZmlnc1NlYXJjaGJveCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCgkJCWxvY2FsIFNldHRpbmdzU3ViUGFnZSA9IFNldHRpbmdzUGFnZTpTdWJQYWdlKHtOYW1lID0gIlNldHRpbmdzIiwgQ29sdW1ucyA9IDJ9KSBkbyAKCQkJICAgIGxvY2FsIFNldHRpbmdzU2VjdGlvbiA9IFNldHRpbmdzU3ViUGFnZTpTZWN0aW9uKHtOYW1lID0gIlNldHRpbmdzIiwgU2lkZSA9IDF9KSBkbwoJCQkgICAgICAgIFNldHRpbmdzU2VjdGlvbjpUb2dnbGUoewoJCQkgICAgICAgICAgICBOYW1lID0gIldhdGVybWFyayIsCgkJCSAgICAgICAgICAgIEZsYWcgPSAiV2F0ZXJtYXJrIiwKCQkJICAgICAgICAgICAgRGVmYXVsdCA9IHRydWUsCgkJCSAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCSAgICAgICAgICAgICAgICBXYXRlcm1hcms6U2V0VmlzaWJpbGl0eShWYWx1ZSkKCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgfSkKCQkJCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOlRvZ2dsZSh7CgkJCSAgICAgICAgICAgIE5hbWUgPSAiS2V5YmluZCBsaXN0IiwKCQkJICAgICAgICAgICAgRmxhZyA9ICJLZXliaW5kIGxpc3QiLAoJCQkgICAgICAgICAgICBEZWZhdWx0ID0gdHJ1ZSwKCQkJICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKCQkJICAgICAgICAgICAgICAgIEtleWJpbmRMaXN0OlNldFZpc2liaWxpdHkoVmFsdWUpCgkJCSAgICAgICAgICAgIGVuZAoJCQkgICAgICAgIH0pCgkJCQoJCQkgICAgICAgIFNldHRpbmdzU2VjdGlvbjpTbGlkZXIoewoJCQkgICAgICAgICAgICBOYW1lID0gIkZhZGUgdGltZSIsCgkJCSAgICAgICAgICAgIEZsYWcgPSAiRmFkZVRpbWUiLAoJCQkgICAgICAgICAgICBEZWZhdWx0ID0gTGlicmFyeS5GYWRlU3BlZWQsCgkJCSAgICAgICAgICAgIE1pbiA9IDAsCgkJCSAgICAgICAgICAgIE1heCA9IDEsCgkJCSAgICAgICAgICAgIERlY2ltYWxzID0gMC4wMSwKCQkJICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKCQkJICAgICAgICAgICAgICAgIExpYnJhcnkuRmFkZVNwZWVkID0gVmFsdWUKCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgfSkKCQkJCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOlNsaWRlcih7CgkJCSAgICAgICAgICAgIE5hbWUgPSAiVHdlZW4gdGltZSIsCgkJCSAgICAgICAgICAgIEZsYWcgPSAiVHdlZW5UaW1lIiwKCQkJICAgICAgICAgICAgRGVmYXVsdCA9IExpYnJhcnkuVHdlZW4uVGltZSwKCQkJICAgICAgICAgICAgTWluID0gMCwKCQkJICAgICAgICAgICAgTWF4ID0gMSwKCQkJICAgICAgICAgICAgRGVjaW1hbHMgPSAwLjAxLAoJCQkgICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQoJCQkgICAgICAgICAgICAgICAgTGlicmFyeS5Ud2Vlbi5UaW1lID0gVmFsdWUKCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgfSkKCQkJCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOkRyb3Bkb3duKHsKCQkJICAgICAgICAgICAgTmFtZSA9ICJUd2VlbiBzdHlsZSIsCgkJCSAgICAgICAgICAgIEZsYWcgPSAiVHdlZW4gc3R5bGUiLAoJCQkgICAgICAgICAgICBJdGVtcyA9IHsgIkxpbmVhciIsICJRdWFkIiwgIlF1YXJ0IiwgIkJhY2siLCAiQm91bmNlIiwgIkNpcmN1bGFyIiwgIkN1YmljIiwgIkVsYXN0aWMiLCAiRXhwb25lbnRpYWwiLCAiU2luZSIsICJRdWludCIgfSwKCQkJICAgICAgICAgICAgRGVmYXVsdCA9ICJDdWJpYyIsCgkJCSAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCSAgICAgICAgICAgICAgICBMaWJyYXJ5LlR3ZWVuLlN0eWxlID0gRW51bS5FYXNpbmdTdHlsZVtWYWx1ZV0KCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgfSkKCQkJCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOkRyb3Bkb3duKHsKCQkJICAgICAgICAgICAgTmFtZSA9ICJUd2VlbiBkaXJlY3Rpb24iLAoJCQkgICAgICAgICAgICBGbGFnID0gIlR3ZWVuIGRpcmVjdGlvbiIsCgkJCSAgICAgICAgICAgIEl0ZW1zID0geyAiSW4iLCAiT3V0IiwgIkluT3V0IiB9LAoJCQkgICAgICAgICAgICBEZWZhdWx0ID0gIk91dCIsCgkJCSAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCgkJCSAgICAgICAgICAgICAgICBMaWJyYXJ5LlR3ZWVuLkRpcmVjdGlvbiA9IEVudW0uRWFzaW5nRGlyZWN0aW9uW1ZhbHVlXQoJCQkgICAgICAgICAgICBlbmQKCQkJICAgICAgICB9KQoJCQkKCQkJICAgICAgICBTZXR0aW5nc1NlY3Rpb246QnV0dG9uKCk6QWRkKCJVbmxvYWQiLCBmdW5jdGlvbigpCgkJCSAgICAgICAgICAgIExpYnJhcnk6VW5sb2FkKCkKCQkJICAgICAgICBlbmQpCgkJCQoJCQkgICAgICAgIC0tIEFkZGVkIFJlam9pbiBCdXR0b24KCQkJICAgICAgICBTZXR0aW5nc1NlY3Rpb246QnV0dG9uKCk6QWRkKCJSZWpvaW4iLCBmdW5jdGlvbigpCgkJCSAgICAgICAgICAgIGxvY2FsIFRlbGVwb3J0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVGVsZXBvcnRTZXJ2aWNlIikKCQkJICAgICAgICAgICAgbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCgkJCSAgICAgICAgICAgIGxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoJCQkgICAgICAgICAgICBpZiBMb2NhbFBsYXllciB0aGVuCgkJCSAgICAgICAgICAgICAgICBUZWxlcG9ydFNlcnZpY2U6VGVsZXBvcnRUb1BsYWNlSW5zdGFuY2UoZ2FtZS5QbGFjZUlkLCBnYW1lLkpvYklkLCBMb2NhbFBsYXllcikKCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgZW5kKQoJCQkKCQkJICAgICAgICAtLSBBZGRlZCBTZXJ2ZXJob3AgQnV0dG9uCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOkJ1dHRvbigpOkFkZCgiU2VydmVyaG9wIiwgZnVuY3Rpb24oKQoJCQkgICAgICAgICAgICBsb2NhbCBUZWxlcG9ydFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpCgkJCSAgICAgICAgICAgIGxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQoJCQkgICAgICAgICAgICBsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCQkJICAgICAgICAgICAgaWYgTG9jYWxQbGF5ZXIgdGhlbgoJCQkgICAgICAgICAgICAgICAgVGVsZXBvcnRTZXJ2aWNlOlRlbGVwb3J0KGdhbWUuUGxhY2VJZCwgTG9jYWxQbGF5ZXIpCgkJCSAgICAgICAgICAgIGVuZAoJCQkgICAgICAgIGVuZCkKCQkJCgkJCSAgICAgICAgU2V0dGluZ3NTZWN0aW9uOkxhYmVsKCJVSSBLZXliaW5kIik6S2V5YmluZCh7CgkJCSAgICAgICAgICAgIE5hbWUgPSAiTWVudSBrZXliaW5kIiwKCQkJICAgICAgICAgICAgRmxhZyA9ICJVSUtleWJpbmQiLAoJCQkgICAgICAgICAgICBEZWZhdWx0ID0gTGlicmFyeS5NZW51S2V5YmluZCwKCQkJICAgICAgICAgICAgTW9kZSA9ICJUb2dnbGUiLAoJCQkgICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJICAgICAgICAgICAgICAgIExpYnJhcnkuTWVudUtleWJpbmQgPSBMaWJyYXJ5LkZsYWdzWyJVSUtleWJpbmQiXS5LZXkKCQkJICAgICAgICAgICAgZW5kCgkJCSAgICAgICAgfSkKCQkJICAgIGVuZAoJCQllbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICByZXR1cm4gU2V0dGluZ3NQYWdlCiAgICBlbmQKZW5kCgpsb2NhbCBXaW5kb3cgPSBMaWJyYXJ5OldpbmRvdyh7CiAgICBMb2dvID0gIjc3MjE4NjgwMjg1MjYyIiwKICAgIEZhZGVUaW1lID0gMC40LAp9KQoKbG9jYWwgV2F0ZXJtYXJrID0gTGlicmFyeTpXYXRlcm1hcmsoInZlci4gMC4zMWItMjgxMjIwMjUgIikKbG9jYWwgS2V5YmluZExpc3QgPSBMaWJyYXJ5OktleWJpbmRMaXN0KCkKCi0tIERlZmluZSB0aGUgVUkgcGFnZXMKbG9jYWwgSGFkYWxQYWdlID0gV2luZG93OlBhZ2UoeyBOYW1lID0gIlRoZSBIYWRhbCBCbGFja3NpdGUiLCBTdWJQYWdlcyA9IHRydWUgfSkKbG9jYWwgUmF2ZVBhZ2UgPSBXaW5kb3c6UGFnZSh7IE5hbWUgPSAiVGhlIFJhdmV5YXJkIiwgQ29sdW1ucyA9IDEgfSkKbG9jYWwgSHVudGVkUGFnZSA9IFdpbmRvdzpQYWdlKHsgTmFtZSA9ICJUaGUgSHVudGVkIiwgQ29sdW1ucyA9IDEgfSkKbG9jYWwgVmlzdWFsUGFnZSA9IFdpbmRvdzpQYWdlKHsgTmFtZSA9ICJWaXN1YWwiLCBDb2x1bW5zID0gMSB9KQpsb2NhbCBNb3ZlbWVudFBhZ2UgPSBXaW5kb3c6UGFnZSh7IE5hbWUgPSAiTW92ZW1lbnQiLCBDb2x1bW5zID0gMSB9KQpsb2NhbCBTZXR0aW5nc1BhZ2UgPSBMaWJyYXJ5OkNyZWF0ZVNldHRpbmdzUGFnZShXaW5kb3csIFdhdGVybWFyaywgS2V5YmluZExpc3QpCgoKLS0gU2VydmljZXMKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCmxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCmxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgd29ya3NwYWNlID0gZ2FtZS5Xb3Jrc3BhY2UKbG9jYWwgZ2FtZXBsYXlGb2xkZXIgPSB3b3Jrc3BhY2U6V2FpdEZvckNoaWxkKCJHYW1lcGxheUZvbGRlciIpCmxvY2FsIHJvb21zID0gZ2FtZXBsYXlGb2xkZXI6V2FpdEZvckNoaWxkKCJSb29tcyIpCmxvY2FsIG1vbnN0ZXJzRm9sZGVyID0gZ2FtZXBsYXlGb2xkZXI6V2FpdEZvckNoaWxkKCJNb25zdGVycyIpCgotLSBTaGFyZWQgYW50aS1mZWF0dXJlIG1vbml0b3JpbmcKbG9jYWwgYW50aUNvbm5lY3Rpb25zID0ge30KbG9jYWwgYW50aUVuYWJsZWQgPSB7CiAgICBQYW5kZW1vbml1bSA9IGZhbHNlLCBFeWVmZXN0YXRpb24gPSBmYWxzZSwgRmlyZXdhbGwgPSBmYWxzZSwgQWJvbWluYXRpb24gPSBmYWxzZSwgVm9pZCA9IGZhbHNlLAogICAgTWluZSA9IGZhbHNlLCBSZW1vdGVFdmVudCA9IGZhbHNlLCBUdXJyZXRzID0gZmFsc2UsIFNlYXJjaGxpZ2h0cyA9IGZhbHNlLCBDYW5kbGVzID0gZmFsc2UsCiAgICBEd2VsbGVyID0gZmFsc2UsIEJhbGRpID0gZmFsc2UsIEJvdW5jZXIgPSBmYWxzZSwgU2tlbGV0b25IZWFkID0gZmFsc2UsIENvcnBzZSA9IGZhbHNlLCBEaXZpbmUgPSBmYWxzZSwKfQoKbG9jYWwgZW50aXRpZXMgPSB7CiAgICBBbmdsZXIgPSB0cnVlLCBDaGFpbnNtb2tlciA9IHRydWUsIFBpbmtpZSA9IHRydWUsIEJsaXR6ID0gdHJ1ZSwgRnJvZ2VyID0gdHJ1ZSwgUGFuZGVtb25pdW0gPSB0cnVlLAogICAgUmlkZ2VBbmdsZXIgPSB0cnVlLCBSaWRnZUNoYWluc21va2VyID0gdHJ1ZSwgUmlkZ2VQaW5raWUgPSB0cnVlLCBSaWRnZUJsaXR6ID0gdHJ1ZSwgUmlkZ2VGcm9nZXIgPSB0cnVlLAogICAgUmlkZ2VQYW5kZW1vbml1bSA9IHRydWUsIFsiQTYwIl0gPSB0cnVlLCBEaVZpbmVSb290ID0gdHJ1ZQp9Cgpsb2NhbCBhY3RpdmVMb29wcyA9IHt9CmxvY2FsIG9yaWdpbmFsUG9zaXRpb24gPSBuaWwKbG9jYWwgc2FmZVBhcnQgPSBuaWwKbG9jYWwgYW5nbGVyID0gbmlsCmxvY2FsIGNoZWNraW5nRW5lbWllcyA9IGZhbHNlCmxvY2FsIGVuZW15Q2hlY2tDb25uID0gbmlsCmxvY2FsIGVuZW15UmVtb3ZlQ29ubiA9IG5pbAoKLS0gUmV1c2FibGUgZnVuY3Rpb25zCmxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lJbnN0YW5jZShpbnN0YW5jZSwgbmFtZSkKICAgIGlmIGluc3RhbmNlIHRoZW4KICAgICAgICBwY2FsbChmdW5jdGlvbigpIGluc3RhbmNlOkRlc3Ryb3koKSBlbmQpCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBzY2FuQW5kRGVzdHJveShwYXJlbnQsIHRhcmdldE5hbWVzLCBlbmFibGVkS2V5KQogICAgaWYgbm90IGFudGlFbmFibGVkW2VuYWJsZWRLZXldIHRoZW4gcmV0dXJuIGVuZAogICAgZm9yIF8sIGNoaWxkIGluIHBhaXJzKHBhcmVudDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHR5cGVvZih0YXJnZXROYW1lcykgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgIGZvciBfLCBuYW1lIGluIHBhaXJzKHRhcmdldE5hbWVzKSBkbwogICAgICAgICAgICAgICAgaWYgY2hpbGQuTmFtZSA9PSBuYW1lIHRoZW4gZGVzdHJveUluc3RhbmNlKGNoaWxkLCBuYW1lKSBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIGNoaWxkLk5hbWUgPT0gdGFyZ2V0TmFtZXMgdGhlbgogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UoY2hpbGQsIHRhcmdldE5hbWVzKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gc2V0dXBEZXNjZW5kYW50TW9uaXRvcihwYXJlbnQsIHRhcmdldE5hbWVzLCBlbmFibGVkS2V5KQogICAgbG9jYWwgY29ubiA9IHBhcmVudC5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICBpZiBhbnRpRW5hYmxlZFtlbmFibGVkS2V5XSBhbmQgKHR5cGVvZih0YXJnZXROYW1lcykgPT0gInRhYmxlIiBhbmQgdGFibGUuZmluZCh0YXJnZXROYW1lcywgY2hpbGQuTmFtZSkgb3IgY2hpbGQuTmFtZSA9PSB0YXJnZXROYW1lcykgdGhlbgogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UoY2hpbGQsIGNoaWxkLk5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICB0YWJsZS5pbnNlcnQoYW50aUNvbm5lY3Rpb25zLCBjb25uKQogICAgcmV0dXJuIGNvbm4KZW5kCgpsb2NhbCBmdW5jdGlvbiBzdGFydExvb3AobmFtZSwgY2FsbGJhY2ssIGludGVydmFsKQogICAgaWYgYWN0aXZlTG9vcHNbbmFtZV0gdGhlbiByZXR1cm4gZW5kCiAgICBhY3RpdmVMb29wc1tuYW1lXSA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGFjdGl2ZUxvb3BzW25hbWVdIGRvCiAgICAgICAgICAgIGNhbGxiYWNrKCkKICAgICAgICAgICAgdGFzay53YWl0KGludGVydmFsIG9yIDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdG9wTG9vcChuYW1lKQogICAgaWYgYWN0aXZlTG9vcHNbbmFtZV0gdGhlbgogICAgICAgIHRhc2suY2FuY2VsKGFjdGl2ZUxvb3BzW25hbWVdKQogICAgICAgIGFjdGl2ZUxvb3BzW25hbWVdID0gbmlsCiAgICBlbmQKZW5kCgoKCi0tIEhhZGFsIEJsYWNrc2l0ZSBQYWdlCmRvCiAgICAtLSBBbnRpLUZlYXR1cmVzIFN1YnBhZ2UKICAgIGxvY2FsIEFudGlGZWF0dXJlc1N1YlBhZ2UgPSBIYWRhbFBhZ2U6U3ViUGFnZSh7IE5hbWUgPSAiQW50aS1GZWF0dXJlcyIsIENvbHVtbnMgPSAxIH0pCgogICAgZG8KICAgICAgICBsb2NhbCBBbnRpRmVhdHVyZXNTZWN0aW9uID0gQW50aUZlYXR1cmVzU3ViUGFnZTpTZWN0aW9uKHsgTmFtZSA9ICJBbnRpLUZlYXR1cmVzIiwgU2lkZSA9IDEgfSkKCiAgICAgICAgLS0gQW50aSBQYW5kZW1vbml1bQogICAgICAgIEFudGlGZWF0dXJlc1NlY3Rpb246VG9nZ2xlKHsKICAgICAgICAgICAgTmFtZSA9ICJBbnRpIFBhbmRlbW9uaXVtIiwKICAgICAgICAgICAgRmxhZyA9ICJBbnRpUGFuZGVtb25pdW0iLAogICAgICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIGFudGlFbmFibGVkLlBhbmRlbW9uaXVtID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIHNjYW5BbmREZXN0cm95KHdvcmtzcGFjZSwgeyJQYW5kZW1vbml1bSIsICJSaWRnZVBhbmRlbW9uaXVtIn0sICJQYW5kZW1vbml1bSIpCiAgICAgICAgICAgIHNldHVwRGVzY2VuZGFudE1vbml0b3Iod29ya3NwYWNlLCB7IlBhbmRlbW9uaXVtIiwgIlJpZGdlUGFuZGVtb25pdW0ifSwgIlBhbmRlbW9uaXVtIikKICAgICAgICAgICAgc3RhcnRMb29wKCJQYW5kZW1vbml1bUNoZWNrIiwgZnVuY3Rpb24oKSBzY2FuQW5kRGVzdHJveSh3b3Jrc3BhY2UsIHsiUGFuZGVtb25pdW0iLCAiUmlkZ2VQYW5kZW1vbml1bSJ9LCAiUGFuZGVtb25pdW0iKSBlbmQsIDAuNSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3BMb29wKCJQYW5kZW1vbml1bUNoZWNrIikKICAgICAgICBlbmQKICAgIGVuZAogICAgICAgIH0pCgogICAgICAgIC0tIEFudGkgRXllZmVzdGF0aW9uCiAgICAgICAgbG9jYWwgZXllZmVzdGF0aW9uQ29ubnMgPSB7fQogICAgICAgIEFudGlGZWF0dXJlc1NlY3Rpb246VG9nZ2xlKHsKICAgICAgICAgICAgTmFtZSA9ICJBbnRpIEV5ZWZlc3RhdGlvbiIsCiAgICAgICAgICAgIEZsYWcgPSAiQW50aUV5ZWZlc3RhdGlvbiIsCiAgICAgICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgYW50aUVuYWJsZWQuRXllZmVzdGF0aW9uID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIENsZWFyIHByZXZpb3VzIGNvbm5zIGlmIGFueQogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBwYWlycyhleWVmZXN0YXRpb25Db25ucykgZG8KICAgICAgICAgICAgICAgIGNvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBleWVmZXN0YXRpb25Db25ucyA9IHt9CiAgICAgICAgICAgIAogICAgICAgICAgICAtLSBTY2FuIGV4aXN0aW5nCiAgICAgICAgICAgIGxvY2FsIHJvb21zID0gd29ya3NwYWNlLkdhbWVwbGF5Rm9sZGVyLlJvb21zCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBpbnRlcmFjdGFibGVzID0gcm9vbTpGaW5kRmlyc3RDaGlsZCgiSW50ZXJhY3RhYmxlcyIpCiAgICAgICAgICAgICAgICBpZiBpbnRlcmFjdGFibGVzIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBleWVmZXN0YXRpb25TcGF3biA9IGludGVyYWN0YWJsZXM6RmluZEZpcnN0Q2hpbGQoIkV5ZWZlc3RhdGlvblNwYXduIikKICAgICAgICAgICAgICAgICAgICBpZiBleWVmZXN0YXRpb25TcGF3biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lJbnN0YW5jZShleWVmZXN0YXRpb25TcGF3biwgIkV5ZWZlc3RhdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXllZmVzdGF0aW9uUm9vdCA9IGludGVyYWN0YWJsZXM6RmluZEZpcnN0Q2hpbGQoIkV5ZWZlc3RhdGlvblJvb3QiKQogICAgICAgICAgICAgICAgICAgIGlmIGV5ZWZlc3RhdGlvblJvb3QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UoZXllZmVzdGF0aW9uUm9vdCwgIkV5ZWZlc3RhdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tIE1vbml0b3IgbmV3IG9uZXMgdmlhIGRlc2NlbmRhbnQgYWRkZWQKICAgICAgICAgICAgbG9jYWwgY29ubjEgPSByb29tcy5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgaWYgYW50aUVuYWJsZWQuRXllZmVzdGF0aW9uIGFuZCBjaGlsZC5QYXJlbnQgYW5kIGNoaWxkLlBhcmVudC5OYW1lID09ICJJbnRlcmFjdGFibGVzIiBhbmQgKGNoaWxkLk5hbWUgPT0gIkV5ZWZlc3RhdGlvblNwYXduIiBvciBjaGlsZC5OYW1lID09ICJFeWVmZXN0YXRpb25Sb290IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UoY2hpbGQsICJFeWVmZXN0YXRpb24iKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhYmxlLmluc2VydChleWVmZXN0YXRpb25Db25ucywgY29ubjEpCiAgICAgICAgICAgIHRhYmxlLmluc2VydChhbnRpQ29ubmVjdGlvbnMsIGNvbm4xKQogICAgICAgICAgICAKICAgICAgICAgICAgLS0gTW9uaXRvciBuZXcgcm9vbXMKICAgICAgICAgICAgbG9jYWwgY29ubjIgPSByb29tcy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24obmV3Um9vbSkKICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgICAgICAgICAgICAgaWYgYW50aUVuYWJsZWQuRXllZmVzdGF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaW50ZXJhY3RhYmxlcyA9IG5ld1Jvb206RmluZEZpcnN0Q2hpbGQoIkludGVyYWN0YWJsZXMiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpbnRlcmFjdGFibGVzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV5ZWZlc3RhdGlvblNwYXduID0gaW50ZXJhY3RhYmxlczpGaW5kRmlyc3RDaGlsZCgiRXllZmVzdGF0aW9uU3Bhd24iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXllZmVzdGF0aW9uU3Bhd24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lJbnN0YW5jZShleWVmZXN0YXRpb25TcGF3biwgIkV5ZWZlc3RhdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV5ZWZlc3RhdGlvblJvb3QgPSBpbnRlcmFjdGFibGVzOkZpbmRGaXJzdENoaWxkKCJFeWVmZXN0YXRpb25Sb290IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGV5ZWZlc3RhdGlvblJvb3QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lJbnN0YW5jZShleWVmZXN0YXRpb25Sb290LCAiRXllZmVzdGF0aW9uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQoZXllZmVzdGF0aW9uQ29ubnMsIGNvbm4yKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQoYW50aUNvbm5lY3Rpb25zLCBjb25uMikKICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIEJhY2t1cCBsb29wCiAgICAgICAgICAgIHN0YXJ0TG9vcCgiRXllZmVzdGF0aW9uQ2hlY2siLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCByb29tcyA9IHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tcwogICAgICAgICAgICAgICAgZm9yIF8sIHJvb20gaW4gcGFpcnMocm9vbXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBpbnRlcmFjdGFibGVzID0gcm9vbTpGaW5kRmlyc3RDaGlsZCgiSW50ZXJhY3RhYmxlcyIpCiAgICAgICAgICAgICAgICAgICAgaWYgaW50ZXJhY3RhYmxlcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV5ZWZlc3RhdGlvblNwYXduID0gaW50ZXJhY3RhYmxlczpGaW5kRmlyc3RDaGlsZCgiRXllZmVzdGF0aW9uU3Bhd24iKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBleWVmZXN0YXRpb25TcGF3biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UoZXllZmVzdGF0aW9uU3Bhd24sICJFeWVmZXN0YXRpb24iKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXllZmVzdGF0aW9uUm9vdCA9IGludGVyYWN0YWJsZXM6RmluZEZpcnN0Q2hpbGQoIkV5ZWZlc3RhdGlvblJvb3QiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBleWVmZXN0YXRpb25Sb290IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lJbnN0YW5jZShleWVmZXN0YXRpb25Sb290LCAiRXllZmVzdGF0aW9uIikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kLCAwLjUpCiAgICAgICAgZWxzZQogICAgICAgICAgICAtLSBDbGVhbnVwIGNvbm5zCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIHBhaXJzKGV5ZWZlc3RhdGlvbkNvbm5zKSBkbwogICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGV5ZWZlc3RhdGlvbkNvbm5zID0ge30KICAgICAgICAgICAgc3RvcExvb3AoIkV5ZWZlc3RhdGlvbkNoZWNrIikKICAgICAgICBlbmQKICAgIGVuZAogICAgICAgIH0pCgogICAgICAgIC0tIEFudGktRmlyZXdhbGwKbG9jYWwgaGFzVGVsZXBvcnRlZCA9IGZhbHNlCmxvY2FsIEFudGlGaXJld2FsbENvbm4gPSBuaWwKICAgICAgICBBbnRpRmVhdHVyZXNTZWN0aW9uOlRvZ2dsZSh7CiAgICAgICAgICAgIE5hbWUgPSAiU2tpcCBGaXJld2FsbCIsCiAgICAgICAgICAgIEZsYWcgPSAiQW50aUZpcmV3YWxsIiwKICAgICAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICBhbnRpRW5hYmxlZC5GaXJld2FsbCA9IFZhbHVlCiAgICAgICAgaGFzVGVsZXBvcnRlZCA9IGZhbHNlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBBbnRpRmlyZXdhbGxDb25uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgYW50aUVuYWJsZWQuRmlyZXdhbGwgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBmaXJld2FsbEVuZCA9IHJvb21zOkZpbmRGaXJzdENoaWxkKCJGaXJld2FsbEVuZCIpCiAgICAgICAgICAgICAgICBpZiBmaXJld2FsbEVuZCBhbmQgbm90IGhhc1RlbGVwb3J0ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRvb3IgPSBmaXJld2FsbEVuZC5FbnRyYW5jZXMuTGFyZ2VSb3VuZERvb3IuTW9kZWwKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBkb29yOkdldFBpdm90KCkKICAgICAgICAgICAgICAgICAgICAgICAgaGFzVGVsZXBvcnRlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBBbnRpRmlyZXdhbGxDb25uIHRoZW4gQW50aUZpcmV3YWxsQ29ubjpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgICAgICB9KQoKICAgICAgICAtLSBBbnRpIEFib21pbmF0aW9uCiAgICAgICAgQW50aUZlYXR1cmVzU2VjdGlvbjpUb2dnbGUoewogICAgICAgICAgICBOYW1lID0gIkFudGkgQWJvbWluYXRpb24iLAogICAgICAgICAgICBGbGFnID0gIkFudGlBYm9taW5hdGlvbiIsCiAgICAgICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICBhbnRpRW5hYmxlZC5BYm9taW5hdGlvbiA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBzY2FuQW5kRGVzdHJveSh3b3Jrc3BhY2UsICJBYm9taW5hdGlvbiIsICJBYm9taW5hdGlvbiIpCiAgICAgICAgICAgIHNldHVwRGVzY2VuZGFudE1vbml0b3Iod29ya3NwYWNlLCAiQWJvbWluYXRpb24iLCAiQWJvbWluYXRpb24iKQogICAgICAgICAgICBzdGFydExvb3AoIkFib21pbmF0aW9uQ2hlY2siLCBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBzY2FuQW5kRGVzdHJveSh3b3Jrc3BhY2UsICJBYm9taW5hdGlvbiIsICJBYm9taW5hdGlvbiIpCiAgICAgICAgICAgICAgICBsb2NhbCBkYW1hZ2VQYXJ0cyA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR2FtZXBsYXlGb2xkZXIiLCB0cnVlKTpGaW5kRmlyc3RDaGlsZCgiUm9vbXMiLCB0cnVlKTpGaW5kRmlyc3RDaGlsZCgiQ2hhc2VFbmQiLCB0cnVlKTpGaW5kRmlyc3RDaGlsZCgiRGFtYWdlUGFydHMiLCB0cnVlKQogICAgICAgICAgICAgICAgaWYgZGFtYWdlUGFydHMgdGhlbiBkYW1hZ2VQYXJ0czpEZXN0cm95KCkgZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBkb29yID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJHYW1lcGxheUZvbGRlciIsIHRydWUpOkZpbmRGaXJzdENoaWxkKCJSb29tcyIsIHRydWUpOkZpbmRGaXJzdENoaWxkKCJDaGFzZUVuZCIsIHRydWUpOkZpbmRGaXJzdENoaWxkKCJFbnRyYW5jZXMiLCB0cnVlKTpGaW5kRmlyc3RDaGlsZCgiTGFyZ2VSb3VuZERvb3IiLCB0cnVlKQogICAgICAgICAgICAgICAgaWYgZG9vciBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gZG9vci5DRnJhbWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQsIDAuNSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3BMb29wKCJBYm9taW5hdGlvbkNoZWNrIikKICAgICAgICBlbmQKICAgIGVuZAogICAgICAgIH0pCi0tIEFudGlWb2lkCmxvY2FsIGFudGlFbmFibGVkID0geyBWb2lkID0gZmFsc2UgfQpsb2NhbCBkZXNjZW5kYW50Q29ubmVjdGlvbnMgPSB7fQpsb2NhbCByb29tcyA9IHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tcwpsb2NhbCBzY2FuSW50ZXJ2YWwgPSAwLjMgIC0tIEFkanVzdCBzY2FuIGZyZXF1ZW5jeSAoc2Vjb25kcykKCmxvY2FsIGZ1bmN0aW9uIERlc3Ryb3lWb2lkTG9ja2VycygpCiAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGZvciBfLCBkZXNjZW5kYW50IGluIHBhaXJzKHJvb206R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgaWYgZGVzY2VuZGFudC5OYW1lID09ICJNb25zdGVyTG9ja2VyIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9tcHQgPSBkZXNjZW5kYW50OkZpbmRGaXJzdENoaWxkKCJQcm94aW1pdHlQcm9tcHQiKQogICAgICAgICAgICAgICAgaWYgcHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkRlc3Ryb3llZCBWb2lkIExvY2tlciBwcm9tcHQgaW46IiwgZGVzY2VuZGFudDpHZXRGdWxsTmFtZSgpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gU2V0dXBWb2lkTW9uaXRvcihyb29tKQogICAgLS0gTW9uaXRvciBmb3IgbmV3IE1vbnN0ZXJMb2NrZXJzIGluIHRoaXMgcm9vbQogICAgbG9jYWwgY29ubmVjdGlvbiA9IHJvb20uRGVzY2VuZGFudEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oZGVzY2VuZGFudCkKICAgICAgICBpZiBkZXNjZW5kYW50Lk5hbWUgPT0gIk1vbnN0ZXJMb2NrZXIiIHRoZW4KICAgICAgICAgICAgbG9jYWwgcHJvbXB0ID0gZGVzY2VuZGFudDpGaW5kRmlyc3RDaGlsZCgiUHJveGltaXR5UHJvbXB0IikKICAgICAgICAgICAgaWYgcHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgIHByb21wdDpEZXN0cm95KCkKICAgICAgICAgICAgICAgIHByaW50KCJEZXN0cm95ZWQgbmV3IFZvaWQgTG9ja2VyIHByb21wdCBpbjoiLCBkZXNjZW5kYW50OkdldEZ1bGxOYW1lKCkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQogICAgdGFibGUuaW5zZXJ0KGRlc2NlbmRhbnRDb25uZWN0aW9ucywgY29ubmVjdGlvbikKICAgIHJldHVybiBjb25uZWN0aW9uCmVuZAoKQW50aUZlYXR1cmVzU2VjdGlvbjpUb2dnbGUoewogICAgTmFtZSA9ICJBbnRpIFZvaWQgTG9ja2VyIiwKICAgIEZsYWcgPSAiQW50aVZvaWQiLAogICAgRGVmYXVsdCA9IGZhbHNlLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBhbnRpRW5hYmxlZC5Wb2lkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIEluaXRpYWwgc2NhbiBhbmQgZGVzdHJveQogICAgICAgICAgICBEZXN0cm95Vm9pZExvY2tlcnMoKQoKICAgICAgICAgICAgLS0gU2V0dXAgbW9uaXRvcnMgZm9yIGV4aXN0aW5nIHJvb21zCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBTZXR1cFZvaWRNb25pdG9yKHJvb20pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS0gTW9uaXRvciBmb3IgbmV3IHJvb21zCiAgICAgICAgICAgIGxvY2FsIHJvb21Db25uID0gcm9vbXMuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHJvb20pCiAgICAgICAgICAgICAgICAtLSBJbW1lZGlhdGVseSBzY2FuIG5ldyByb29tCiAgICAgICAgICAgICAgICBmb3IgXywgZGVzY2VuZGFudCBpbiBwYWlycyhyb29tOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzY2VuZGFudC5OYW1lID09ICJNb25zdGVyTG9ja2VyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHByb21wdCA9IGRlc2NlbmRhbnQ6RmluZEZpcnN0Q2hpbGQoIlByb3hpbWl0eVByb21wdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByb21wdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiRGVzdHJveWVkIFZvaWQgTG9ja2VyIHByb21wdCBpbiBuZXcgcm9vbToiLCBkZXNjZW5kYW50OkdldEZ1bGxOYW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBTZXR1cFZvaWRNb25pdG9yKHJvb20pCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGRlc2NlbmRhbnRDb25uZWN0aW9ucywgcm9vbUNvbm4pCgogICAgICAgICAgICAtLSBTdGFydCBjb25zdGFudCBzY2FubmluZyBsb29wCiAgICAgICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIGFudGlFbmFibGVkLlZvaWQgZG8KICAgICAgICAgICAgICAgICAgICBEZXN0cm95Vm9pZExvY2tlcnMoKQogICAgICAgICAgICAgICAgICAgIHdhaXQoc2NhbkludGVydmFsKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIENsZWFudXAKICAgICAgICAgICAgc3RvcExvb3AoIlZvaWRDaGVjayIpCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhkZXNjZW5kYW50Q29ubmVjdGlvbnMpIGRvCiAgICAgICAgICAgICAgICBjb25uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZGVzY2VuZGFudENvbm5lY3Rpb25zID0ge30KICAgICAgICBlbmQKICAgIGVuZAp9KQoKCiAgICAgICAgLS0gQW50aSBNaW5lcyBhbmQgVHJpcHdpcmVzCiAgICAgICAgLS0gQW50aS1NaW5lCmxvY2FsIEFudGlNaW5lVmFsdWUgPSBmYWxzZQpsb2NhbCBmdW5jdGlvbiBVcGRhdGVBbGxPYmplY3RzKHZhbHVlKQogICAgZm9yIF8sIHJvb20gaW4gcGFpcnMocm9vbXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKHJvb206R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgaWYgb2JqLk5hbWUgPT0gIkxhbmRtaW5lU3Bhd24iIHRoZW4KICAgICAgICAgICAgICAgIG9iai5DYW5Ub3VjaCA9IG5vdCB2YWx1ZQogICAgICAgICAgICBlbHNlaWYgb2JqLk5hbWUgPT0gIlRyaXB3aXJlIiBhbmQgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgb2JqOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIEFudGlNaW5lVmFsdWUgPSBmYWxzZQpsb2NhbCBkZXNjZW5kYW50Q29ubmVjdGlvbnMgPSB7fQpsb2NhbCByb29tcyA9IHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tcwpsb2NhbCBzY2FuSW50ZXJ2YWwgPSAwLjMgIC0tIEFkanVzdCBzY2FuIGZyZXF1ZW5jeSAoc2Vjb25kcykKCmxvY2FsIGZ1bmN0aW9uIFVwZGF0ZUFsbE9iamVjdHModmFsdWUpCiAgICBBbnRpTWluZVZhbHVlID0gdmFsdWUKICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyb29tOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgIGlmIG9iai5OYW1lID09ICJMYW5kbWluZVNwYXduIiB0aGVuCiAgICAgICAgICAgICAgICBvYmouQ2FuVG91Y2ggPSBub3QgdmFsdWUKICAgICAgICAgICAgZWxzZWlmIG9iai5OYW1lID09ICJUcmlwd2lyZSIgYW5kIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIG9iajpEZXN0cm95KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBTZXR1cE9iamVjdE1vbml0b3Jpbmcocm9vbSkKICAgIC0tIFByb2Nlc3MgZXhpc3Rpbmcgb2JqZWN0cwogICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyb29tOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgb2JqLk5hbWUgPT0gIkxhbmRtaW5lU3Bhd24iIHRoZW4KICAgICAgICAgICAgb2JqLkNhblRvdWNoID0gbm90IEFudGlNaW5lVmFsdWUKICAgICAgICBlbHNlaWYgb2JqLk5hbWUgPT0gIlRyaXB3aXJlIiBhbmQgQW50aU1pbmVWYWx1ZSB0aGVuCiAgICAgICAgICAgIG9iajpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIE1vbml0b3IgZm9yIG5ldyBvYmplY3RzCiAgICBsb2NhbCBjb25uZWN0aW9uID0gcm9vbS5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihkZXNjZW5kYW50KQogICAgICAgIGlmIGRlc2NlbmRhbnQuTmFtZSA9PSAiTGFuZG1pbmVTcGF3biIgdGhlbgogICAgICAgICAgICBkZXNjZW5kYW50LkNhblRvdWNoID0gbm90IEFudGlNaW5lVmFsdWUKICAgICAgICBlbHNlaWYgZGVzY2VuZGFudC5OYW1lID09ICJUcmlwd2lyZSIgYW5kIEFudGlNaW5lVmFsdWUgdGhlbgogICAgICAgICAgICBkZXNjZW5kYW50OkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgZW5kKQogICAgdGFibGUuaW5zZXJ0KGRlc2NlbmRhbnRDb25uZWN0aW9ucywgY29ubmVjdGlvbikKZW5kCgpBbnRpRmVhdHVyZXNTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgTWluZXMgYW5kIFRyaXB3aXJlcyIsCiAgICBGbGFnID0gIkFudGlNaW5lIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgQW50aU1pbmVWYWx1ZSA9IFZhbHVlCiAgICAgICAgVXBkYXRlQWxsT2JqZWN0cyhWYWx1ZSkKCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICAtLSBTZXR1cCBtb25pdG9yaW5nIGZvciBleGlzdGluZyByb29tcwogICAgICAgICAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgU2V0dXBPYmplY3RNb25pdG9yaW5nKHJvb20pCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS0gTW9uaXRvciBmb3IgbmV3IHJvb21zCiAgICAgICAgICAgIGxvY2FsIHJvb21Db25uID0gcm9vbXMuQ2hpbGRBZGRlZDpDb25uZWN0KFNldHVwT2JqZWN0TW9uaXRvcmluZykKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGRlc2NlbmRhbnRDb25uZWN0aW9ucywgcm9vbUNvbm4pCgogICAgICAgICAgICAtLSBTdGFydCBjb25zdGFudCBzY2FubmluZyBsb29wCiAgICAgICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIEFudGlNaW5lVmFsdWUgZG8KICAgICAgICAgICAgICAgICAgICBVcGRhdGVBbGxPYmplY3RzKHRydWUpCiAgICAgICAgICAgICAgICAgICAgd2FpdChzY2FuSW50ZXJ2YWwpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gQ2xlYW51cAogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnMoZGVzY2VuZGFudENvbm5lY3Rpb25zKSBkbwogICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGRlc2NlbmRhbnRDb25uZWN0aW9ucyA9IHt9CiAgICAgICAgZW5kCiAgICBlbmQKfSkKCgotLSBBbnRpLVJlbW90ZUV2ZW50IChUcmlja3N0ZXIpIC0gT3B0aW1pemVkCmxvY2FsIEFudGlSZW1vdGVFdmVudFZhbHVlID0gZmFsc2UKbG9jYWwgZGVzY2VuZGFudENvbm5lY3Rpb25zID0ge30KbG9jYWwgcm9vbXMgPSB3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXMKbG9jYWwgc2NhbkludGVydmFsID0gMC4zICAtLSBBZGp1c3Qgc2NhbiBmcmVxdWVuY3kgKHNlY29uZHMpCgpsb2NhbCBmdW5jdGlvbiBJc1RhcmdldFJlbW90ZUV2ZW50KG9iaikKICAgIGlmIG5vdCBvYmo6SXNBKCJSZW1vdGVFdmVudCIpIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgbG9jYWwgcGFyZW50ID0gb2JqLlBhcmVudAogICAgaWYgcGFyZW50IGFuZCBwYXJlbnQuTmFtZSA9PSAiVHJpY2tzdGVyIiB0aGVuCiAgICAgICAgbG9jYWwgZ3JhbmRwYXJlbnQgPSBwYXJlbnQuUGFyZW50CiAgICAgICAgaWYgZ3JhbmRwYXJlbnQgYW5kIGdyYW5kcGFyZW50Lk5hbWUgPT0gIkludGVyYWN0YWJsZXMiIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gRGVzdHJveVJlbW90ZUV2ZW50KG9iaikKICAgIGlmIEFudGlSZW1vdGVFdmVudFZhbHVlIGFuZCBJc1RhcmdldFJlbW90ZUV2ZW50KG9iaikgdGhlbgogICAgICAgIG9iajpEZXN0cm95KCkKICAgICAgICBwcmludCgiRGVzdHJveWVkIFJlbW90ZUV2ZW50IGluOiIsIG9iajpHZXRGdWxsTmFtZSgpKQogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gRnVsbFJvb21TY2FuKCkKICAgIC0tIFNjYW4gYWxsIGV4aXN0aW5nIHJvb21zCiAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGxvY2FsIHRyaWNrc3RlclJvb20gPSByb29tOkZpbmRGaXJzdENoaWxkKCJUcmlja3N0ZXJSb29tIikKICAgICAgICBpZiB0cmlja3N0ZXJSb29tIHRoZW4KICAgICAgICAgICAgbG9jYWwgaW50ZXJhY3RhYmxlcyA9IHRyaWNrc3RlclJvb206RmluZEZpcnN0Q2hpbGQoIkludGVyYWN0YWJsZXMiKQogICAgICAgICAgICBpZiBpbnRlcmFjdGFibGVzIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRyaWNrc3RlciA9IGludGVyYWN0YWJsZXM6RmluZEZpcnN0Q2hpbGQoIlRyaWNrc3RlciIpCiAgICAgICAgICAgICAgICBpZiB0cmlja3N0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJlbW90ZUV2ZW50ID0gdHJpY2tzdGVyOkZpbmRGaXJzdENoaWxkKCJSZW1vdGVFdmVudCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVtb3RlRXZlbnQgYW5kIElzVGFyZ2V0UmVtb3RlRXZlbnQocmVtb3RlRXZlbnQpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlRXZlbnQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJEZXN0cm95ZWQgUmVtb3RlRXZlbnQgaW46IiwgcmVtb3RlRXZlbnQ6R2V0RnVsbE5hbWUoKSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIFNldHVwUm9vbU1vbml0b3Iocm9vbSkKICAgIC0tIE1vbml0b3IgZm9yIG5ldyBSZW1vdGVFdmVudHMgaW4gdGhpcyByb29tCiAgICBsb2NhbCBjb25uZWN0aW9uID0gcm9vbS5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihvYmopCiAgICAgICAgRGVzdHJveVJlbW90ZUV2ZW50KG9iaikKICAgIGVuZCkKICAgIHRhYmxlLmluc2VydChkZXNjZW5kYW50Q29ubmVjdGlvbnMsIGNvbm5lY3Rpb24pCiAgICByZXR1cm4gY29ubmVjdGlvbgplbmQKCkFudGlGZWF0dXJlc1NlY3Rpb246VG9nZ2xlKHsKICAgIE5hbWUgPSAiQW50aSBHb29kIFBlb3BsZSIsCiAgICBGbGFnID0gIkFudGlSZW1vdGVFdmVudCIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIEFudGlSZW1vdGVFdmVudFZhbHVlID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIEluaXRpYWwgZnVsbCBzY2FuCiAgICAgICAgICAgIEZ1bGxSb29tU2NhbigpCgogICAgICAgICAgICAtLSBTZXR1cCBtb25pdG9ycyBmb3IgZXhpc3Rpbmcgcm9vbXMKICAgICAgICAgICAgZm9yIF8sIHJvb20gaW4gcGFpcnMocm9vbXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIFNldHVwUm9vbU1vbml0b3Iocm9vbSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLSBNb25pdG9yIGZvciBuZXcgcm9vbXMKICAgICAgICAgICAgbG9jYWwgcm9vbUNvbm4gPSByb29tcy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocm9vbSkKICAgICAgICAgICAgICAgIC0tIEltbWVkaWF0ZWx5IHNjYW4gbmV3IHJvb20KICAgICAgICAgICAgICAgIGxvY2FsIHRyaWNrc3RlclJvb20gPSByb29tOkZpbmRGaXJzdENoaWxkKCJUcmlja3N0ZXJSb29tIikKICAgICAgICAgICAgICAgIGlmIHRyaWNrc3RlclJvb20gdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGludGVyYWN0YWJsZXMgPSB0cmlja3N0ZXJSb29tOkZpbmRGaXJzdENoaWxkKCJJbnRlcmFjdGFibGVzIikKICAgICAgICAgICAgICAgICAgICBpZiBpbnRlcmFjdGFibGVzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJpY2tzdGVyID0gaW50ZXJhY3RhYmxlczpGaW5kRmlyc3RDaGlsZCgiVHJpY2tzdGVyIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHJpY2tzdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJlbW90ZUV2ZW50ID0gdHJpY2tzdGVyOkZpbmRGaXJzdENoaWxkKCJSZW1vdGVFdmVudCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZW1vdGVFdmVudCBhbmQgSXNUYXJnZXRSZW1vdGVFdmVudChyZW1vdGVFdmVudCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW90ZUV2ZW50OkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJEZXN0cm95ZWQgUmVtb3RlRXZlbnQgaW4gbmV3IHJvb206IiwgcmVtb3RlRXZlbnQ6R2V0RnVsbE5hbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgU2V0dXBSb29tTW9uaXRvcihyb29tKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhYmxlLmluc2VydChkZXNjZW5kYW50Q29ubmVjdGlvbnMsIHJvb21Db25uKQoKICAgICAgICAgICAgLS0gU3RhcnQgY29uc3RhbnQgc2Nhbm5pbmcgbG9vcAogICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBBbnRpUmVtb3RlRXZlbnRWYWx1ZSBkbwogICAgICAgICAgICAgICAgICAgIEZ1bGxSb29tU2NhbigpCiAgICAgICAgICAgICAgICAgICAgd2FpdChzY2FuSW50ZXJ2YWwpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gQ2xlYW51cAogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnMoZGVzY2VuZGFudENvbm5lY3Rpb25zKSBkbwogICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGRlc2NlbmRhbnRDb25uZWN0aW9ucyA9IHt9CiAgICAgICAgZW5kCiAgICBlbmQKfSkKCgoKCi0tIFVuaXZlcnNhbCBIZWxwZXIgRnVuY3Rpb25zCmxvY2FsIGZ1bmN0aW9uIHNldHVwRGVzY2VuZGFudE1vbml0b3IocGFyZW50LCB0YXJnZXROYW1lcywgZGlzcGxheU5hbWUsIGNhbGxiYWNrKQogICAgbG9jYWwgY29ubmVjdGlvbnMgPSB7fQogICAgbG9jYWwgZnVuY3Rpb24gbW9uaXRvcihkZXNjZW5kYW50KQogICAgICAgIGlmIHR5cGUodGFyZ2V0TmFtZXMpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICBpZiB0YXJnZXROYW1lc1tkZXNjZW5kYW50Lk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRlc2NlbmRhbnQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBkZXNjZW5kYW50Lk5hbWUgPT0gdGFyZ2V0TmFtZXMgdGhlbgogICAgICAgICAgICBjYWxsYmFjayhkZXNjZW5kYW50KQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0gTW9uaXRvciBleGlzdGluZyBkZXNjZW5kYW50cwogICAgZm9yIF8sIGNoaWxkIGluIHBhaXJzKHBhcmVudDpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgIG1vbml0b3IoY2hpbGQpCiAgICBlbmQKCiAgICAtLSBNb25pdG9yIG5ldyBkZXNjZW5kYW50cwogICAgbG9jYWwgY29ubiA9IHBhcmVudC5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChtb25pdG9yKQogICAgdGFibGUuaW5zZXJ0KGNvbm5lY3Rpb25zLCBjb25uKQoKICAgIHJldHVybiBjb25uZWN0aW9ucwplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0Q29uc3RhbnRTY2FuKHBhcmVudCwgdGFyZ2V0TmFtZXMsIGRpc3BsYXlOYW1lLCBjYWxsYmFjaywgaW50ZXJ2YWwpCiAgICAtLSBJbml0aWFsIHNjYW4KICAgIGZvciBfLCBjaGlsZCBpbiBwYWlycyhwYXJlbnQ6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB0eXBlKHRhcmdldE5hbWVzKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgaWYgdGFyZ2V0TmFtZXNbY2hpbGQuTmFtZV0gdGhlbiBjYWxsYmFjayhjaGlsZCkgZW5kCiAgICAgICAgZWxzZWlmIGNoaWxkLk5hbWUgPT0gdGFyZ2V0TmFtZXMgdGhlbiBjYWxsYmFjayhjaGlsZCkgZW5kCiAgICBlbmQKCiAgICAtLSBTdGFydCBsb29wCiAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBmb3IgXywgY2hpbGQgaW4gcGFpcnMocGFyZW50OkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB0eXBlKHRhcmdldE5hbWVzKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXROYW1lc1tjaGlsZC5OYW1lXSB0aGVuIGNhbGxiYWNrKGNoaWxkKSBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBjaGlsZC5OYW1lID09IHRhcmdldE5hbWVzIHRoZW4gY2FsbGJhY2soY2hpbGQpIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgd2FpdChpbnRlcnZhbCkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBBbnRpIFR1cnJldHMKbG9jYWwgYW50aUVuYWJsZWQgPSB7IFR1cnJldHMgPSBmYWxzZSB9CmxvY2FsIHR1cnJldENvbm5zID0ge30KbG9jYWwgcm9vbXMgPSB3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXMKCmxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lUdXJyZXQob2JqKQogICAgaWYgb2JqLk5hbWUgPT0gIlR1cnJldCIgdGhlbgogICAgICAgIHByaW50KCJEZXN0cm95ZWQgVHVycmV0IGluOiIsIG9iajpHZXRGdWxsTmFtZSgpKQogICAgICAgIG9iajpEZXN0cm95KCkKICAgIGVuZAplbmQKCkFudGlGZWF0dXJlc1NlY3Rpb246VG9nZ2xlKHsKICAgIE5hbWUgPSAiQW50aSBUdXJyZXRzIiwKICAgIEZsYWcgPSAiQW50aXR1cnJldHMiLAogICAgRGVmYXVsdCA9IGZhbHNlLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBhbnRpRW5hYmxlZC5UdXJyZXRzID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIFNjYW4gYW5kIGRlc3Ryb3kgZXhpc3RpbmcgdHVycmV0cwogICAgICAgICAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgaW50ZXJhY3RhYmxlcyA9IHJvb206RmluZEZpcnN0Q2hpbGQoIkludGVyYWN0YWJsZXMiKQogICAgICAgICAgICAgICAgaWYgaW50ZXJhY3RhYmxlcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhpbnRlcmFjdGFibGVzOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lUdXJyZXQob2JqKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIC0tIE1vbml0b3IgZm9yIG5ldyB0dXJyZXRzCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29ubnMgPSBzZXR1cERlc2NlbmRhbnRNb25pdG9yKGludGVyYWN0YWJsZXMsICJUdXJyZXQiLCAiVHVycmV0cyIsIGRlc3Ryb3lUdXJyZXQpCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGNvbm5zKSBkbyB0YWJsZS5pbnNlcnQodHVycmV0Q29ubnMsIGNvbm4pIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS0gTW9uaXRvciBmb3IgbmV3IHJvb21zCiAgICAgICAgICAgIGxvY2FsIHJvb21Db25uID0gcm9vbXMuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHJvb20pCiAgICAgICAgICAgICAgICBsb2NhbCBpbnRlcmFjdGFibGVzID0gcm9vbTpGaW5kRmlyc3RDaGlsZCgiSW50ZXJhY3RhYmxlcyIpCiAgICAgICAgICAgICAgICBpZiBpbnRlcmFjdGFibGVzIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKGludGVyYWN0YWJsZXM6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveVR1cnJldChvYmopCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29ubnMgPSBzZXR1cERlc2NlbmRhbnRNb25pdG9yKGludGVyYWN0YWJsZXMsICJUdXJyZXQiLCAiVHVycmV0cyIsIGRlc3Ryb3lUdXJyZXQpCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGNvbm5zKSBkbyB0YWJsZS5pbnNlcnQodHVycmV0Q29ubnMsIGNvbm4pIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHR1cnJldENvbm5zLCByb29tQ29ubikKCiAgICAgICAgICAgIC0tIFN0YXJ0IGNvbnN0YW50IHNjYW5uaW5nCiAgICAgICAgICAgIHN0YXJ0Q29uc3RhbnRTY2FuKHJvb21zLCAiVHVycmV0IiwgIlR1cnJldHMiLCBkZXN0cm95VHVycmV0LCAyKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gQ2xlYW51cAogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnModHVycmV0Q29ubnMpIGRvCiAgICAgICAgICAgICAgICBpZiBjb25uLkRpc2Nvbm5lY3QgdGhlbiBjb25uOkRpc2Nvbm5lY3QoKSBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHR1cnJldENvbm5zID0ge30KICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gQW50aSBTZWFyY2hsaWdodHMKbG9jYWwgQW50aVNlYXJjaGxpZ2h0c0VuYWJsZWQgPSBmYWxzZQpsb2NhbCBzZWFyY2hsaWdodENvbm5zID0ge30KbG9jYWwgc2VhcmNobGlnaHROYW1lcyA9IHsKICAgIE1haW5TZWFyY2hsaWdodCA9IHRydWUsIFNlYXJjaGxpZ2h0czEgPSB0cnVlLCBTZWFyY2hsaWdodHMyID0gdHJ1ZSwgU2VhcmNobGlnaHRzMyA9IHRydWUsCiAgICBTZWFyY2hsaWdodHNFbmRpbmcxID0gdHJ1ZSwgU2VhcmNobGlnaHRzRW5kaW5nMiA9IHRydWUsIFNlYXJjaGxpZ2h0c0VuZGluZzMgPSB0cnVlCn0KCmxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lTZWFyY2hsaWdodChvYmopCiAgICBpZiBzZWFyY2hsaWdodE5hbWVzW29iai5OYW1lXSB0aGVuCiAgICAgICAgcHJpbnQoIkRlc3Ryb3llZCBTZWFyY2hsaWdodDoiLCBvYmouTmFtZSwgImluOiIsIG9iajpHZXRGdWxsTmFtZSgpKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkgb2JqOkRlc3Ryb3koKSBlbmQpCiAgICBlbmQKZW5kCgpBbnRpRmVhdHVyZXNTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgU2VhcmNobGlnaHRzIiwKICAgIEZsYWcgPSAiQW50aVNlYXJjaGxpZ2h0cyIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIEFudGlTZWFyY2hsaWdodHNFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIEluaXRpYWwgc2NhbiBhbmQgZGVzdHJveQogICAgICAgICAgICBsb2NhbCBjb25ucyA9IHNldHVwRGVzY2VuZGFudE1vbml0b3Iocm9vbXMsIHNlYXJjaGxpZ2h0TmFtZXMsICJTZWFyY2hsaWdodHMiLCBkZXN0cm95U2VhcmNobGlnaHQpCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25ucykgZG8gdGFibGUuaW5zZXJ0KHNlYXJjaGxpZ2h0Q29ubnMsIGNvbm4pIGVuZAoKICAgICAgICAgICAgLS0gU3RhcnQgY29uc3RhbnQgc2Nhbm5pbmcKICAgICAgICAgICAgc3RhcnRDb25zdGFudFNjYW4ocm9vbXMsIHNlYXJjaGxpZ2h0TmFtZXMsICJTZWFyY2hsaWdodHMiLCBkZXN0cm95U2VhcmNobGlnaHQsIDAuNSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIENsZWFudXAKICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKHNlYXJjaGxpZ2h0Q29ubnMpIGRvCiAgICAgICAgICAgICAgICBpZiBjb25uLkRpc2Nvbm5lY3QgdGhlbiBjb25uOkRpc2Nvbm5lY3QoKSBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHNlYXJjaGxpZ2h0Q29ubnMgPSB7fQogICAgICAgIGVuZAogICAgZW5kCn0pCgotLSBBbnRpIENhbmRsZXMKbG9jYWwgYW50aUNhbmRsZXNFbmFibGVkID0gZmFsc2UKbG9jYWwgY2FuZGxlQ29ubnMgPSB7fQpsb2NhbCBtb25zdGVyc0ZvbGRlciA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiTW9uc3RlcnMiKSBvciB3b3Jrc3BhY2UKCmxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lDYW5kbGUob2JqLCBuYW1lKQogICAgaWYgb2JqIGFuZCBvYmouTmFtZSA9PSBuYW1lIHRoZW4KICAgICAgICBwcmludCgiRGVzdHJveWVkIiwgbmFtZSwgImluOiIsIG9iajpHZXRGdWxsTmFtZSgpKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkgb2JqOkRlc3Ryb3koKSBlbmQpCiAgICBlbmQKZW5kCgpBbnRpRmVhdHVyZXNTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgQ2FuZGxlcyIsCiAgICBGbGFnID0gIkFudGlDYW5kbGVzIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aUNhbmRsZXNFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIEluaXRpYWwgZGVzdHJ1Y3Rpb24KICAgICAgICAgICAgZGVzdHJveUNhbmRsZShtb25zdGVyc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiU3RhdHVlUm9vdCIpLCAiU3RhdHVlUm9vdCIpCiAgICAgICAgICAgIGRlc3Ryb3lDYW5kbGUod29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJCaWdnZXJTdGF0dWUiKSwgIkJpZ2dlclN0YXR1ZSIpCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBkZXN0cm95Q2FuZGxlKHJvb206RmluZEZpcnN0Q2hpbGQoIlN0YXR1ZVJvb3QiKSwgIlN0YXR1ZVJvb3QiKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tIFNldHVwIG1vbml0b3JzCiAgICAgICAgICAgIGxvY2FsIGNvbm5zMSA9IHNldHVwRGVzY2VuZGFudE1vbml0b3IobW9uc3RlcnNGb2xkZXIsICJTdGF0dWVSb290IiwgIkNhbmRsZXMiLCBmdW5jdGlvbihvYmopIGRlc3Ryb3lDYW5kbGUob2JqLCAiU3RhdHVlUm9vdCIpIGVuZCkKICAgICAgICAgICAgbG9jYWwgY29ubnMyID0gc2V0dXBEZXNjZW5kYW50TW9uaXRvcihyb29tcywgIlN0YXR1ZVJvb3QiLCAiQ2FuZGxlcyIsIGZ1bmN0aW9uKG9iaikgZGVzdHJveUNhbmRsZShvYmosICJTdGF0dWVSb290IikgZW5kKQogICAgICAgICAgICBsb2NhbCBjb25uczMgPSBzZXR1cERlc2NlbmRhbnRNb25pdG9yKHdvcmtzcGFjZSwgIkJpZ2dlclN0YXR1ZSIsICJDYW5kbGVzIiwgZnVuY3Rpb24ob2JqKSBkZXN0cm95Q2FuZGxlKG9iaiwgIkJpZ2dlclN0YXR1ZSIpIGVuZCkKCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25uczEpIGRvIHRhYmxlLmluc2VydChjYW5kbGVDb25ucywgY29ubikgZW5kCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25uczIpIGRvIHRhYmxlLmluc2VydChjYW5kbGVDb25ucywgY29ubikgZW5kCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25uczMpIGRvIHRhYmxlLmluc2VydChjYW5kbGVDb25ucywgY29ubikgZW5kCgogICAgICAgICAgICAtLSBTdGFydCBjb25zdGFudCBzY2FubmluZwogICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBhbnRpQ2FuZGxlc0VuYWJsZWQgZG8KICAgICAgICAgICAgICAgICAgICBkZXN0cm95Q2FuZGxlKG1vbnN0ZXJzRm9sZGVyOkZpbmRGaXJzdENoaWxkKCJTdGF0dWVSb290IiksICJTdGF0dWVSb290IikKICAgICAgICAgICAgICAgICAgICBkZXN0cm95Q2FuZGxlKHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiQmlnZ2VyU3RhdHVlIiksICJCaWdnZXJTdGF0dWUiKQogICAgICAgICAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lDYW5kbGUocm9vbTpGaW5kRmlyc3RDaGlsZCgiU3RhdHVlUm9vdCIpLCAiU3RhdHVlUm9vdCIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gQ2xlYW51cAogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnMoY2FuZGxlQ29ubnMpIGRvCiAgICAgICAgICAgICAgICBpZiBjb25uLkRpc2Nvbm5lY3QgdGhlbiBjb25uOkRpc2Nvbm5lY3QoKSBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGNhbmRsZUNvbm5zID0ge30KICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gQW50aSBEd2VsbGVyCmxvY2FsIGFudGlEd2VsbGVyRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGR3ZWxsZXJDb25ucyA9IHt9Cgpsb2NhbCBmdW5jdGlvbiBkZXN0cm95RHdlbGxlcihvYmosIG5hbWUpCiAgICBpZiBvYmogYW5kIChvYmouTmFtZSA9PSAiRGlWaW5lIiBvciBvYmouTmFtZSA9PSAiRGlWaW5lUm9vdCIpIHRoZW4KICAgICAgICBwcmludCgiRGVzdHJveWVkIiwgbmFtZSwgImluOiIsIG9iajpHZXRGdWxsTmFtZSgpKQogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkgb2JqOkRlc3Ryb3koKSBlbmQpCiAgICBlbmQKZW5kCgpBbnRpRmVhdHVyZXNTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkFudGkgRHdlbGxlciIsCiAgICBGbGFnID0gIkFudGlEd2VsbGVyIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aUR3ZWxsZXJFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIC0tIEluaXRpYWwgc2NhbiBhbmQgZGVzdHJveQogICAgICAgICAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgZGVzdHJveUR3ZWxsZXIocm9vbTpGaW5kRmlyc3RDaGlsZCgiRGlWaW5lIiksICJEaVZpbmUiKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZGVzdHJveUR3ZWxsZXIobW9uc3RlcnNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIkRpVmluZVJvb3QiKSwgIkRpVmluZVJvb3QiKQoKICAgICAgICAgICAgLS0gU2V0dXAgbW9uaXRvcnMKICAgICAgICAgICAgbG9jYWwgY29ubnMxID0gc2V0dXBEZXNjZW5kYW50TW9uaXRvcihyb29tcywgIkRpVmluZSIsICJEd2VsbGVyIiwgZnVuY3Rpb24ob2JqKSBkZXN0cm95RHdlbGxlcihvYmosICJEaVZpbmUiKSBlbmQpCiAgICAgICAgICAgIGxvY2FsIGNvbm5zMiA9IHNldHVwRGVzY2VuZGFudE1vbml0b3IobW9uc3RlcnNGb2xkZXIsICJEaVZpbmVSb290IiwgIkR3ZWxsZXIiLCBmdW5jdGlvbihvYmopIGRlc3Ryb3lEd2VsbGVyKG9iaiwgIkRpVmluZVJvb3QiKSBlbmQpCgogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnMoY29ubnMxKSBkbyB0YWJsZS5pbnNlcnQoZHdlbGxlckNvbm5zLCBjb25uKSBlbmQKICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGNvbm5zMikgZG8gdGFibGUuaW5zZXJ0KGR3ZWxsZXJDb25ucywgY29ubikgZW5kCgogICAgICAgICAgICAtLSBTdGFydCBjb25zdGFudCBzY2FubmluZwogICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBhbnRpRHdlbGxlckVuYWJsZWQgZG8KICAgICAgICAgICAgICAgICAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95RHdlbGxlcihyb29tOkZpbmRGaXJzdENoaWxkKCJEaVZpbmUiKSwgIkRpVmluZSIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveUR3ZWxsZXIobW9uc3RlcnNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIkRpVmluZVJvb3QiKSwgIkRpVmluZVJvb3QiKQogICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIENsZWFudXAKICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGR3ZWxsZXJDb25ucykgZG8KICAgICAgICAgICAgICAgIGlmIGNvbm4uRGlzY29ubmVjdCB0aGVuIGNvbm46RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZHdlbGxlckNvbm5zID0ge30KICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gQW50aSBEaXZpbmUKbG9jYWwgYW50aURpdmluZUVuYWJsZWQgPSBmYWxzZQpsb2NhbCBkaXZpbmVDb25ucyA9IHt9Cgpsb2NhbCBmdW5jdGlvbiBkZXN0cm95RGl2aW5lKG9iaiwgbmFtZSkKICAgIGlmIG9iaiBhbmQgKG9iai5OYW1lID09ICJEaVZpbmUiIG9yIG9iai5OYW1lID09ICJEaVZpbmVSb290IikgdGhlbgogICAgICAgIHByaW50KCJEZXN0cm95ZWQiLCBuYW1lLCAiaW46Iiwgb2JqOkdldEZ1bGxOYW1lKCkpCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSBvYmo6RGVzdHJveSgpIGVuZCkKICAgIGVuZAplbmQKCkFudGlGZWF0dXJlc1NlY3Rpb246VG9nZ2xlKHsKICAgIE5hbWUgPSAiQW50aSBEaXZpbmUiLAogICAgRmxhZyA9ICJBbnRpRGl2aW5lIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aURpdmluZUVuYWJsZWQgPSBWYWx1ZQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgLS0gSW5pdGlhbCBzY2FuIGFuZCBkZXN0cm95CiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBkZXN0cm95RGl2aW5lKHJvb206RmluZEZpcnN0Q2hpbGQoIkRpVmluZSIpLCAiRGlWaW5lIikKICAgICAgICAgICAgICAgIGRlc3Ryb3lEaXZpbmUocm9vbTpGaW5kRmlyc3RDaGlsZCgiRGlWaW5lUm9vdCIpLCAiRGlWaW5lUm9vdCIpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS0gU2V0dXAgbW9uaXRvcnMgZm9yIGV4aXN0aW5nIHJvb21zCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBjb25ucyA9IHNldHVwRGVzY2VuZGFudE1vbml0b3Iocm9vbSwgeyJEaVZpbmUiLCAiRGlWaW5lUm9vdCJ9LCAiRGl2aW5lIiwgZnVuY3Rpb24ob2JqKQogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lEaXZpbmUob2JqLCBvYmouTmFtZSkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25ucykgZG8gdGFibGUuaW5zZXJ0KGRpdmluZUNvbm5zLCBjb25uKSBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLSBNb25pdG9yIGZvciBuZXcgcm9vbXMKICAgICAgICAgICAgbG9jYWwgcm9vbUNvbm4gPSByb29tcy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocm9vbSkKICAgICAgICAgICAgICAgIGRlc3Ryb3lEaXZpbmUocm9vbTpGaW5kRmlyc3RDaGlsZCgiRGlWaW5lIiksICJEaVZpbmUiKQogICAgICAgICAgICAgICAgZGVzdHJveURpdmluZShyb29tOkZpbmRGaXJzdENoaWxkKCJEaVZpbmVSb290IiksICJEaVZpbmVSb290IikKICAgICAgICAgICAgICAgIGxvY2FsIGNvbm5zID0gc2V0dXBEZXNjZW5kYW50TW9uaXRvcihyb29tLCB7IkRpVmluZSIsICJEaVZpbmVSb290In0sICJEaXZpbmUiLCBmdW5jdGlvbihvYmopCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveURpdmluZShvYmosIG9iai5OYW1lKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGNvbm5zKSBkbyB0YWJsZS5pbnNlcnQoZGl2aW5lQ29ubnMsIGNvbm4pIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhYmxlLmluc2VydChkaXZpbmVDb25ucywgcm9vbUNvbm4pCgogICAgICAgICAgICAtLSBTdGFydCBjb25zdGFudCBzY2FubmluZwogICAgICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBhbnRpRGl2aW5lRW5hYmxlZCBkbwogICAgICAgICAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lEaXZpbmUocm9vbTpGaW5kRmlyc3RDaGlsZCgiRGlWaW5lIiksICJEaVZpbmUiKQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95RGl2aW5lKHJvb206RmluZEZpcnN0Q2hpbGQoIkRpVmluZVJvb3QiKSwgIkRpVmluZVJvb3QiKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHdhaXQoMC41KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIENsZWFudXAKICAgICAgICAgICAgZm9yIF8sIGNvbm4gaW4gaXBhaXJzKGRpdmluZUNvbm5zKSBkbwogICAgICAgICAgICAgICAgaWYgY29ubi5EaXNjb25uZWN0IHRoZW4gY29ubjpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBkaXZpbmVDb25ucyA9IHt9CiAgICAgICAgZW5kCiAgICBlbmQKfSkKCi0tIEFudGkgQmFsZGkKbG9jYWwgYW50aUJhbGRpRW5hYmxlZCA9IGZhbHNlCmxvY2FsIGJhbGRpQ29ubnMgPSB7fQoKbG9jYWwgZnVuY3Rpb24gZGVzdHJveUJhbGRpKG9iaikKICAgIGlmIG9iaiBhbmQgb2JqLk5hbWUgPT0gIkJhbGRpIiB0aGVuCiAgICAgICAgcHJpbnQoIkRlc3Ryb3llZCBCYWxkaSBpbjoiLCBvYmo6R2V0RnVsbE5hbWUoKSkKICAgICAgICBwY2FsbChmdW5jdGlvbigpIG9iajpEZXN0cm95KCkgZW5kKQogICAgZW5kCmVuZAoKQW50aUZlYXR1cmVzU2VjdGlvbjpUb2dnbGUoewogICAgTmFtZSA9ICJBbnRpIEJhbGRpIiwKICAgIEZsYWcgPSAiQW50aUJhbGRpIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aUJhbGRpRW5hYmxlZCA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICAtLSBJbml0aWFsIGRlc3RydWN0aW9uCiAgICAgICAgICAgIGRlc3Ryb3lCYWxkaSh3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkJhbGRpIikpCgogICAgICAgICAgICAtLSBTZXR1cCBtb25pdG9ycwogICAgICAgICAgICBsb2NhbCBjb25ucyA9IHNldHVwRGVzY2VuZGFudE1vbml0b3Iod29ya3NwYWNlLCAiQmFsZGkiLCAiQmFsZGkiLCBkZXN0cm95QmFsZGkpCiAgICAgICAgICAgIGZvciBfLCBjb25uIGluIGlwYWlycyhjb25ucykgZG8gdGFibGUuaW5zZXJ0KGJhbGRpQ29ubnMsIGNvbm4pIGVuZAoKICAgICAgICAgICAgLS0gU3RhcnQgY29uc3RhbnQgc2Nhbm5pbmcKICAgICAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgYW50aUJhbGRpRW5hYmxlZCBkbwogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lCYWxkaSh3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkJhbGRpIikpCiAgICAgICAgICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gQ2xlYW51cAogICAgICAgICAgICBmb3IgXywgY29ubiBpbiBpcGFpcnMoYmFsZGlDb25ucykgZG8KICAgICAgICAgICAgICAgIGlmIGNvbm4uRGlzY29ubmVjdCB0aGVuIGNvbm46RGlzY29ubmVjdCgpIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgYmFsZGlDb25ucyA9IHt9CiAgICAgICAgZW5kCiAgICBlbmQKfSkKICAgIGVuZAoKICAgIC0tIEF1dG9tYXRpb24gU3VicGFnZQogICAgbG9jYWwgQXV0b21hdGlvblN1YlBhZ2UgPSBIYWRhbFBhZ2U6U3ViUGFnZSh7IE5hbWUgPSAiQXV0b21hdGlvbiIsIENvbHVtbnMgPSAxIH0pCgogICAgZG8KICAgICAgICBsb2NhbCBBdXRvbWF0aW9uU2VjdGlvbiA9IEF1dG9tYXRpb25TdWJQYWdlOlNlY3Rpb24oeyBOYW1lID0gIkF1dG9tYXRpb24iLCBTaWRlID0gMSB9KQogICAgICAgIGxvY2FsIGZ1bmN0aW9uIGdldEdlbmVyYXRvclBvc2l0aW9uKG9iaikKICAgIC0tIFRyeSBQcmltYXJ5UGFydCBmaXJzdAogICAgaWYgb2JqLlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICByZXR1cm4gb2JqLlByaW1hcnlQYXJ0LlBvc2l0aW9uCiAgICBlbmQKCiAgICAtLSBUcnkgYSBuYW1lZCBwYXJ0IGxpa2UgIlJvb3QiIG9yICJCYXNlIgogICAgbG9jYWwgcm9vdFBhcnQgPSBvYmo6RmluZEZpcnN0Q2hpbGQoIlJvb3QiKSBvciBvYmo6RmluZEZpcnN0Q2hpbGQoIkJhc2UiKQogICAgaWYgcm9vdFBhcnQgYW5kIHJvb3RQYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgcmV0dXJuIHJvb3RQYXJ0LlBvc2l0aW9uCiAgICBlbmQKCiAgICAtLSBGYWxsYmFjazogQ2FsY3VsYXRlIGNlbnRyb2lkIG9mIGFsbCBCYXNlUGFydCBkZXNjZW5kYW50cwogICAgbG9jYWwgcGFydHMgPSB7fQogICAgZm9yIF8sIHBhcnQgaW4gcGFpcnMob2JqOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIHBhcnQpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiAjcGFydHMgPT0gMCB0aGVuCiAgICAgICAgd2FybigiTm8gQmFzZVBhcnRzIGZvdW5kIGZvciBHZW5lcmF0b3I6ICIgLi4gdG9zdHJpbmcob2JqOkdldEZ1bGxOYW1lKCkpKQogICAgICAgIHJldHVybiBuaWwKICAgIGVuZAoKICAgIGxvY2FsIHRvdGFsUG9zaXRpb24gPSBWZWN0b3IzLm5ldygwLCAwLCAwKQogICAgZm9yIF8sIHBhcnQgaW4gcGFpcnMocGFydHMpIGRvCiAgICAgICAgdG90YWxQb3NpdGlvbiA9IHRvdGFsUG9zaXRpb24gKyBwYXJ0LlBvc2l0aW9uCiAgICBlbmQKICAgIHJldHVybiB0b3RhbFBvc2l0aW9uIC8gI3BhcnRzCmVuZAoKbG9jYWwgZnVuY3Rpb24gZml4R2VuZXJhdG9yKG9iaikKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAtLSBHZXQgZ2VuZXJhdG9yJ3MgcG9zaXRpb24KICAgICAgICBsb2NhbCBnZW5lcmF0b3JQb3NpdGlvbiA9IGdldEdlbmVyYXRvclBvc2l0aW9uKG9iaikKICAgICAgICBpZiBub3QgZ2VuZXJhdG9yUG9zaXRpb24gdGhlbgogICAgICAgICAgICB3YXJuKCJDb3VsZCBub3QgZGV0ZXJtaW5lIHBvc2l0aW9uIGZvciBHZW5lcmF0b3I6ICIgLi4gdG9zdHJpbmcob2JqOkdldEZ1bGxOYW1lKCkpKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgLS0gR2V0IHBsYXllcidzIHBvc2l0aW9uCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGlmIG5vdCByb290UGFydCB0aGVuCiAgICAgICAgICAgIHByaW50KCJObyBIdW1hbm9pZFJvb3RQYXJ0IGZvdW5kLCBza2lwcGluZyBnZW5lcmF0b3I6ICIgLi4gdG9zdHJpbmcob2JqOkdldEZ1bGxOYW1lKCkpKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgLS0gQ2FsY3VsYXRlIGRpc3RhbmNlCiAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSBnZW5lcmF0b3JQb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiR2VuZXJhdG9yOiAlcywgUGxheWVyIFBvc2l0aW9uOiAlcywgR2VuZXJhdG9yIFBvc2l0aW9uOiAlcywgRGlzdGFuY2U6ICUuMmYgc3R1ZHMiLAogICAgICAgICAgICBvYmo6R2V0RnVsbE5hbWUoKSwgdG9zdHJpbmcocm9vdFBhcnQuUG9zaXRpb24pLCB0b3N0cmluZyhnZW5lcmF0b3JQb3NpdGlvbiksIGRpc3RhbmNlKSkKCiAgICAgICAgaWYgZGlzdGFuY2UgPiAxMCB0aGVuCiAgICAgICAgICAgIHByaW50KCJHZW5lcmF0b3IgdG9vIGZhciAoZGlzdGFuY2U6ICIgLi4gdG9zdHJpbmcoZGlzdGFuY2UpIC4uICIgc3R1ZHMpLCBza2lwcGluZzogIiAuLiB0b3N0cmluZyhvYmo6R2V0RnVsbE5hbWUoKSkpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICAtLSBJbnZva2UgUmVtb3RlRnVuY3Rpb24gaWYgcHJlc2VudAogICAgICAgIGlmIG9iajpGaW5kRmlyc3RDaGlsZCgiUmVtb3RlRnVuY3Rpb24iKSB0aGVuCiAgICAgICAgICAgIG9iai5SZW1vdGVGdW5jdGlvbjpJbnZva2VTZXJ2ZXIoKQogICAgICAgICAgICBwcmludCgiSW52b2tlZCBSZW1vdGVGdW5jdGlvbiBvbiBHZW5lcmF0b3I6ICIgLi4gdG9zdHJpbmcob2JqOkdldEZ1bGxOYW1lKCkpKQogICAgICAgIGVuZAoKICAgICAgICAtLSBGaXJlIFJlbW90ZUV2ZW50IDIwIHRpbWVzIGlmIHByZXNlbnQKICAgICAgICBpZiBvYmo6RmluZEZpcnN0Q2hpbGQoIlJlbW90ZUV2ZW50IikgdGhlbgogICAgICAgICAgICBmb3IgaSA9IDEsIDMwIGRvCiAgICAgICAgICAgICAgICBvYmouUmVtb3RlRXZlbnQ6RmlyZVNlcnZlcih0cnVlKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpIC0tIFNtYWxsIGRlbGF5IHRvIGF2b2lkIHNlcnZlciBvdmVybG9hZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcHJpbnQoIkZpcmVkIFJlbW90ZUV2ZW50IDIwIHRpbWVzIG9uIEdlbmVyYXRvcjogIiAuLiB0b3N0cmluZyhvYmo6R2V0RnVsbE5hbWUoKSkpCiAgICAgICAgZW5kCiAgICBlbmQsIGZ1bmN0aW9uKGVycikKICAgICAgICB3YXJuKCJGYWlsZWQgdG8gZml4IEdlbmVyYXRvcjogIiAuLiB0b3N0cmluZyhvYmo6R2V0RnVsbE5hbWUoKSkgLi4gIiwgRXJyb3I6ICIgLi4gdG9zdHJpbmcoZXJyKSkKICAgIGVuZCkKZW5kCiAgICAgICAgLS0gQXV0byBGaXggR2VuZXJhdG9ycwogICAgICAgIGxvY2FsIEF1dG9GaXhFbmFibGVkID0gZmFsc2UKICAgICAgICBBdXRvbWF0aW9uU2VjdGlvbjpUb2dnbGUoewogICAgICAgICAgICBOYW1lID0gIkF1dG8gRml4IEdlbmVyYXRvcnMiLAogICAgICAgICAgICBGbGFnID0gIkF1dG9GaXgiLAogICAgICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIEF1dG9GaXhFbmFibGVkID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIHByaW50KCJBdXRvRml4IGVuYWJsZWQsIHN0YXJ0aW5nIGdlbmVyYXRvciBjaGVjayBsb29wLi4uIikKICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3aGlsZSBBdXRvRml4RW5hYmxlZCBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIER5bmFtaWNhbGx5IGNoZWNrIGZvciByb29tcwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgcm9vbSBpbiBwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vbS5OYW1lID09ICJTZWFyY2hsaWdodHNUcmFtU3RhcnQiIG9yIHJvb20uTmFtZSA9PSAiU2VhcmNobGlnaHRzRW5jb3VudGVyIiBvciByb29tLk5hbWUgPT0gIlNlYXJjaGxpZ2h0c0VuZGluZyIgb3Igcm9vbS5OYW1lID09ICJTZWFyY2hsaWdodHNFbmRpbmdQIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaW50ZXJhY3RhYmxlcyA9IHJvb206RmluZEZpcnN0Q2hpbGQoIkludGVyYWN0YWJsZXMiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGludGVyYWN0YWJsZXMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKGludGVyYWN0YWJsZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9iai5OYW1lID09ICJQcmVzZXRHZW5lcmF0b3IiIG9yIG9iai5OYW1lID09ICJHZW5lcmF0b3IiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiRm91bmQgZ2VuZXJhdG9yOiAiIC4uIHRvc3RyaW5nKG9iajpHZXRGdWxsTmFtZSgpKSAuLiAiLCBjaGVja2luZyBkaXN0YW5jZS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4R2VuZXJhdG9yKG9iaikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkgLS0gV2FpdCBiZWZvcmUgcHJvY2Vzc2luZyBuZXh0IGdlbmVyYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIk5vIEludGVyYWN0YWJsZXMgZm91bmQgaW4gcm9vbTogIiAuLiB0b3N0cmluZyhyb29tOkdldEZ1bGxOYW1lKCkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIk5vIGNoYXJhY3RlciBvciBIdW1hbm9pZFJvb3RQYXJ0IGZvdW5kLCBza2lwcGluZyBnZW5lcmF0b3IgY2hlY2siKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KSAtLSBDaGVjayBldmVyeSAwLjIgc2Vjb25kcyBmb3IgbmV3L3Jlc2V0IGdlbmVyYXRvcnMKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcHJpbnQoIkF1dG9GaXggbG9vcCBzdG9wcGVkIikKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCiAgICAgICAgfSkKCgotLSBBdXRvLUhpZGUKbG9jYWwgZnVuY3Rpb24gc3Bhd25BbmRUZWxlcG9ydChlbmVteU5hbWUpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIAogICAgb3JpZ2luYWxQb3NpdGlvbiA9IGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAKICAgIGlmIG5vdCBzYWZlUGFydCB0aGVuCiAgICAgICAgc2FmZVBhcnQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgIHNhZmVQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxMDAwMCwgMSwgMTAwMDApCiAgICAgICAgc2FmZVBhcnQuUG9zaXRpb24gPSBvcmlnaW5hbFBvc2l0aW9uLlBvc2l0aW9uICsgVmVjdG9yMy5uZXcoMCwgNDAwLCAwKQogICAgICAgIHNhZmVQYXJ0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgIHNhZmVQYXJ0LkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgc2FmZVBhcnQuVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgc2FmZVBhcnQuUGFyZW50ID0gd29ya3NwYWNlCiAgICBlbmQKCiAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoc2FmZVBhcnQuUG9zaXRpb24gKyBWZWN0b3IzLm5ldygwLCBzYWZlUGFydC5TaXplLlkgLyAyICsgMywgMCkpCmVuZAoKbG9jYWwgZnVuY3Rpb24gY2xlYW51cCgpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBub3QgaHVtYW5vaWRSb290UGFydCB0aGVuIHJldHVybiBlbmQKICAgIAogICAgaWYgb3JpZ2luYWxQb3NpdGlvbiB0aGVuCiAgICAgICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICBlbmQKICAgIGlmIHNhZmVQYXJ0IHRoZW4KICAgICAgICBzYWZlUGFydDpEZXN0cm95KCkKICAgICAgICBzYWZlUGFydCA9IG5pbAogICAgZW5kCiAgICBvcmlnaW5hbFBvc2l0aW9uID0gbmlsCiAgICBhbmdsZXIgPSBuaWwKZW5kCiAgICAgICAgLS0gQXV0byBIaWRlCiAgICAgICAgQXV0b21hdGlvblNlY3Rpb246VG9nZ2xlKHsKICAgICAgICAgICAgTmFtZSA9ICJBdXRvIEhpZGUiLAogICAgICAgICAgICBGbGFnID0gIkF1dG9IaWRlIiwKICAgICAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgY2hlY2tpbmdFbmVtaWVzID0gVmFsdWUKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGVuZW15Q2hlY2tDb25uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgY2hlY2tpbmdFbmVtaWVzIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgZm9yIF8sIGNoaWxkIGluIHBhaXJzKHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGVudGl0aWVzW2NoaWxkLk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFuZ2xlciBvciBhbmdsZXIgfj0gY2hpbGQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGVyID0gY2hpbGQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYXduQW5kVGVsZXBvcnQoY2hpbGQuTmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFuZ2xlciBhbmQgc2FmZVBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBodW1hbm9pZFJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KHNhZmVQYXJ0LlBvc2l0aW9uICsgVmVjdG9yMy5uZXcoMCwgc2FmZVBhcnQuU2l6ZS5ZIC8gMiArIDMsIDApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5lbXlSZW1vdmVDb25uID0gd29ya3NwYWNlLkNoaWxkUmVtb3ZlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQgPT0gYW5nbGVyIGFuZCBjaGVja2luZ0VuZW1pZXMgdGhlbgogICAgICAgICAgICAgICAgICAgIGNsZWFudXAoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIGVuZW15Q2hlY2tDb25uIHRoZW4KICAgICAgICAgICAgICAgIGVuZW15Q2hlY2tDb25uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgZW5lbXlDaGVja0Nvbm4gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGVuZW15UmVtb3ZlQ29ubiB0aGVuCiAgICAgICAgICAgICAgICBlbmVteVJlbW92ZUNvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBlbmVteVJlbW92ZUNvbm4gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGNsZWFudXAoKQogICAgICAgIGVuZAogICAgZW5kCn0pCgpwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICBpZiBjaGVja2luZ0VuZW1pZXMgYW5kIGFuZ2xlciBhbmQgc2FmZVBhcnQgdGhlbgogICAgICAgIHNwYXduQW5kVGVsZXBvcnQoYW5nbGVyLk5hbWUpCiAgICBlbmQKZW5kKQoKICAgICAgICAtLSBBdXRvcGxheQpsb2NhbCBkZWxheSA9IDEKbG9jYWwgdHdlZW5TcGVlZCA9IDUwCmxvY2FsIHR3ZWVuZWREb29ycyA9IHt9CmxvY2FsIGNvbGxlY3RlZEl0ZW1zID0ge30KbG9jYWwgbG9vcFRocmVhZCA9IG5pbApsb2NhbCBpc0J1c3kgPSBmYWxzZQpsb2NhbCBoaWRpbmcgPSBmYWxzZQoKbG9jYWwgZnVuY3Rpb24gdHdlZW5Ub1RhcmdldChyb290UGFydCwgdGFyZ2V0Q0ZyYW1lKQogICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSB0YXJnZXRDRnJhbWUuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgbG9jYWwgdHdlZW5UaW1lID0gZGlzdGFuY2UgLyB0d2VlblNwZWVkCiAgICBsb2NhbCBpbmZvID0gVHdlZW5JbmZvLm5ldyh0d2VlblRpbWUsIEVudW0uRWFzaW5nU3R5bGUuUXVhZCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KQogICAgbG9jYWwgdHdlZW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKHJvb3RQYXJ0LCBpbmZvLCB7Q0ZyYW1lID0gdGFyZ2V0Q0ZyYW1lfSkKICAgIHR3ZWVuOlBsYXkoKQogICAgdHdlZW4uQ29tcGxldGVkOldhaXQoKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGNvbGxlY3RJdGVtKHByb21wdCkKICAgIHBjYWxsKGZ1bmN0aW9uKCkgZmlyZXByb3hpbWl0eXByb21wdChwcm9tcHQpIGVuZCkKICAgIGNvbGxlY3RlZEl0ZW1zW3Byb21wdF0gPSB0cnVlCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0S2V5Y2FyZENhbmRpZGF0ZXMocm9vdFBhcnQpCiAgICBsb2NhbCBjYW5kaWRhdGVzID0ge30KICAgIGZvciBfLCBjaGlsZCBpbiBwYWlycyh3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXM6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiBjaGlsZDpJc0EoIlByb3hpbWl0eVByb21wdCIpIGFuZCBub3QgY29sbGVjdGVkSXRlbXNbY2hpbGRdIHRoZW4KICAgICAgICAgICAgbG9jYWwgcHJveHlQYXJ0ID0gY2hpbGQuUGFyZW50CiAgICAgICAgICAgIGlmIHByb3h5UGFydCBhbmQgcHJveHlQYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwID0gcHJveHlQYXJ0LlBhcmVudAogICAgICAgICAgICAgICAgaWYgcC5OYW1lID09ICJOb3JtYWxLZXlDYXJkIiBvciBwLk5hbWUgPT0gIlBhc3N3b3JkUGFwZXIiIG9yIHAuTmFtZSA9PSAiSW5uZXJLZXlDYXJkIiBvciBwLk5hbWUgPT0gIlJpZGdlS2V5Q2FyZCIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKHJvb3RQYXJ0LlBvc2l0aW9uIC0gcHJveHlQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSA1MDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGNhbmRpZGF0ZXMsIHtwcm9tcHQgPSBjaGlsZCwgcHJveHlQYXJ0ID0gcHJveHlQYXJ0LCBkaXN0ID0gZGlzdGFuY2V9KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gY2FuZGlkYXRlcwplbmQKICAgICAgICBBdXRvbWF0aW9uU2VjdGlvbjpUb2dnbGUoewogICAgICAgICAgICBOYW1lID0gIkF1dG8gUGxheSIsCiAgICAgICAgICAgIEZsYWcgPSAiQXV0b1BsYXkiLAogICAgICAgICAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgaWYgbG9vcFRocmVhZCB0aGVuIHRhc2suY2FuY2VsKGxvb3BUaHJlYWQpIGVuZAogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgbG9vcFRocmVhZCA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGlzQnVzeSBvciBoaWRpbmcgb3Igbm90IHBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGtleUNhbmRpZGF0ZXMgPSBnZXRLZXljYXJkQ2FuZGlkYXRlcyhyb290UGFydCkKICAgICAgICAgICAgICAgICAgICBpZiAja2V5Q2FuZGlkYXRlcyA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5zb3J0KGtleUNhbmRpZGF0ZXMsIGZ1bmN0aW9uKGEsIGIpIHJldHVybiBhLmRpc3QgPCBiLmRpc3QgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBrZXlDYW5kaWRhdGVzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnVzeSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zID0gdGFyZ2V0LnByb3h5UGFydC5Qb3NpdGlvbiArIFZlY3RvcjMubmV3KDAsIDMsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldENGcmFtZSA9IENGcmFtZS5sb29rQXQodGFyZ2V0UG9zLCB0YXJnZXQucHJveHlQYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICB0d2VlblRvVGFyZ2V0KHJvb3RQYXJ0LCB0YXJnZXRDRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldC5wcm9tcHQ6SXNEZXNjZW5kYW50T2Yod29ya3NwYWNlKSB0aGVuIGNvbGxlY3RJdGVtKHRhcmdldC5wcm9tcHQpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoZGVsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQnVzeSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb3VuZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW50cmFuY2VzID0gcm9vbTpGaW5kRmlyc3RDaGlsZCgiRW50cmFuY2VzIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVudHJhbmNlcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZG9vciA9IGVudHJhbmNlczpGaW5kRmlyc3RDaGlsZCgiTm9ybWFsRG9vciIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZG9vciBhbmQgZG9vcjpJc0EoIk1vZGVsIikgYW5kIGRvb3IuUHJpbWFyeVBhcnQgYW5kIG5vdCB0d2VlbmVkRG9vcnNbZG9vcl0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0J1c3kgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRvb3JDRnJhbWUgPSBkb29yLlByaW1hcnlQYXJ0LkNGcmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlblRvVGFyZ2V0KHJvb3RQYXJ0LCBkb29yQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0d2VlbmVkRG9vcnNbZG9vcl0gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdChkZWxheSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNCdXN5ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBmb3VuZCB0aGVuIHRhc2sud2FpdCgwLjUpIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVsc2UKICAgICAgICAgICAgaXNCdXN5ID0gZmFsc2UKICAgICAgICAgICAgdHdlZW5lZERvb3JzID0ge30KICAgICAgICAgICAgY29sbGVjdGVkSXRlbXMgPSB7fQogICAgICAgIGVuZAogICAgZW5kCiAgICAgICAgfSkKCiAgICAgICAgLS0gU2xpZGVycyBmb3IgQXV0byBQbGF5CiAgICAgICAgQXV0b21hdGlvblNlY3Rpb246U2xpZGVyKHsKICAgICAgICAgICAgTmFtZSA9ICJUd2VlbiBTcGVlZCAoc3R1ZHMvcykiLAogICAgICAgICAgICBGbGFnID0gIlR3ZWVuU3BlZWQiLAogICAgICAgICAgICBNaW4gPSAxMDAsCiAgICAgICAgICAgIE1heCA9IDUwMCwKICAgICAgICAgICAgRGVmYXVsdCA9IDUwLAogICAgICAgICAgICBEZWNpbWFscyA9IDEwMCwKICAgICAgICAgICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgIHR3ZWVuU3BlZWQgPSBWYWx1ZQogICAgICAgICAgICBlbmQKICAgICAgICB9KQoKICAgICAgICBBdXRvbWF0aW9uU2VjdGlvbjpTbGlkZXIoewogICAgICAgICAgICBOYW1lID0gIkRlbGF5IChzKSIsCiAgICAgICAgICAgIEZsYWcgPSAiRGVsYXkiLAogICAgICAgICAgICBNaW4gPSAwLAogICAgICAgICAgICBNYXggPSA1LAogICAgICAgICAgICBEZWZhdWx0ID0gLjUsCiAgICAgICAgICAgIERlY2ltYWxzID0gLjEsCiAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICAgICBkZWxheSA9IFZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIH0pCiAgICBlbmQKZW5kCgotLSBUaGUgUmF2ZXlhcmQgUGFnZQpkbwogICAgCiAgICBsb2NhbCBSYXZleWFyZFNlY3Rpb24gPSBSYXZlUGFnZTpTZWN0aW9uKHsgTmFtZSA9ICJBbnRpLUZlYXR1cmVzIiwgU2lkZSA9IDF9KQogICAgbG9jYWwgUmF2ZXlhcmRTZWN0aW9uMiA9IFJhdmVQYWdlOlNlY3Rpb24oeyBOYW1lID0gIkF1dG9tYXRpb24iLCBTaWRlID0gMX0pCiAgICAtLSBBbnRpIEJvdW5jZXIKICAgIFJhdmV5YXJkU2VjdGlvbjpUb2dnbGUoewogICAgICAgIE5hbWUgPSAiQW50aSBCb3VuY2VyIiwKICAgICAgICBGbGFnID0gIkFudGlTa2VsZXRvbiIsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aUVuYWJsZWQuQm91bmNlciA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UobW9uc3RlcnNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIkJvdW5jZXIiKSwgIkJvdW5jZXIiKQogICAgICAgICAgICBzZXR1cERlc2NlbmRhbnRNb25pdG9yKG1vbnN0ZXJzRm9sZGVyLCAiQm91bmNlciIsICJCb3VuY2VyIikKICAgICAgICAgICAgc3RhcnRMb29wKCJCb3VuY2VyQ2hlY2siLCBmdW5jdGlvbigpIHNjYW5BbmREZXN0cm95KG1vbnN0ZXJzRm9sZGVyLCAiQm91bmNlciIsICJCb3VuY2VyIikgZW5kLCAwLjUpCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdG9wTG9vcCgiQm91bmNlckNoZWNrIikKICAgICAgICBlbmQKICAgIGVuZAogICAgfSkKCiAgICAtLSBBbnRpIFNrZWxldG9uIEhlYWQKICAgIFJhdmV5YXJkU2VjdGlvbjpUb2dnbGUoewogICAgICAgIE5hbWUgPSAiQW50aSBTa2VsZXRvbiBIZWFkIiwKICAgICAgICBGbGFnID0gIkFudGlTa2VsZXRvbjIiLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGFudGlFbmFibGVkLlNrZWxldG9uSGVhZCA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UobW9uc3RlcnNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlNrZWxldG9uSGVhZCIpLCAiU2tlbGV0b25IZWFkIikKICAgICAgICAgICAgc2V0dXBEZXNjZW5kYW50TW9uaXRvcihtb25zdGVyc0ZvbGRlciwgIlNrZWxldG9uSGVhZCIsICJTa2VsZXRvbkhlYWQiKQogICAgICAgICAgICBzdGFydExvb3AoIlNrZWxldG9uSGVhZENoZWNrIiwgZnVuY3Rpb24oKSBzY2FuQW5kRGVzdHJveShtb25zdGVyc0ZvbGRlciwgIlNrZWxldG9uSGVhZCIsICJTa2VsZXRvbkhlYWQiKSBlbmQsIDAuNSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0b3BMb29wKCJTa2VsZXRvbkhlYWRDaGVjayIpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIH0pCgogICAgLS0gQW50aSBDYW5kbGVzCmxvY2FsIENhbmRsZSA9IGZhbHNlCmxvY2FsIENhbmRsZUNvbm4gPSBuaWwKICAgIFJhdmV5YXJkU2VjdGlvbjpUb2dnbGUoewogICAgICAgIE5hbWUgPSAiQW50aSBDYW5kbGVzIiwKICAgICAgICBGbGFnID0gIkFudGlDYW5kbGUiLAogICAgICAgIERlZmF1bHQgPSBmYWxzZSwKICAgICAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIENhbmRsZSA9IFZhbHVlCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBDYW5kbGVDb25uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgQ2FuZGxlIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgZGVzdHJveUluc3RhbmNlKG1vbnN0ZXJzRm9sZGVyOkZpbmRGaXJzdENoaWxkKCJTdGF0dWVSb290IiksICJTdGF0dWVSb290IikKICAgICAgICAgICAgICAgIGRlc3Ryb3lJbnN0YW5jZSh3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkJpZ2dlclN0YXR1ZSIpLCAiQmlnZ2VyU3RhdHVlIikKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2UobW9uc3RlcnNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlN0YXR1ZVJvb3QiKSwgIlN0YXR1ZVJvb3QiKQogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2Uod29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJCaWdnZXJTdGF0dWUiKSwgIkJpZ2dlclN0YXR1ZSIpCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBkZXN0cm95SW5zdGFuY2Uocm9vbTpGaW5kRmlyc3RDaGlsZCgiU3RhdHVlUm9vdCIpLCAiU3RhdHVlUm9vdCIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBzZXR1cERlc2NlbmRhbnRNb25pdG9yKG1vbnN0ZXJzRm9sZGVyLCAiU3RhdHVlUm9vdCIsICJDYW5kbGVzIikKICAgICAgICAgICAgc2V0dXBEZXNjZW5kYW50TW9uaXRvcihyb29tcywgIlN0YXR1ZVJvb3QiLCAiQ2FuZGxlcyIpCiAgICAgICAgICAgIHNldHVwRGVzY2VuZGFudE1vbml0b3Iod29ya3NwYWNlLCAiQmlnZ2VyU3RhdHVlIiwgIkNhbmRsZXMiKQogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgQ2FuZGxlQ29ubiB0aGVuIENhbmRsZUNvbm46RGlzY29ubmVjdCgpIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICB9KQoKCgotLSBTZXJ2aWNlcwpsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQoKLS0gUGxheWVyIGFuZCBjaGFyYWN0ZXIgc2V0dXAKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCi0tIFZhcmlhYmxlcyBmb3IgdHdlZW5pbmcKbG9jYWwgbG9vcFRocmVhZCA9IG5pbApsb2NhbCB0d2VlblNwZWVkID0gMzAwCmxvY2FsIGRlbGF5ID0gMApsb2NhbCBzcGVjaWFsVHdlZW5EZWxheSA9IC4yIC0tIERlbGF5IGZvciBSYXZleWFyZDIgdHdlZW5zCmxvY2FsIHR3ZWVuZWRPYmplY3RzID0ge30KbG9jYWwgaXNCdXN5ID0gZmFsc2UKbG9jYWwgcmF2ZXlhcmQyU2VxdWVuY2UgPSB7CiAgICAiRW50cmFuY2VzLkdyYXZleWFyZEdhdGUiLAogICAgIkxvd2VyQ3J5cHRFeGl0IiwKICAgICJDaHVyY2hEb29yIiwKICAgICJJbnRlcmFjdGFibGVzLkNyeXB0RG9vciIsCiAgICAiSW50ZXJhY3RhYmxlcy5DaHVyY2hEb29yIiwKICAgICJFbmRpbmdTdHVmZi5QbGF5ZXJUUCIKfQpsb2NhbCByYXZleWFyZDJJbmRleCA9IDEKbG9jYWwgYXV0b1BsYXlFbmFibGVkID0gZmFsc2UKbG9jYWwgcmF2ZXlhcmQyRm91bmQgPSBmYWxzZQoKLS0gRnVuY3Rpb24gdG8gdHdlZW4gdG8gYSB0YXJnZXQgQ0ZyYW1lCmxvY2FsIGZ1bmN0aW9uIHR3ZWVuVG9UYXJnZXQocGFydCwgdGFyZ2V0Q0ZyYW1lKQogICAgbG9jYWwgZGlzdGFuY2UgPSAocGFydC5Qb3NpdGlvbiAtIHRhcmdldENGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICBsb2NhbCB0d2VlblRpbWUgPSBkaXN0YW5jZSAvIHR3ZWVuU3BlZWQKICAgIGxvY2FsIHR3ZWVuSW5mbyA9IFR3ZWVuSW5mby5uZXcodHdlZW5UaW1lLCBFbnVtLkVhc2luZ1N0eWxlLkxpbmVhciwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KQogICAgbG9jYWwgdHdlZW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKHBhcnQsIHR3ZWVuSW5mbywgeyBDRnJhbWUgPSB0YXJnZXRDRnJhbWUgfSkKICAgIHR3ZWVuOlBsYXkoKQogICAgdHdlZW4uQ29tcGxldGVkOldhaXQoKQplbmQKCi0tIEZ1bmN0aW9uIHRvIGZpbmQgdGhlIG5leHQgdW52aXNpdGVkIG9iamVjdCBpbiBFbnRyYW5jZXMKbG9jYWwgZnVuY3Rpb24gZmluZE5leHRFbnRyYW5jZU9iamVjdCgpCiAgICBmb3IgXywgcm9vbSBpbiBwYWlycyh3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBsb2NhbCBlbnRyYW5jZXMgPSByb29tOkZpbmRGaXJzdENoaWxkKCJFbnRyYW5jZXMiKQogICAgICAgIGlmIGVudHJhbmNlcyB0aGVuCiAgICAgICAgICAgIGZvciBfLCBvYmplY3QgaW4gcGFpcnMoZW50cmFuY2VzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgdHdlZW5lZE9iamVjdHNbb2JqZWN0XSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gRW5zdXJlIFByaW1hcnlQYXJ0IGlzIHNldCBmb3IgbW9kZWxzCiAgICAgICAgICAgICAgICAgICAgaWYgb2JqZWN0OklzQSgiTW9kZWwiKSBhbmQgbm90IG9iamVjdC5QcmltYXJ5UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHByaW1hcnlQYXJ0ID0gb2JqZWN0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkJhc2VQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHJpbWFyeVBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LlByaW1hcnlQYXJ0ID0gcHJpbWFyeVBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybigiUHJpbWFyeVBhcnQgbm90IGZvdW5kIGZvciBvYmplY3QgaW4gRW50cmFuY2VzOiIsIG9iamVjdC5OYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbmlsCmVuZAoKLS0gRnVuY3Rpb24gdG8gZ2V0IGEgdGFyZ2V0IGZyb20gUmF2ZXlhcmQyIGJ5IHBhdGgKbG9jYWwgZnVuY3Rpb24gZ2V0UmF2ZXlhcmQyVGFyZ2V0KHBhdGgpCiAgICBsb2NhbCByYXZleWFyZDIgPSB3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXM6RmluZEZpcnN0Q2hpbGQoIlJhdmV5YXJkMiIpCiAgICBpZiBub3QgcmF2ZXlhcmQyIHRoZW4KICAgICAgICByZXR1cm4gbmlsCiAgICBlbmQKICAgIGxvY2FsIHRhcmdldCA9IHJhdmV5YXJkMgogICAgZm9yIHBhcnQgaW4gcGF0aDpnbWF0Y2goIlteLl0rIikgZG8KICAgICAgICB0YXJnZXQgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQocGFydCkKICAgICAgICBpZiBub3QgdGFyZ2V0IHRoZW4KICAgICAgICAgICAgcmV0dXJuIG5pbAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gdGFyZ2V0CmVuZAoKLS0gRnVuY3Rpb24gdG8gcnVuIHRoZSBSYXZleWFyZDIgc2VxdWVuY2UKbG9jYWwgZnVuY3Rpb24gcnVuUmF2ZXlhcmQyU2VxdWVuY2UoKQogICAgaWYgcmF2ZXlhcmQySW5kZXggPiAjcmF2ZXlhcmQyU2VxdWVuY2UgdGhlbgogICAgICAgIHdhcm4oIlJhdmV5YXJkMiBzZXF1ZW5jZSBjb21wbGV0ZS4iKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgbG9jYWwgcGF0aCA9IHJhdmV5YXJkMlNlcXVlbmNlW3JhdmV5YXJkMkluZGV4XQogICAgbG9jYWwgdGFyZ2V0ID0gZ2V0UmF2ZXlhcmQyVGFyZ2V0KHBhdGgpCiAgICBpZiBub3QgdGFyZ2V0IHRoZW4KICAgICAgICB3YXJuKCJUYXJnZXQgbm90IGZvdW5kIGluIFJhdmV5YXJkMjoiLCBwYXRoKQogICAgICAgIHJhdmV5YXJkMkluZGV4ICs9IDEKICAgICAgICByZXR1cm4gcmF2ZXlhcmQySW5kZXggPD0gI3JhdmV5YXJkMlNlcXVlbmNlCiAgICBlbmQKCiAgICAtLSBFbnN1cmUgUHJpbWFyeVBhcnQgaXMgc2V0IGZvciBtb2RlbHMKICAgIGlmIHRhcmdldDpJc0EoIk1vZGVsIikgYW5kIG5vdCB0YXJnZXQuUHJpbWFyeVBhcnQgdGhlbgogICAgICAgIGxvY2FsIHByaW1hcnlQYXJ0ID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkJhc2VQYXJ0IikKICAgICAgICBpZiBwcmltYXJ5UGFydCB0aGVuCiAgICAgICAgICAgIHRhcmdldC5QcmltYXJ5UGFydCA9IHByaW1hcnlQYXJ0CiAgICAgICAgZWxzZQogICAgICAgICAgICB3YXJuKCJQcmltYXJ5UGFydCBub3QgZm91bmQgZm9yIHRhcmdldCBpbiBSYXZleWFyZDI6IiwgdGFyZ2V0Lk5hbWUpCiAgICAgICAgICAgIHJhdmV5YXJkMkluZGV4ICs9IDEKICAgICAgICAgICAgcmV0dXJuIHJhdmV5YXJkMkluZGV4IDw9ICNyYXZleWFyZDJTZXF1ZW5jZQogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgdGFyZ2V0UGFydCA9IHRhcmdldDpJc0EoIk1vZGVsIikgYW5kIHRhcmdldC5QcmltYXJ5UGFydCBvciB0YXJnZXQKICAgIGxvY2FsIHJvb3RQYXJ0ID0gcGxheWVyLkNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgdHdlZW5Ub1RhcmdldChyb290UGFydCwgdGFyZ2V0UGFydC5DRnJhbWUpCiAgICB0YXNrLndhaXQoc3BlY2lhbFR3ZWVuRGVsYXkpCiAgICByYXZleWFyZDJJbmRleCArPSAxCiAgICByZXR1cm4gdHJ1ZQplbmQKCi0tIE1haW4gbG9vcApsb2NhbCBmdW5jdGlvbiBzdGFydEF1dG9QbGF5KCkKICAgIGlmIGxvb3BUaHJlYWQgdGhlbgogICAgICAgIHRhc2suY2FuY2VsKGxvb3BUaHJlYWQpCiAgICBlbmQKICAgIGxvb3BUaHJlYWQgPSB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvUGxheUVuYWJsZWQgZG8KICAgICAgICAgICAgLS0gQ2hlY2sgaWYgUmF2ZXlhcmQyIGV4aXN0cwogICAgICAgICAgICByYXZleWFyZDJGb3VuZCA9IHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tczpGaW5kRmlyc3RDaGlsZCgiUmF2ZXlhcmQyIikgfj0gbmlsCgogICAgICAgICAgICBpZiByYXZleWFyZDJGb3VuZCB0aGVuCiAgICAgICAgICAgICAgICAtLSBSYXZleWFyZDIgZm91bmQ6IHBhdXNlIEVudHJhbmNlcywgdHdlZW4gUmF2ZXlhcmQyCiAgICAgICAgICAgICAgICB3aGlsZSBhdXRvUGxheUVuYWJsZWQgYW5kIHJhdmV5YXJkMkZvdW5kIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJ1blJhdmV5YXJkMlNlcXVlbmNlKCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByYXZleWFyZDJGb3VuZCA9IHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlci5Sb29tczpGaW5kRmlyc3RDaGlsZCgiUmF2ZXlhcmQyIikgfj0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByYXZleWFyZDJGb3VuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCJSYXZleWFyZDIgZGlzYXBwZWFyZWQsIHJlc3VtaW5nIEVudHJhbmNlcy4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAtLSBSYXZleWFyZDIgbm90IGZvdW5kOiB0d2VlbiBFbnRyYW5jZXMKICAgICAgICAgICAgICAgIGlmIGlzQnVzeSBvciBub3QgcGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBwbGF5ZXIuQ2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBsb2NhbCBuZXh0T2JqZWN0ID0gZmluZE5leHRFbnRyYW5jZU9iamVjdCgpCgogICAgICAgICAgICAgICAgaWYgbmV4dE9iamVjdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgaXNCdXN5ID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFBhcnQgPSBuZXh0T2JqZWN0OklzQSgiTW9kZWwiKSBhbmQgbmV4dE9iamVjdC5QcmltYXJ5UGFydCBvciBuZXh0T2JqZWN0CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0Q0ZyYW1lID0gdGFyZ2V0UGFydC5DRnJhbWUKICAgICAgICAgICAgICAgICAgICB0d2VlblRvVGFyZ2V0KHJvb3RQYXJ0LCB0YXJnZXRDRnJhbWUpCiAgICAgICAgICAgICAgICAgICAgdHdlZW5lZE9iamVjdHNbbmV4dE9iamVjdF0gPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KGRlbGF5KQogICAgICAgICAgICAgICAgICAgIGlzQnVzeSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBBdXRvIFBsYXkgVG9nZ2xlClJhdmV5YXJkU2VjdGlvbjI6VG9nZ2xlKHsKICAgIE5hbWUgPSAiQXV0byBQbGF5IiwKICAgIEZsYWcgPSAiQXV0b1BsYXlSYXZleWFyZCIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGF1dG9QbGF5RW5hYmxlZCA9IFZhbHVlCiAgICAgICAgaWYgbm90IFZhbHVlIGFuZCBsb29wVGhyZWFkIHRoZW4KICAgICAgICAgICAgdGFzay5jYW5jZWwobG9vcFRocmVhZCkKICAgICAgICAgICAgbG9vcFRocmVhZCA9IG5pbAogICAgICAgICAgICBpc0J1c3kgPSBmYWxzZQogICAgICAgICAgICB0d2VlbmVkT2JqZWN0cyA9IHt9CiAgICAgICAgICAgIHJhdmV5YXJkMkluZGV4ID0gMQogICAgICAgICAgICByYXZleWFyZDJGb3VuZCA9IGZhbHNlCiAgICAgICAgZWxzZQogICAgICAgICAgICBzdGFydEF1dG9QbGF5KCkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gU2xpZGVycyBmb3IgdHdlZW4gc3BlZWQgYW5kIGRlbGF5ClJhdmV5YXJkU2VjdGlvbjI6U2xpZGVyKHsKICAgIE5hbWUgPSAiVHdlZW4gU3BlZWQgKHN0dWRzL3MpIiwKICAgIEZsYWcgPSAiVHdlZW5TcGVlZFJhdmV5YXJkIiwKICAgIE1pbiA9IDEwMCwKICAgIE1heCA9IDgwMCwKICAgIERlZmF1bHQgPSAyMDAsCiAgICBEZWNpbWFscyA9IDEwMCwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgdHdlZW5TcGVlZCA9IFZhbHVlCiAgICBlbmQKfSkKClJhdmV5YXJkU2VjdGlvbjI6U2xpZGVyKHsKICAgIE5hbWUgPSAiRGVsYXkgKHMpIiwKICAgIEZsYWcgPSAiRGVsYXlSYXZleWFyZCIsCiAgICBNaW4gPSAwLAogICAgTWF4ID0gMTAsCiAgICBEZWZhdWx0ID0gMCwKICAgIERlY2ltYWxzID0gMSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgZGVsYXkgPSBWYWx1ZQogICAgZW5kCn0pCgotLSBIYW5kbGUgY2hhcmFjdGVyIHJlc3Bhd25zCnBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKG5ld0NoYXJhY3RlcikKICAgIGNoYXJhY3RlciA9IG5ld0NoYXJhY3RlcgplbmQpCmVuZAoKCi0tIFRoZSBIdW50ZWQgUGFnZQpkbwogICAgbG9jYWwgSHVudGVkU2VjdGlvbiA9IEh1bnRlZFBhZ2U6U2VjdGlvbih7IE5hbWUgPSAiQW50aS1GZWF0dXJlcyIsIFNpZGUgPSAxIH0pCgogICAgLS0gQWRkIEh1bnRlZC1zcGVjaWZpYyBmZWF0dXJlcyBoZXJlCiAgICBIdW50ZWRTZWN0aW9uOlRvZ2dsZSh7CiAgICAgICAgTmFtZSA9ICJBbnRpIENyb3BzZSAmIFBpcHNxdWVhayIsCiAgICAgICAgRmxhZyA9ICJBbnRpSHVudGVkRmVhdHVyZSIsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIC0tIEltcGxlbWVudCBBbnRpIEh1bnRlZCBGZWF0dXJlIGxvZ2ljCiAgICAgICAgZW5kCiAgICB9KQplbmQKCi0tIFZpc3VhbCBQYWdlCmRvCiAgICBsb2NhbCBWaXN1YWxzU2VjdGlvbiA9IFZpc3VhbFBhZ2U6U2VjdGlvbih7IE5hbWUgPSAiVmlzdWFscyIsIFNpZGUgPSAxIH0pCgogICAgLS0gRnVsbGJyaWdodAogICAgVmlzdWFsc1NlY3Rpb246VG9nZ2xlKHsKICAgICAgICBOYW1lID0gIkZ1bGxicmlnaHQiLAogICAgICAgIEZsYWcgPSAiRnVsbGJyaWdodCIsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSAKICAgICAgICBlbmQKICAgIGVuZAogICAgfSkKCi0tIEZPViBDaGFuZ2VyCmxvY2FsIGZvdkVuYWJsZWQgPSBmYWxzZQpsb2NhbCBmb3ZWYWx1ZSA9IDkwCmxvY2FsIGZvdkNvbm5lY3Rpb24gPSBuaWwKICAgIFZpc3VhbHNTZWN0aW9uOlNsaWRlcih7CiAgICAgICAgTmFtZSA9ICJGT1YgQ2hhbmdlciIsCiAgICAgICAgRmxhZyA9ICJGT1YiLAogICAgICAgIE1pbiA9IDkwLAogICAgICAgIE1heCA9IDEyMCwKICAgICAgICBEZWZhdWx0ID0gOTAsCiAgICAgICAgRGVjaW1hbHMgPSAxLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgZm92VmFsdWUgPSBWYWx1ZQogICAgICAgIGZvdkVuYWJsZWQgPSB0cnVlCiAgICAgICAgaWYgbm90IGZvdkNvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICBmb3ZDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBmb3ZFbmFibGVkIGFuZCB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYSB0aGVuCiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuRmllbGRPZlZpZXcgPSBmb3ZWYWx1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAogICAgfSkKCiAgICAtLU5vdGlmaWVycwogICAgLS1FbnRpdHkKbG9jYWwgZnVuY3Rpb24gY2hlY2tGb3JFbnRpdGllcygpCiAgICBmb3IgbmFtZSwgXyBpbiBwYWlycyhlbnRpdGllcykgZG8KICAgICAgICBpZiB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQobmFtZSkgdGhlbgogICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmaWNhdGlvbihuYW1lLi4gIiBoYXMgYmVlbiBzcGF3bmVkISIsICItIiwgNSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKClZpc3VhbHNTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkVudGl0eSBOb3RpZmllciIsCiAgICBGbGFnID0gIkVudE5vdCIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgLS0gQ2hlY2sgaW1tZWRpYXRlbHkKICAgICAgICAgICAgY2hlY2tGb3JFbnRpdGllcygpCiAgICAgICAgICAgIC0tIE1vbml0b3IgZm9yIG5ldyBlbnRpdGllcwogICAgICAgICAgICBsb2NhbCBjb25uZWN0aW9uCiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSB3b3Jrc3BhY2UuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgZW50aXRpZXNbY2hpbGQuTmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnk6Tm90aWZpY2F0aW9uKGNoaWxkLk5hbWUuLiAiIGhhcyBiZWVuIHNwYXduZWQhIiwgIi0iLCAxNSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIC0tIFN0b3JlIGNvbm5lY3Rpb24gZm9yIGxhdGVyIGRpc2Nvbm5lY3Rpb24KICAgICAgICAgICAgZ2V0Z2VudigpLmVudGl0eU5vdGlmaWVyQ29ubmVjdGlvbiA9IGNvbm5lY3Rpb24KICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIERpc2Nvbm5lY3QgdGhlIGV2ZW50IHdoZW4gdG9nZ2xlZCBvZmYKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLmVudGl0eU5vdGlmaWVyQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuZW50aXR5Tm90aWZpZXJDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLmVudGl0eU5vdGlmaWVyQ29ubmVjdGlvbiA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gRVNQIFN5c3RlbQpsb2NhbCBFU1BDb25maWdzID0gewogICAgewogICAgICAgIG5hbWUgPSAiSXRlbXMiLAogICAgICAgIGZsYWcgPSAiSXRlbUVTUCIsCiAgICAgICAgdGV4dCA9ICJFU1AgSXRlbXMiLAogICAgICAgIGRlZmF1bHQgPSBmYWxzZSwKICAgICAgICBjb2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCA1MCksCiAgICAgICAgbWF0Y2hlciA9IGZ1bmN0aW9uKG9iaikKICAgICAgICAgICAgcmV0dXJuIG9iajpHZXRBdHRyaWJ1dGUoIkludGVyYWN0aW9uVHlwZSIpID09ICJJdGVtQmFzZSIKICAgICAgICBlbmQsCiAgICAgICAgZm9sZGVyTmFtZXMgPSB7IlJvb21zIiwgIkRyb3BwZWRJdGVtcyJ9LAogICAgICAgIGlzV29ya3NwYWNlU2NhbiA9IGZhbHNlLAogICAgfSwKICAgIHsKICAgICAgICBuYW1lID0gIkN1cnJlbmN5IiwKICAgICAgICBmbGFnID0gIkN1cnJlbmN5RVNQIiwKICAgICAgICB0ZXh0ID0gIkVTUCBDdXJyZW5jeSIsCiAgICAgICAgZGVmYXVsdCA9IGZhbHNlLAogICAgICAgIGNvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAwKSwKICAgICAgICBtYXRjaGVyID0gZnVuY3Rpb24ob2JqKQogICAgICAgICAgICByZXR1cm4gb2JqOkdldEF0dHJpYnV0ZSgiSW50ZXJhY3Rpb25UeXBlIikgPT0gIkN1cnJlbmN5QmFzZSIKICAgICAgICBlbmQsCiAgICAgICAgZm9sZGVyTmFtZXMgPSB7IlJvb21zIiwgIkRyb3BwZWRJdGVtcyJ9LAogICAgICAgIGlzV29ya3NwYWNlU2NhbiA9IGZhbHNlLAogICAgfSwKICAgIHsKICAgICAgICBuYW1lID0gIktleUNhcmRzIiwKICAgICAgICBmbGFnID0gIktleUNhcmRFU1AiLAogICAgICAgIHRleHQgPSAiRVNQIEtleUNhcmRzIiwKICAgICAgICBkZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgY29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAyNTUsIDI1NSksCiAgICAgICAgbWF0Y2hlciA9IGZ1bmN0aW9uKG9iaikKICAgICAgICAgICAgbG9jYWwga2V5Q2FyZHMgPSB7CiAgICAgICAgICAgICAgICBOb3JtYWxLZXlDYXJkID0gdHJ1ZSwKICAgICAgICAgICAgICAgIElubmVyS2V5Q2FyZCA9IHRydWUsCiAgICAgICAgICAgICAgICBQYXNzd29yZFBhcGVyID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJpZGdlS2V5Q2FyZCA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4ga2V5Q2FyZHNbb2JqLk5hbWVdCiAgICAgICAgZW5kLAogICAgICAgIGZvbGRlck5hbWVzID0geyJSb29tcyIsICJEcm9wcGVkSXRlbXMifSwKICAgICAgICBpc1dvcmtzcGFjZVNjYW4gPSBmYWxzZSwKICAgIH0sCiAgICB7CiAgICAgICAgbmFtZSA9ICJNb25zdGVycyIsCiAgICAgICAgZmxhZyA9ICJNb25zdGVyRVNQIiwKICAgICAgICB0ZXh0ID0gIkVTUCBNb25zdGVycyIsCiAgICAgICAgZGVmYXVsdCA9IGZhbHNlLAogICAgICAgIGNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKSwKICAgICAgICBtYXRjaGVyID0gZnVuY3Rpb24ob2JqKQogICAgICAgICAgICBsb2NhbCBtb25zdGVycyA9IHsKICAgICAgICAgICAgICAgIEFuZ2xlciA9IHRydWUsCiAgICAgICAgICAgICAgICBQaW5raWUgPSB0cnVlLAogICAgICAgICAgICAgICAgRnJvZ2VyID0gdHJ1ZSwKICAgICAgICAgICAgICAgIEJsaXR6ID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFBhbmRlbW9uaXVtID0gdHJ1ZSwKICAgICAgICAgICAgICAgIENoYWluc21va2VyID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJpZGdlQW5nbGVyID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJpZGdlUGlua2llID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJpZGdlRnJvZ2VyID0gdHJ1ZSwKICAgICAgICAgICAgICAgIFJpZGdlQmxpdHogPSB0cnVlLAogICAgICAgICAgICAgICAgUmlkZ2VDaGFpbnNtb2tlciA9IHRydWUsCiAgICAgICAgICAgICAgICBSaWRnZVBhbmRlbW9uaXVtID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtb25zdGVyc1tvYmouTmFtZV0KICAgICAgICBlbmQsCiAgICAgICAgZm9sZGVyTmFtZXMgPSB7IlJvb21zIn0sCiAgICAgICAgaXNXb3Jrc3BhY2VTY2FuID0gdHJ1ZSwKICAgIH0sCiAgICB7CiAgICAgICAgbmFtZSA9ICJUcmlja3N0ZXJEb29ycyIsCiAgICAgICAgZmxhZyA9ICJUcmlja3N0ZXJEb29yRVNQIiwKICAgICAgICB0ZXh0ID0gIkVTUCBUcmlja3N0ZXIgRG9vcnMiLAogICAgICAgIGRlZmF1bHQgPSBmYWxzZSwKICAgICAgICBjb2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNDAsIDApLAogICAgICAgIG1hdGNoZXIgPSBmdW5jdGlvbihvYmopCiAgICAgICAgICAgIHJldHVybiBvYmouTmFtZSA9PSAiVHJpY2tzdGVyRG9vciIKICAgICAgICBlbmQsCiAgICAgICAgZm9sZGVyTmFtZXMgPSB7IlJvb21zIn0sCiAgICAgICAgaXNXb3Jrc3BhY2VTY2FuID0gZmFsc2UsCiAgICB9LAogICAgewogICAgICAgIG5hbWUgPSAiR2VuZXJhdG9ycyIsCiAgICAgICAgZmxhZyA9ICJHZW5lcmF0b3JFU1AiLAogICAgICAgIHRleHQgPSAiRVNQIEdlbmVyYXRvcnMiLAogICAgICAgIGRlZmF1bHQgPSBmYWxzZSwKICAgICAgICBjb2xvciA9IENvbG9yMy5mcm9tUkdCKDE1MCwgNTAsIDI1MCksCiAgICAgICAgbWF0Y2hlciA9IGZ1bmN0aW9uKG9iaikKICAgICAgICAgICAgcmV0dXJuIG9iai5OYW1lID09ICJHZW5lcmF0b3IiIG9yIG9iai5OYW1lID09ICJQcmVzZXRHZW5lcmF0b3IiCiAgICAgICAgZW5kLAogICAgICAgIGZvbGRlck5hbWVzID0geyJSb29tcyJ9LAogICAgICAgIGlzV29ya3NwYWNlU2NhbiA9IGZhbHNlLAogICAgfSwKICAgIHsKICAgICAgICBuYW1lID0gIkRvb3JzIiwKICAgICAgICBmbGFnID0gIkRvb3JFU1AiLAogICAgICAgIHRleHQgPSAiRVNQIERvb3JzIiwKICAgICAgICBkZWZhdWx0ID0gZmFsc2UsCiAgICAgICAgY29sb3IgPSBDb2xvcjMuZnJvbVJHQigxMDAsIDIzMCwgMjApLAogICAgICAgIG1hdGNoZXIgPSBmdW5jdGlvbihvYmopCiAgICAgICAgICAgIHJldHVybiBvYmouTmFtZSA9PSAiTm9ybWFsRG9vciIgYW5kIG9iai5QYXJlbnQgYW5kIG9iai5QYXJlbnQuTmFtZSA9PSAiRW50cmFuY2VzIiBhbmQgb2JqLlBhcmVudC5QYXJlbnQuUGFyZW50ID09IHJvb21zCiAgICAgICAgZW5kLAogICAgICAgIGZvbGRlck5hbWVzID0geyJSb29tcyJ9LAogICAgICAgIGlzV29ya3NwYWNlU2NhbiA9IGZhbHNlLAogICAgfSwKfQoKLS0gRVNQIFN5c3RlbSBWYXJpYWJsZXMKbG9jYWwgYmlsbGJvYXJkQ2FjaGUgPSB7fQpsb2NhbCBoZWFydGJlYXRDb25uZWN0aW9uID0gbmlsCmxvY2FsIGxhc3RVcGRhdGVUaW1lID0gMApsb2NhbCBlc3BEaXN0YW5jZXMgPSB7fQpsb2NhbCBkcm9wcGVkSXRlbXNGb2xkZXIgPSBnYW1lcGxheUZvbGRlcjpXYWl0Rm9yQ2hpbGQoIkRyb3BwZWRJdGVtcyIpCgotLSBIZWxwZXIgRnVuY3Rpb25zCmxvY2FsIGZ1bmN0aW9uIGdldE9iamVjdFBvc2l0aW9uKG9iamVjdCkKICAgIGlmIG9iamVjdDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgIHJldHVybiBvYmplY3QuUG9zaXRpb24KICAgIGVsc2VpZiBvYmplY3Q6SXNBKCJNb2RlbCIpIHRoZW4KICAgICAgICByZXR1cm4gb2JqZWN0LlByaW1hcnlQYXJ0IGFuZCBvYmplY3QuUHJpbWFyeVBhcnQuUG9zaXRpb24gb3IKICAgICAgICAgICAgICAgKG9iamVjdDpGaW5kRmlyc3RDaGlsZCgiSGFuZGxlIikgb3Igb2JqZWN0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkJhc2VQYXJ0IikpIGFuZAogICAgICAgICAgICAgICAob2JqZWN0OkZpbmRGaXJzdENoaWxkKCJIYW5kbGUiKSBvciBvYmplY3Q6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiQmFzZVBhcnQiKSkuUG9zaXRpb24gb3IKICAgICAgICAgICAgICAgb2JqZWN0OkdldFBpdm90KCkuUG9zaXRpb24KICAgIGVuZAogICAgcmV0dXJuIG5pbAplbmQKCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZUJpbGxib2FyZEd1aShwYXJlbnQsIGNvbG9yLCBkaXN0YW5jZSkKICAgIGlmIG5vdCBwYXJlbnQgb3Igbm90IHBhcmVudDpJc0Rlc2NlbmRhbnRPZih3b3Jrc3BhY2UpIG9yIHBhcmVudDpGaW5kRmlyc3RDaGlsZCgiRVNQQmlsbGJvYXJkIikgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCBhZG9ybmVlID0gcGFyZW50OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFyZW50IG9yIHBhcmVudC5QcmltYXJ5UGFydCBvciBwYXJlbnQ6RmluZEZpcnN0Q2hpbGQoIkhhbmRsZSIpIG9yIHBhcmVudDpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJCYXNlUGFydCIpCiAgICBpZiBub3QgYWRvcm5lZSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGxvY2FsIGJpbGxib2FyZCA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikKICAgIGJpbGxib2FyZC5OYW1lID0gIkVTUEJpbGxib2FyZCIKICAgIGJpbGxib2FyZC5BZG9ybmVlID0gYWRvcm5lZQogICAgYmlsbGJvYXJkLlNpemUgPSBVRGltMi5uZXcoMCwgMTAwLCAwLCAxMDApCiAgICBiaWxsYm9hcmQuU3R1ZHNPZmZzZXQgPSBWZWN0b3IzLm5ldygwLCAyLCAwKQogICAgYmlsbGJvYXJkLkFsd2F5c09uVG9wID0gdHJ1ZQogICAgYmlsbGJvYXJkLk1heERpc3RhbmNlID0gZGlzdGFuY2Ugb3IgMTAwCiAgICBiaWxsYm9hcmQuUGFyZW50ID0gcGFyZW50CiAgICBsb2NhbCB0ZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICB0ZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgdGV4dExhYmVsLlRleHRTaXplID0gMjIKICAgIHRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgdGV4dExhYmVsLlRleHQgPSBwYXJlbnQuTmFtZQogICAgdGV4dExhYmVsLlRleHRDb2xvcjMgPSBjb2xvcgogICAgdGV4dExhYmVsLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLjUKICAgIHRleHRMYWJlbC5UZXh0U3Ryb2tlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgIHRleHRMYWJlbC5UZXh0U2NhbGVkID0gZmFsc2UKICAgIHRleHRMYWJlbC5UZXh0V3JhcHBlZCA9IGZhbHNlCiAgICB0ZXh0TGFiZWwuRm9udCA9IEVudW0uRm9udC5Tb3VyY2VTYW5zQm9sZAogICAgdGV4dExhYmVsLlBhcmVudCA9IGJpbGxib2FyZAogICAgYmlsbGJvYXJkQ2FjaGVbcGFyZW50XSA9IGJpbGxib2FyZAogICAgcGFyZW50LkFuY2VzdHJ5Q2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgcGFyZW50OklzRGVzY2VuZGFudE9mKHdvcmtzcGFjZSkgYW5kIGJpbGxib2FyZENhY2hlW3BhcmVudF0gdGhlbgogICAgICAgICAgICBiaWxsYm9hcmRDYWNoZVtwYXJlbnRdOkRlc3Ryb3koKQogICAgICAgICAgICBiaWxsYm9hcmRDYWNoZVtwYXJlbnRdID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gcmVtb3ZlQmlsbGJvYXJkcyhtYXRjaGVyKQogICAgZm9yIGl0ZW0sIGJpbGxib2FyZCBpbiBwYWlycyhiaWxsYm9hcmRDYWNoZSkgZG8KICAgICAgICBpZiBtYXRjaGVyKGl0ZW0pIGFuZCBiaWxsYm9hcmQgdGhlbgogICAgICAgICAgICBiaWxsYm9hcmQ6RGVzdHJveSgpCiAgICAgICAgICAgIGJpbGxib2FyZENhY2hlW2l0ZW1dID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiByZW1vdmVBbGxCaWxsYm9hcmRzKCkKICAgIGZvciBpdGVtLCBiaWxsYm9hcmQgaW4gcGFpcnMoYmlsbGJvYXJkQ2FjaGUpIGRvCiAgICAgICAgaWYgYmlsbGJvYXJkIHRoZW4KICAgICAgICAgICAgYmlsbGJvYXJkOkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgZW5kCiAgICB0YWJsZS5jbGVhcihiaWxsYm9hcmRDYWNoZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiB1cGRhdGVEaXN0YW5jZURpc3BsYXkoKQogICAgbG9jYWwgcm9vdFBhcnQgPSBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGlmIG5vdCByb290UGFydCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGZvciBpdGVtLCBiaWxsYm9hcmQgaW4gcGFpcnMoYmlsbGJvYXJkQ2FjaGUpIGRvCiAgICAgICAgaWYgYmlsbGJvYXJkIGFuZCBiaWxsYm9hcmQuUGFyZW50IHRoZW4KICAgICAgICAgICAgbG9jYWwgdGV4dExhYmVsID0gYmlsbGJvYXJkOkZpbmRGaXJzdENoaWxkKCJUZXh0TGFiZWwiKQogICAgICAgICAgICBpZiB0ZXh0TGFiZWwgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaXRlbVBvc2l0aW9uID0gZ2V0T2JqZWN0UG9zaXRpb24oaXRlbSkKICAgICAgICAgICAgICAgIGlmIGl0ZW1Qb3NpdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdCA9IChyb290UGFydC5Qb3NpdGlvbiAtIGl0ZW1Qb3NpdGlvbikuTWFnbml0dWRlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzcGxheU5hbWUgPSBpdGVtLk5hbWUKICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLk5hbWUgPT0gIkdlbmVyYXRvciIgb3IgaXRlbS5OYW1lID09ICJQcmVzZXRHZW5lcmF0b3IiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZml4ZWQgPSBpdGVtOkZpbmRGaXJzdENoaWxkKCJGaXhlZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGZpeGVkVmFsdWUgPSBmaXhlZCBhbmQgKGZpeGVkOklzQSgiSW50VmFsdWUiKSBvciBmaXhlZDpJc0EoIk51bWJlclZhbHVlIikpIGFuZCBmaXhlZC5WYWx1ZSBvciAiTi9BIgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIiVzXG5GaXhlZDogJXNcbiUuMWYgc3R1ZHMiLCBkaXNwbGF5TmFtZSwgdG9zdHJpbmcoZml4ZWRWYWx1ZSksIGRpc3QpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIiVzXG4lLjFmIHN0dWRzIiwgZGlzcGxheU5hbWUsIGRpc3QpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHQgPSBkaXNwbGF5TmFtZSAuLiAiXG5ObyBwb3NpdGlvbiIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIHNjYW5Gb2xkZXIoZm9sZGVyLCBtYXRjaGVyLCBjb2xvciwgZGlzdGFuY2UpCiAgICBpZiBub3QgZm9sZGVyIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAogICAgZm9yIF8sIGRlc2NlbmRhbnQgaW4gcGFpcnMoZm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgbWF0Y2hlcihkZXNjZW5kYW50KSB0aGVuCiAgICAgICAgICAgIGNyZWF0ZUJpbGxib2FyZEd1aShkZXNjZW5kYW50LCBjb2xvciwgZGlzdGFuY2UpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBpc0FueUVTUEVhYmxlZCgpCiAgICBmb3IgXywgY29uZmlnIGluIGlwYWlycyhFU1BDb25maWdzKSBkbwogICAgICAgIGlmIExpYnJhcnkuRmxhZ3NbY29uZmlnLmZsYWddIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gaW5pdGlhbGl6ZUVTUChjb25maWcpCiAgICBpZiBub3QgTGlicmFyeS5GbGFnc1tjb25maWcuZmxhZ10gdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCBkaXN0YW5jZSA9IGVzcERpc3RhbmNlc1tjb25maWcubmFtZV0gb3IgMTAwCiAgICBpZiBjb25maWcuaXNXb3Jrc3BhY2VTY2FuIHRoZW4KICAgICAgICBmb3IgXywgY2hpbGQgaW4gcGFpcnMod29ya3NwYWNlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIGNvbmZpZy5tYXRjaGVyKGNoaWxkKSB0aGVuCiAgICAgICAgICAgICAgICBjcmVhdGVCaWxsYm9hcmRHdWkoY2hpbGQsIGNvbmZpZy5jb2xvciwgZGlzdGFuY2UpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHdvcmtzcGFjZS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgIGlmIExpYnJhcnkuRmxhZ3NbY29uZmlnLmZsYWddIGFuZCBjb25maWcubWF0Y2hlcihjaGlsZCkgdGhlbgogICAgICAgICAgICAgICAgY3JlYXRlQmlsbGJvYXJkR3VpKGNoaWxkLCBjb25maWcuY29sb3IsIGVzcERpc3RhbmNlc1tjb25maWcubmFtZV0gb3IgMTAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKICAgIGZvciBfLCBmb2xkZXJOYW1lIGluIGlwYWlycyhjb25maWcuZm9sZGVyTmFtZXMpIGRvCiAgICAgICAgbG9jYWwgZm9sZGVyID0gZm9sZGVyTmFtZSA9PSAiUm9vbXMiIGFuZCByb29tcyBvciBkcm9wcGVkSXRlbXNGb2xkZXIKICAgICAgICBpZiBmb2xkZXIgdGhlbgogICAgICAgICAgICBzY2FuRm9sZGVyKGZvbGRlciwgY29uZmlnLm1hdGNoZXIsIGNvbmZpZy5jb2xvciwgZGlzdGFuY2UpCiAgICAgICAgICAgIGZvbGRlci5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihkZXNjZW5kYW50KQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuRmxhZ3NbY29uZmlnLmZsYWddIGFuZCBjb25maWcubWF0Y2hlcihkZXNjZW5kYW50KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQmlsbGJvYXJkR3VpKGRlc2NlbmRhbnQsIGNvbmZpZy5jb2xvciwgZXNwRGlzdGFuY2VzW2NvbmZpZy5uYW1lXSBvciAxMDApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gSW5pdGlhbGl6ZSBFU1AgZm9yIGVhY2ggY29uZmlnCmZvciBfLCBjb25maWcgaW4gaXBhaXJzKEVTUENvbmZpZ3MpIGRvCiAgICBlc3BEaXN0YW5jZXNbY29uZmlnLm5hbWVdID0gMzUwCiAgICBWaXN1YWxzU2VjdGlvbjpUb2dnbGUoewogICAgICAgIE5hbWUgPSBjb25maWcudGV4dCwKICAgICAgICBGbGFnID0gY29uZmlnLmZsYWcsCiAgICAgICAgRGVmYXVsdCA9IGNvbmZpZy5kZWZhdWx0LAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGluaXRpYWxpemVFU1AoY29uZmlnKQogICAgICAgICAgICAgICAgaWYgbm90IGhlYXJ0YmVhdENvbm5lY3Rpb24gYW5kIGlzQW55RVNQRWFibGVkKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdENvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudFRpbWUgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlVGltZSA+PSAwLjIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGlzdGFuY2VEaXNwbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVUaW1lID0gY3VycmVudFRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJlbW92ZUJpbGxib2FyZHMoY29uZmlnLm1hdGNoZXIpCiAgICAgICAgICAgICAgICBpZiBub3QgaXNBbnlFU1BFYWJsZWQoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQWxsQmlsbGJvYXJkcygpCiAgICAgICAgICAgICAgICAgICAgaWYgaGVhcnRiZWF0Q29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdENvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCmVuZAplbmQKCgotLSBNb3ZlbWVudCBQYWdlCmRvCiAgICBsb2NhbCBNb3ZlbWVudFNlY3Rpb24gPSBNb3ZlbWVudFBhZ2U6U2VjdGlvbih7IE5hbWUgPSAiTW92ZW1lbnQiLCBTaWRlID0gMSB9KQoKICAgIC0tIE5vY2xpcApsb2NhbCBub2NsaXBDb25uZWN0aW9uID0gbmlsCmxvY2FsIG5vY2xpcEVuYWJsZWQgPSBmYWxzZQpsb2NhbCBvcmlnaW5hbENvbGxpc2lvbnMgPSB7fQoKbG9jYWwgZnVuY3Rpb24gc2V0Tm9jbGlwKGVuYWJsZWQpCiAgICBub2NsaXBFbmFibGVkID0gZW5hYmxlZAogICAgaWYgbm9jbGlwQ29ubmVjdGlvbiB0aGVuIG5vY2xpcENvbm5lY3Rpb246RGlzY29ubmVjdCgpIGVuZAogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXJhY3RlciB0aGVuIHJldHVybiBlbmQKICAgIGlmIGVuYWJsZWQgdGhlbgogICAgICAgIGZvciBfLCBwYXJ0IGluIHBhaXJzKGNoYXJhY3RlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBvcmlnaW5hbENvbGxpc2lvbnNbcGFydF0gPSBwYXJ0LkNhbkNvbGxpZGUKICAgICAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGxvY2FsIGZ1bmN0aW9uIG5vY2xpcExvb3AoKQogICAgICAgICAgICBpZiBub3Qgbm9jbGlwRW5hYmxlZCBvciBub3QgcGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICBpZiBub2NsaXBDb25uZWN0aW9uIHRoZW4gbm9jbGlwQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIHBhaXJzKHBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4gcGFydC5DYW5Db2xsaWRlID0gZmFsc2UgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIG5vY2xpcENvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLlN0ZXBwZWQ6Q29ubmVjdChub2NsaXBMb29wKQogICAgZWxzZQogICAgICAgIGZvciBwYXJ0LCBjYW5Db2xsaWRlIGluIHBhaXJzKG9yaWdpbmFsQ29sbGlzaW9ucykgZG8KICAgICAgICAgICAgaWYgcGFydDpJc0Rlc2NlbmRhbnRPZihjaGFyYWN0ZXIpIGFuZCBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBwYXJ0LkNhbkNvbGxpZGUgPSBjYW5Db2xsaWRlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIG9yaWdpbmFsQ29sbGlzaW9ucyA9IHt9CiAgICBlbmQKZW5kCgpwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdDaGFyYWN0ZXIpCiAgICBpZiBub2NsaXBFbmFibGVkIHRoZW4gdGFzay53YWl0KDAuMSk7IHNldE5vY2xpcCh0cnVlKSBlbmQKZW5kKQoKcGxheWVyLkNoYXJhY3RlclJlbW92aW5nOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgaWYgbm9jbGlwQ29ubmVjdGlvbiB0aGVuIG5vY2xpcENvbm5lY3Rpb246RGlzY29ubmVjdCgpIGVuZAogICAgb3JpZ2luYWxDb2xsaXNpb25zID0ge30KZW5kKQogICAgTW92ZW1lbnRTZWN0aW9uOlRvZ2dsZSh7CiAgICAgICAgTmFtZSA9ICJUb2dnbGUgTm9jbGlwIiwKICAgICAgICBGbGFnID0gIk5vY2xpcCIsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgIHNldE5vY2xpcChWYWx1ZSkKICAgICAgICBlbmQKICAgIH0pCgotLSBTcGVlZCBDaGFuZ2VyCmxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQpsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKbG9jYWwgcm9vdFBhcnQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKbG9jYWwgc3BlZWRDb25uID0gbmlsCgogICAgTW92ZW1lbnRTZWN0aW9uOlNsaWRlcih7CiAgICAgICAgTmFtZSA9ICJTcGVlZCBDaGFuZ2VyIiwKICAgICAgICBGbGFnID0gIlNwZWVkIiwKICAgICAgICBNaW4gPSAwLAogICAgICAgIE1heCA9IDEwMCwKICAgICAgICBEZWZhdWx0ID0gMCwKICAgICAgICBEZWNpbWFscyA9IDEwLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgICAgICBwbGF5ZXI6U2V0QXR0cmlidXRlKCJDdXN0b21TcGVlZCIsIFZhbHVlKQogICAgICAgIGVuZAogICAgfSkKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZU1vdmVtZW50KCkKICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIGh1bSA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgIGxvY2FsIHJvb3QgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGlmIG5vdCBodW0gb3Igbm90IHJvb3QgdGhlbiByZXR1cm4gZW5kCiAgICBpZiBodW0uTW92ZURpcmVjdGlvbi5NYWduaXR1ZGUgPiAwIHRoZW4KICAgICAgICBsb2NhbCBzcGVlZCA9IHBsYXllcjpHZXRBdHRyaWJ1dGUoIkN1c3RvbVNwZWVkIikgb3IgMAogICAgICAgIGxvY2FsIGRlbHRhID0gUnVuU2VydmljZS5IZWFydGJlYXQ6V2FpdCgpCiAgICAgICAgbG9jYWwgbW92ZVZlY3RvciA9IGh1bS5Nb3ZlRGlyZWN0aW9uICogc3BlZWQgKiBkZWx0YQogICAgICAgIHJvb3QuQ0ZyYW1lID0gcm9vdC5DRnJhbWUgKyBWZWN0b3IzLm5ldyhtb3ZlVmVjdG9yLlgsIDAsIG1vdmVWZWN0b3IuWikKICAgIGVuZAplbmQKCnNwZWVkQ29ubiA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QodXBkYXRlTW92ZW1lbnQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBhY3RpdmVMb29wcyA9IHt9CmxvY2FsIHNlbGVjdGVkTG9vdFR5cGVzID0geyBDdXJyZW5jeSA9IGZhbHNlLCBLZXlDYXJkcyA9IGZhbHNlLCBJdGVtcyA9IGZhbHNlIH0KCi0tIEZ1bmN0aW9uIHRvIGZpbmQgYW5kIGZpcmUgUHJveGltaXR5UHJvbXB0cyBmb3Igc2VsZWN0ZWQgbG9vdCB0eXBlcwpsb2NhbCBmdW5jdGlvbiBmaW5kQW5kRmlyZVByb3hpbWl0eVByb21wdHMoKQogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGlmIG5vdCByb290UGFydCB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCByb29tc0ZvbGRlciA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR2FtZXBsYXlGb2xkZXIiKSBhbmQgd29ya3NwYWNlLkdhbWVwbGF5Rm9sZGVyOkZpbmRGaXJzdENoaWxkKCJSb29tcyIpCiAgICBpZiBub3Qgcm9vbXNGb2xkZXIgdGhlbgogICAgICAgIHdhcm4oIlJvb21zIGZvbGRlciBub3QgZm91bmQiKQogICAgICAgIHJldHVybgogICAgZW5kCgogICAgZm9yIF8sIHJvb20gaW4gaXBhaXJzKHJvb21zRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgZm9yIF8sIG9iamVjdCBpbiBpcGFpcnMocm9vbTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBvYmplY3Q6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSBhbmQgb2JqZWN0OkZpbmRGaXJzdEFuY2VzdG9yKCJTcGF3bkxvY2F0aW9ucyIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHByb3h5UGFydCA9IG9iamVjdC5QYXJlbnQKICAgICAgICAgICAgICAgIGlmIHByb3h5UGFydCBhbmQgcHJveHlQYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcCA9IHByb3h5UGFydC5QYXJlbnQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBsb290VHlwZSA9IG5pbAoKICAgICAgICAgICAgICAgICAgICBpZiBwLk5hbWUgPT0gIk5vcm1hbEtleUNhcmQiIG9yIHAuTmFtZSA9PSAiUGFzc3dvcmRQYXBlciIgb3IgcC5OYW1lID09ICJJbm5lcktleUNhcmQiIG9yIHAuTmFtZSA9PSAiUmlkZ2VLZXlDYXJkIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3RUeXBlID0gIktleUNhcmRzIgogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBwOkdldEF0dHJpYnV0ZSgiSW50ZXJhY3Rpb25UeXBlIikgPT0gIkN1cnJlbmN5QmFzZSIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb290VHlwZSA9ICJDdXJyZW5jeSIKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgcDpHZXRBdHRyaWJ1dGUoIkludGVyYWN0aW9uVHlwZSIpID09ICJJdGVtQmFzZSIgb3IgcDpHZXRBdHRyaWJ1dGUoIkludGVyYWN0aW9uVHlwZSIpID09ICJBbW1vIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3RUeXBlID0gIkl0ZW1zIgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBsb290VHlwZSBhbmQgc2VsZWN0ZWRMb290VHlwZXNbbG9vdFR5cGVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAocm9vdFBhcnQuUG9zaXRpb24gLSBwcm94eVBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSAxMiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBvYmplY3Q6SXNEZXNjZW5kYW50T2Yod29ya3NwYWNlKSBhbmQgKHJvb3RQYXJ0LlBvc2l0aW9uIC0gcHJveHlQYXJ0LlBvc2l0aW9uKS5NYWduaXR1ZGUgPD0gMTIgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FsbChmaXJlcHJveGltaXR5cHJvbXB0LCBvYmplY3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tIEZ1bmN0aW9uIHRvIHN0YXJ0IGEgbG9vcApsb2NhbCBmdW5jdGlvbiBzdGFydExvb3AobmFtZSwgY2FsbGJhY2ssIGludGVydmFsKQogICAgaWYgYWN0aXZlTG9vcHNbbmFtZV0gdGhlbiByZXR1cm4gZW5kCiAgICBhY3RpdmVMb29wc1tuYW1lXSA9IHRydWUKICAgIGFjdGl2ZUxvb3BzW25hbWUgLi4gIl90aHJlYWQiXSA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGFjdGl2ZUxvb3BzW25hbWVdIGRvCiAgICAgICAgICAgIGNhbGxiYWNrKCkKICAgICAgICAgICAgdGFzay53YWl0KGludGVydmFsIG9yIDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBGdW5jdGlvbiB0byBzdG9wIGEgbG9vcApsb2NhbCBmdW5jdGlvbiBzdG9wTG9vcChuYW1lKQogICAgaWYgYWN0aXZlTG9vcHNbbmFtZV0gdGhlbgogICAgICAgIGFjdGl2ZUxvb3BzW25hbWVdID0gZmFsc2UKICAgICAgICBpZiBhY3RpdmVMb29wc1tuYW1lIC4uICJfdGhyZWFkIl0gdGhlbgogICAgICAgICAgICB0YXNrLmNhbmNlbChhY3RpdmVMb29wc1tuYW1lIC4uICJfdGhyZWFkIl0pCiAgICAgICAgICAgIGFjdGl2ZUxvb3BzW25hbWUgLi4gIl90aHJlYWQiXSA9IG5pbAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gRnVuY3Rpb24gdG8gc3RhcnQgdGhlIGxvb3QgbG9vcApsb2NhbCBmdW5jdGlvbiBzdGFydExvb3RMb29wKCkKICAgIC0tIENoZWNrIGlmIGFueSBsb290IHR5cGUgaXMgc2VsZWN0ZWQKICAgIGxvY2FsIGFueVNlbGVjdGVkID0gc2VsZWN0ZWRMb290VHlwZXMuQ3VycmVuY3kgb3Igc2VsZWN0ZWRMb290VHlwZXMuS2V5Q2FyZHMgb3Igc2VsZWN0ZWRMb290VHlwZXMuSXRlbXMKCiAgICBpZiBhbnlTZWxlY3RlZCB0aGVuCiAgICAgICAgc3RhcnRMb29wKCJBdXRvTG9vdCIsIGZpbmRBbmRGaXJlUHJveGltaXR5UHJvbXB0cywgMC4xKQogICAgICAgIHByaW50KCJBdXRvIExvb3QgbG9vcCBzdGFydGVkIikKICAgIGVsc2UKICAgICAgICBwcmludCgiQXV0byBMb290IG5vdCBzdGFydGVkIChub3RoaW5nIHNlbGVjdGVkKSIpCiAgICBlbmQKZW5kCgotLSBUb2dnbGUgdG8gZW5hYmxlL2Rpc2FibGUgQXV0byBMb290Ck1vdmVtZW50U2VjdGlvbjpUb2dnbGUoewogICAgTmFtZSA9ICJBdXRvIExvb3QiLAogICAgRmxhZyA9ICJBdXRvTG9vdFRvZ2dsZSIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGlmIG5vdCBWYWx1ZSB0aGVuCiAgICAgICAgICAgIHN0b3BMb29wKCJBdXRvTG9vdCIpCiAgICAgICAgICAgIHByaW50KCJBdXRvIExvb3QgZGlzYWJsZWQgYnkgdG9nZ2xlIikKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN0YXJ0TG9vdExvb3AoKQogICAgICAgIGVuZAogICAgZW5kCn0pCgotLSBEcm9wZG93biB0byBzZWxlY3Qgd2hhdCB0byBsb290Ck1vdmVtZW50U2VjdGlvbjpEcm9wZG93bih7CiAgICBOYW1lID0gIkF1dG8gTG9vdCBBdXJhIiwKICAgIEZsYWcgPSAiQXV0b0xvb3QiLAogICAgSXRlbXMgPSB7IkN1cnJlbmN5IiwgIktleUNhcmRzIiwgIkl0ZW1zIn0sCiAgICBNdWx0aSA9IHRydWUsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlcykKICAgICAgICAtLSBSZXNldCBzZWxlY3RlZCBsb290IHR5cGVzCiAgICAgICAgc2VsZWN0ZWRMb290VHlwZXMgPSB7IEN1cnJlbmN5ID0gZmFsc2UsIEtleUNhcmRzID0gZmFsc2UsIEl0ZW1zID0gZmFsc2UgfQoKICAgICAgICAtLSBEZWJ1ZzogUHJpbnQgdGhlIFZhbHVlcyB0YWJsZSB0byB1bmRlcnN0YW5kIGl0cyBzdHJ1Y3R1cmUKICAgICAgICBwcmludCgiRHJvcGRvd24gVmFsdWVzOiIsIFZhbHVlcykKCiAgICAgICAgLS0gU2V0IHNlbGVjdGVkIGxvb3QgdHlwZXMgYmFzZWQgb24gVmFsdWVzCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKFZhbHVlcykgZG8KICAgICAgICAgICAgc2VsZWN0ZWRMb290VHlwZXNbaXRlbV0gPSB0cnVlCiAgICAgICAgZW5kCgogICAgICAgIHByaW50KCJTZWxlY3RlZCBMb290IFR5cGVzOiIsIHNlbGVjdGVkTG9vdFR5cGVzKQoKICAgICAgICAtLSBTdGFydCBvciBzdG9wIHRoZSBsb29wIGJhc2VkIG9uIHNlbGVjdGlvbnMgYW5kIHRvZ2dsZSBzdGF0ZQogICAgICAgIGlmIExpYnJhcnkuRmxhZ3MuQXV0b0xvb3RUb2dnbGUgdGhlbgogICAgICAgICAgICBzdG9wTG9vcCgiQXV0b0xvb3QiKQogICAgICAgICAgICBzdGFydExvb3RMb29wKCkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKLS0gSGFuZGxlIGNoYXJhY3RlciByZXNwYXducwpwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyYWN0ZXIpCiAgICBwcmludCgiQ2hhcmFjdGVyIHJlc3Bhd25lZCIpCiAgICBpZiBMaWJyYXJ5LkZsYWdzLkF1dG9Mb290VG9nZ2xlIHRoZW4KICAgICAgICB0YXNrLndhaXQoMikgLS0gV2FpdCBmb3IgY2hhcmFjdGVyIHRvIGZ1bGx5IGxvYWQKICAgICAgICBzdGFydExvb3RMb29wKCkKICAgIGVuZAplbmQpCgoKCgoKCi0tIFByb3hpbWl0eVByb21wdCArIFBhc3N3b3JkIFBhcGVyICsgS2V5cGFkIEVudHJ5IChGaW5hbCkKbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIKbG9jYWwgcm9vbXMgPSB3b3Jrc3BhY2UuR2FtZXBsYXlGb2xkZXIuUm9vbXMKCmxvY2FsIGZ1bmN0aW9uIGZpbmRQYXNzd29yZENvZGUoKQogICAgcHJpbnQoIlNjYW5uaW5nIGZvciBQYXNzd29yZFBhcGVyLi4uIikKICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyb29tOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgIGlmIG9iai5OYW1lID09ICJQYXNzd29yZFBhcGVyIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjb2RlT2JqID0gb2JqOkZpbmRGaXJzdENoaWxkKCJDb2RlIikKICAgICAgICAgICAgICAgIGlmIGNvZGVPYmogdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1cmZhY2VHdWkgPSBjb2RlT2JqOkZpbmRGaXJzdENoaWxkKCJTdXJmYWNlR3VpIikKICAgICAgICAgICAgICAgICAgICBpZiBzdXJmYWNlR3VpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGV4dExhYmVsID0gc3VyZmFjZUd1aTpGaW5kRmlyc3RDaGlsZCgiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGV4dExhYmVsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNvZGUgPSB0ZXh0TGFiZWwuVGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkZldGNoZWQgY29kZToiLCBjb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHByaW50KCJObyBQYXNzd29yZFBhcGVyIG9yIGNvZGUgZm91bmQuIikKICAgIHJldHVybiBuaWwKZW5kCgpsb2NhbCBmdW5jdGlvbiBmaW5kQW5kRmlyZUtleXBhZChjb2RlKQogICAgcHJpbnQoIlNjYW5uaW5nIGZvciBLZXlwYWQgQ2xpY2tEZXRlY3RvcnMuLi4iKQogICAgbG9jYWwga2V5cGFkID0ge30KICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyb29tOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgIGlmIG9iai5OYW1lOm1hdGNoKCJLZXlwYWQlZCIpIG9yIG9iai5OYW1lID09ICJLZXlwYWRCYWNrc3BhY2UiIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGNsaWNrRGV0ZWN0b3IgPSBvYmo6RmluZEZpcnN0Q2hpbGQoIkNsaWNrRGV0ZWN0b3IiKQogICAgICAgICAgICAgICAgaWYgY2xpY2tEZXRlY3RvciB0aGVuCiAgICAgICAgICAgICAgICAgICAga2V5cGFkW29iai5OYW1lXSA9IGNsaWNrRGV0ZWN0b3IKICAgICAgICAgICAgICAgICAgICBwcmludCgiRm91bmQ6Iiwgb2JqLk5hbWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBuZXh0KGtleXBhZCkgPT0gbmlsIHRoZW4KICAgICAgICBwcmludCgiTm8gS2V5cGFkIENsaWNrRGV0ZWN0b3JzIGZvdW5kLiIpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBwcmludCgiRW50ZXJpbmcgY29kZToiLCBjb2RlKQogICAgZm9yIGkgPSAxLCAjY29kZSBkbwogICAgICAgIGxvY2FsIGRpZ2l0ID0gY29kZTpzdWIoaSwgaSkKICAgICAgICBsb2NhbCBrZXlwYWROYW1lID0gIktleXBhZCIgLi4gZGlnaXQKICAgICAgICBpZiBrZXlwYWRba2V5cGFkTmFtZV0gdGhlbgogICAgICAgICAgICBwcmludCgiRmlyaW5nOiIsIGtleXBhZE5hbWUpCiAgICAgICAgICAgIGZpcmVjbGlja2RldGVjdG9yKGtleXBhZFtrZXlwYWROYW1lXSkKICAgICAgICAgICAgd2FpdCgwKSAtLSBNaW5pbWFsIGRlbGF5IGJldHdlZW4ga2V5IHByZXNzZXMKICAgICAgICBlbHNlCiAgICAgICAgICAgIHByaW50KCJLZXlwYWQiIC4uIGRpZ2l0IC4uICIgbm90IGZvdW5kISIpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiB0cnVlCmVuZAoKTW92ZW1lbnRTZWN0aW9uOlRvZ2dsZSh7CiAgICBOYW1lID0gIkluc3RhIERvb3IgT3BlbiIsCiAgICBGbGFnID0gIlByb3hpbWl0eUtleXBhZCIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCn0pOktleWJpbmQoewogICAgRmxhZyA9ICJQcm94aW1pdHlLZXlwYWRLZXliaW5kIiwKICAgIERlZmF1bHQgPSBFbnVtLktleUNvZGUuRSwKICAgIE1vZGUgPSAiSG9sZCIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgcHJpbnQoIi0tLSBTdGFydGluZyBQcm94aW1pdHkgKyBLZXlwYWQgQXV0by1FbnRyeSAtLS0iKQoKICAgICAgICAgICAgLS0gMS4gRmlyZSBuZWFyZXN0IFByb3hpbWl0eVByb21wdCAoRklSU1QgUFJJT1JJVFkpCiAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBsb2NhbCByb290ID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgIGlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBsb2NhbCBjbG9zZXN0UHJvbXB0ID0gbmlsCiAgICAgICAgICAgIGxvY2FsIGNsb3Nlc3REaXN0ID0gbWF0aC5odWdlCiAgICAgICAgICAgIGZvciBfLCByb29tIGluIHBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICBmb3IgXywgcHJvbXB0IGluIHBhaXJzKHJvb206R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBwcm9tcHQ6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBhcmVudCA9IHByb21wdC5QYXJlbnQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5OYW1lID09ICJNYWluIiBvciBwYXJlbnQuTmFtZSA9PSAiUHJveHlQYXJ0IikgYW5kIHBhcmVudDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdCA9IChyb290LlBvc2l0aW9uIC0gcGFyZW50LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRpc3QgPD0gMTIgYW5kIGRpc3QgPCBjbG9zZXN0RGlzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3QgPSBkaXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdFByb21wdCA9IHByb21wdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBjbG9zZXN0UHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgIHByaW50KCJGaXJpbmcgUHJveGltaXR5UHJvbXB0OiIsIGNsb3Nlc3RQcm9tcHQ6R2V0RnVsbE5hbWUoKSkKICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQoY2xvc2VzdFByb21wdCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcHJpbnQoIk5vIFByb3hpbWl0eVByb21wdCBmb3VuZCBuZWFyYnkuIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIC0tIDIuIFNjYW4gZm9yIGNvZGUgYW5kIGVudGVyIGl0IGltbWVkaWF0ZWx5CiAgICAgICAgICAgIGxvY2FsIGNvZGUgPSBmaW5kUGFzc3dvcmRDb2RlKCkKICAgICAgICAgICAgaWYgbm90IGNvZGUgdGhlbiByZXR1cm4gZW5kCgogICAgICAgICAgICAtLSAzLiBTY2FuIGZvciBhbmQgZmlyZSBLZXlwYWQgQ2xpY2tEZXRlY3RvcnMKICAgICAgICAgICAgZmluZEFuZEZpcmVLZXlwYWQoY29kZSkKCiAgICAgICAgICAgIHByaW50KCItLS0gQ29kZSBlbnRyeSBjb21wbGV0ZSAtLS0iKQogICAgICAgIGVuZAogICAgZW5kCn0pCgoKbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgbG9vcFRocmVhZCA9IG5pbAoKLS0gRnVuY3Rpb24gdG8gZmluZCBhbmQgZmlyZSBQcm94aW1pdHlQcm9tcHRzIGluIEVudHJhbmNlcwpsb2NhbCBmdW5jdGlvbiBmaW5kQW5kRmlyZVByb3hpbWl0eVByb21wdHMoKQogICAgbG9jYWwgcm9vbXMgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkdhbWVwbGF5Rm9sZGVyIikgYW5kIHdvcmtzcGFjZS5HYW1lcGxheUZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiUm9vbXMiKQogICAgaWYgbm90IHJvb21zIHRoZW4gcmV0dXJuIGVuZAoKICAgIGZvciBfLCByb29tIGluIGlwYWlycyhyb29tczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGxvY2FsIGVudHJhbmNlcyA9IHJvb206RmluZEZpcnN0Q2hpbGQoIkVudHJhbmNlcyIpCiAgICAgICAgaWYgZW50cmFuY2VzIHRoZW4KICAgICAgICAgICAgZm9yIF8sIGVudHJhbmNlIGluIGlwYWlycyhlbnRyYW5jZXM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHJvb3QgPSBlbnRyYW5jZTpGaW5kRmlyc3RDaGlsZCgiUm9vdCIpCiAgICAgICAgICAgICAgICBpZiByb290IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcm9tcHQgPSByb290OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlByb3hpbWl0eVByb21wdCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcHJvbXB0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS0gRmlyZSB0aGUgUHJveGltaXR5UHJvbXB0CiAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQocHJvbXB0KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBsb29wVGhyZWFkID0gbmlsCgotLSBGdW5jdGlvbiB0byBmaW5kIGFuZCBmaXJlIFByb3hpbWl0eVByb21wdHMgaW4gRW50cmFuY2VzCmxvY2FsIGZ1bmN0aW9uIGZpbmRBbmRGaXJlUHJveGltaXR5UHJvbXB0cygpCiAgICBsb2NhbCByb29tcyA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiR2FtZXBsYXlGb2xkZXIiKSBhbmQgd29ya3NwYWNlLkdhbWVwbGF5Rm9sZGVyOkZpbmRGaXJzdENoaWxkKCJSb29tcyIpCiAgICBpZiBub3Qgcm9vbXMgdGhlbiByZXR1cm4gZW5kCgogICAgZm9yIF8sIHJvb20gaW4gaXBhaXJzKHJvb21zOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgbG9jYWwgZW50cmFuY2VzID0gcm9vbTpGaW5kRmlyc3RDaGlsZCgiRW50cmFuY2VzIikKICAgICAgICBpZiBlbnRyYW5jZXMgdGhlbgogICAgICAgICAgICBmb3IgXywgZW50cmFuY2UgaW4gaXBhaXJzKGVudHJhbmNlczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgcm9vdCA9IGVudHJhbmNlOkZpbmRGaXJzdENoaWxkKCJSb290IikKICAgICAgICAgICAgICAgIGlmIHJvb3QgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHByb21wdCA9IHJvb3Q6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiUHJveGltaXR5UHJvbXB0IikKICAgICAgICAgICAgICAgICAgICBpZiBwcm9tcHQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLSBGaXJlIHRoZSBQcm94aW1pdHlQcm9tcHQKICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChwcm9tcHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCk1vdmVtZW50U2VjdGlvbjpUb2dnbGUoewogICAgTmFtZSA9ICJGb3JjZSBEb29yIE9wZW4gW0dvb2QgZm9yIGF1dG9wbGF5c10iLAogICAgRmxhZyA9ICJEb29yIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICAtLSBTdGFydCB0aGUgbG9vcCBpZiB0aGUgdG9nZ2xlIGlzIGVuYWJsZWQKICAgICAgICAgICAgbG9vcFRocmVhZCA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgd2hpbGUgTGlicmFyeS5GbGFncy5Eb29yIGRvCiAgICAgICAgICAgICAgICAgICAgZmluZEFuZEZpcmVQcm94aW1pdHlQcm9tcHRzKCkKICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wMSkgLS0gQWRqdXN0IGRlbGF5IGFzIG5lZWRlZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIENhbmNlbCB0aGUgbG9vcCBpZiB0aGUgdG9nZ2xlIGlzIGRpc2FibGVkCiAgICAgICAgICAgIGlmIGxvb3BUaHJlYWQgdGhlbgogICAgICAgICAgICAgICAgdGFzay5jYW5jZWwobG9vcFRocmVhZCkKICAgICAgICAgICAgICAgIGxvb3BUaHJlYWQgPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQpsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGNvbm5lY3Rpb24gPSBuaWwKCi0tIFdhaXQgZm9yIHRoZSBQbGF5ZXJHdWkgdG8gbG9hZApsb2NhbCBwbGF5ZXJHdWkgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQpsb2NhbCBtYWluR3VpID0gcGxheWVyR3VpOldhaXRGb3JDaGlsZCgiTWFpbiIpCmxvY2FsIGFmdGVyRGVhdGhHdWkgPSBtYWluR3VpOldhaXRGb3JDaGlsZCgiQWZ0ZXJEZWF0aCIpCgotLSBGdW5jdGlvbiB0byBmaXJlIHRoZSBQbGF5QWdhaW4gZXZlbnQgb25jZQpsb2NhbCBmdW5jdGlvbiBmaXJlUGxheUFnYWluT25jZSgpCiAgICBsb2NhbCBwbGF5QWdhaW5FdmVudCA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJFdmVudHMiKSBhbmQgUmVwbGljYXRlZFN0b3JhZ2UuRXZlbnRzOkZpbmRGaXJzdENoaWxkKCJQbGF5QWdhaW4iKQogICAgaWYgcGxheUFnYWluRXZlbnQgdGhlbgogICAgICAgIHBsYXlBZ2FpbkV2ZW50OkZpcmVTZXJ2ZXIoKQogICAgZWxzZQogICAgICAgIHdhcm4oIlBsYXlBZ2FpbiBldmVudCBub3QgZm91bmQgaW4gUmVwbGljYXRlZFN0b3JhZ2UuRXZlbnRzIikKICAgIGVuZAplbmQKCi0tIFRvZ2dsZSBmb3IgQXV0by1SZXRyeQpNb3ZlbWVudFNlY3Rpb246VG9nZ2xlKHsKICAgIE5hbWUgPSAiQXV0byBSZXRyeSIsCiAgICBGbGFnID0gIlJldHJ5IiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICAtLSBDb25uZWN0IHRvIHRoZSBWaXNpYmxlIHByb3BlcnR5IGNoYW5nZSBzaWduYWwKICAgICAgICAgICAgY29ubmVjdGlvbiA9IGFmdGVyRGVhdGhHdWk6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCJWaXNpYmxlIik6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBhZnRlckRlYXRoR3VpLlZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgICAgIGZpcmVQbGF5QWdhaW5PbmNlKCkKICAgICAgICAgICAgICAgICAgICAtLSBEaXNjb25uZWN0IGFmdGVyIGZpcmluZyBvbmNlCiAgICAgICAgICAgICAgICAgICAgaWYgY29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZWxzZQogICAgICAgICAgICAtLSBEaXNjb25uZWN0IHRoZSBzaWduYWwgaWYgdGhlIHRvZ2dsZSBpcyBkaXNhYmxlZAogICAgICAgICAgICBpZiBjb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCn0pCmVuZAoKTGlicmFyeTpOb3RpZmljYXRpb24oIkxvYWRlZCEiLCAiTWVudSB0b29rICIuLnN0cmluZy5mb3JtYXQoIiUuNGYiLCBvcy5jbG9jaygpIC0gTG9hZFRpY2spLi4iIHNlY29uZHMgdG8gbG9hZCIsIDUpCgpnZXRnZW52KCkuTGlicmFyeSA9IExpYnJhcnkKcmV0dXJuIExpYnJhcnk='))()
